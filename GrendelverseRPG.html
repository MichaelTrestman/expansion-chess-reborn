<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>GrendelverseRPG</title>
<style title="Twine CSS">@keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes rumble{25%{top:-0.1em}75%{top:.1em}0%,to{top:0px}}@keyframes shudder{25%{left:.1em}75%{left:-0.1em}0%,to{left:0px}}@keyframes buoy{25%{top:.25em}75%{top:-0.25em}0%,to{top:0px}}@keyframes sway{25%{left:.25em}75%{left:-0.25em}0%,to{left:0px}}@keyframes pulse{0%{transform:scale(0, 0)}20%{transform:scale(1.2, 1.2)}40%{transform:scale(0.9, 0.9)}60%{transform:scale(1.05, 1.05)}80%{transform:scale(0.925, 0.925)}to{transform:scale(1, 1)}}@keyframes zoom-in{0%{transform:scale(0, 0)}to{transform:scale(1, 1)}}@keyframes shudder-in{0%,to{transform:translateX(0em)}5%,25%,45%{transform:translateX(-1em)}15%,35%,55%{transform:translateX(1em)}65%{transform:translateX(-0.6em)}75%{transform:translateX(0.6em)}85%{transform:translateX(-0.2em)}95%{transform:translateX(0.2em)}}@keyframes rumble-in{0%,to{transform:translateY(0em)}5%,25%,45%{transform:translateY(-1em)}15%,35%,55%{transform:translateY(1em)}65%{transform:translateY(-0.6em)}75%{transform:translateY(0.6em)}85%{transform:translateY(-0.2em)}95%{transform:translateY(0.2em)}}@keyframes fidget{0%,8.1%,82.1%,31.1%,38.1%,44.1%,40.1%,47.1%,74.1%,16.1%,27.1%,72.1%,24.1%,95.1%,6.1%,36.1%,20.1%,4.1%,91.1%,14.1%,87.1%,to{left:0px;top:0px}8%,82%,31%,38%,44%{left:-1px}40%,47%,74%,16%,27%{left:1px}72%,24%,95%,6%,36%{top:-1px}20%,4%,91%,14%,87%{top:1px}}@keyframes slide-right{0%{transform:translateX(-100vw)}}@keyframes slide-left{0%{transform:translateX(100vw)}}@keyframes slide-up{0%{transform:translateY(100vh)}}@keyframes slide-down{0%{transform:translateY(-100vh)}}@keyframes fade-right{0%{opacity:0;transform:translateX(-1em)}to{opacity:1}}@keyframes fade-left{0%{opacity:0;transform:translateX(1em)}to{opacity:1}}@keyframes fade-up{0%{opacity:0;transform:translateY(1em)}to{opacity:1}}@keyframes fade-down{0%{opacity:0;transform:translateY(-1em)}to{opacity:1}}@keyframes flicker{0%,29%,31%,63%,65%,77%,79%,86%,88%,91%,93%{opacity:0}30%{opacity:.2}64%{opacity:.4}78%{opacity:.6}87%{opacity:.8}92%,to{opacity:1}}@keyframes blur{0%{filter:blur(2rem);opacity:0}25%{opacity:1}to{filter:blur(0rem);opacity:1}}.dom-debug-mode tw-story,.dom-debug-mode tw-passage,.dom-debug-mode tw-sidebar,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{outline:1px solid #f5a3da;min-height:32px;display:block !important}.dom-debug-mode tw-story::before,.dom-debug-mode tw-passage::before,.dom-debug-mode tw-sidebar::before,.dom-debug-mode tw-include::before,.dom-debug-mode tw-hook::before,.dom-debug-mode tw-expression::before,.dom-debug-mode tw-link::before,.dom-debug-mode tw-dialog::before,.dom-debug-mode tw-columns::before,.dom-debug-mode tw-column::before,.dom-debug-mode tw-align::before{position:absolute;top:0;left:0;height:16px;background-color:#f5a3da;color:#000;font-size:16px;font-weight:normal;font-style:normal;font-family:monospace;display:inline-block;line-height:100%;white-space:pre;z-index:999997}.dom-debug-mode tw-story:hover,.dom-debug-mode tw-passage:hover,.dom-debug-mode tw-sidebar:hover,.dom-debug-mode tw-include:hover,.dom-debug-mode tw-hook:hover,.dom-debug-mode tw-expression:hover,.dom-debug-mode tw-link:hover,.dom-debug-mode tw-dialog:hover,.dom-debug-mode tw-columns:hover,.dom-debug-mode tw-column:hover,.dom-debug-mode tw-align:hover{outline:1px solid #fc9}.dom-debug-mode tw-story:hover::before,.dom-debug-mode tw-passage:hover::before,.dom-debug-mode tw-sidebar:hover::before,.dom-debug-mode tw-include:hover::before,.dom-debug-mode tw-hook:hover::before,.dom-debug-mode tw-expression:hover::before,.dom-debug-mode tw-link:hover::before,.dom-debug-mode tw-dialog:hover::before,.dom-debug-mode tw-columns:hover::before,.dom-debug-mode tw-column:hover::before,.dom-debug-mode tw-align:hover::before{background-color:#fc9;transition:background-color 1s}.dom-debug-mode tw-passage,.dom-debug-mode tw-include,.dom-debug-mode tw-hook,.dom-debug-mode tw-expression,.dom-debug-mode tw-link,.dom-debug-mode tw-dialog,.dom-debug-mode tw-columns,.dom-debug-mode tw-column,.dom-debug-mode tw-align{padding:1em;margin:0}.dom-debug-mode tw-story::before{content:'<tw-story tags="' attr(tags) '">'}.dom-debug-mode tw-passage::before{top:-16px;content:'<tw-passage tags="' attr(tags) '">'}.dom-debug-mode tw-sidebar::before{top:-16px;content:"<tw-sidebar>"}.dom-debug-mode tw-hook::before{content:'<tw-hook name="' attr(name) '">'}.dom-debug-mode tw-expression::before{content:'<tw-expression name="' attr(name) '">'}.dom-debug-mode tw-link::before{content:'<tw-link name="' attr(name) '">'}.dom-debug-mode tw-dialog::before{content:"<tw-dialog>"}.dom-debug-mode tw-columns::before{content:"<tw-columns>"}.dom-debug-mode tw-column::before{content:"<tw-column>"}.dom-debug-mode tw-align::before{content:"<tw-align>"}.dom-debug-mode tw-include::before{content:'<tw-include type="' attr(type) '" name="' attr(name) '">'}tw-open-button[goto]{display:none}.debug-mode tw-open-button[replay],.debug-mode tw-open-button[goto]{display:inline}.debug-mode tw-expression{display:inline-block !important}.debug-mode tw-expression[type=variable]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"$" attr(name)}.debug-mode tw-expression[type=tempVariable]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"_" attr(name)}.debug-mode tw-expression[return=boolean]{background-color:rgba(179,179,179,.2)}.debug-mode tw-expression[return=array]{background-color:rgba(255,102,102,.2)}.debug-mode tw-expression[return=dataset]{background-color:rgba(255,128,0,.2)}.debug-mode tw-expression[return=number]{background-color:rgba(255,179,102,.2)}.debug-mode tw-expression[return=datamap]{background-color:rgba(255,255,102,.2)}.debug-mode tw-expression[return=changer]{background-color:rgba(179,255,102,.2)}.debug-mode tw-expression[return=lambda]{background-color:rgba(102,255,102,.2)}.debug-mode tw-expression[return=hookname]{background-color:rgba(102,255,204,.2)}.debug-mode tw-expression[return=string]{background-color:rgba(102,255,255,.2)}.debug-mode tw-expression[return=datatype]{background-color:rgba(102,153,255,.2)}.debug-mode tw-expression[return=gradient],.debug-mode tw-expression[return=colour]{background-color:rgba(204,102,255,.2)}.debug-mode tw-expression[return=instant],.debug-mode tw-expression[return=macro]{background-color:rgba(240,117,199,.2)}.debug-mode tw-expression[return=command]{background-color:rgba(153,153,255,.2)}.debug-mode tw-expression.false{background-color:rgba(255,0,0,.2) !important}.debug-mode tw-expression[type=macro]::before{content:"(" attr(name) ":)";padding:0 .5rem;font-size:1rem;vertical-align:middle;line-height:normal;background-color:inherit;border:1px solid rgba(255,255,255,.5)}.debug-mode tw-expression[title]:not([title=""]){cursor:help}.debug-mode tw-hook{background-color:rgba(0,85,255,.1) !important}.debug-mode tw-hook::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"["}.debug-mode tw-hook::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"]"}.debug-mode tw-hook[name]::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"]<" attr(name) "|"}.debug-mode tw-pseudo-hook{background-color:rgba(255,170,0,.1) !important}.debug-mode tw-collapsed::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"{"}.debug-mode tw-collapsed::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"}"}.debug-mode tw-verbatim::before,.debug-mode tw-verbatim::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:"`"}.debug-mode tw-align[style*="text-align: center"]{background:linear-gradient(to right, hsla(14, 100%, 87%, 0) 0%, hsla(14, 100%, 87%, 0.25) 50%, hsla(14, 100%, 87%, 0) 100%)}.debug-mode tw-align[style*="text-align: left"]{background:linear-gradient(to right, hsla(14, 100%, 87%, 0.25) 0%, hsla(14, 100%, 87%, 0) 100%)}.debug-mode tw-align[style*="text-align: right"]{background:linear-gradient(to right, hsla(14, 100%, 87%, 0) 0%, hsla(14, 100%, 87%, 0.25) 100%)}.debug-mode tw-column{background-color:rgba(189,228,255,.2)}.debug-mode tw-enchantment{animation:enchantment .5s infinite;border:1px solid}.debug-mode tw-link::after,.debug-mode tw-broken-link::after{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:attr(passage-name)}.debug-mode tw-include{background-color:rgba(204,128,51,.1)}.debug-mode tw-include::before{font-size:.8rem;padding-left:.2rem;padding-right:.2rem;vertical-align:top;content:attr(type) ' "' attr(name) '"'}.debug-dialogs tw-backdrop:not(.eval-replay):not(.harlowe-crash){pointer-events:none;opacity:.1}tw-eval-replay tw-eval-code,tw-eval-replay tw-eval-explanation{max-height:20vh;overflow:auto;margin:10px auto}tw-eval-replay tw-eval-code{display:block;font-family:monospace;padding-bottom:1ex;border-bottom:2px solid gray}tw-eval-replay tw-eval-explanation{display:block;text-align:center}tw-eval-replay tw-eval-explanation>code{white-space:pre-wrap}tw-eval-replay tw-eval-explanation>code.from-block{width:40%;display:inline-block;text-align:left;max-height:4em;overflow-wrap:anywhere;overflow-y:scroll}tw-eval-replay tw-eval-explanation>code.from-block~.to-desc{width:calc(40% - 2em);margin-left:2em;display:inline-block}tw-eval-replay tw-eval-explanation>code.from-block+span::after{content:"..."}tw-eval-replay tw-eval-explanation>code.from-inline{text-align:right}tw-eval-replay tw-eval-explanation>:nth-child(2){white-space:pre}tw-eval-replay tw-eval-explanation>.to-desc{text-align:left}tw-eval-replay tw-eval-explanation>table{width:100%;margin-top:1em}tw-eval-replay tw-eval-explanation>table td{white-space:pre-wrap !important;word-wrap:anywhere}tw-eval-replay tw-eval-reason{text-align:center;font-size:80%;font-style:italic;display:block}tw-eval-replay tw-eval-it{text-align:center;font-size:80%;display:block}tw-eval-replay tw-dialog-links{display:-ms-flexbox;display:flex;-ms-flex-pack:distribute;justify-content:space-around}@keyframes enchantment{0%,to{border-color:#ffb366}50%{border-color:#6fc}}tw-debugger{position:fixed;box-sizing:border-box;bottom:0;right:0;z-index:999999;min-width:14em;min-height:1em;padding:0em .5em .5em 1em;font-size:1.25em;font-family:sans-serif;color:#262626;background-color:#fff;border-left:solid #262626 2px;border-top:solid #262626 2px;border-top-left-radius:.5em;opacity:1}tw-debugger.fade-panel:not(:hover){opacity:.33}tw-debugger.theme-dark{color:#d9d9d9;background-color:#000}tw-debugger.theme-dark{border-color:#d9d9d9 rgba(0,0,0,0) rgba(0,0,0,0) #d9d9d9}tw-debugger select{margin-right:1em;width:12em}tw-debugger button,tw-debugger tw-link{border-radius:3px;border:solid #999 1px;margin:auto 4px;color:#262626;background-color:#fff;cursor:pointer}tw-debugger button.enabled,tw-debugger tw-link.enabled{color:#000;background-color:#d9d9d9;box-shadow:inset #999 3px 5px .5em}tw-debugger.theme-dark button,tw-debugger.theme-dark tw-link{color:#d9d9d9;background-color:#000;border-color:#666}tw-debugger.theme-dark button.enabled,tw-debugger.theme-dark tw-link.enabled{color:#e6e6e6;background-color:#424242;box-shadow:inset #666 3px 5px .5em}tw-debugger button{font-size:1em;overflow-x:hidden;text-overflow:ellipsis;white-space:pre}tw-debugger tw-link{font-size:1.25em;border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}tw-debugger tw-link:hover{border-color:#262626;color:#262626}tw-debugger.theme-dark tw-link:hover{border-color:#d9d9d9;color:#d9d9d9}tw-debugger tw-dialog{background-color:#fff;color:#000;font-size:1.25em}tw-debugger.theme-dark tw-dialog{background-color:#000;color:#e6e6e6}tw-debugger .panel{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;position:absolute;bottom:100%;left:-2px;right:0;padding:1em;overflow-y:scroll;overflow-x:hidden;border:inherit;box-sizing:content-box;background-color:#fff;border-bottom:solid #999 2px;border-top-left-radius:.5em;border-bottom-left-radius:.5em;font-size:.8em}tw-debugger .panel:empty,tw-debugger .panel[hidden]{display:none}tw-debugger.theme-dark .panel{background-color:#000;border-bottom-color:#666}tw-debugger .panel-source .panel-row-buttons{width:2rem}tw-debugger .panel-source .source-tags{width:20%;font-style:italic}tw-debugger .panel-row-source td{font-family:monospace;font-size:1rem;white-space:pre-wrap;overflow-wrap:anywhere;max-height:8rem;padding:1rem}tw-debugger .panel-rows{width:100%;overflow-x:scroll}tw-debugger .panel-rows>*{display:table-row}tw-debugger .panel-rows>div:nth-of-type(2n){background-color:#e6e6e6}tw-debugger .panel-tools .panel-rows>*,tw-debugger .panel-options .panel-rows>*{margin-top:.4rem;display:block}tw-debugger.theme-dark .panel-rows>div:nth-of-type(2n){background-color:#212121}tw-debugger .panel-row-buttons{text-align:right}tw-debugger .panel-variables .panel-rows:empty::before{content:"~ No variables ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-enchantments .panel-rows:empty::before{content:"~ No enchantments ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-errors .panel-rows:empty::before{content:"~ No errors... for now. ~";font-style:italic;color:#575757;text-align:center}tw-debugger .panel-errors .panel-rows:empty+.panel-errors-bottom{display:none}tw-debugger.theme-dark .panel-variables .panel-rows:empty::before,tw-debugger.theme-dark .panel-enchantments .panel-rows:empty::before,tw-debugger.theme-dark .panel-errors .panel-rows:empty::before{color:#a8a8a8}tw-debugger .panel-rows:empty+.panel-variables-bottom{display:none}tw-debugger th[data-col]{text-decoration:underline;cursor:pointer}tw-debugger th[data-col][data-order=asc]::after{content:"↓"}tw-debugger th[data-col][data-order=desc]::after{content:"↑"}tw-debugger .panel-storylets:not(.panel-exclusive) .storylet-exclusive,tw-debugger .panel-storylets:not(.panel-urgent) .storylet-urgent{display:none}tw-debugger .storylet-exclusive,tw-debugger .storylet-urgent,tw-debugger .storylet-open{text-align:center}tw-debugger .panel-variables-bottom{padding-top:5px}tw-debugger .enchantment-row{min-height:1.5em}tw-debugger .variable-path{opacity:.4}tw-debugger .temporary-variable-scope,tw-debugger .enchantment-local{font-family:sans-serif;font-weight:normal;opacity:.8;font-size:.75em}tw-debugger .temporary-variable-scope:not(:empty)::before,tw-debugger .enchantment-local:not(:empty)::before{content:" in "}tw-debugger .variable-name,tw-debugger .enchantment-name{font-family:monospace;font-weight:bold}tw-debugger .variable-type{color:#575757;font-weight:normal;text-overflow:ellipsis;overflow:hidden;max-width:10em}tw-debugger.theme-dark .variable-type{color:#a8a8a8}tw-debugger .error-row{display:table-row;background-color:rgba(230,101,204,.3)}tw-debugger .error-row:nth-of-type(2n){background-color:rgba(237,145,219,.3)}tw-debugger .error-row>*{display:table-cell;padding:.25em .5em}tw-debugger .error-row .error-message[title]:not([title=""]){cursor:help}tw-debugger .error-row .error-passage{color:#575757}tw-debugger.theme-dark .error-row .error-passage{color:#a8a8a8}tw-debugger .storylet-row{background-color:rgba(193,240,225,.3)}tw-debugger .storylet-row:nth-child(2n){background-color:rgba(152,231,204,.3)}tw-debugger .storylet-row.storylet-closed{font-style:italic;background-color:#fff}tw-debugger .storylet-row.storylet-closed:nth-child(2n){background-color:#e6e6e6}tw-debugger .storylet-row.storylet-closed>:not(.storylet-lambda){opacity:.6}.storylet-error tw-debugger .storylet-row{background-color:rgba(230,101,204,.3)}.storylet-error tw-debugger .storylet-row:nth-child(2n){background-color:rgba(237,145,219,.3)}tw-debugger .storylet-row .storylet-name,tw-debugger .storylet-row .storylet-value{display:inline-block;width:50%}tw-debugger .storylet-row .storylet-lambda{font-family:monospace;font-size:1rem;white-space:pre-wrap;overflow-wrap:anywhere}tw-debugger.theme-dark .storylet-row.storylet-closed{background-color:#000}tw-debugger.theme-dark .storylet-row.storylet-closed:nth-child(2n){background-color:#212121}tw-debugger .tabs{padding-bottom:.5em}tw-debugger .tab{border-radius:0px 0px .5em .5em;border-top:none;top:-2px}tw-debugger .resizer-h{position:absolute;height:14em;border-left:2px solid #999;border-right:2px solid #999;top:10px;left:4px;width:8px;cursor:ew-resize}tw-debugger.theme-dark .resizer-h{border-color:rgba(0,0,0,0) #666}tw-debugger .resizer-v{position:absolute;height:8px;border-top:2px solid #999;border-bottom:2px solid #999;margin-bottom:4px;top:4px;left:10px;width:95%;cursor:ns-resize;box-sizing:border-box}tw-debugger.theme-dark .resizer-v{border-color:#666 rgba(0,0,0,0)}tw-debugger mark{color:inherit;background-color:rgba(101,230,230,.3) !important}tw-dialog{z-index:999997;border:#fff solid 2px;padding:2em;color:#fff;background-color:#000;display:block}@media(min-width: 576px){tw-dialog{max-width:50vw}}tw-dialog input[type=text]{font-size:inherit;width:100%;border:solid #fff !important}tw-dialog-links{text-align:right;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end}tw-backdrop{z-index:999996;position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.8);display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center}tw-backdrop~tw-backdrop{display:none}tw-link,.enchantment-link{cursor:pointer;color:#4169e1;font-weight:bold;text-decoration:none;transition:color .2s ease-in-out}tw-passage [style^=color] tw-link:not(:hover),tw-passage [style*=" color"] tw-link:not(:hover),tw-passage [style^=color][hover=true] tw-link:hover,tw-passage [style*=" color"][hover=true] tw-link:hover,tw-passage [style^=color] .enchantment-link:not(:hover),tw-passage [style*=" color"] .enchantment-link:not(:hover),tw-passage [style^=color][hover=true] .enchantment-link:hover,tw-passage [style*=" color"][hover=true] .enchantment-link:hover{color:inherit}tw-link:hover,.enchantment-link:hover{color:#00bfff}tw-link:active,.enchantment-link:active{color:#dd4b39}.visited{color:#6941e1}tw-passage [style^=color] .visited:not(:hover),tw-passage [style*=" color"] .visited:not(:hover),tw-passage [style^=color][hover=true] .visited:hover,tw-passage [style*=" color"][hover=true] .visited:hover{color:inherit}.visited:hover{color:#e3e}tw-broken-link{color:#933;border-bottom:2px solid #933;cursor:not-allowed}tw-passage [style^=color] tw-broken-link:not(:hover),tw-passage [style*=" color"] tw-broken-link:not(:hover),tw-passage [style^=color][hover=true] tw-broken-link:hover,tw-passage [style*=" color"][hover=true] tw-broken-link:hover{color:inherit}tw-link.enchantment-mouseover,.link.enchantment-mouseover,tw-expression.enchantment-mouseover>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;border-bottom:2px dashed #999}tw-link.enchantment-mouseover:hover,tw-link.enchantment-mouseover:active,.link.enchantment-mouseover:hover,.link.enchantment-mouseover:active,tw-expression.enchantment-mouseover>tw-link:hover,tw-expression.enchantment-mouseover>tw-link:active{color:inherit}tw-link.enchantment-mouseover.enchantment-button,.link.enchantment-mouseover.enchantment-button,tw-expression.enchantment-mouseover>tw-link.enchantment-button{border-style:dashed}tw-link.enchantment-mouseout,.link.enchantment-mouseout,tw-expression.enchantment-mouseout>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;border:rgba(64,149,191,.6) 1px solid;border-radius:.2em}tw-link.enchantment-mouseout:hover,tw-link.enchantment-mouseout:active,.link.enchantment-mouseout:hover,.link.enchantment-mouseout:active,tw-expression.enchantment-mouseout>tw-link:hover,tw-expression.enchantment-mouseout>tw-link:active{color:inherit}tw-link.enchantment-mouseout:hover,.link.enchantment-mouseout:hover,tw-expression.enchantment-mouseout>tw-link:hover{background-color:rgba(175,197,207,.75);border:rgba(0,0,0,0) 1px solid}tw-link.enchantment-dblclick,.link.enchantment-dblclick,tw-expression.enchantment-dblclick>tw-link{color:inherit;font-weight:inherit;transition:none;cursor:inherit;cursor:pointer;border:2px solid #999;border-radius:0}tw-link.enchantment-dblclick:hover,tw-link.enchantment-dblclick:active,.link.enchantment-dblclick:hover,.link.enchantment-dblclick:active,tw-expression.enchantment-dblclick>tw-link:hover,tw-expression.enchantment-dblclick>tw-link:active{color:inherit}tw-link.enchantment-dblclick:active,.link.enchantment-dblclick:active,tw-expression.enchantment-dblclick>tw-link:active{background-color:#999}tw-link.enchantment-button,.link.enchantment-button,.enchantment-button:not(.link) tw-link,.enchantment-button:not(.link) .link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block}.enchantment-button{display:block}.enchantment-clickblock{cursor:pointer;width:100%;height:100%;display:block}.enchantment-clickblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;color:rgba(65,105,225,.5);transition:color .2s ease-in-out}.enchantment-clickblock>:not(tw-enchantment):hover::after{color:rgba(0,191,255,.5)}.enchantment-clickblock>:not(tw-enchantment):active::after{color:rgba(222,78,59,.5)}.enchantment-clickblock>:not(tw-enchantment)::after{box-shadow:inset 0 0 0 .5vmax}.enchantment-clickblock>tw-passage::after,.enchantment-clickblock>tw-sidebar::after{box-shadow:0 0 0 .5vmax}.enchantment-mouseoverblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:2px dashed #999}.enchantment-mouseoutblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;border:rgba(64,149,191,.6) 2px solid}.enchantment-mouseoutblock:hover>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;background-color:rgba(175,197,207,.75);border:rgba(0,0,0,0) 2px solid;border-radius:.2em}.enchantment-dblclickblock>:not(tw-enchantment)::after{content:"";width:100%;height:100%;top:0;left:0;display:block;box-sizing:border-box;position:absolute;pointer-events:none;cursor:pointer;border:2px solid #999}tw-dialog-links{padding-top:1.5em}tw-dialog-links tw-link{border-radius:16px;border-style:solid;border-width:2px;text-align:center;padding:0px 8px;display:block;display:inline-block}html{margin:0;height:100%;overflow-x:hidden}*,:before,:after{position:relative;box-sizing:inherit}body{margin:0;height:100%}tw-storydata{display:none}tw-story{display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;font:100% Georgia,serif;box-sizing:border-box;width:100%;min-height:100%;font-size:1.5em;line-height:1.5em;padding:5% 5%;overflow:hidden;background-color:#000;color:#fff}tw-story [style*=content-box] *{box-sizing:border-box}@media(min-width: 576px){tw-story{padding:5% 20%}}tw-story tw-consecutive-br{display:block;height:1.6ex;visibility:hidden}tw-story select{background-color:rgba(0,0,0,0);font:inherit;border-style:solid;padding:2px}tw-story select:not([disabled]){color:inherit}tw-story textarea{resize:none;background-color:rgba(0,0,0,0);font:inherit;color:inherit;border-style:none;padding:2px}tw-story input[type=text]{background-color:rgba(0,0,0,0);font:inherit;color:inherit;border-style:none}tw-story input[type=checkbox]{transform:scale(1.5);margin:0 .5em .5em .5em;vertical-align:middle}tw-story tw-noscript{animation:appear .8s}tw-passage{display:block}tw-sidebar{text-align:center;display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}@media(min-width: 576px){tw-sidebar{left:-5em;width:3em;position:absolute;-ms-flex-direction:column;flex-direction:column}tw-enchantment[style*=width]>tw-sidebar{width:inherit}}tw-icon{display:inline-block;margin:.5em 0;font-size:66px;font-family:"Verdana",sans-serif}tw-icon[alt]{opacity:.2;cursor:pointer}tw-icon[alt]:hover{opacity:.4}tw-icon[data-label]::after{font-weight:bold;content:attr(data-label);font-size:20px;bottom:-20px;left:-50%;white-space:nowrap}tw-meter{display:block}tw-hook:empty,tw-expression:empty{display:none}tw-error{display:inline-block;border-radius:.2em;padding:.2em;font-size:1rem;cursor:help;white-space:pre-wrap}tw-error.error{background-color:rgba(223,58,190,.6);color:#fff}tw-error.warning{background-color:rgba(223,140,58,.6);color:#fff;display:none}.debug-mode tw-error.warning{display:inline}tw-error-explanation{display:block;font-size:.8rem;line-height:1rem}tw-open-button,tw-folddown{cursor:pointer;line-height:0em;border-radius:4px;border:1px solid rgba(255,255,255,.5);font-size:.8rem;margin:0 .2rem;padding:3px;white-space:pre}tw-folddown::after{content:"▶"}tw-folddown.open::after{content:"▼"}tw-open-button[replay]{display:none}tw-error tw-open-button,tw-eval-replay tw-open-button{display:inline !important}tw-open-button::after{content:attr(label)}tw-notifier{border-radius:.2em;padding:.2em;font-size:1rem;background-color:rgba(223,182,58,.4);display:none}.debug-mode tw-notifier{display:inline}tw-notifier::before{content:attr(message)}tw-colour{border:1px solid #000;display:inline-block;width:1em;height:1em}tw-enchantment:empty{display:none}h1{font-size:3em}h2{font-size:2.25em}h3{font-size:1.75em}h1,h2,h3,h4,h5,h6{line-height:1em;margin:.3em 0 .6em 0}pre{font-size:1rem;line-height:initial}small{font-size:70%}big{font-size:120%}mark{color:rgba(0,0,0,.6);background-color:#ff9}ins{color:rgba(0,0,0,.6);background-color:rgba(255,242,204,.5);border-radius:.5em;box-shadow:0em 0em .2em #ffe699;text-decoration:none}center{text-align:center;margin:0 auto;width:60%}blink{text-decoration:none;animation:fade-in-out 1s steps(1, end) infinite alternate}tw-align{display:block}tw-columns{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:justify;justify-content:space-between}.transition-in{animation:appear 0ms step-start}.transition-out{animation:appear 0ms step-end}[data-t8n^=dissolve].transition-in,[data-t8n=fade].transition-in{animation:appear .8s}[data-t8n^=dissolve].transition-out,[data-t8n=fade].transition-out{animation:appear .8s reverse}[data-t8n^=shudder].transition-in{display:inline-block !important;animation:shudder-in .8s}[data-t8n^=shudder].transition-out{display:inline-block !important;animation:shudder-in .8s reverse}[data-t8n^=rumble].transition-in{display:inline-block !important;animation:rumble-in .8s}[data-t8n^=rumble].transition-out{display:inline-block !important;animation:rumble-in .8s reverse}[data-t8n^=pulse].transition-in{animation:pulse .8s;display:inline-block !important}[data-t8n^=pulse].transition-out{animation:pulse .8s reverse;display:inline-block !important}[data-t8n^=zoom].transition-in{animation:zoom-in .8s;display:inline-block !important}[data-t8n^=zoom].transition-out{animation:zoom-in .8s reverse;display:inline-block !important}[data-t8n^=blur].transition-in{animation:blur .8s;display:inline-block !important}[data-t8n^=blur].transition-out{animation:blur .8s reverse;display:inline-block !important}[data-t8n^=slideleft].transition-in{animation:slide-left .8s;display:inline-block !important}[data-t8n^=slideleft].transition-out{animation:slide-right .8s reverse;display:inline-block !important}[data-t8n^=slideright].transition-in{animation:slide-right .8s;display:inline-block !important}[data-t8n^=slideright].transition-out{animation:slide-left .8s reverse;display:inline-block !important}[data-t8n^=slideup].transition-in{animation:slide-up .8s;display:inline-block !important}[data-t8n^=slideup].transition-out{animation:slide-down .8s reverse;display:inline-block !important}[data-t8n^=slidedown].transition-in{animation:slide-down .8s;display:inline-block !important}[data-t8n^=slidedown].transition-out{animation:slide-up .8s reverse;display:inline-block !important}[data-t8n^=fadeleft].transition-in{animation:fade-left .8s;display:inline-block !important}[data-t8n^=fadeleft].transition-out{animation:fade-right .8s reverse;display:inline-block !important}[data-t8n^=faderight].transition-in{animation:fade-right .8s;display:inline-block !important}[data-t8n^=faderight].transition-out{animation:fade-left .8s reverse;display:inline-block !important}[data-t8n^=fadeup].transition-in{animation:fade-up .8s;display:inline-block !important}[data-t8n^=fadeup].transition-out{animation:fade-down .8s reverse;display:inline-block !important}[data-t8n^=fadedown].transition-in{animation:fade-down .8s;display:inline-block !important}[data-t8n^=fadedown].transition-out{animation:fade-up .8s reverse;display:inline-block !important}[data-t8n^=flicker].transition-in{animation:flicker .8s}[data-t8n^=flicker].transition-out{animation:flicker .8s reverse}
</style>
</head>
<body>
<tw-story><noscript><tw-noscript>JavaScript needs to be enabled to play GrendelverseRPG.</tw-noscript></noscript></tw-story>
<tw-storydata name="GrendelverseRPG" startnode="272" creator="Twine" creator-version="2.10.0" format="Harlowe" format-version="3.3.9" ifid="3F4A54C8-1B43-46DF-915A-4376BC9D3464" options="" tags="" zoom="0.6" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">/* Story Background */
tw-story {
  background-color: #0A0A0A; /* Very dark grey, almost black */
  /* Optional: Add a subtle dark texture background image */
  /* background-image: url('YOUR-DARK-BACKGROUND-IMAGE-URL'); */
  background-size: cover;
  background-attachment: fixed;
  color: #E0E0E0; /* Light grey text for readability */
  font-family: 'Garamond', 'Georgia', serif;
}

/* Passage Styling */
tw-passage {
  margin: 2em auto;
  padding: 1em 2em;
  background-color: rgba(20, 20, 20, 0.9); /* Slightly lighter background for text passages */
  border-radius: 10px;
  line-height: 1.6;
}

/* Links */
tw-link {
  color: #B0B0B0; /* Light grey for links */
  text-decoration: none;
  border: 1px solid gray; 
  padding: 4px;
  box-shadow: 2px 1px 1px black;
  display: inline-block; /* Ensure proper rendering on mobile */
}

tw-link:hover {
  background-color: #333333; /* Slightly lighter background on hover */
}

/* Sidebar (Undo/Redo Icons) */
tw-sidebar {
  background-color: transparent;
}

tw-icon.undo,
tw-icon.redo {
  color: #E0E0E0;
}

tw-icon.undo:hover,
tw-icon.redo:hover {
  color: #FFFFFF;
}

/* Headers */
h1, h2, h3 {
  font-family: 'Garamond', 'Georgia', serif;
  color: #E0E0E0; /* Same as text color for consistency */
}

h1 {
  font-size: 2.5em;
  text-align: center;
}

h2 {
  font-size: 2em;
  margin-top: 1.5em;
}

h3 {
  font-size: 1.5em;
  margin-top: 1em;
}

/* Special Text Classes */
.magic {
  color: #C0C0C0; /* Light grey for magical elements */
  font-style: italic;
}

.tech {
  color: #A0A0A0; /* Slightly darker grey for technological elements */
  font-weight: bold;
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-track {
  background: #0A0A0A;
}

::-webkit-scrollbar-thumb {
  background: #555555;
  border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
  background: #777777;
}

/* Mobile Responsiveness */
@media screen and (max-width: 600px) {
  tw-passage {
    max-width: 100%;
    margin: 1em;
    padding: 1em;
  }

  tw-link {
    padding: 2px;
    font-size: 1em;
    box-shadow: none;
  }

  h1 {
    font-size: 1.8em;
  }

  h2 {
    font-size: 1.5em;
  }

  h3 {
    font-size: 1.2em;
  }
  
  /* Adjust background attachment for mobile performance */
  tw-story {
    background-attachment: scroll;
  }
}</style><script role="script" id="twine-user-script" type="text/twine-javascript"></script><tw-passagedata pid="1" name=" Quest: The Herb of Insight" tags="" position="5000,1225" size="100,100">(display:&quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)

    Aeschere hesitates before speaking, his tone shifting to one of calculated caution. &quot;There is an herb known as Jötunn&#39;s Bane, a rare plant that grows only in the deepest parts of the Whispering Forest. When properly prepared, it grants visions—clarity to pierce the veils of deception.&quot;

    &quot;The herbalist Eir possesses knowledge of this plant. However, she is... reluctant to assist me, given her misguided adherence to outdated beliefs.&quot;

    He fixes you with a stern gaze. &quot;I need you to procure this herb for me, discreetly. Do not mention my name. Use whatever means necessary—charm, trade, or subtlety—but ensure that it cannot be traced back to me.&quot;

[[Back-&gt;Aeschere Quest Hub]]</tw-passagedata><tw-passagedata pid="2" name="(Lie/bluff) Say that Hrothgar himself has tasked you with assessing Sir Thryth&#39;s response to the attack" tags="" position="3375,3000" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
(if:$reputation&#39;s &quot;Thryth&quot; is &quot;high&quot;)[

He looks impressed and talks to you more as an equal 

](else:)[




]</tw-passagedata><tw-passagedata pid="3" name="Accept the Cursed Artifact" tags="" position="4000,2325" size="100,100">(display: &quot;header&quot;)(set:$effort to 3)(display:&quot;Effort&quot;)
With a deep breath, you meet Unferth’s intense gaze. “I accept the cursed artifact,” you say, feeling the weight of your words settle upon you.(set: $misc to it + (a: $cursedRelic))

Unferth nods solemnly and gestures to the guards, who step forward to lift the chest from its warded pedestal. They hand it to you with a cautionary glance, their expressions conveying the seriousness of the task ahead.

The chest is heavier than it appears, its iron-bound wooden frame etched with ancient runes that seem to writhe under the torchlight.

He fixes each of you with a penetrating stare. &quot;You //must// be discreet. Do not draw attention to yourselves. The roads are watched, and there are those who would stop at nothing to claim the artifact for their own purposes.&quot;

He pauses, his expression grave. &quot;Remember: under no circumstances are you to open the chest. Its contents are perilous. Exposure could bring calamity upon us all, and Hrothgar&#39;s wrath would be the least of your worries.&quot;

He looks at each of you one last time. &quot;May fortune favor you. Upon your return, seek me out quietly. There are those within Heorot who need not know of this endeavor.&quot;

[[Go to meet Bjorn the boatman-&gt;destroy the cursed artifact]]
(if:$reputation&#39;s &quot;Village Elders&quot; is &quot;friendly&quot; or &quot;trusted&quot;)[
[[Take the artifact to the village elders to seek their advice-&gt;go to torsten]]
]</tw-passagedata><tw-passagedata pid="4" name="Achievements" tags="" position="50,900" size="100,100">&#39;&#39;Achievements&#39;&#39;: (if:$achievements is (a:))[ no active effects.]
&lt;ul&gt;(for: each _ach, ...$achievements)[&lt;li&gt;(print: _ach)&lt;/li&gt;]
&lt;/ul&gt;</tw-passagedata><tw-passagedata pid="5" name="Adventurers Hub" tags="" position="600,1825" size="200,100">(display: &quot;header&quot;)(set:$effort to 0)(display:&quot;Effort&quot;)
The adventurers&#39; laughter and camaraderie envelop you, offering a momentary escape from the tension that pervades the village.

[[Ask about their past battles-&gt;Past Battles]]
[[Ask what brought them to Kattinge-&gt;Current Quest]] {
(if: $achievements contains &quot;Close encounter: parlayed with the Sceadugenga and Torsten&quot; and $achievements does not contain &quot;Confided the secret of the Sceadugenga to the Adventurers&quot;)[
[[Tell the group about your encounter with the sceadugenga and try to persuade them to rethink their allegiance to Hrothgar&#39;s plan.-&gt;Confide in the Adventurers]]&lt;br&gt;
]
(if: $reputation&#39;s &quot;Adventurers&quot; is &quot;allied&quot;)[]
}
[[Ask them for more details about what they know of Grendel and the dangers of the forest.-&gt;Ask adventurers about Grendel]]
[[Discuss the party&#39;s plans.-&gt;Patrol plans]]
[[Leave the table-&gt;Inn Hub]]</tw-passagedata><tw-passagedata pid="6" name="Adventurers Introduction" tags="" position="825,1600" size="100,100">(display: &quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)

You introduce yourself, sharing that you, (print: $name) the bard have been drawn to the village by the tales of Grendel and are hoping to learn more about the land and its people.

Hroald nods, his gaze steady and appraising. &quot;Well met, bard. I am Hroald, a warrior of Haithabu. Join us for a drink if you will.&quot;

Going around the table, he introduces Edda the Goth, Ciar, a Celtic druid, and Lothar, a Lombard. Apparently the group met while working for a Byzantine mercenary company in the Kingdom of Lazica, and has been travelling together for several years.
{

(for: each _item, ...$adventurersLarder)[

(set: _descriptionLabel to &quot;Description of &quot; + _item&#39;s &quot;name&quot;)
	(set:_label to &quot;take &quot; + &quot;name&quot; of _item)
	(set: _descriptionLabel to &quot;description of &quot; + _item&#39;s &quot;name&quot;)
---
Name: (print: &quot;name&quot; of _item) | [_label]&lt;br&gt;
(click:_label)[
	(set: $food to it + (a: _item))
    	(set: $adventurersLarder to it - (a: _item))
   (replace: _label)[ (print: &quot;name&quot; of _item) &quot;added to inventory&quot; ]
]
[_descriptionLabel]&lt;br&gt;
(click: _descriptionLabel )[(print: &quot;description&quot; of _item)]
]

(set:$reputation&#39;s &quot;Adventurers&quot; to &quot;friendly&quot;)
}

[[Continue-&gt;Adventurers Hub]]</tw-passagedata><tw-passagedata pid="7" name="Adventurers observe" tags="" position="700,1575" size="100,100">(display: &quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)

The speaker is an imposing figure with a wild mane of red hair touched with streaks of silver, and a bearskin cloak hanging from his shoulders. His blue eyes gleam with intensity as he debates some issue with the tall, pale woman across the table from him. Her intricate facial tattoos and blonde hair braided down her back mark her as a goth. Clearly a warrior, she wears a fitted leather cuirass over her tunic, and metal greaves and bracers are stacked neatly with a round spiked shield and a quiver of javelins on the bench beside her, and a short sword hangs at her side. 

Beside her is a woman in a green hooded tunic. A bow rests within her easy reach, and a raven sits on the table next among a jumble of cracked walnut shells, looking up at you with cocked head.

The final member of the group is a burly, fair-haired man with a jovial and surprisingly youthful face. He wears a simple tunic, but heavy armor and a great axe lean against the table beside him. He continues to guffaw at a joke apparently told a moment before by the hooded woman, oblivious to your approach.

[[Introduce Yourself-&gt;Adventurers Introduction]]
[[Back-&gt;Inn Hub]]</tw-passagedata><tw-passagedata pid="8" name="Agree to Return the Horn" tags="" position="5275,3600" size="100,100">(display: &quot;header&quot;)
Agree to Return the Horn

With a determined nod, you decide to take the risk and return the sacred horn to the Sceadugenga. &quot;We will do it,&quot; you say, meeting Torsten&#39;s eyes. &quot;We will return the horn and seek peace.&quot;

Torsten smiles, a glimmer of hope in his eyes. &quot;May the gods be with you on your journey. Be cautious and respectful, and perhaps you will succeed where others have failed.&quot;

You gather your companions and prepare to set out. The village is quiet as you make your way towards the edge of the forest, the horn securely packed in your belongings. The atmosphere is tense, each of you aware of the potential dangers ahead.

As you reach the outskirts of the village, you suddenly hear the sound of marching footsteps and the clinking of armor. Emerging from a side path, you see Unferth and Hrothgar at the head of a company of warriors. Their faces are stern, and their eyes lock onto your group with suspicion.

[[Continue...-&gt;Under Attack at Torsten&#39;s]]</tw-passagedata><tw-passagedata pid="9" name="Approach the fishermen" tags="" position="1450,200" size="100,100">(display: &quot;header&quot;)
Along the docks, fishermen clean their catch, mend nets, and tend to their boats and gear.

Hardened by sea and sun, they have a look about them that suggest many an untold tale. As you draw near, their conversation falters, their eyes wary, yet curious.
[[Continue-&gt;Fishermen Convo Hub]]</tw-passagedata><tw-passagedata pid="10" name="Ask About the Draugr" tags="" position="3725,6125" size="100,100">(display:&quot;header&quot;)
You take a steadying breath and address Véfrøðr with a tone of earnest inquiry. &quot;These undead warriors—the Draugr—you mentioned they are relentless guardians of the treasure. What more can you tell us about them?&quot;

The dragon&#39;s expression grows somber, and a shadow seems to pass over its ancient eyes. &quot;The Draugr are a terror beyond the reckoning of most mortals,&quot; Véfrøðr begins. &quot;In life, they were Eirikr&#39;s most loyal thanes, warriors of unmatched skill and unwavering loyalty. In death, they have become something far more dreadful.&quot;

He continues, his voice heavy with the weight of centuries. &quot;Bound by the darkest of necromantic sorcery, the Draugr are cursed to an existence of eternal vigilance. But their curse is not a static one. With each intruder they slay—each soul that falls within these forsaken ruins—they grow in both power and form.&quot;

Véfrøðr&#39;s gaze meets yours, and you can see a flicker of fear—or perhaps deep regret—in his eyes. &quot;They consume the flesh and essence of their victims, absorbing their strength, their vitality. Over the long centuries, this has transformed them into monstrous abominations.&quot;

He elaborates, &quot;The Draugr have swollen to immense sizes, their bodies a grotesque amalgamation of stolen limbs and distorted features. Extra arms, twisted and gnarled, sprout from their torsos. Faces—some screaming, others frozen in silent agony—are embedded in their flesh, remnants of the souls they&#39;ve devoured.&quot;

Your companions exchange uneasy glances.

    Edda grips her javelin tighter. &quot;By the gods... such abominations defy nature itself.&quot;

    Ciar shudders, her voice barely above a whisper. &quot;I&#39;ve heard whispers of such creatures in the old tales, but never imagined them to be real.&quot;

    Lothar swallows hard. &quot;And you say they get stronger with every life they take?&quot;

Véfrøðr nods gravely. &quot;Indeed. Their strength, their resilience, their very essence grows with each victim. Their abilities have expanded beyond mere physical might. Some can manipulate shadows, others exhale mists of poison or unleash wails that can shatter the mind.&quot;

He adds, &quot;They are bound to Eirikr&#39;s will, and through him, their malice is focused on any who dare approach the treasure.&quot;
[[Do the draugr have any weaknesses?]]
[[Continue-&gt;Dragon Convo Hub]]</tw-passagedata><tw-passagedata pid="11" name="Ask Ciar about her druid training" tags="" position="975,2075" size="100,100">(display: &quot;header&quot;)
She takes a long swig of her ale and gathers her thoughts.
&quot;Yes, I completed my training at the great temple on Orkney Isle. I could have served as a priestess if things hadn&#39;t taken a... different turn. Perhaps I&#39;ll tell you about it another time. It&#39;s... a long story.&quot;
(if:$reputation&#39;s &quot;Adventurers&quot; is not &quot;trusted&quot;)[

](else:)[

]
[[Continue-&gt;Adventurers Hub]]</tw-passagedata><tw-passagedata pid="12" name="Ask Ciar what she means" tags="" position="675,2250" size="100,100">(display: &quot;header&quot;)
Ciar&#39;s raven shifts on her shoulder, its dark eyes reflecting the firelight. She meets your gaze with a thoughtful expression. &quot;Grendel and his ilk, what most of the locals call //Sceadugenga// or //shadow walkers//, and the Christians call the &#39;children of Cain&#39;, are seen as monstrous beings, but the truth is often twisted by fear and ignorance. In many cases, what people see as monsters are just men and women fighting for their homes and way of life.&quot;

She pauses to let her words sink in before continuing, &quot;my role as a druid is to see beyond the surface, to understand the underlying causes of conflict. I&#39;ve studied various cultures and their beliefs, and I&#39;ve learned that there is often more to these &#39;monsters&#39; than meets the eye. They might be defending sacred lands, seeking revenge for past wrongs, or simply trying to survive.&quot;

Ciar&#39;s voice grows softer, more contemplative. &quot;Magic and the old ways still hold power here. There are spirits in these lands, forces that we don&#39;t fully understand. It&#39;s possible that the Sceadugenga are connected to these forces in some way. If we can understand their motivations, we might find a way to resolve this conflict without needless bloodshed.&quot;

Hroald scoffs lightly but without malice. &quot;Leave it to Ciar to find the heart in a conflict. We&#39;ll see if your wisdom holds up when we face these &#39;monsters.&#39;&quot;

Edda nods, her expression neutral. &quot;Understanding our enemy is important, but we must be prepared for anything. Whether they are men or something more, we need to be ready to fight.&quot;

Lothar grunts in agreement. &quot;We&#39;ve been through enough to know that battles aren&#39;t won on ideals alone. We&#39;ll see what these Sceadugenga truly are soon enough.&quot;

Ciar smiles slightly, undeterred. &quot;I don&#39;t expect everyone to agree with me, but I believe it&#39;s worth exploring every angle. The truth is often more complex than it seems.&quot;
[[Ask Ciar about her druid training]]
[[Continue-&gt;Adventurers Hub]]</tw-passagedata><tw-passagedata pid="13" name="Ask Eir about Grendel&#39;s impact on daily life" tags="" position="2550,1800" size="100,100">(display: &quot;header&quot;)
[[Continue-&gt;Elders Hub]]
[[Excuse yourself and return to the village-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="14" name="Ask Eir about making a sleeping potion for a dragon" tags="" position="2175,2225" size="100,100">(display: &quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)

(set:$activeQuests to it + (a:&quot;Collect dragon sleeping potion ingredients...&quot;))


[[Back-&gt;Elders dragon hub]]</tw-passagedata><tw-passagedata pid="15" name="Ask Father Aelfric about the church and its history" tags="" position="1475,2550" size="100,100">(display: &quot;header&quot;)
You approach Father Aelfric as he finishes tending to the candles. &quot;Father,&quot; you begin, &quot;this church feels like a haven amidst the turmoil outside. Could you tell me more about its history?&quot;

He offers a gentle smile, the wrinkles around his eyes deepening. &quot;Certainly,&quot; he replies softly. &quot;Our humble chapel has stood here for nearly fifteen years, though it feels like a lifetime ago when we first arrived.&quot;

He gazes thoughtfully at the wooden cross behind the altar. &quot;I journeyed north from the Frankish lands with Brother Aeschere—an inspiring man whose faith burns brighter than the finest candle. We came at the behest of the Church to bring the light of Christ to these ancient lands.&quot;

&quot;King Hrothgar was... receptive,&quot; he continues cautiously. &quot;A man of great ambition, he saw in our faith not only spiritual enlightenment but a means to unify his people and strengthen ties with powerful allies to the south. His conversion was a significant moment—one that paved the way for the establishment of Christianity here in Heorot.&quot;

Father Aelfric moves to a small window, the muted light casting a soft glow on his weathered face. &quot;While Brother Aeschere advises the king and oversees matters of the court, I was tasked with tending to the spiritual needs of the common folk. This chapel became a refuge for those seeking solace, especially now with the hardships brought by Grendel&#39;s attacks.&quot;

He sighs softly. &quot;In the early days, we received ample support. King Hrothgar provided resources, and the people were curious and eager to learn. But as time wore on and challenges grew, attention shifted elsewhere. The king&#39;s focus turned to fortifying his reign and dealing with... threats.&quot;

He turns back to you, his eyes reflecting a mix of resolve and humility. &quot;We do what we can here—with limited means—to offer shelter, food, and spiritual guidance to those in need. Though our coffers are modest, the spirit of the Lord provides where material wealth does not.&quot;

&quot;Forgive me,&quot; he adds quickly, &quot;I do not mean to imply neglect. The times are demanding for all, and priorities can shift. We remain grateful for what we have and continue our mission with glad hearts.&quot;
(set: $knownLore to it + (a: &quot;Brother Aeschere advises the king on spiritual matters.&quot;))
[[Continue-&gt;Church Hub]]</tw-passagedata><tw-passagedata pid="16" name="Ask Father Aelfric what he knows of Grendel" tags="" position="1525,2850" size="100,100">(display: &quot;header&quot;)
You approach Father Aelfric, his sharp eyes tracking your movements as you come closer. The soft flickering of candlelight casts shadows across his lined face, making him appear even more worn by age and worry. His nervous energy is palpable, and you can&#39;t help but notice how he glances around the church as if expecting danger to leap out from the shadows.

&quot;Father Aelfric,&quot; you begin cautiously, &quot;I have heard many tales about the creature known as Grendel. Can you tell me more about what we face?&quot;

Father Aelfric sighs deeply, his shoulders slumping slightly as if the weight of the world rests upon them. He runs a hand through his thinning hair, a gesture that seems more habitual than necessary. &quot;Grendel, huh?&quot; he mutters, his voice a mix of fear and exasperation. &quot;Grendel is a blight upon this land,&quot; he begins, louder now, his voice carrying a hint of a southern accent. &quot;Hrothgar believes it to be the spawn of Cain, a cursed being sent to punish us for our sins.&quot;

He pauses, glancing around the church again, his eyes darting from shadow to shadow. The other travelers in the church seem lost in their own fears, barely paying attention to your conversation. The smell of burning tallow and the earthy scent of the wooden structure mix in the air, creating an almost oppressive atmosphere.

&quot;I came here from the south,&quot; Father Aelfric continues, his voice now tinged with disdain. &quot;Hrothgar converted to Christianity fifteen years ago and has been working tirelessly to root out the pagan nonsense that has plagued this land for far too long. The old ways, the worship of false gods, the superstitions—they are dangerous and must be eradicated.&quot;

He leans in closer, his eyes intense and a little wild. &quot;Grendel is not just a physical threat; it is a manifestation of the darkness that comes from these pagan practices. The locals, clinging to their old ways, have brought this curse upon themselves. Hrothgar believes that by strengthening the Christian faith here, we can banish this evil once and for all. Every devil has its weaknesses.&quot;

Father Aelfric&#39;s voice drops to a near whisper, his eyes narrowing as if he&#39;s sharing a conspiracy. &quot;But it is not easy. The people are fearful, and the old beliefs run deep. Grendel strikes in the night, preying on that fear. We must stand firm in our faith, for it is only through the light of Christ that we can hope to drive this darkness away.&quot;

He looks at you with a mixture of hope and desperation, his hands gripping your arm. &quot;You must help spread the word, reinforce the teachings of the Church. Only then can we hope to rid ourselves of this scourge.&quot;

The flickering candlelight reflects in his eyes as he looks toward the wooden cross on the wall. &quot;This place,&quot; he says, his voice barely audible, &quot;is a battleground. Every soul we save is a blow against the darkness.&quot;

[[Offer to help with the Grendel problem]]
[[Inquire about Grendel&#39;s weaknesses]]
[[Continue-&gt;Church Hub]]</tw-passagedata><tw-passagedata pid="17" name="Ask Ivar about the lore of the land" tags="" position="3050,1875" size="100,100">(display: &quot;header&quot;)

Ivar&#39;s eyes sparkle with a mix of excitement and mystery as you ask for a tale steeped in ancient lore.
&quot;Ah then, let me tell you of...&quot;
(set:$effort to 1)(display:&quot;Effort&quot;)
[[The Lindworm of Göinge Forest-&gt;Legend of the Lindworm]]
[[Styrbjörn and the whispering winds -&gt;Legend of the Whispering Wind]]
[[Sigrid and the Dragon of Jelling]]
[[Talk to the other elders-&gt;Elders Hub]]</tw-passagedata><tw-passagedata pid="18" name="Ask Marta about the tree" tags="" position="2400,3450" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)





[[Continue-&gt;Marta Hub]]</tw-passagedata><tw-passagedata pid="19" name="Ask Marta foreshadow" tags="" position="2550,3425" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)

she&#39;s uneasy but tells you about how her husband and the workers had found this strange grove, and he was nervous about it, but Thryth had them chop down the tree, collect the wood and burn the grove. he was worried they would be cursed, and then this happened. Thryth didn&#39;t care about the danger...


[[Ask Marta about the tree]]</tw-passagedata><tw-passagedata pid="20" name="Ask Sir Thryth about the attack" tags="" position="2825,3100" size="100,100">(display:&quot;header&quot;)(set:$ThrythInvestigation to it+20)
&quot;The attackers raided the farm four nights ago,&quot; begins Sir Thryth. &quot;They targeted one of my work groups. Broke into their barracks, killed all 6 men and carried away the bodies for some ungodly end. Utter savages.&quot;

He sighs, a flicker of irritation crossing his face. &quot;Witnesses claim they saw giants—shadows that towered over men, impervious to weapons. Nonsense, of course. Likely the work of the savage brigands using trickery to instill fear. Pagans worship fear and draw their strength from it, which is why they are defeated by //Faith//.&quot;
[[Inquire about any unusual activities prior to the attack-&gt;Ask Thryth Unusual Activities]]
[[Ask Sir Thryth about the tree]]
[[Ask Sir Thryth about the workers who were attacked]]
[[Continue-&gt;Thryth Hub]]</tw-passagedata><tw-passagedata pid="21" name="Ask Sir Thryth about the tree" tags="" position="2900,3275" size="100,100">(display:&quot;header&quot;)(set:$ThrythInvestigation to it+20)
He stiffens slightly. &quot;Yes. The men discovered such a grove. An oddity, but nothing more than superstitious relics of the old ways.&quot;

&quot;What did you do with the grove?&quot; Edda presses.

Sir Thryth&#39;s jaw sets. &quot;I had it destroyed, as is our duty to purge these lands of pagan idolatry. The wood was harvested, the stumps burned.&quot;

Hroald&#39;s expression darkens. &quot;And shortly after, your men were taken.&quot;

He shrugs dismissively. &quot;Coincidence. The old gods hold no power here.&quot;
[[Continue-&gt;Thryth Hub]]</tw-passagedata><tw-passagedata pid="22" name="Ask Thryth Unusual Activities" tags="" position="2575,3075" size="100,100">(display: &quot;header&quot;)(set:$ThrythInvestigation to it+20)
&quot;Were there any unusual events or activities leading up to the attack?&quot; you ask. &quot;Anything that might have provoked such aggression?&quot;

Sir Thryth&#39;s eyes flicker with a hint of annoyance. &quot;Nothing of consequence. We are clearing this land as per King Hrothgar&#39;s directives. Expanding civilization into the wilderness.&quot;
[[Continue-&gt;Thryth Hub]]</tw-passagedata><tw-passagedata pid="23" name="Ask about old rituals or customs" tags="" position="1550,1675" size="100,100">(display:&quot;header&quot;)

A wistful smile tugs at the corners of Eir&#39;s mouth. &quot;Ah, the old rituals,&quot; she murmurs. &quot;There was a time when we would gather under the full moon, singing songs and offering gifts to the spirits of the land. We believed that these rituals kept the balance, that they honored the old gods and kept the darkness at bay.&quot;

She sighs softly. &quot;But those days are gone. Hrothgar&#39;s new faith has no place for such customs, and many of the old ways have been forgotten. Yet, in times of great need, some still whisper the old prayers, hoping that the ancient powers will hear and protect us.&quot;

She looks you in the eyes a long moment as if deciding whether or not to trust you, and then tells you that if you want to learn more about the Old Ways, sometimes she and the other elders from the village hang out and drink tea by the well on top of the hill at the far end of town. But don&#39;t go asking too many quesitons about this stuff until then... not everyone is sympathetic..

{(set: _loreDrop to &quot;The elders of Kattinge Village gather near the well.&quot;)
(set: _quest to &quot;Meet the elders of Kattinge Village&quot;)
(if: $completedQuests does not contain _quest)[
(set: $activeQuests to it + (a: _quest))
]
}
Known lore updated: (print: _loreDrop)
(if: _loreDrop is not in $knownLore )[(set: $knownLore to it + (a: _loreDrop))]
[[Continue talking to Eir-&gt;Eir Hub]]
[[Excuse yourself and continue exploring the market-&gt;Market Hub]]</tw-passagedata><tw-passagedata pid="24" name="Ask about the attacks on Thryth farmstead" tags="" position="3400,2575" size="100,100">(display:&quot;header&quot;)
She eyes you with scrutiny. 
&quot;Are you a christian, bard?&quot;

[[Yes, I&#39;m on a mission to drive the pagan darkness from this land! -&gt;Shephard Christian Yes mean]]
[[Yes, but I respect everyone&#39;s rights to their own spiritual beliefs.-&gt;Shephard Christian Yes nice]]
[[I&#39;m a seeker of truth, my beliefs can&#39;t be so easily summarized.-&gt;Shephard Christian no]]</tw-passagedata><tw-passagedata pid="25" name="Ask adventurers about Grendel" tags="" position="875,2225" size="100,100">(display: &quot;header&quot;)
Ciar, his voice softer but no less confident, nods. &quot;Aye, the tales of Grendel have reached far and wide. There are those who see it as a challenge worth facing, and others who view it as a chance to earn an easy coin. But make no mistake, the beast is real, and its wrath is deadly.&quot;

Edda, her expression serious, adds, &quot;We’ve all faced dangers before, but this... this is something different. The forest itself seems to breathe with malevolence, as if Grendel’s presence has poisoned the very earth. But we’re ready. We’ve prepared for this.&quot;
[[Persuade the adventurers to reconsider their plan-&gt;Adventurers Hub]]</tw-passagedata><tw-passagedata pid="26" name="Ask around about Grendel" tags="" position="1450,1225" size="100,100">(display: &quot;header&quot;)

The baker nods eagerly. &quot;Oh, sure, there have been many signs,&quot; she says, in a whisper that somehow carries above the noise of the marketplace. &quot;Strange tracks found near the village, livestock disappearing without a trace, and whispers of a shadow moving through the night. One fisherman swore he saw a great, hulking shape lurking just beneath the water&#39;s surface, its eyes glowing with an unnatural light.&quot;

&quot;I heard a most chilling tale from my cousin Netta,&quot; says the fishmonger, leaning in closer. &quot;Her seventh son Hronner wandered too close to the forest one evening last spring. Returned pale and shaking, claiming he heard a voice—calling his name from the shadows. The boy&#39;s changed, they say. Never laughs nor cries, only sits staring out into the forest. Waiting for the shadow to return, he says. Who could that be, I ask you,&quot; concludes the fishmonger gesturing emphatically with a smoked eel, &quot;but //Grendel//?&quot;

[[Continue-&gt;Buy some food]]</tw-passagedata><tw-passagedata pid="27" name="Ask how to set the dragon free" tags="" position="3150,6550" size="100,100">&quot;Given these obstacles,&quot; you say, &quot;do you have any suggestions on how we might overcome Eirikr and his Draugr? Any weaknesses we can exploit?&quot;

Véfrøðr considers your question carefully. &quot;Eirikr&#39;s arrogance is his greatest weakness,&quot; he begins. &quot;He believes himself invincible, his defenses impenetrable. However, his reliance on me as a final line of defense has made him complacent in other areas.&quot;

He continues, &quot;If you can neutralize me as a threat, you could infiltrate his sanctum with less resistance. The Draugr, while formidable, can be distracted or bypassed using stealth and cunning.&quot;

Véfrøðr adds, &quot;Eirikr&#39;s power is tied to his physical remains. He resides within a crypt deep beneath the fortress. If you can reach him and destroy his corporeal form you can sever the source of his magic. You must use fire to destroy every part of his flesh, or the curse will persist. 

&quot;How I wish it could be //my// fire,&quot; he adds calmly, almost whimsically, and then as an afterthought, &quot;ah, and beware the evil smoke that flows when he is burnt, for that bears his spirit and can possess one caught unaware.&quot;

[[Continue-&gt;Dragon Convo Hub]]</tw-passagedata><tw-passagedata pid="28" name="Ask if there is any way to overcome this compulsion" tags="" position="3550,6200" size="100,100">(display: &quot;header&quot;)

Véfrøðr&#39;s eyes meet yours, a hint of cautious hope flickering within them. &quot;There may be a way,&quot; he says slowly. &quot;The curse binds me to defend the treasure and obey Eirikr&#39;s commands. However, if I were rendered incapable of acting—temporarily incapacitated—I could not be used against you.&quot;

He elaborates, &quot;A powerful sleeping draught could achieve this. If you were to administer such a potion, potent enough to affect a dragon of my size, I could enter a deep slumber. While asleep, I would be beyond Eirikr&#39;s reach, and he could not compel me to attack you.&quot;

Your companions exchange glances.

    Edda raises an eyebrow. &quot;A sleeping draught for a dragon? That would require rare and powerful ingredients.&quot;
    Ciar nods. &quot;I may know of such a potion, but we would need to gather the components.&quot;
    Lothar grins slightly. &quot;At least he’s willing to help us help him.&quot;
    Hroald adds, &quot;We&#39;d also need strong chains to ensure he remains bound, just in case.&quot;

Véfrøðr continues, &quot;Indeed. Chains forged of sturdy metal, perhaps reinforced with enchantments or silver, would prevent any... unexpected movements upon waking. It&#39;s a precaution I recommend.&quot;
[[Wouldn&#39;t that render you very vulnerable? Why would you trust us that much?]]
[[Continue-&gt;Dragon Convo Hub]]</tw-passagedata><tw-passagedata pid="29" name="Ask Marta" tags="" position="2675,3200" size="100,100">(display:&quot;header&quot;)
Sir Dastsrup nods curtly. &quot;Very well. They&#39;re housed in the western quarters. Though I doubt the wife will be of much help—she&#39;s been hysterical since the incident.&quot;

He gestures to a servant and says, &quot;show them to Marta&#39;s dwelling,&quot; before turning back to the house.

As you make your way across the compound, the atmosphere grows heavier. Laborers avert their eyes, hastening their tasks. The overseer&#39;s house stands apart, its door hanging askew, the faint scent of smoke lingering.


[[Ask to speak with the overseer&#39;s family-&gt;Marta Hub]]</tw-passagedata><tw-passagedata pid="30" name="Ask to join the patrol" tags="" position="1125,2375" size="100,100">(display: &quot;header&quot;)
{
(display: &quot;updateCombatBonus&quot;)

}
(if:$totalArmorBonus &gt; 6 and  $totalCombatBonus &gt; 10)[

Hroald&#39;s eyes gleam with approval as he eyes you up and down, taking in your sturdy gear. &quot;Aye, you look like you can handle yourself. Fine with me if you tag along.&quot;

The other agree after conferring briefly. Lothar grins broadly, raising his mug. &quot;To new companions and future victories!&quot; he declares, his booming voice drawing glances from around the inn.

Edda and Ciar nod in agreement, and soon you find yourself caught up in a night of celebration. The inn fills with laughter and the clinking of mugs as the camaraderie of the group envelops you.
{(set: $reputation&#39;s &quot;Adventurers&quot; to &quot;allied&quot;)
(set:$recruitedParty to true)
}
[[Continue-&gt;Party night before patrol]]
](else-if: $totalArmorBonus &gt; 1 and  $totalCombatBonus &gt; 1)[
&quot;Well,&quot; says Hroald, eyeing your gear and finding it somewhat lacking &quot;You can tag along, just try not to get to get yourself killed. You might want to find yourself another weapon and some more armor before we find ourselves in battle.&quot;

The other agree after conferring briefly. Lothar grins broadly, raising his mug. &quot;To new companions and future victories!&quot; he declares, his booming voice drawing glances from around the inn.

Edda and Ciar nod in agreement, and soon you find yourself caught up in a night of celebration. The inn fills with laughter and the clinking of mugs as the camaraderie of the group envelops you.
{(set: $reputation&#39;s &quot;Adventurers&quot; to &quot;allied&quot;)
(set:$recruitedParty to true)}
[[Continue-&gt;Party night before patrol]]
](else:)[
Hroald looks you up and down, noting your lack of sufficient armor and weaponry. &quot;You seem eager, but you&#39;ll need better gear if you want to survive out there. Head over to the blacksmith and get yourself some proper armor and at least one sturdy weapon. Once you&#39;re equipped, we might reconsider.&quot;

Edda nods in agreement. &quot;We can&#39;t afford to have anyone unprepared. Get what you need and then seek us out again.&quot;

With a sense of purpose, you thank them and set off for the blacksmith, determined to equip yourself properly for the venture.

[[Continue-&gt;Inn Hub]]
]</tw-passagedata><tw-passagedata pid="31" name="Ask to speak with the thralls" tags="" position="3175,3075" size="100,100">(display:&quot;header&quot;)(set:$ThrythInvestigation to it+20)
&quot;That would not be... //appropriate//,&quot; Sir Thryth says in a slow, measured tone of restrained anger. &quot;The thralls that work my fields are //criminals// and //debtors// who earned their penance through lack intemperance and sin. Their word is worth less than nothing, less even than a //woman//&#39;s word.&quot;

(if:$reputation&#39;s &quot;Adventurers&quot; is &quot;allied&quot;)[ Sir Thryth snickers unpleasantly, looking over your party, and glares at you confrontationally.]
[[Coninue-&gt;Thryth Hub]]</tw-passagedata><tw-passagedata pid="32" name="Ask to take Marta and her children back to the village" tags="" position="2950,3450" size="100,100">(display:&quot;header&quot;)
He shrugs dismissively. &quot;I&#39;ve no use for them. Do what you will.&quot;
(set:$ThrythReleasedMarta to true)
(set:$doneQuest to &quot;Secure the release of Marta and her children from Sir Thryth&quot;)(display:&quot;questComplete&quot;)
[[Back-&gt;Thryth Hub]]</tw-passagedata><tw-passagedata pid="33" name="Ask what the dragon knows of grendel and the sceadugenga" tags="" position="3225,5525" size="100,100">(display:&quot;header&quot;)
The dragon&#39;s eyes flicker with a faint light, a mixture of recognition and something else—perhaps caution or regret.

&quot;Grendel,&quot; Véfrøðr echoes, his voice a low rumble that seems to resonate from the very stones beneath you. &quot;Yes, I know of whom you speak. Though many know him as a monster of legend, the truth is far more complex.&quot;

He shifts slightly, the long coils of his body rustling against the cold ground. &quot;Grendel and his kin are ancient beings—Sceadugenga, the Shadow Walkers. They have walked these lands long before the halls of men were raised, before the songs of heroes echoed across the fjords.&quot;

Your companions react silently:

    Edda leans in, her eyes narrowed with intrigue.
    Ciar whispers a quiet prayer, her connection to the old ways stirred.
    Lothar listens intently, his usual bravado subdued.
    Hroald furrows his brow, absorbing the dragon&#39;s words.

Véfrøðr continues, &quot;They are the remnants of a time when magic was woven into the very fabric of the world—when spirits of the earth and sky moved freely among mortals. Grendel&#39;s kind are guardians of the wild places, protectors of the balance that once was.&quot;

He sighs, a deep and sorrowful sound. &quot;But as the realms of men expanded, driving deeper into forests and mountains, the Sceadugenga were pushed to the fringes. Their sacred sites defiled, their ways forgotten. Fear and misunderstanding turned them into figures of nightmare—a convenient scapegoat for the woes that befell settlements encroaching upon nature&#39;s domain.&quot;

Do Grendel and his kin have any connection to Eirikr or the Draugr?&quot; you inquire. &quot;Is there any interplay between their stories?&quot;

Véfrøðr considers your question. &quot;Indirectly, perhaps,&quot; he replies. &quot;Eirikr&#39;s actions contributed to the imbalance in these lands. His use of dark magic and the curse upon Drekaborg have tainted the surrounding areas, seeping malevolence into the earth.&quot;

He elaborates, &quot;Such corruption affects all beings connected to the land. The Sceadugenga, being deeply attuned to nature, would have felt this disturbance acutely. It may have exacerbated their suffering and fueled their resentment.&quot;

Véfrøðr adds, &quot;Furthermore, the chaos and fear wrought by Eirikr&#39;s legacy may have hardened the hearts of men against any they perceive as threats, including Grendel&#39;s kin.&quot;</tw-passagedata><tw-passagedata pid="34" name="AskAboutHistory" tags="" position="3050,5850" size="100,100">(display: &quot;header&quot;)

You steady your voice and address Véfrøðr with respect. &quot;We have seen the ruins and felt the weight of this place&#39;s sorrow. Please, tell us the history of Drekaborg. What happened here?&quot;

The dragon&#39;s eyes narrow slightly, reflecting the dim light like twin embers. A long, slow breath escapes its nostrils, stirring the dust at its feet. &quot;Very well,&quot; it says, voice tinged with ancient melancholy. &quot;Listen then, to a tale woven with pride and downfall, glory and despair—a saga forgotten by the tongues of men.&quot;

Véfrøðr gazes toward the crumbling silhouette of the fortress. &quot;Drekaborg was once a beacon of might in these lands. Lord Eirikr the Obsessive ruled here, a chieftain of great ambition and unmatched cunning. In his youth, he was celebrated—a warrior of renown, his deeds sung by skalds across the fjords and valleys.&quot;

The dragon&#39;s tone darkens. &quot;But as the years wore on, Eirikr&#39;s thirst for power overshadowed his honor. He became consumed by greed, seeking not just wealth but dominion over secrets best left undisturbed. He delved into the arcane, pursuing forbidden rites whispered of in the elder tales—the kind that bind the fates of gods and men.&quot;

Véfrøðr continues, &quot;In his quest, he sought out relics and artifacts—items of great power spoken of in the &#39;Völuspá&#39; and the &#39;Hávamál&#39;. He collected enchanted weapons, runestones etched with eldritch sigils, and the fabled &#39;Brísingamen&#39;, though whether it was the true necklace of Freyja or a mere imitation, none could say.&quot;

&quot;As his hoard grew, so too did his paranoia. He feared betrayal from all sides—enemies beyond his walls and shadows within them. He withdrew from the world, severing alliances, and shunning the old customs of hospitality and oaths.&quot;

Véfrøðr&#39;s eyes reflect a distant sorrow. &quot;Eirikr&#39;s people suffered under his obsession. Crops withered as fields lay untended, and famine stalked the land. Those who dared speak against him were silenced—some exiled, others meeting darker fates.&quot;

&quot;He sought me out,&quot; Véfrøðr reveals, &quot;believing that a dragon&#39;s wisdom could grant him immortality and secure his treasures for eternity. I was drawn by curiosity and perhaps hubris, intrigued by this mortal who dared reach beyond his grasp.&quot;

The dragon&#39;s voice grows heavy. &quot;But Eirikr&#39;s intentions were treacherous. Through deceit and dark sorcery learned from the jotnar—the giants of old—he bound me to his will. The spells he cast were woven from the deepest strands of seiðr magic, entangling my very essence with his hoard.&quot;

Véfrøðr shifts slightly, the movement betraying lingering pain. &quot;With his dying breath, Eirikr completed the curse. He transformed himself into a Draugr—a revenant, neither alive nor dead, bound to his treasure. His most loyal warriors shared his fate, twisted into undead guardians.&quot;

&quot;Drekaborg fell into ruin,&quot; the dragon continues. &quot;The surrounding lands, once vibrant with life and song, became tainted by his malevolence. Travelers avoided these paths, speaking of restless spirits and a shadow upon the land.&quot;

Véfrøðr&#39;s gaze meets yours, the weight of centuries reflected in his eyes. &quot;And so, here I remain—chained to this desolation. I have witnessed the rise and fall of kingdoms. Heard the distant echoes of Ragnarök whispered in the howling winds. All while bound to a duty I never chose.&quot;

[[Express sympathy for the dragon&#39;s plight-&gt;ExpressSympathy]]
[[Comment on the Folly of Greed and Its Consequences-&gt;CommentOnGreed]]</tw-passagedata><tw-passagedata pid="35" name="AskAboutRisks" tags="" position="3275,6100" size="100,100">(display:&quot;header&quot;)


[[Ask If There Is Knowledge Here That Could Help Undo the Curse-&gt;inquireCurseBreak]]
[[Continue-&gt;Dragon Convo Hub]]</tw-passagedata><tw-passagedata pid="36" name="AskAboutVisitors" tags="" position="3400,6175" size="100,100">(display: &quot;header&quot;)

You consider all that Véfrøðr has shared—the history of Drekaborg, the curse that binds him, and the formidable Draugr that patrol the ruins. A question forms in your mind, one that may shed light on the challenges ahead.

&quot;Véfrøðr,&quot; you begin thoughtfully, &quot;you mentioned that many have come before us, seeking the treasure or perhaps to break the curse. Why have they all failed, and how may we fare better?&quot;

&quot;Many who have come before you were fools, simply looking for a way to die gruesomely in order to prove their courage,&quot; he says, his voice melodious and sorrowful. &quot;But some were brave, capable, and intelligent.&quot;

He continues, &quot;None of these qualities are enough. The Draugr are relentless and deadly. They have grown in power over the centuries, absorbing the strength and vitality of those they&#39;ve slain. Their forms have become grotesque amalgamations—massive, hulking figures adorned with the remnants of their victims. Extra limbs, distorted faces, a patchwork of terror that only adds to their might. Many of their victims fail even to lift their swords in defense, overwhelmed with terror. You must find a way to overcome this obstacle.&quot;

&quot;But Eirikr&#39;s most prized weapon,&quot; Véfrøðr&#39;s gaze hardens as he pauses for emphasis, &quot;is me. I am compelled by the curse to defend the treasure. Should Eirikr command it, I am forced to act against any who threaten his hoard—even if it is against my will.&quot;
[[Ask if there is any way to overcome this compulsion]]
[[Continue-&gt;Dragon Convo Hub]]</tw-passagedata><tw-passagedata pid="37" name="Attack Dragon" tags="" position="4225,5575" size="100,100">(display: &quot;header&quot;)
Ha bad choice, you get burned up and die.
&#39;&#39;Game Over&#39;&#39;</tw-passagedata><tw-passagedata pid="38" name="Attack Véfrøðr" tags="" position="4000,5525" size="100,100">(display: &quot;header&quot;)
Ha bad choice, you get burned up and die.
&#39;&#39;Game Over&#39;&#39;</tw-passagedata><tw-passagedata pid="39" name="Attack the Sceadugenga" tags="" position="400,4250" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
(display: &quot;updateCombatBonus&quot;)

Your comrades cluster nervously around you, clutching their weapons. The air is thick with the scent of moss and an electric buzz of dread. As the last rays of sunlight retreat, the shadows cast by the ancient trees grow longer, more menacing.

You feel the oppressive presence of the Sceadugenga all around you, and your heart pounds with fear. But you steel yourself and decide that the best defense is a good offense. &quot;We need to attack,&quot; you say, trying to sound confident. &quot;If we drive them off, we&#39;ll be safer.&quot;

Hroald looks at you with a mix of surprise and approval. &quot;Aye, let&#39;s show these shadow walkers that we&#39;re not afraid.&quot;

Edda nods, gripping her shield tightly. &quot;Let&#39;s do it. Stay close and watch each other&#39;s backs.&quot;

Lothar raises his axe, a grim smile on his face. &quot;We&#39;ll make them regret stalking us.&quot;

Ciar&#39;s expression is more cautious, but she nods in agreement, her raven taking flight with a sharp caw. &quot;Be careful. These are no ordinary foes.&quot;

The group tightens their formation, weapons at the ready. Hroald leads the charge, his battle-axe gleaming in the dim light. You move forward, every sense heightened, the forest around you growing darker and more oppressive.

Resolved to confront the threat head-on, you grip your weapon, reassured by its weight and fine balance. Raising it above your head, you shout, &quot;let&#39;s slaughter these beasts!&quot;

With a collective shout that seems to momentarily dispel the gathering darkness, you charge into the forest. The canopy above obscures the sky, turning the world into a rush of shadow.

As you penetrate into the forest, an eerie howl pierces the night quickly answered by another from the other side, and then another, surrounding you in a chorus of primal fury. Forms emerge from the trees, long arms, great shaggy heads and torsos covered in fur like a bear’s. They carry long staves or spears and you see charms of stone or bone woven into their coats, as well as the sheen of some strange leather or metal scales worn as armor. 

Suddenly you lock eyes with one of the creatures, and you understand your folly in coming here.

---
Current Energy: $energy
Current combat bonus: $totalCombatBonus

(if: $energy &gt; 50)[
[[Curl into a ball and play dead-&gt;Scream]]
[[Scream]]
[[Flee at full speed]]
[[Fight!]]
](else:)[
Exhaustion overtakes your courage, and your martial training abandons you.
[[Curl into a ball and play dead-&gt;Scream]]
[[Scream-&gt;Scream]]
]</tw-passagedata><tw-passagedata pid="40" name="Attempt Communication" tags="" position="2225,3900" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
Siezed by sudden inspiration, you step calmly forward towards the waters edge, your hands wide in a universal gesture of peace. The creature continues to glide forward, now only 20 feet feet from the water&#39;s edge.

&quot;(print:$name), watch out!&quot; cries Ciar, but you are entranced by the sight of the creature&#39;s form now visible beneath the water. It&#39;s skin is smooth and covered in rippling patterns, and you can see its tremendous bulk looming in the murk below the surface of the water. It&#39;s head is wide and spade-shaped, and traced with strange ridges.

As you watch, the creature&#39;s head rises from the water, so smoothly it makes barely a splash. A row of teeth, uniform and razor sharp, are barely visible the edge of it&#39;s huge mouth, which is easily as wide as the span of your outsretched arms.

Suddenly there is a great sideways thrashing as the creature pumps it&#39;s tail, and it comes forward, upward and out of the water towards you in a great wave, it&#39;s cavernous mouth yawning open to sieze you.

[[Retreat!-&gt;Run from frog]]</tw-passagedata><tw-passagedata pid="41" name="Attempt communication" tags="" position="425,3625" size="100,100">(display: &quot;header&quot;)(set:$energy to it - 12)(set:$effort to 9)(display:&quot;Effort&quot;)
Suddenly a sense of purpose melts through the clouds of fear. Your heart pounds in your chest, but your resolve is firm. &quot;Stay back,&quot; you instruct them softly, &quot;I&#39;ll try to communicate.&quot;  You step forward, leaving behind the protection of your comrades.

The underbrush rustles ominously. You sense many eyes upon you, watching, assessing. The air is heavy with the musk of the wild, a primal scent that speaks of untamed nature.

Taking a deep breath, you raise your hands in a gesture of peace. &quot;We mean you no harm,&quot; you call out, your voice steady despite the pounding of your heart. &quot;We seek understanding, not conflict.&quot;

Suddenly the shadow seems to melt away, and where there was only darkness you see a face, human-like yet distinctly inhuman, with deep-set eyes under a heavy brow, and a wide, flat nose and lips. Other than its face, the creature is covered in dark, sleek fur, although it wears a variety of gear belted and tied to its body.

For a long, tense moment, there is silence, save for the whisper of the wind through the trees. Then, one of the creatures steps forward, its movements deliberate, almost cautious. Its eyes, intelligent and deep, lock onto yours. You feel a connection, an unspoken communication that transcends language.

The creature emits a low, rumbling sound that you feel in your chest rather than your ears. Suddenly, into your mind comes a series of images, flashing quickly in sequence, you see men cutting the forest, great trees crashing to the ground. You see fire, the forest burning, animals fleeing before the great hot wave of death, bones left charred and smoking, streams choked with ash and mud.

&quot;No...,&quot; you hear Ciar gasp, and she actually staggers to one knee under the weight of the vision before Lothar grabs her shoulder to steady her.

Slowly, you lower your hands, maintaining eye contact with the creature.
&quot;No,&quot; you say, your voice clear and steady, echoing Ciar. &quot;That is //not// our wish. We have not come to destroy your home. I am a seeker of truth. I wish the truth of this conflict to be known.&quot;

The moment is fragile, the truce delicate. You take a tentative step back, signaling your respect for their space, and after a moment, the creatures retreat into the depths of the forest, their departure as silent and enigmatic as their arrival.

{
(set:_lore to &quot;The Sceadugenga fight to defend the forest from destruction.&quot;)
//Known Lore added: (print: _lore)//
(if:$knownLore contains _lore)[](else:)[
	(set:$knownLore to it +(a:_lore))
]
(set: $reputation&#39;s &quot;Sceadugenga&quot; to &quot;delicate, hopeful truce&quot;)
}
[[Continue back to the inn to rest]]</tw-passagedata><tw-passagedata pid="42" name="Attempt to Play the Horn" tags="" position="4650,4150" size="100,100">(display: &quot;header&quot;)
Attempt to Play the Horn

The moonlight casts an eerie glow over the clearing as you take a deep breath and carefully remove the horn from its secure place in your pack. The artifact is heavier than it looks, its surface smooth and cool to the touch, with intricate carvings that seem to glow faintly in the moonlight. You run your fingers over the strange material, feeling a sense of awe and trepidation.

You bring the horn to your lips, the cold material sending a shiver down your spine. The forest around you is silent, as if holding its breath in anticipation. With one last look around, you blow into the horn, producing a deep, resonant sound that echoes through the trees, reverberating off the trunks and carrying far into the distance.

The note hangs in the air, lingering like a ghostly presence. You lower the horn, listening intently to the silence that follows. The forest seems to come alive with a sense of anticipation, the leaves rustling softly as if whispering secrets to one another. The air grows cooler, a gentle breeze brushing against your skin.

Moments pass, each one stretching into eternity, and you begin to wonder if you have made a terrible mistake. Just as doubt starts to creep in, you hear a faint rustling sound, growing steadily louder. The hairs on the back of your neck stand on end as you realize you are not alone.

From the shadows of the forest, dark shapes begin to emerge, moving with a grace and silence that is both mesmerizing and terrifying. The Sceadugenga. Cloaked in their active camouflage, they appear as shadowy, indistinct forms, blending seamlessly with the darkness around them. Their presence is overwhelming, and you feel a surge of fear, mingled with a strange sense of resignation.

You clutch the horn tightly, your heart pounding in your chest. The Sceadugenga move closer, surrounding you in a tightening circle. Their forms are barely discernible, like living shadows, their eyes glinting with a cold, otherworldly light. You feel their gaze upon you, assessing, judging, and you realize that this might be the end.

With trembling hands, you slowly lower the horn to the ground, placing it gently before you as an offering. You bow your head, accepting whatever fate awaits you. The Sceadugenga pause, their movements slowing as they observe your actions. The forest is silent once more, the tension thick enough to cut with a knife.

Time seems to stretch, each second an eternity as you wait, your breath shallow and your heart racing. Then, one by one, the Sceadugenga begin to uncloak. The shadows melt away, revealing their true forms in the pale moonlight.

They are unlike anything you have ever seen—tall and lanky, standing between seven and nine feet in height. Their bodies are covered in fur of varying colors, from deep browns and blacks to russet and gray. Their eyes are large and intelligent, glinting with curiosity and ancient wisdom. They do not wear clothes, but their fur is adorned with talismans made of bone, wood, and stone, each one unique and intricate.

In their hands, they carry long staves or clubs, each one carved with symbols and adorned with charms. The air is thick with the scent of earth and wildness, a primal energy that seems to hum with life.

The leader of the group steps forward, his fur a deep black with streaks of silver. He gazes down at the horn, then back at you, his expression inscrutable. You meet his gaze, feeling a connection that transcends words—a shared understanding of the gravity of the moment.

Slowly, he reaches out and picks up the horn, examining it with a reverence that speaks of its importance. He turns to the others, and they nod in silent agreement. The leader looks back at you, his eyes softening slightly.

You rise to your feet, feeling a sense of awe and humility in the presence of these majestic beings. The leader raises his staff, and the others follow suit, creating a circle around you. You stand at the center, feeling the weight of their collective gaze.

In that moment, you realize that you have made the right choice. By returning the horn, you have shown respect and a desire for peace. The Sceadugenga recognize this, and though their ways are foreign and their appearance intimidating, there is a sense of acceptance and understanding.

The leader lowers his staff and takes a step back, breaking the circle. The others follow suit, their forms blending back into the shadows. The leader gives you one last look, a silent acknowledgment of your bravery and wisdom, before turning and leading his kin back into the depths of the forest.

You stand alone in the clearing, the weight of the moment pressing down on you. The forest is silent once more, but the energy has changed. The Sceadugenga have accepted your offering, and with it, a fragile peace has been forged.

**Chapter Complete!**</tw-passagedata><tw-passagedata pid="43" name="Attempt to jump from stone to stone to reach the ruined tower" tags="" position="1975,3050" size="100,100">(display: &quot;header&quot;)(set:$effort to 2)(display:&quot;Effort&quot;)

---
(set: _success to (round: ( (random: 1, 10)+ $energy/10)/2))
Your success: _success / 10!
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]
---
(if: _success &gt; 6 )[
You take a deep breath to steady yourself, and take two steps to gather speed as you approach the edge before leaping carefully, once, twice, and then a third time, maintaining your momentum, to land tenuously at the edge of the structure.

For one heart-stopping moment, you scrabble at the slick stone, unable to find a secure handhold, before managing to lever your arm against the edge of an overhang. You manage to pull your chest up and onto the stone shelf.

From there, you&#39;re able to climb up to the second level.
(set:$achievements to it + (a:&quot;Reached the ruined tower.&quot;))
(set:$moatCleared to true)
[[Continue-&gt;Fen Tower]]
[[Climb back down]]

](else:)[

	(if: $fenRuinRopeSecure )[
You fall in the water and then they drag you out
[[Continue-&gt;Fen ruins approach]]
    ](else:)[
You get eaten by the snakes and shit
    ]


]</tw-passagedata><tw-passagedata pid="44" name="Attempt to sketch the stone runes" tags="" position="2450,3775" size="100,100">(display: &quot;header&quot;)(set:$energy to it - 10)(set:$effort to 5)(display:&quot;Effort&quot;)
You take out a piece of parchment and a stick of charcoal from your pack. The stones loom before you, covered in strange symbols you&#39;ve never seen before.

Ciar watches you. &quot;Be careful,&quot; she says. &quot;Such runes may hold power beyond our understanding.&quot;

You nod and begin to sketch. The charcoal moves smoothly over the parchment.

&quot;Got them,&quot; you say after a few minutes.
{(set: $misc to it + (a:(dm:
&quot;name&quot;, &quot;Standing stone rune sketch&quot;,
&quot;description&quot;, &quot;A sketch of the runes you found on the standing stones in the fen.&quot;
)))}
[[Continue-&gt;Fen]]</tw-passagedata><tw-passagedata pid="45" name="Attempt to sketch the tree runes" tags="" position="725,3850" size="100,100">(display: &quot;header&quot;)(set:$energy to it - 10)(set:$effort to 5)(display:&quot;Effort&quot;)
You take out a piece of parchment and a stick of charcoal from your pack. The tree stands before you, tall and silent, its bark covered in strange symbols you&#39;ve never seen before.

Ciar watches you. &quot;Be careful,&quot; she says. &quot;Such runes may hold power beyond our understanding.&quot;

You nod and begin to sketch. The charcoal moves smoothly over the parchment. The runes are intricate but clear. As you work, the forest is quiet around you, the only sounds the rustle of the wind through the leaves overhead, and the occasional call of a distant bird.

&quot;Got them,&quot; you say after a few minutes.
{(set: $misc to it + (a:(dm:
&quot;name&quot;, &quot;Forest rune sketch&quot;,
&quot;description&quot;, &quot;A sketch of the runes you found on the bark of the tree in the strange grove in the forest.&quot;
)))}
[[continue-&gt;Investigate Tree]]</tw-passagedata><tw-passagedata pid="46" name="Back from tree 2" tags="" position="450,3925" size="100,100">(display:&quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
(if:$energy &lt; 50 )[
A wave of panic washes over you, your breath coming in shallow gasps. Your vision blurs, and for a moment, you feel as though the forest is closing in on you.

Edda notices your distress and places a reassuring hand on your shoulder. &quot;Steady now. It’s just the exhaustion. Take a deep breath and settle yourself.&quot;

]
As you move further, the feeling of eyes watching intensifies. You hear a soft rustling behind you, and everyone stops, weapons at the ready. The silence that follows is deafening, the forest holding its breath along with you.

Suddenly, from the corner of your eye, you catch a glimpse of movement—a shadow shifting among the trees. You turn, heart pounding, but see nothing. The sensation of being surrounded becomes overwhelming.

Suddenly, an eerie call echoes through the trees. It&#39;s unlike any birdcall you&#39;ve ever heard—louder, deeper, and filled with an unsettling resonance. The sound seems to come from everywhere and nowhere at once, and is soon answered by another call from a different direction, creating a haunting symphony that reverberates through the forest.

&quot;They&#39;re here, watching us,&quot; Edda mutters, her voice barely audible.

You strain your eyes, trying to catch any movement among the trees. The forest seems to hold its breath, the silence oppressive and foreboding. Then, out of the corner of your eye, you catch a glimpse of something moving in the shadows.

[[Attack the Sceadugenga]]
[[Flee at full speed]]
[[Retreat carefully in formation]]
[[Attempt communication]]</tw-passagedata><tw-passagedata pid="47" name="Back to shore" tags="" position="3950,2675" size="100,100">(display: &quot;header&quot;)

&quot;Wow, what an experience,&quot; you all reflect amazedly, as you go back to shore. Let&#39;s go back to the Inn and drink about it.

[[Inn Hub]]</tw-passagedata><tw-passagedata pid="48" name="Back-link" tags="" position="175,300" size="100,100">{
(set: _scenes to (history:) - (a: &quot;Character Sheet&quot;,&quot;Plot log&quot;, &quot;eat something&quot;, &quot;Purchase Confirmation&quot;, &quot;Games Dashboard&quot;, &quot;How to play this game&quot;))
(set: _scenes to _scenes - $rolls)
}
(if: length of _scenes is 0)[(link-goto: &quot;Continue game&quot;, &quot;Start&quot;)](else:)[(link-goto: &quot;Back to game&quot;, last of _scenes)]</tw-passagedata><tw-passagedata pid="49" name="Beg for Hrothgar&#39;s mercy" tags="" position="4875,675" size="100,100">Suddenly aware of the danger you are in, you stammeringly apologize and offer your sympathy and support for Heorot&#39;s plight, and your faith in Hrothgar&#39;s divinely inspired leadership.

---
(set: _success to (round: ( (random: 1, 10)+ $energy/10)/2))
Your success: _success / 10 !
(if $energy &gt; 0)[(set: $energy to $energy - 20)]
---

(if: _success &gt; 7 )[
Though you barely know what words you&#39;re saying, you manage to avoid the worst of Hrothgar&#39;s disfavor and manage to slink away to the recesses of the hall.
{
(set: $reputation&#39;s &quot;Heorot Court&quot; to &quot;low&quot;)
(set: $energy to $energy - 20)
}
[[Continue-&gt;Heorot Hub]]
]
(else:)[ 
(set: $reputation&#39;s &quot;Heorot Court&quot; to &quot;low&quot;)
(set: $energy to $energy - 20)
Thanes shove you as you make your way to the exit, their boots and kicks hastening your departure. The once warm and inviting hall now feels hostile and unforgiving. You stumble out into the night, the sound of ridicule ringing in your ears, your dreams of impressing Hrothgar’s court shattered. At least your head is still attached to your neck.

[[Flee the hall in disgrace-&gt;Village Hub]]

]</tw-passagedata><tw-passagedata pid="50" name="Blacksmith" tags="" position="1475,900" size="200,100">(display: &quot;header&quot;)
The forge in Heorot is a hub of relentless activity, the clang of hammer on anvil cutting through the chatter of onlookers. A burly man with muscular arms and a face streaked with soot, evidently the head smith, orchestrates the chaos as a number of assistants scurry about, maintaining the bellows and furnace, and fetching tools and materials.

Outside the forge, a group of villagers and warriors mill, chatting and watching the activity of the forge.

As you approach the forge, one of the assistants, a wiry young man with a serious expression, steps forward to greet you. His hands are rough from work, and his eyes hold the keen sharpness of someone who has seen much in his short life. &quot;Welcome to our forge,&quot; he says, his voice steady and respectful. &quot;How can we assist you today, traveler?&quot;
(set:$effort to 1)(display:&quot;Effort&quot;)
[[Examine the wares-&gt;Smith weapons]]
[[Ask the smith for news of the recent Grendel attacks?-&gt;Smith Grendel Inquiry]]
[[Continue exploring the market-&gt;Market Hub]]
[[Return to the crossroads-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="51" name="Browse the clothing for sale" tags="" position="2050,1000" size="100,100">(display: &quot;header&quot;)

Colorful awnings flutter gently along the merchant booths in the marketplace. The scent of fresh bread mingles with the salty tang of the nearby sea and the rich aroma of spices displayed in open sacks.

You make your way through clothing shops, eyeing the fabrics and designs of varying quality and price.

(set:$effort to 3)(display:&quot;Effort&quot;)

[[Continue exploring the market-&gt;Market Hub]]
{

[Your current silver: (print: $sp)]&lt;sp|


(for: each _item, ...$ClothingShopInventory)[(set:_label to &quot;purchase &quot; + &quot;name&quot; of _item)
(set: _descriptionLabel to &quot;Description of &quot; + _item&#39;s &quot;name&quot;)
---
(print: &quot;name&quot; of _item) |  Price: (print: &quot;price&quot; of _item) silver penningar | (link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] | (link:&quot;purchase&quot;)[
	(set: $purchaseItem to _item)
    (display: &quot;Purchase confirmation&quot;)
    (replace: ?sp)[ [Your current silver: (print: $sp)]&lt;sp|]
]

]
}</tw-passagedata><tw-passagedata pid="52" name="Browse the general goods" tags="" position="1675,1075" size="100,100">(display: &quot;header&quot;)

Colorful awnings flutter gently along the merchant booths in the marketplace. The scent of fresh bread mingles with the salty tang of the nearby sea and the rich aroma of spices displayed in open sacks.

You make your way through the general goods section, where an array of items catches your eye. Earthenware jars of pitch are stacked neatly beside coils of sturdy hemp rope. Iron lanterns hang from wooden beams, their glass panes reflecting the sunlight. A merchant displays flint and steel sets, whetstones, and bundles of candles on a well-worn table.

(set:$effort to 3)(display:&quot;Effort&quot;)

[[Continue exploring the market-&gt;Market Hub]]
{

[Your current silver: (print: $sp)]&lt;sp|


(for: each _item, ...$GeneralShopInventory)[(set:_label to &quot;purchase &quot; + &quot;name&quot; of _item)
(set: _descriptionLabel to &quot;Description of &quot; + _item&#39;s &quot;name&quot;)
---
(print: &quot;name&quot; of _item) |  Price: (print: &quot;price&quot; of _item) silver penningar | (link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] | (link:&quot;purchase&quot;)[
	(set: $purchaseItem to _item)
    (display: &quot;Purchase confirmation&quot;)
    (replace: ?sp)[ [Your current silver: (print: $sp)]&lt;sp|]
]

]
}</tw-passagedata><tw-passagedata pid="53" name="Buy some food" tags="" position="1550,1075" size="100,100">(display: &quot;header&quot;)

A stout woman with flour-dusted hands tends a stall laden with loaves of bread, flatbreads, and sweet rolls. Nearby, a fishmonger with weathered skin and a salt-crusted apron displays a selection of salted fish, smoked eels, and dried herring. Next to him, a butcher offers meat pies and cuts of pork and mutton, the rich scent of roasting meat wafting from his stall.

Across the way, farmers&#39; stalls are piled high with carrots, onions, turnips, and cabbages. A merchant selling dry goods displays sacks of grain, jars of honey, and bundles of dried herbs.

A brewer with a ruddy complexion and a jovial demeanor serves tankards of ale from a large wooden barrel.

(set:$effort to 3)(display:&quot;Effort&quot;)
[[Ask around about Grendel]]
[[Continue exploring the market-&gt;Market Hub]]
{
(display: &quot;Initialize Food Shops&quot;)
[Your current silver: (print: $sp)]&lt;sp|


(for: each _item, ...$foodForSaleMarket)[(set:_label to &quot;purchase &quot; + &quot;name&quot; of _item)
(set: _descriptionLabel to &quot;Description of &quot; + _item&#39;s &quot;name&quot;)
---
(print: &quot;name&quot; of _item) |  Price: (print: &quot;price&quot; of _item) silver penningar | (link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] | (link:&quot;purchase&quot;)[
	(set: $purchaseItem to _item)
    (display: &quot;Purchase confirmation&quot;)
    (replace: ?sp)[ [Your current silver: (print: $sp)]&lt;sp|]
]

]
}</tw-passagedata><tw-passagedata pid="54" name="Challenge Thryth to a duel" tags="" position="3075,3475" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
Sir Thryth laughs in your face, &quot;You aren&#39;t capable of //dueling// me because we aren&#39;t peers. I&#39;m a thane, and you,&quot; he looks you up and down, &quot;are //nothing//. But if you want to settle this argument with blades, nothing would please me more. //Men//,&quot; he emphasizes the word, addressing his guards, &quot;you will stand aside.&quot;

Sir Thryth allows an attendant to come forward and strap a shield to his left arm, and draws his sword to face you.

Ciar and the others attend you and then step aside, eyeing you with concern but trusting to your skills.

[[Duel Thryth]]</tw-passagedata><tw-passagedata pid="55" name="Character Sheet" tags="" position="550,550" size="100,100">---
### Character Sheet: the Skald
---
(display: &quot;Back-link&quot;) | [[Plot log]] | [[Games Dashboard]] | [[How to play-&gt;How to play this game]] 
---
(display: &quot;Status&quot;)
---
(display: &quot;Inventory&quot;)

(display: &quot;Back-link&quot;)</tw-passagedata><tw-passagedata pid="56" name="CheatCode" tags="" position="75,25" size="100,100">(set: $energy to 1000)
(set: $sp to 1000)
(set: $reputation&#39;s &quot;Adventurers&quot; to &quot;allied&quot;)
(set: $weaponsAndArmor to $smithInventory)</tw-passagedata><tw-passagedata pid="57" name="Check on the horses" tags="" position="2825,4850" size="100,100">(display: &quot;header&quot;)
Your Horse:

Svala, your dappled gray mare, snorts softly as she picks her way along the narrow trail. Her ears swivel back and forth, attuned to the whispers of the wind and the subtle creaks of the earth beneath. The reins feel taut in your hands, a silent communication of trust between you and your steed.

Edda&#39;s Horse:

Beside you, Edda guides her black stallion, Gleipnir, a beast as formidable as its rider. Gleipnir&#39;s muscles ripple under a sleek coat, and his breath steams in the cool air. Edda sits tall in the saddle, her blonde hair braided tightly against the wind. Tattoos weave intricate patterns across her skin—symbols of her Gothic lineage. A spiked shield rests on her back, and javelins are secured within easy reach. Her eyes, sharp and calculating, scan the terrain ahead for any sign of danger.

Ciar&#39;s Horse:

Trailing slightly behind is Ciar on her nimble pony, Bran, whose dark coat blends seamlessly with the shadows cast by the overhanging rocks. Ciar&#39;s small frame is wrapped in a cloak of deep green, and strands of her dark hair escape from under her hood. Perched on her shoulder is Morrigan, her raven companion. The bird&#39;s beady eyes reflect the waning light, and it caws softly, a sound that seems to meld with the murmurs of the mountain. Ciar whispers in response, her words a melodic cadence lost to the wind.

Lothar&#39;s Horse:

Lothar the Lombard follows on his sturdy chestnut gelding, Gorm, whose broad back bears the weight of Lothar&#39;s heavy armor with steadfast endurance. Lothar&#39;s blonde hair peeks out from beneath his helmet, his youthful face marred by a perpetual smirk. An imposing axe hangs at his side, and his fingers drum eagerly against the haft. &quot;These hills could use a good clearing,&quot; he mutters, a hint of anticipation in his voice.

Hroald&#39;s Horse:

At the rear rides Hroald, astride Skirnir, a mottled gray horse with a calm demeanor. Hroald adjusts his worn cloak, his keen eyes taking in every detail of the surroundings. Lines of experience etch his face, and a cynical smile plays at the corner of his mouth. &quot;Mind your steps,&quot; he warns. &quot;This path is as treacherous as the promises of a Jarl.&quot;</tw-passagedata><tw-passagedata pid="58" name="Church Hub" tags="" position="1675,2525" size="200,200">(display:&quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)
Inside, the church is sparsely decorated but exudes a sense of earnest devotion. Wooden benches, roughly carved but well-used, line the walls. The wood is dark and polished smooth from years of use, the grain patterns visible under the flickering candlelight. The floor is covered with rushes, replaced regularly to keep the space clean and fresh.

At the front of the church stands a simple altar, made from a large, flat stone supported by wooden legs. A wooden cross, intricately carved with delicate patterns, hangs on the wall behind it. Candles, made from tallow, cast a soft, wavering light. The air inside is cool and carries the faint, smoky scent of burning tallow mixed with the earthy smell of the wooden structure.

An elderly priest with a gentle demeanor tends to the candles on the altar. His hair is white and thin, his face deeply lined with age and worry. He wears simple, worn robes made from coarse wool, dyed a modest brown.

Several people rest in the rear of the church-house, and a pot of gruel and another of thin soup sit over a 

A woman, her hair covered by a simple linen veil, tends to a small child with a worried expression. Her eyes to dart to surreptitiously inspect you, and her movements are quick and furtive, as if expecting danger to burst through the doors at any moment.

One man, his clothes tattered and face gaunt, sits with his head bowed, muttering prayers under his breath. 

The wooden benches are hard, but they offer a place to sit and rest. The rushes on the floor rustle softly underfoot, their earthy scent mingling with the musty smell of the old wood. The few windows, small and covered with oiled parchment to let in light while keeping out the cold, add to the dim, somber atmosphere.


{
(for: each _item, ...$churchLarder)[
---
(print: &quot;name&quot; of _item) | (link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] | (link:&quot;take&quot;)[
	(set: $purchaseItem to _item)
    (set: $purchaseCategory to $food)
    (set: $churchLarder to it - (a:_item))
    (display: &quot;Purchase confirmation&quot;)
    ]

]
---
}
(set:$effort to 3)(display:&quot;Effort&quot;)
(if:$reputation&#39;s &quot;Aelfric&quot; is &quot;unknown&quot;)[
[[Introduce yourself to the priest]] ](else:)[
[[Ask Father Aelfric about the church and its history]]
[[Ask Father Aelfric what he knows of Grendel]]
[[Ask to stay the night-&gt;Sleep at the church]]
]
[[Return to the village-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="59" name="Church Post Execution" tags="" position="5850,1925" size="100,100">(display:&quot;header&quot;)</tw-passagedata><tw-passagedata pid="60" name="Climb a Tree for a Better View" tags="" position="5075,3875" size="100,100">(display: &quot;header&quot;)
Climb a Tree for a Better View

You glance around the small clearing, searching for a suitable tree to climb. Your eyes settle on a sturdy oak, its thick branches spreading wide and offering a promising vantage point. Taking a deep breath, you approach the tree and begin your ascent.

The bark is rough against your palms, its texture providing a reassuring grip as you hoist yourself up. Your muscles strain with the effort, but the physical exertion grounds you, helping to focus your mind in the midst of chaos. The scent of the forest intensifies as you climb higher, a mix of earthy moss and fresh leaves filling your nostrils.

You find a secure branch about halfway up and pause to catch your breath. The wind rustles the leaves, creating a soothing whisper that contrasts with the pounding of your heart. You feel the rough bark pressing into your skin, grounding you in the present moment. The moonlight filters through the canopy, casting intricate patterns of light and shadow that dance across your vision.

Pushing onward, you continue your ascent. The higher you climb, the cooler the air becomes, carrying a faint hint of the sea&#39;s brine. Your arms and legs ache from the effort, but you press on, driven by the need to find a way out of this labyrinthine forest. The leaves brush against your face, their cool touch a reminder of the living, breathing world around you.

Finally, you reach a sturdy branch near the top of the tree. You settle yourself carefully, ensuring a secure perch before looking out over the forest. The sight that greets you is both awe-inspiring and disorienting. The forest stretches out in all directions, a sea of undulating shadows and silvery moonlight. The trees sway gently in the breeze, their leaves rustling like a thousand whispered secrets.

The moon hangs low in the sky, casting a soft glow over the landscape. From this height, the world seems both vast and intimately connected, each tree a part of a greater whole. You take a moment to absorb the beauty of the scene, the sense of peace mingling with the urgency of your mission.

You scan the horizon, looking for any sign of a landmark or a path. To the north, you see a faint glimmer of light—perhaps a reflection of the moon on water, indicating a river or a lake. To the east, the forest seems to thin out, suggesting a possible edge or clearing.

As you sit there, high above the forest floor, you become acutely aware of your surroundings. The sounds of the forest at night are a symphony of life: the distant call of an owl, the soft rustle of small animals in the underbrush, and the occasional creak of the tree itself as it sways in the wind. Your own breath, steady and rhythmic, becomes a part of this natural chorus.

Your skin prickles with the cool night air, and you feel the steady thump of your heartbeat in your chest. The rough bark of the tree digs into your back, a tactile reminder of your precarious position. The smell of the forest—damp earth, fresh leaves, and a hint of blooming nightflowers—fills your senses, grounding you in the reality of this moment.

You also realize the climbing down in the dark will be much more difficult and dangerous than climbing up was.

[[Stay in the Tree to Rest]]: Stay in the tree for a while longer to rest and gather your thoughts, using the height as a vantage point to stay alert.

[[Look for a Safer Route Down]]: Carefully look for an easier, safer route down the tree to avoid any unnecessary risks.</tw-passagedata><tw-passagedata pid="61" name="Climb back down" tags="" position="2100,3200" size="100,100">(display: &quot;header&quot;)(set:$effort to 2)(display:&quot;Effort&quot;)
you get ready to climb back down...
---

(set: $success to  (random: 1, 10) + $energy/10)
(set: $success to it /2)
(set:$success to (round:it))
Your success: $success / 10!
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]
---
(if: $success &gt; 5 )[
You manage to climb back down and reach your companions without problems.
[[Continue-&gt;Fen ruins approach]]
](else:)[
	(if: $fenRuinRopeSecure )[
You fall in the water and get real wet. Plus some giant snakes grab you. Good thing you have that rope, so your pals can drag you out and stab the snakes. nice.
[[Continue-&gt;Fen ruins approach]]
    ](else:)[
You fall in the water and get real wet. Plus some giant snakes grab you. You get eaten by the snakes, but probably drown first.
**GAME OVER :(**
    ]
]</tw-passagedata><tw-passagedata pid="62" name="CommentOnGreed" tags="" position="3125,5725" size="100,100">(display:&quot;header&quot;)
&quot;It seems Eirikr&#39;s greed was his undoing,&quot; you observe somberly. &quot;In seeking to preserve his wealth, he lost everything that truly mattered.&quot;

Véfrøðr nods slowly. &quot;A tale as old as Midgard itself. Mortals often chase shadows, believing wealth or power will grant them immortality or peace. Yet, as the Norns weave the fates, such pursuits often lead to ruin.&quot;

The dragon sighs, a sound like the distant roar of the sea. &quot;Eirikr&#39;s story is a cautionary one, but few heed its lessons. I have watched generations repeat his mistakes, each believing they will be the exception.&quot;

[[Express sympathy for the dragon&#39;s plight-&gt;ExpressSympathy]]
[[Continue-&gt;Dragon Convo Hub]]</tw-passagedata><tw-passagedata pid="63" name="Compliment Unferth&#39;s technique at winning the duel" tags="" position="3075,1475" size="100,100">(display:&quot;header&quot;)
Unferth inclines his head graciously at the compliment. &quot;A useful technique, if not one seen as particularly glorious.&quot; (set:$achievements to it + (a:&quot;Complimented Unferth&#39;s dueling technique.&quot;))

&quot;One of the more... repetitive aspects of my position as Hrothgar&#39;s head of security is defending my own honor. It&#39;s all about communication.&quot; He sighs, &quot;Heorot cannot be seen as weak, but nobody insults the King of course. They challenge the highest ranking  thane that seems weak to them, not realizing that because every challenger chooses the same way, those must be precisely the strongest. So tiresome.&quot;

&quot;Really, it&#39;s all about gold. That fool&#39;s father sent him down here to die on my blade in the hopes of getting some slight advantage in his trade dealings.&quot; He sighs again, looking suddenly weary.

[[Continue-&gt;Unferth Convo Hub]]</tw-passagedata><tw-passagedata pid="64" name="Confide in the Adventurers" tags="" position="800,2450" size="100,100">(display: &quot;header&quot;)

(set:$a to &quot;Confided the secret of the Sceadugenga to the Adventurers&quot;)(display:&quot;addAchievement&quot;)

[[Continue-&gt;Adventurers Hub]]</tw-passagedata><tw-passagedata pid="65" name="Confront Sir Thryth about his cruelty" tags="" position="3225,3350" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
Sir Thryth&#39;s expression hardens. &quot;Mind your tongue. I am lord paramount of this estate under the authority of King Hrothgar.&quot;

Before you can respond, Ciar steps forward, her voice ringing out with anger but clear and steady,
&quot;We&#39;ve found that your actions—ordering the destruction of a sacred grove and enslaving men—may have provoked forces beyond your understanding,&quot; she says. &quot;You claim to follow Christian virtues, yet you engage in the abomination of slavery with //usury// as your excuse. Your intentional desecration of sacred sites in the forest has predictably provoked this conflict, and endangers yourself and all the residents of this region.&quot;

He scoffs. &quot;I won&#39;t be lectured by heathen mercenaries. Your pagan superstitions hold no sway here. You&#39;ve come under the seal of Heorot, and so you have safe passage //off of my land// immediately, but I warn you not to provoke me further. Now get gone.&quot;

[[Challenge Thryth to a duel]]
[[Attempt to place Thryth under arrest-&gt;Fight Thryth]] 
[[Take you leave and head back to Heorot/Kattinge-&gt;Village Hub]]
Escalation:

You hold your ground. &quot;We won&#39;t stand by while you bring ruin upon these people through your hypocrisy and cruelty. Your actions have consequences.&quot;

Sir Thryth&#39;s hand moves to the hilt of his sword. &quot;I owe you no explanations. This is my land, and I won&#39;t have outsiders sowing dissent.&quot;

Edda&#39;s eyes flash. &quot;Your men suffer because of your pride. Innocent lives are at stake.&quot;

A few of Thryth&#39;s guards begin to gather, sensing the rising tension. They grip their weapons, eyes darting between you and their master.

Sir Thryth&#39;s voice drops to a dangerous low. &quot;Perhaps you need a lesson in obedience.&quot;</tw-passagedata><tw-passagedata pid="66" name="Consult Ciar grove" tags="" position="1150,3925" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)

You turn to Ciar, her raven perched on her shoulder. &quot;What do you make of this?&quot; you ask, gesturing toward the tree. &quot;Do you sense anything more?&quot;

Ciar steps closer, examining the markings. &quot;These symbols are ancient,&quot; she says. &quot;They speak of protection and warding. This tree is a guardian, a sentinel of the old ways.&quot;

She reaches out and touches the silvery bark. Closing her eyes, she concentrates. The raven caws softly, as if responding to the tree.

&quot;This tree is more than just a guardian,&quot; Ciar says. &quot;It&#39;s a conduit of old magic, a link between our world and the realm of the Sceadugenga. The symbols aren&#39;t just wards; they&#39;re part of an ancient spell that binds the magic of the forest here.&quot;

[[How can we we use this knowledge against them?]]
[[Search Perimeter]] 
[[continue-&gt;Investigate Tree]]</tw-passagedata><tw-passagedata pid="67" name="Continue Wandering" tags="" position="4500,4000" size="100,100">(display: &quot;header&quot;)</tw-passagedata><tw-passagedata pid="68" name="Continue back to the inn to rest" tags="" position="575,3375" size="100,100">(display:&quot;header&quot;)

Finally, just before darkness fully envelops the forest, you reach the village walls. You make your way back to the inn, the warmth, light and noise making the strange events in the forest seem like a dream.

You find a table in a corner, away from the noise and light of the hearth. The innkeeper brings mugs of ale, and the group drinks in silence, the tension slowly easing as the reality of your safe return sinks in.

Hroald takes a deep breath, his eyes tired but relieved. &quot;To survival, and to learning from our experiences.&quot;

As the night wears on, the inn grows quieter, the other patrons retiring to their rooms or drifting off to sleep by the hearth. The fire crackles softly, and the warmth of the inn wraps around you like a comforting blanket.
(if:$reputation&#39;s &quot;Innkeeper&quot; is &quot;valued customer&quot;)[
[[Continue-&gt;Wake up in the private room]] 
](else:)[
[[Continue-&gt;Wake up at the hearth]]
]</tw-passagedata><tw-passagedata pid="69" name="Continue toward Drekaborg" tags="" position="3625,4550" size="100,100">(display:&quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)

As you progress, the path narrows, forcing you to dismount. The ground underfoot is uneven, a mixture of gravel and shale that shifts unpredictably. You lead the horses carefully, mindful of the sheer drop to your right, where the valley stretches out below like a patchwork quilt of forest and rock.

The wind picks up, carrying with it a chill that bites through your garments. Clouds gather above, casting a gray pall over the landscape. The distant cry of an eagle echoes, a solitary sound in the vastness.

Then, you crest a ridge and catch your first glimpse of Drekaborg. The ruined fort stands atop a hill, silhouetted against the fiery hues of sunset. Crumbling stone walls and the remnants of towers hint at its former grandeur.

Hroald reins in Skadi. &quot;There it is,&quot; he says quietly.

Ciar narrows her eyes. &quot;No signs of activity from this distance, but that doesn&#39;t mean it&#39;s uninhabited.&quot;


The Ruined Fort:

Perched atop a steep incline, the ruined  fort looms like a specter from a forgotten time. Its stone walls, once mighty, are now crumbling and overgrown with creeping vines and lichen. Towers stand in ruin, their battlements jagged against the darkening sky. The fort seems almost fused with the mountain itself, an extension of the rugged terrain.

A narrow path winds its way up to the fort&#39;s entrance, but it&#39;s exposed and would leave you vulnerable. The shadows lengthen as the sun dips lower, and an uneasy silence settles over the area.


Edda narrows her eyes, assessing the fortification. &quot;We can&#39;t approach openly,&quot; she advises. &quot;There may be hidden watchers, and the path is too exposed.&quot;

Ciar closes her eyes briefly, communing with Morrigan. The raven takes flight, circling above before returning to her shoulder. &quot;There&#39;s movement within,&quot; she whispers. &quot;But whether it&#39;s man or beast, I cannot tell.&quot;

Lothar grips his axe with a fierce grin, and says &quot;I&#39;ve been itching for a good fight.&quot;

Hroald shakes his head at Lothar. &quot;Bravado will get us killed. We need a plan.&quot;

[[Drekaborg Quest Hub]]</tw-passagedata><tw-passagedata pid="70" name="Continue toward Thryth" tags="" position="3550,2475" size="100,100">(display:&quot;header&quot;)
As the afternoon begins to wane into evening, you crest the top of a ridge and the scene changes dramatically. A sprawling farmstead dominates the next valley. In the center, a complex of newly constructed wooden buildings is ringed by a high stakewall. Vast swathes of trees have been felled, leaving the land raw and scarred. Groups of men toil in the fields, sowing and reaping under the watchful eyes of overseers on horseback. As you watch, you notice that the laborers appear to be roped together in lines.

&quot;This must be Thryth Farmstead,&quot; Hroald observes, his voice tinged with unease.

Ciar&#39;s eyes narrow. &quot;A grim place. The land itself seems to mourn.&quot;

Lothar grunts. &quot;Let&#39;s hope Sir Thryth is more welcoming than his fields suggest.&quot;

As you approach the entrance to the complex, a sturdy wooden gate reinforced with iron bands, two guards step forward. They wear chainmail and carry spears, their expressions hard.

[[Request Audience with Sir Thryth]]</tw-passagedata><tw-passagedata pid="71" name="Could this be Grendel himself? Take your chance and try to assassinate the Sceadugenga leader!" tags="" position="2750,2850" size="100,100">(display: &quot;header&quot;)

A surge of ambition floods your veins as you stand amidst the ancient beings. Ignoring Torsten&#39;s earlier warning, your hand moves slowly toward the hilt of your sword. The thought of becoming a celebrated hero in Hrothgar&#39;s court, the one who vanquished the leader of the dreaded Sceadugenga, consumes your mind.

Torsten notices the shift in your demeanor. His eyes widen with alarm as he whispers urgently, &quot;What are you doing? Stop this madness!&quot;

But it&#39;s too late. In one swift motion, you unsheathe your sword and lunge at the Sceadugenga leader. Time seems to slow as the blade arcs through the air.

---
(set: _success to (round: ( (random: 1, 10)+ $energy/10)/2))
Your success: _success / 10!
---
(if: _success &gt; 7 )[
(set: $achievements to it + (a:&quot;Slew Sceadugenga chieftan!&quot;))


Your strike finds its mark. The sword pierces the leader&#39;s chest, and a look of shock and pain crosses its bestial, otherworldy features. The other Sceadugenga roar in unison, a sound that shakes the very trees. Torsten&#39;s face contorts with horror and despair.

Before you can revel in your deed, the Sceadugenga descend upon you. Claws and fists strike with the force of a raging storm. Yet, even as the blows rain down, a fierce pride swells within you. Visions of songs sung in your honor and tales of your bravery echo in your mind. You believe wholeheartedly that your name will be etched into the annals of history as a legendary hero who struck a decisive blow against the darkness.

Your vision fades as the world slips away. The forest grows silent once more.

GAME OVER!

](else:)[

Your blade swings toward the leader, but the creature moves with uncanny speed. It sidesteps effortlessly, and your attack cuts through empty air. The Sceadugenga react instantly. A powerful blow strikes you from behind, sending you sprawling to the ground. The forest spins as multiple forms loom over you.

Torsten shouts, &quot;No! Wait!&quot; but his plea is lost in the fury.

The Sceadugenga close in, and darkness envelops you swiftly, your ambitions extinguished as quickly as they ignited.

]</tw-passagedata><tw-passagedata pid="72" name="Current Quest" tags="" position="600,2050" size="100,100">(display: &quot;header&quot;)
Hroald&#39;s expression grows serious, and he leans back in his chair, the firelight casting shadows on his rugged face. &quot;We&#39;re here to aid King Hrothgar in his struggle against what he calls Grendel. Someone or something has been raiding outlying farms and outposts. There are wild reports, and little solid information.&quot;

Edda nods, her green eyes sharp with determination. &quot;There&#39;s good silver in it if we can get to the bottom of who is behind the attacks. Everyone around here talks like there&#39;s some great devil, this //Grrrendel//,&quot; she draws out the word for mock dramatic effect, using a recognizably local accent that brings a chuckle from the others, &quot;but it&#39;s hard to credit that when attacks and sighting have been so wide. We&#39;ve seen kingdoms come under pressure from bandits and unruly tribes, so we assume this is just another such group resisting the expansion of Hrothgar&#39;s territory and influence. It&#39;s not the first time we&#39;ve been called in to handle such matters.&quot;

Ciar&#39;s raven flaps its wings and caws softly as she speaks. &quot;The locals here have all sorts of tales about Grendel and his kin, painting them as monstrous beings. But we&#39;ve seen enough to know that fear and superstition can make men see monsters where there are none. Our task is to bring order, whether by force or... perhaps by understanding what drives the conflict.&quot;

&quot;Sure, sure, Ciar.&quot; Lothar chuckles. &quot;We&#39;re mercenaries, not missionaries. In every land there are people who resist change, or who fight to protect what they believe is theirs against those who declare themselves rulers. We&#39;re here for Hrothgar&#39;s silver. And if that means cutting down a few &#39;monsters&#39; to do it, so be it.&quot;

Ciar&#39;s face is unreadable as she studies your face, rather than Lothar&#39;s. Hroald nods, his gaze steady and determined. &quot;We&#39;re here to get the job done. We&#39;ll scout the area, learn what we can, and deal with these attackers. Our goal is to make Heorot safe, for the right price, of course.&quot;

At that, all of the adventurers raise their glasses.

[[Ask Ciar what she means]]
[[Continue-&gt;Adventurers Hub]]
[[Ask about their past battles-&gt;Past Battles]]</tw-passagedata><tw-passagedata pid="73" name="Debrief Unferth about your findings at Drekaborg" tags="" position="3750,2025" size="100,100">(display: &quot;header&quot;)

[[Back-&gt;Unferth Quest Hub]]</tw-passagedata><tw-passagedata pid="74" name="Decline and Seek Another Solution" tags="" position="3925,3125" size="100,100">(display: &quot;header&quot;)</tw-passagedata><tw-passagedata pid="75" name="Defeat Thryth" tags="" position="3125,3750" size="100,100">&quot;It&#39;s over, Thryth,&quot; you state firmly. &quot;You will release the thralls and cease your exploitation of this land.&quot;

He laughs bitterly. &quot;You overstep. These people are property, and the land is under my control by royal decree.&quot;

&quot;Not anymore,&quot; Edda interjects. &quot;Your actions have voided any claim to authority.&quot;

The thralls begin to gather courage, stepping closer. One among them, a sturdy man with a determined gaze, steps forward. &quot;We won&#39;t be held in chains any longer.&quot;

Sir Thryth looks around, seeing the shift in power. His guards are disarmed or unwilling to fight further. The workers and thralls now outnumber any loyal to him.

&quot;You&#39;ll regret this,&quot; he hisses.

&quot;Perhaps,&quot; you reply. &quot;But not as much as you&#39;ll regret your choices if you continue down this path.&quot;

Final Resolution:

Under your watch, the thralls remove their shackles. Some of Thryth&#39;s men lay down their arms, choosing to join the liberated rather than defend a fallen master.

Ciar approaches Thryth. &quot;There&#39;s still a chance for redemption. Learn from this, or the consequences will be dire.&quot;

He says nothing, his face a mask of rage and humiliation.

The freed workers begin to discuss plans to return to their homelands or establish their own community.
You offer guidance on how to avoid further conflict with the forest and its guardians, sharing what you&#39;ve learned about the grove.

[[Execute Sir Thryth and his henchmen, release the thralls and innocents.]]
[[Return to King Hrothgar to report Thryth&#39;s actions and the situation.]]</tw-passagedata><tw-passagedata pid="76" name="Defend your actions against Datrub" tags="" position="3125,4000" size="100,100">Your Response:

You step forward calmly. &quot;Great King Hrothgar, we stand before you not as rebels, but as those who seek justice and balance. Sir Datrub&#39;s actions have not only violated the sanctity of these lands but have also brought peril upon your people.&quot;

Hrothgar&#39;s eyes narrow slightly. &quot;Explain yourself.&quot;

Presentation of Your Case:

You recount the events:

    Destruction of the Sacred Grove: &quot;Sir Datrub ordered the destruction of a sacred grove—trees of ancient significance, bearing markings and imbued with powers beyond mortal understanding.&quot;

    Enslavement and Cruelty: &quot;He holds men in bondage, treating them with cruelty contrary to the virtues you uphold.&quot;

    Supernatural Retribution: &quot;His actions have provoked the wrath of forces manifesting as attacks on his farmstead, endangering not only his domain but potentially spreading to your own.&quot;

Ciar steps forward. &quot;We have witnessed signs of unrest among the spirits of the land. The balance is disturbed.&quot;

Edda adds, &quot;We confronted Sir Datrub about these matters, seeking a resolution, but he chose violence over reason.&quot;

Reactions in the Hall:

The gathered crowd reacts with a mix of shock and skepticism. Some whisper of old superstitions; others eye you warily.

Unferth leans toward Hrothgar. &quot;My king, these are serious allegations. But we must consider the source. Outsiders, perhaps with their own agenda.&quot;




[[Hrothgar&#39;s Wrathful Response]]</tw-passagedata><tw-passagedata pid="77" name="Depart to take Marta to the Church" tags="" position="2825,3650" size="100,100">(display:&quot;header&quot;)
Yay Marta goes to live at the church
{
(set:$newQuest to &quot;Help Marta and her children&quot;)(display:&quot;questComplete&quot;)
}
[[Church Hub]]</tw-passagedata><tw-passagedata pid="78" name="Depart to take Marta to the inn" tags="" position="2775,3800" size="100,100">(display:&quot;header&quot;)
Yay Marta goes to live at the inn
{
(set:$newQuest to &quot;Help Marta and her children&quot;)(display:&quot;questComplete&quot;)
}
[[Inn Hub]]</tw-passagedata><tw-passagedata pid="79" name="Depart to take Marta to the village elders" tags="" position="2650,3800" size="100,100">(display:&quot;header&quot;)
Yay Marta goes to live with the Village Edlers
{
(set:$newQuest to &quot;Help Marta and her children&quot;)(display:&quot;questComplete&quot;)
}
[[Elders Hub]]</tw-passagedata><tw-passagedata pid="80" name="Discuss Quest: Shadow over the Queen" tags="" position="5000,1350" size="100,100">(display:&quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)
(set: $newQuest to &quot;Spy on Queen Wealhtheow for Aeschere&quot;)
(if: $completedQuests contains $newQuest )[

](else-if: $activeQuests contains $newQuest )[

Aeschere whispers, leaning in conspiratorially, &quot;I have reason to suspect that Queen Wealhtheow herself harbors sympathies for the old ways. She spends much time away from the court, visiting the Whispering Forest and communing with... undesirable elements.&quot;

&quot;Observe the queen. Follow her if necessary. Find proof of her heresy. But be cautious—she is cunning and well-guarded. Bring any evidence directly to me.&quot;
](else:)[(display:&quot;getNewQuest&quot;)

Aeschere whispers, leaning in conspiratorially, &quot;I have reason to suspect that Queen Wealhtheow herself harbors sympathies for the old ways. She spends much time away from the court, visiting the Whispering Forest and communing with... undesirable elements.&quot;

&quot;Observe the queen. Follow her if necessary. Find proof of her heresy. But be cautious—she is cunning and well-guarded. Bring any evidence directly to me.&quot;
]

[[Back-&gt;Aeschere Quest Hub]]</tw-passagedata><tw-passagedata pid="81" name="Discuss Quest: The Lost Relic of St. Cuthbert" tags="" position="4950,1625" size="100,100">(display:&quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)

    &quot;There is a relic of immense power—a fragment of the staff of St. Cuthbert, a holy man who drove pagan spirits from these lands in ages past. It was lost during a skirmish with northern raiders and is said to be hidden in the Barrow of the Ancient Ones, a tomb shrouded in myth.&quot;

    Aeschere&#39;s voice grows fervent. &quot;Retrieve this relic for me. With it, we can bolster the king&#39;s faith and drive back the darkness encroaching upon us.&quot;

    He unfurls a tattered map marked with cryptic symbols. &quot;But beware—the barrow is guarded by restless spirits and traps set by those who buried their secrets. Only the righteous may pass unharmed.&quot;
    
(set: $newQuest to &quot;Find the lost relic of St. Cuthbert&quot;)(display:&quot;getNewQuest&quot;)
[[Back-&gt;Aeschere Quest Hub]]</tw-passagedata><tw-passagedata pid="82" name="Discuss Quest: Unveil Unferth" tags="" position="5050,1500" size="100,100">(display:&quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)
(set: $newQuest to &quot;Slip Aeschere&#39;s holy water into Unferth&#39;s drink&quot;)
(if: $completedQuests contains $newQuest )[

](else-if: $activeQuests contains $newQuest )[
Aeschere&#39;s eyes narrow. &quot;Unferth, the king&#39;s favored thane, is another who bears watching. He skulks in shadows and traffics with suspicious characters. His loyalty is... questionable.&quot;

&quot;You have certain attributes that may cause him to become... interested in you. If so, get close to him. Take the opportunity to search for any artifacts or writings that reveal his true intentions. But //do not confront him//—he is dangerous and will not hesitate to silence those who threaten him.&quot;

He produces a small vial from a pocket in his robes, &quot;Pour a drop of this into his drink, if you have the chance. If he consorts with dark forces, signs will manifest—unholy symbols, disturbances in the air.&quot;
](else:)[(display:&quot;getNewQuest&quot;)
Aeschere&#39;s eyes narrow. &quot;Unferth, the king&#39;s favored thane, is another who bears watching. He skulks in shadows and traffics with suspicious characters. His loyalty is... questionable.&quot;

&quot;You have certain attributes that may cause him to become... interested in you. If so, get close to him. Take the opportunity to search for any artifacts or writings that reveal his true intentions. But //do not confront him//—he is dangerous and will not hesitate to silence those who threaten him.&quot;

He produces a small vial from a pocket in his robes, &quot;Pour a drop of this into his drink, if you have the chance. If he consorts with dark forces, signs will manifest—unholy symbols, disturbances in the air.&quot;
(set: $newQuest to &quot;Spy on Unferth for Aeschere&quot;)
(display:&quot;getNewQuest&quot;)
(set: $newQuest to &quot;Slip Aeschere&#39;s holy water into Unferth&#39;s drink&quot;)(display:&quot;getNewQuest&quot;)

(set:$misc to it + (a: $holyWater))
]

[[Back-&gt;Aeschere Quest Hub]]</tw-passagedata><tw-passagedata pid="83" name="Discuss quest: Dispose of the Relic" tags="" position="4050,2000" size="100,100">(display: &quot;header&quot;)
Unferth takes a deep breath, as if weighing his words. &quot;Finally, there is a personal matter I need assistance with. In my efforts to... suppress pagan magic, I have come across a relic of significant power. It is said to be cursed, and I need someone to help me transport it to a place where it can be safely disposed.&quot;

He glances around to ensure no one is within earshot. &quot;The journey will be perilous, and the relic itself may attract unwanted attention from those who covet its power. We must be discreet. If certain... parties learn we possess this artifact, they will stop at nothing to claim it.&quot;

He meets your eyes earnestly. &quot;Your discretion and skill make you an ideal candidate for this task. Will you assist me?&quot;

[[Inquire about the Relic Quest]]</tw-passagedata><tw-passagedata pid="84" name="Discuss quest: Find the Dragon&#39;s Lair" tags="" position="3675,2150" size="100,100">(display: &quot;header&quot;)
&quot;Speaking of dragons,&quot; Unferth&#39;s voice drops to a whisper, his eyes scanning the room before continuing, &quot;there is also a more... unusual task. We know there is a dragon in the area, though it has not been seen in two generations. Its lair is hidden, but finding it could provide us with invaluable resources—or unleash a terrible threat.&quot;

(if:$reputation&#39;s &quot;Véfrøðr&quot; is &quot;unknown&quot;)[
[[Inquire about the details of the dragon quest-&gt;Dragon Quest Inquiry]]
](else:)[
[[Debrief Unferth about your findings at Drekaborg]]
]
[[Back-&gt;Unferth Quest Hub]]</tw-passagedata><tw-passagedata pid="85" name="Discuss quest: Hunt the Bandit Leader" tags="" position="4500,1475" size="100,100">(display: &quot;header&quot;)

Unferth&#39;s expression turns somber. &quot;There is another matter that troubles me greatly. Rumors speak of a group of marauding bandits taking advantage of the chaos caused by Grendel&#39;s attacks. These bandits are not just a threat to our people; they might also be in league with the Sceadugenga.&quot;

He continues, &quot;If we can locate their hideout and eliminate the threat they pose, it would bring much-needed relief to Heorot.&quot;

{
(set: _quest to &quot;Quest recieved: Hunt the bandit leader.&quot;)
(if: $activeQuests does not contain _quest)[
	(if: $completedQuests does not contain _quest)[
		(set: $activeQuests to it + (a: _quest))
Unferth produces a rolled parchment from within his cloak and unfurls it to reveal a portrait sketch so exquisitely detailed that you are sure it was produced with magic of some kind.
		(set: $misc to it + (a: (dm:
    &quot;name&quot;, &quot;Wanted Bandit Sketch&quot;,
    &quot;description&quot;, &quot;A detailed sketch of Skarde the Grim, wanted dead or alive by King Hrothgar for crimes of banditry and collusion with Grendel.&quot;
    )))
		(if: $reputation&#39;s &quot;Village Elders&quot; is &quot;unknown&quot;)[
The image portrays a rugged man with a scar across his nose and left eye, a menacing sneer etched upon his lips.
		](else:)[
You instantly recognize Torsten the woodsman, one of the elders of Kattinge Village. You take a steadying breath, aware of Unferth&#39;s eyes upon you 
		]
	]
]
}
&quot;Start by speaking with the villagers and the guards, then report back to me. They may have sightings or information. Some may even be sympathetic to him, so tread carefully. Approach this task with caution—such a man can be as deadly as a dragon if you let down your guard.&quot;

[[Tell Unferth bandit info]]
[[Unferth Quest Hub]]</tw-passagedata><tw-passagedata pid="86" name="Discuss quest: Investigate the attack on Thryth farmstead" tags="" position="3500,2000" size="100,100">(display: &quot;header&quot;)

&quot;I need someone reliable to go out to Thryth farmstead and sort fact from fiction regarding the recent so-called Grendel attacks,&quot; unferth says plainly, indicating the location on the map. &quot;I am interested in what people are saying about what happened, but more so in what people actually witnessed with their own eyes, and what physical evidence there is. I&#39;d like to draw my own conclusions, but I don&#39;t have the time to travel out there myself,&quot; he laments. &quot;Be my eyes and ears. Do it well and I will reward you well.&quot;
{
(set: _quest to &quot;Investigate Thryth Farmstead&quot;)
(if: $activeQuests does not contain _quest)[
	(if: $completedQuests does not contain _quest)[
		(set: $activeQuests to it + (a: _quest))
	]
]
}
[[Set out for Thryth farmstead]]
[[Back-&gt;Unferth Quest Hub]]</tw-passagedata><tw-passagedata pid="87" name="Discuss quest: Locate sources of Sceadugenga magic" tags="" position="3450,1525" size="100,100">(display: &quot;header&quot;)
Unferth strokes his chin reflectively. &quot;Of Sceadugenga magic, we know precious little, other than that they seem to be adept. There are reports that they frequent certain sites throughout the forest, particular caves, glens, or circles of stone. Scout carefully any areas that bear their traces and recover any artifacts or materials you can.&quot;
{
(set: _quest to &quot;Locate Sources of Sceadugenga Magic&quot;)
(if: $activeQuests does not contain _quest)[
	(if: $completedQuests does not contain _quest)[
		(set: $activeQuests to it + (a: _quest))
	]
]
}
{(for: each _item, ...$misc)[
  (if: _item&#39;s &quot;name&quot; is &quot;Face fruit&quot;)[
  (link:&quot;Give Unferth the fruit of the sacred tree&quot;)[
  Unferth&#39;s eyes hungrily scan the sketch as soon as you lay it on the table, and he nods to himself, looking satisfied.
	(set:$misc to it - (a:_item))
&quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;&lt;br&gt;
    //Reward: 100sp//&lt;br&gt;
(set:$sp to it + 100)

  ]
  ]
  (if: _item&#39;s &quot;name&quot; is &quot;Branch from the face fruit tree&quot;)[
    (link:&quot;Give Unferth the branch from the face fruit tree&quot;)[
  Unferth&#39;s eyes hungrily scan the sketch as soon as you lay it on the table, and he nods to himself, looking satisfied.&lt;br&gt;
	(set:$misc to it - (a:_item))
&quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;&lt;br&gt;
    //Reward: 100sp//&lt;br&gt;
(set:$sp to it + 100)
  ]
  ]
   
  (if: _item&#39;s &quot;name&quot; is &quot;Forest rune sketch&quot;)[
  (link:&quot;Give Unferth the sketch of the runes on the sacred tree&quot;)[
  Unferth&#39;s eyes hungrily scan the sketch as soon as you lay it on the table, and he nods to himself, looking satisfied.&lt;br&gt;
	(set:$misc to it - (a:_item))
&quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;&lt;br&gt;
    //Reward: 100sp//&lt;br&gt;
(set:$sp to it + 100)
  ]
  ]
  
  (if: _item&#39;s &quot;name&quot; is &quot;Standing stone rune sketch&quot;)[
  (link:&quot;Give Unferth the sketch of the runes on the standing stones in the fen&quot;)[
  Unferth&#39;s eyes hungrily scan the sketch as soon as you lay it on the table, and he nods to himself, looking satisfied.&lt;br&gt;
	(set:$misc to it - (a:_item))
    (set:$sp to it + 100)
&quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;&lt;br&gt;
    //Reward: 100sp//&lt;br&gt;
  ]    
  ]
  
  
    (if: _item&#39;s &quot;name&quot; is &quot;Tower rune sketch&quot;)[
  (link:&quot;Give Unferth the sketch of the runes on the tower&quot;)[
  Unferth&#39;s eyes hungrily scan the sketch as soon as you lay it on the table, and he nods to himself, looking satisfied.&lt;br&gt;
	(set:$misc to it - (a:_item))
    (set:$sp to it + 100)
&quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;&lt;br&gt;
    //Reward: 100sp//&lt;br&gt;
  ]    
  ]
]

(if: $knownLore contains &quot;The Sceadugenga tend a magic tree in the forest (location known).&quot; and $completedQuests does not contain &quot;Locate Sources of Sceadugenga Magic (The Sacred Grove)&quot;)[


  (link:&quot;Tell Unferth of the Sceadugenga&#39;s sacred grove&quot;)[
  Quest Complete: &quot;Locate Sources of Sceadugenga Magic (The Sacred Grove)&quot;&lt;br&gt;
	(set:$completedQuests to it + (a:&quot;Locate Sources of Sceadugenga Magic (The Sacred Grove)&quot;))
    	  Unferth&#39;s eyes are uncharacteristically wide with candid interest as you relate the story of your discovery the tree, and carefully mark its location on a map for him.
 &quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;   &lt;br&gt;
    
    //Reward: 100sp//&lt;br&gt;
(set:$sp to it + 100)
  ]
]
$standingStoneLore
(set:_unferthStoneQuest to &quot;Locate Sources of Sceadugenga Magic (The Standing Stones)&quot;)
(if: $knownLore contains $standingStoneLore and $completedQuests does not contain _unferthStoneQuest)[

  (link:&quot;Tell Unferth of the standing stones in the fen&quot;)[
  Quest Complete: (print:_unferthStoneQuest)&lt;br&gt;
	(set:$completedQuests to it + (a:_unferthStoneQuest))
    	  Unferth&#39;s eyes are uncharacteristically wide with candid interest as you relate the story of your discovery the standing stones, and carefully mark its location on a map for him.&lt;br&gt;
 &quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;   &lt;br&gt;
    
    //Reward: 100sp//&lt;br&gt;
(set:$sp to it + 100)
  ]
]

}
(if:$reputation&#39;s &quot;Adventurers&quot; is &quot;allied&quot;)[
[[Prepare to scout the forest with your party in the morning-&gt;Heorot night before patrol]] ]
[[Back-&gt;Unferth Quest Hub]]</tw-passagedata><tw-passagedata pid="88" name="Discuss quest: Recruit a party" tags="" position="3700,1475" size="100,100">(display: &quot;header&quot;)
{(set: _quest to &quot;Recruit a party&quot;)}
(if: $activeQuests contains _quest)[
	(if: $reputation&#39;s &quot;Adventurers&quot; is &quot;allied&quot;)[
&quot;Excellent,&quot; Unferth acknowledges your comrades with approval, &quot;With a small but powerful group under your command, you&#39;ll now be able to take on more lucrative and interesting assignments.&quot;

Unferth reaches into a concealed compartment beneath his cloak and produces a sleek quiver filled with arrows. The shafts are crafted from dark ash wood, straight and true, fletched with black raven feathers. The arrowheads are wrought from a strange, dark metal that seems to absorb the light, and they emit a faint, ominous glimmer.

&quot;These are no ordinary arrows,&quot; he whispers, his eyes meeting yours. &quot;Each tip is coated with Niðdraca&#39;s Bane. It is a poison that reacts very energetically when it contacts the blood of a magical creature.&quot;

His eyes gleam as he hands carefully hands you the quiver. &quot;It has proven effective against trolls, and I suspect it will also be deadly to the Sceadugenga.&quot; If you have the opportunity to test this theory and present me with the evidence of the result, I will be grateful indeed.
{	(set:$doneQuest to _quest)(display:&quot;questComplete&quot;)
      (set: $weaponsAndArmor to it + $unferthArrows) 
      }
	]
](else:)[
    (set: $newQuest to _quest)
	(display:&quot;getNewQuest&quot;)

Unferth&#39;s eyes glint with a hint of excitement. &quot;Heorot needs strong leadership for its patrols. While we have many brave warriors, few can organize and lead them effectively.&quot;

He gestures subtly toward the bustling market outside the hall&#39;s windows. &quot;There are many foreign mercenaries in town, drawn like flies to a rotting corpse, but most of them are riffraff. If you can find a group of capable individuals—men and women of skill and discretion—and organize them into an effective patrol, I will personally provide you with additional weaponry.&quot;

He adds, &quot;Under your leadership, they could undertake tasks that require a delicate touch or a strong arm, depending on the need. Success in this endeavor could open doors to more significant and profitable opportunities.&quot;

]
[[Back-&gt;Unferth Quest Hub]]</tw-passagedata><tw-passagedata pid="89" name="Discuss quest: Root out paganry among the villagers" tags="" position="4775,1500" size="100,100">(display:&quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)
(set: $newQuest to &quot;Root out paganry among the villagers&quot;)
(if: $completedQuests contains $newQuest )[

](else-if: $activeQuests contains $newQuest )[
](else:)[
(display:&quot;getNewQuest&quot;)
]

He leans in, his voice lowering conspiratorially. &quot;There are those within our own village who still cling to the old ways. King Hrothgar has decreed that such practices are forbidden, but I suspect some still practice pagan magic and perhaps possess artifacts of significant power.&quot;

&quot;You must be cautious in your approach,&quot; Aeschere says.efforts to gather information and identify these individuals would be of great service. If they suspect you, they will hide their activities more carefully, which would be... inconvenient.&quot;

&quot;Blend in with the villagers, earn their trust, and observe their activities. Look for signs—unusual gatherings, symbols carved into wood or stone, whispered conversations. Report back to me with what you find. Tell //no one// else.&quot;
[[Inform Aeschere about pagan activities]]


[[Back-&gt;Aeschere Quest Hub]]</tw-passagedata><tw-passagedata pid="90" name="Discuss the duel with Unferth" tags="" position="3075,1350" size="100,100">(display:&quot;header&quot;)
&quot;Ah, my good bard,&quot; says Unferth. &quot;Join me for a drink? I hope your evening has been more placid than my own.&quot;

He leads you away from the center of the hall.

[[Compliment Unferth&#39;s technique at winning the duel]]
[[Continue-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="91" name="Do the draugr have any weaknesses?" tags="" position="3800,6425" size="100,100">(display: &quot;header&quot;)</tw-passagedata><tw-passagedata pid="92" name="DodgePig" tags="" position="1525,4125" size="100,100">(set:$effort to 3)(display:&quot;Effort&quot;)
The nightmare pig-thing lets out a strange, low, belching roar unlike the sound of any pig, and charges toward you, waggling its spiked head menacingly as it picks up speed.

The ground trembles beneath you as the creature comes. With no weapon in hand, you decide to trust to your own skill and agility to save you.

---
(set: _success to (round: ( (random: 1, 10)+ $energy/10)/2))
(set: _success to it + $totalCombatBonus)
Your success: _success / 10!
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]
---
(if: _success &gt; 8 )[

You manage to twist sidways, placing your hand on its great head and pushing off at just the right moment to avoid the threshing spikes on the creature&#39;s head as it swipes at you.  It circles back to face you, its beady eyes tracking you carefully as its plots its next charge.

Then, with two satisfying //thwack// sounds, you one arrow and then another bury themselves in the creature&#39;s flank, followed by one of Edda&#39;s long Javelins, which sinks deep into the flesh of its back. With a pained, angry bellow, the creature turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.
[[Continue-&gt;Patrol Hub]]
](else:)[

You twist sideways, placing your hand on the creature&#39;s great head and attempting to push off at just the right moment to avoid the threshing spikes as it swipes at you. You manage to avoid the main force of the beast&#39;s charge, but it&#39;s huge slashing head smashes against you hard enough to lift you from your feet and knock you sprawling to the ground.

	(if: $totalArmorBonus &gt; 6)[
Fortunately your armor protects you from the worst of the onslaught, and no part of your body seems to be punctured or broken.

As you scramble back to your feet, you see two arrows bury themselves in the creature&#39;s flank, followed by one of Edda&#39;s long Javelins, which sinks deep into the flesh of its back. With a pained, angry bellow, the creature turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.
    (set:$health to it - 10)
    [[Continue-&gt;Patrol Hub]]
    ](else:)[


You lie gasping on the ground, trying to orient yourself through the pain, unsure how much of the blood covering you is yours and how much is the creature&#39;s. It&#39;s ragged, outraged breath fills your ears as you stumble for your weapon, but then you hear one, then another //thwack// as your companions arrows find its flank, with little effect. 

A moment later you look up just as the length of one of Edda&#39;s javelins buries deep itself into the creature&#39;s back.

With a pained, angry bellow, the great beast turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.

Your companions come to your side and try to help you to your feet, but you can feel that critical things are broken inside you, and your time is short. In the last few moments as the darkness closes in, you reflect on what has brought you to this point, and what might be the true meaning of all of this. What is anyone&#39;s story really worth when everyone dies in the end, when all that remains are //words//, half-understood by unkown strangers, their true meaning forgotten.

//&#39;&#39;Game Over&#39;&#39;//
    ]
]
</tw-passagedata><tw-passagedata pid="93" name="Draconic Surprise" tags="" position="3450,5125" size="100,100">(display: &quot;header&quot;)

You awaken to the soft glow of dawn filtering through the canopy of leaves above. The chill of the morning air brushes your skin, and for a moment, everything seems peacefully still. Then, you hear a noise like someone politely clearing their throat, only it seems to come up, not from the forms of your sleeping companions beside you, nor from Edda, who should be keeping watch nearby, but from *above*.
Your eyes snap open and your heart pounds as your vision clears, revealing the sinuous form of a dragon coiled on an outcropping of the rocky wall which overhangs your campsite, enjoying the soft rays of the morning sun. Its scales, which look gray as rock at first, shimmer with hues of emerald and metallic purple as the light plays over them. It is difficult to distinguish legs or wings in the curled mass of its body, and as dragon shifts you see that its size is deceptive; with its tail wound about it like a snake it seems scarcely larger than a man, perhaps the size of a bear. But you can tell that if it were to unfurl, it would be immensely long.

The dragon regards you with a gaze that is both curious and weary, almost sardonic.

“Ah, you’re awake,” it says in a raspy voice, amusement. “I was beginning to wonder if I should come back later.”

Your companions stir at the sound. Edda snaps awake, her hand instantly reaching for a javelin. Her eyes widen as she takes in the sight before her. “By the gods…”

Ciar sits up slowly, her raven Morrigan fluttering nervously. She whispers an incantation under her breath, her gaze locked on the dragon.

Lothar scrambles to his feet, looking around for his axe. Hroald is frozen, mouth hanging open, apparently in shock from sheer sudden physical presence of the dragon.

It now raises a slender claw and circles it in a causal, placating gesture. “Let’s take it easy, everyone. I’m not here for a fight—believe me, it’s been ages since I’ve had a decent conversation.”

The dragon chuckles softly. “But where are my manners? I haven’t even introduced myself.”
(set:$reputation&#39;s &quot;Véfrøðr&quot; to &quot;friendly&quot;)
[[Attack the Dragon-&gt;Attack Dragon]]
[[Flee from the Dragon-&gt;Flee from Dragon]]
[[Converse with the Dragon-&gt;Dragon Convo Hub]]</tw-passagedata><tw-passagedata pid="94" name="Dragon Convo Hub" tags="" position="3525,5700" size="200,100">(display: &quot;header&quot;)
&quot;We have no desire for conflict,&quot; you say evenly. &quot;We seek understanding. Perhaps you can help us.&quot;

The dragon&#39;s eyes, deep pools of ancient wisdom and sorrow, flicker with a hint of surprise and mirth. &quot;Understanding,&quot; it echoes softly. &quot;A rare pursuit in these forsaken ruins.&quot;

It shifts its coils slightly, the movement revealing more of its immense, serpentine form.

&quot;Véfrøðr am I,&quot; the dragons voice rumbles musically, &quot;Bound to this place by chains of no metal, cursed to guard a treasure I despise, for a master long dead. Grateful indeed to the one who sets me free.&quot;

[[Ask About the History of Drekaborg-&gt;AskAboutHistory]]
[[Question the Dangers Present Here-&gt;QuestionDangers]]
[[Inquire for more details about the Curse Binding the Dragon-&gt;InquireCurse]] 
[[Question Why Previous Visitors Have Failed-&gt;AskAboutVisitors]]
[[Ask About the Draugr]]
[[Ask what the dragon knows of grendel and the sceadugenga]]
[[Ask for any advice on how to defeat Eirkr and set Véfrøðr free-&gt;Ask how to set the dragon free]]

[[Attack Véfrøðr]]
[[Vow to defeat Eirkr and free Véfrøðr]]</tw-passagedata><tw-passagedata pid="95" name="Dragon Quest Inquiry" tags="" position="3800,3250" size="100,100">(display: &quot;header&quot;)

Unferth leads you over to a wooden table and retrieves a small, ancient map from a hidden compartment in his belt. &quot;This was discovered among my family&#39;s relics,&quot; Unferth says softly. The parchment is brittle and the edges tattered, and the ink faded with age, although the map is remarkably detailed. Intricate runes and symbols decorate the margins, and a winding path leads to a mountain depicted with flames.

&quot;Start your search in this area,&quot; he says, indicating a point on the map referenced as Drekaborg and indicated to be a ruined fort. 
He fixes you with a piercing gaze. &quot;If you can locate the entrance to the dragon&#39;s cave, it would be a significant boon to Heorot. Be warned, dragons are not to be taken lightly, even in slumber.&quot;

He hands you the map carefully. &quot;Dragons leave signs of their presence—scorched earth, melted stone, and tales whispered by the wind. Be vigilant. The journey is fraught with peril, but the rewards—ancient treasures, knowledge, perhaps even dragon scales—could be beyond measure.&quot;

Unferth&#39;s gaze hardens as he gives you some final advice.

&quot;Remember, the dragon is a legend, but it is still a creature of flesh and blood. To the point at hand, it is an adversary with strengths and weaknesses. The goal of this mission is to gather intelligence on the whereabouts and status of the beast. Do not be a fool and get yourself killed, or neither of us shall have what we desire.

&quot;The area to search is several days ride from here.&quot; Unferth explains.

&quot;If you and your retinue are prepared to depart on the morrow, I&#39;ll have the stablemen prepare your mounts and equippage.&quot;

(if:length of $horses &gt;= 5)[
[[Set out for Drekaborg]]
](else:)[
//You must acquire enough horses for your party.//
]
[[Tell Unferth you need more time to prepare.-&gt;Unferth Quest Hub]]</tw-passagedata><tw-passagedata pid="96" name="Draw your sword and attempt to run Bjorn through" tags="" position="4750,2500" size="100,100">(display: &quot;header&quot;)
Bjorn&#39;s jaw drops and he looks down in mute surprise for a moment at your sword, which has pierced several inches into his chest</tw-passagedata><tw-passagedata pid="97" name="Drekaborg Quest Hub" tags="" position="3300,4525" size="200,200">(display: &quot;header&quot;)

You find yourselves at the outskirts of Drekaborg, the ruined fort looming atop the hill like a silent sentinel. 
The air is crisp and thin, tinged with the scent of pine and the distant promise of snow. From the north, you have journeyed, and now the towering mass of the mountain looms to the south, its peaks piercing the heavens like ancient guardians.

The terrain here is unforgiving—a maze of steep inclines and jagged rocks that challenge both horse and rider. Your mounts must tread cautiously, their hooves dislodging loose stones that clatter down the slopes, echoing ominously in the stillness. Every sound seems amplified, a reminder of the need for stealth in this desolate place.



[[Check on the horses]]
[[Observe the fort]]
[[Establish a hidden base camp-&gt;Set Up Drekaborg Camp]]
[[Scout the area for caves and signs of dragon activity-&gt;Scout Drekaborg Surroundings]]</tw-passagedata><tw-passagedata pid="98" name="Duel Thryth" tags="" position="2975,3600" size="100,100">(display: &quot;header&quot;)(set:$effort to 0)(display:&quot;Effort&quot;)

Round 1

(set: _success1 to (round: ( (random: 1, 10)+ $energy/10)/2))
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]
(set: _success1 to it + $totalCombatBonus)
Your success: _success1 / 10!

---
(if: _success1 &gt; 7 )[

	(set: _success2 to (round: ( (random: 1, 10)+ $energy/10)/2))
    (if: $energy &gt; 20)[(set: $energy to $energy - 20)]
    (set: _success2 to it + $totalCombatBonus)
    Your success: _success2 / 10!
    (if: $energy &gt; 20)[(set: $energy to $energy - 20)]
    ---
    (if: _success1 &gt; 7 )[


Round 2
	](else:)[

]



](else:)[


(if: _success1 &gt; 7 )[

	(set: _success2 to (round: ( (random: 1, 10)+ $energy/10)/2))
    (if: $energy &gt; 20)[(set: $energy to $energy - 20)]
    (set: _success2 to it + $totalCombatBonus)
    Your success: _success2 / 10!
    (if: $energy &gt; 20)[(set: $energy to $energy - 20)]
    ---
    (if: _success1 &gt; 7 )[



Round 2
	](else:)[

	]



Your companions come to your side and try to help you to your feet, but you can feel that critical things are broken inside you, and your time is short. In the last few moments as the darkness closes in, you reflect on what has brought you to this point, and what might be the true meaning of all of this. What is anyone&#39;s story really worth when everyone dies in the end, when all that remains are //words//, half-understood by unkown strangers, their true meaning forgotten.
]</tw-passagedata><tw-passagedata pid="99" name="Effort" tags="" position="175,900" size="100,100">{
(if: (a: &quot;Character Sheet&quot;,&quot;Plot log&quot;, &quot;eat something&quot;, &quot;Purchase Confirmation&quot;, &quot;Games Dashboard&quot;, &quot;How to play this game&quot;) does not contain (history:)&#39;s last)[
(if: $energy &gt; 125)[(set:$energy to 125)]
(set: $energy to $energy - (random:0,$effort))
(if: $energy &lt; 0)[(set:$energy to 0)]
]
}
//Current Energy: (print:$energy)/100//</tw-passagedata><tw-passagedata pid="100" name="Eir Hub" tags="" position="1325,1450" size="200,100">(display: &quot;header&quot;)

(if: $reputation&#39;s &quot;Eir&quot; is &quot;hostile&quot;)[
You approach Eir&#39;s stall with a sense of unease. Her sharp eyes flicker up to meet yours, lacking the warmth they once held. &quot;So, you&#39;ve returned,&quot; she remarks coolly. &quot;What is it that you want this time? We trusted you and you betrayed us, murderer.&quot;

Her gaze does not leave yours as she repeats the word, louder, not shouting but with a ringing clarity that carries through the marketplace, &quot;Murderer!&quot;

[[Return to the village crossroads-&gt;Village Hub]]

](else-if: $reputation&#39;s &quot;Eir&quot; is &quot;unknown&quot;)[
(set: $reputation&#39;s &quot;Eir&quot; to &quot;friendly&quot;)

Behind the stall stands a striking woman. Her long, flowing silver hair cascades over her shoulders, catching the dappled sunlight. Sharp, keen eyes meet yours, seeming to see not just you but through you, as if reading the pages of your life&#39;s story. Despite the color of her hair her face is strangely ageless, and she carries herself with a quiet, dignified grace.

Noticing your approach, she offers a warm, welcoming smile. &quot;Greetings, traveler,&quot; she says, &quot;I am Eir, keeper of herbs and seeker of truths.&quot;
](else-if: $reputation&#39;s &quot;Eir&quot; is &quot;friendly&quot;)[
Eir looks up from arranging a selection of fragrant herbs and greets you with a genuine smile. &quot;Ah, it&#39;s good to see you again,&quot; she says warmly. &quot;How have you been getting along? Have you learned anything interesting?&quot;
]
(set:$effort to 0)(display:&quot;Effort&quot;)
[[Ask about Grendel&#39;s impact on daily life-&gt;Eir grendel daily life?]]
[[Ask about old rituals or customs]]
[[Purchase herbs or other goods]]
[[Excuse yourself and continue exploring the market-&gt;Market Hub]]</tw-passagedata><tw-passagedata pid="101" name="Eir grendel daily life?" tags="" position="1725,1600" size="100,100">(display: &quot;header&quot;)
Eir&#39;s expression grows thoughtful as she considers your question.
&quot;In times past, our ancestors had a different relationship to  Grendel&#39;s folk--the Shadow Walkers or //Sceadugenga// as they are called in the old tongue. Though are worlds are seperate, there was respect and balance. Men and women would leave offerings, and fulfill certain rites and agreements, in order to maintain peace with the spirits of the forest. Now, with King Hrothgar&#39;s conversion to the new faith, those old ways are forbidden. The fear remains, and with no way to appease it, in the darkness it festers and grows.&quot;

She pauses, her eyes distant. &quot;Children are warned to stay close to home, to mistrust their neighbors, to fear the forest and wild places. Even the bravest warriors speak of a malaise that grips their hearts. To people gripped by fear, the very land feels tainted, as if Grendel&#39;s threat has seeped into the soil and air, poisoning everything. They fear the very //land// itself,&quot; she says sadly. &quot;Do you understand?&quot;

[[Continue speaking with Eir-&gt;Eir Hub]]
[[Continue exploring the market--&gt;Market Hub]]</tw-passagedata><tw-passagedata pid="102" name="Elders Approach" tags="" position="2650,1125" size="100,100">(display: &quot;header&quot;)(set:$energy to it - 8)(set:$effort to 8)(display:&quot;Effort&quot;)

The elders of Heorot Village sit around a small fire, drinking tea and conversing quietly. Their faces, etched with the lines of many winters, turn towards you with a mix of curiosity and guarded interest.
(if: $reputation&#39;s &quot;Eir&quot; is not &quot;unknown&quot;)[
Eir, the herbalist smiles and waves to you. “Ah, our adventuring skald. Have you come to hear some tall tales?
]
(set: _quest to &quot;Meet the elders of Kattinge Village&quot;)
(if: $completedQuests does not contain _quest)[
(set: $completedQuests to it + (a: _quest))
]
(set: $activeQuests to it - (a: _quest))
[[Approach the elders-&gt;Elders Hub]]
[[Back to the crossroads-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="103" name="Elders Demand" tags="" position="2375,1375" size="100,100">(display: &quot;header&quot;)

(set: $reputation&#39;s &quot;Village Elders&quot; to &quot;Hostile&quot;)
[[Continue-&gt;Elders Hub]]</tw-passagedata><tw-passagedata pid="104" name="Elders Hub" tags="" position="2675,1475" size="200,200">(display: &quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)

(if: $reputation&#39;s &quot;Village Elders&quot; is &quot;unknown&quot;)[

As you approach the gathering under the ancient oak, the elders sit in quiet contemplation, their faces partially obscured by shadows. There&#39;s an air of mystery about them, a sense that each carries stories untold and wisdom unspoken.

[[Introduce yourself as a traveling Skald seeking knowledge of the old ways.-&gt;Elders Introduction]]
[[Demand to know if the elders are true Christians or follow pagan ways.-&gt;Elders Demand]]

](else-if: $reputation&#39;s &quot;Village Elders&quot; is &quot;friendly&quot;)[

The elders greet you warmly, their lined faces turning toward you with curiosity. Eir offers you a cup of tea from a steaming pot.

Beside her sits Ivar, his face etched with deep laugh lines and a snowy beard covering his chest. His eyes sparkle with a storyteller&#39;s charm.

Torsten the woodsman paces and looks out over the distant horizon of land and sea, his gnarled hands clasped over a walking stick carved from oak. He speaks rarely, but his words are measured and profound, revealing a deep connection to the land and its hidden truths.

{
(for: each _item, ...$eldersHangLarder)[
---
(print: &quot;name&quot; of _item) | (link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] | (link:&quot;take&quot;)[
	(set: $purchaseItem to _item)
    (set: $purchaseCategory to $food)
    (set: $churchLarder to it - (a:_item))
    (display: &quot;Purchase confirmation&quot;)
    ]

]
---
}

(if:$reputation&#39;s &quot;Véfrøðr&quot; is &quot;trusted&quot;)[
[[Ask the edlers&#39; advice about Véfrøðr-&gt;Elders dragon hub]]
]
[[Ask Eir about Grendel&#39;s impact on daily life]]
[[Ask Ivar about the lore of the land]]
[[Ask about old rituals or customs]]
[[Ask about the region&#39;s history-&gt;Elders Inquiry History]]
[[Ask Torsten to guide you into the forest-&gt;Torsten Guide]]
[[Demand to know if the elders are true Christians or follow pagan ways.-&gt;Elders Demand]]

[[Return to the village-&gt;Village Hub]]

](else-if: $reputation&#39;s &quot;Village Elders&quot; is &quot;Hostile&quot;)[
they hate you!!!
(set:$effort to 5)(display:&quot;Effort&quot;)
[[Return to the village-&gt;Village Hub]]
]</tw-passagedata><tw-passagedata pid="105" name="Elders Inquiry History" tags="" position="2400,1750" size="100,100">(display: &quot;header&quot;)

The elders exchange knowing glances, a silent understanding passing between them. Eir, the woman with long, flowing silver hair and eyes as sharp as polished stone, begins to speak. She folds her hands gracefully in her lap, her voice a soft echo of ancient times that commands attention.

&quot;In the days of old, when the earth was young and the skies were vast and clear, this land was different,&quot; she says. &quot;Forests stretched endlessly, their trees so tall they seemed to touch the very heavens. The sea was wilder then, its waves crashing against the shore with untamed fury. Creatures of legend walked openly under the sun and moon—elves danced in the meadows, and giants roamed the mountains. Magic was not just a memory but a living, breathing force.&quot;

Bjorn, his snowy white beard cascading over his chest like a frozen waterfall, leans in. His deep-set eyes reflect the flickering light of the hearth fire, and his voice emerges as a low rumble, resonant and profound. &quot;Our village has stood for countless generations,&quot; he says, &quot;built upon the stories and sacrifices of those who came before us. Legends of gods and monsters, of heroes whose deeds shaped the very contours of the land. But one legend has always loomed larger than the rest—the legend of Grendel.&quot;

Torsten, his hands gnarled like the roots of the ancient oak under which they sit, clasps them together thoughtfully. Though his back is bent with age, his eyes still glimmer with youthful curiosity. He gazes into the distance as if seeing visions others cannot. &quot;Grendel&#39;s tale is woven into the very fabric of our history,&quot; he adds, his voice rough yet steady. &quot;Some say he is the spawn of ancient spirits, a guardian of the old world angered by the relentless encroachment of man. Others whisper that he is a curse from a forgotten god, a punishment for our arrogance and the sins we&#39;ve committed against the earth.&quot;

Eir&#39;s sharp eyes meet yours, a hint of melancholy softening their intensity. &quot;Grendel is not just a monster of flesh and claw,&quot; she continues. &quot;He embodies the fears and guilt of humanity—the shadows we cast upon the world and upon ourselves. His legend reminds us of the delicate balance between man and nature, a balance we have too often disrupted.&quot;

Bjorn nods solemnly. &quot;There are stories of villages that honored the old ways, where humans and the beings of the wild coexisted in harmony. But as time passed, respect gave way to dominion. Trees were felled without gratitude, rivers diverted without thought, and the sacred places forgotten.&quot;

Torsten&#39;s voice grows almost wistful. &quot;The land remembers,&quot; he says. &quot;It holds the echoes of all that has been—joy and sorrow, harmony and discord. If you listen closely, you might hear the whispers of the old songs, the ones that wove together the destinies of all creatures.&quot;

Eir places a gentle hand over her heart. &quot;But remember, traveler, history is a river with many currents,&quot; she muses. &quot;What is legend today may have been truth once, and what is truth now may become legend tomorrow. The lines blur, and often the deepest truths are found not in facts but in the stories we tell and the lessons we heed.&quot;

She leans forward slightly, her gaze piercing yet compassionate. &quot;So when you hear tales of Grendel, consider not just the fear they invoke but the wisdom they offer. Perhaps he is a warning—a reminder of what happens when harmony is broken. Or perhaps he is a call to action, urging us to restore the balance before it&#39;s too late.&quot;

Bjorn strokes his beard thoughtfully. &quot;We share this with you not to burden you, but to enlighten you,&quot; he says. &quot;Every traveler who passes through our village becomes a part of its story. Perhaps you, too, have a role to play in what is to come.&quot;

Torsten smiles faintly, the lines on his weathered face deepening. &quot;Carry these stories with you,&quot; he advises. &quot;Let them guide your steps and inform your choices. For in the end, we are all threads in the same tapestry, each one affecting the others in ways we may not yet understand.&quot;

A moment of silence settles among you, filled only by the soft rustling of leaves and the distant call of a bird. The weight of their words hangs in the air, inviting reflection.

[[Continue-&gt;Elders Hub]]
[[Excuse yourself and return to the village-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="106" name="Elders Inquiry Recent Events" tags="" position="2275,1550" size="100,100">(display: &quot;header&quot;)
[[Continue-&gt;Elders Hub]]
[[Excuse yourself and return to the village-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="107" name="Elders Introduction" tags="" position="2575,1275" size="100,100">(display: &quot;header&quot;)
You explain that you, (print:$name), are on a quest to investigate the mystery of Grendel and compose an epic poem that will last through the centuries. This is your destiny as a Skald: to uncover the truth of this strange, dark secret, and bring it to light.

Eir smiles and nods to the others in turn, a moment of silent accord passing between them before proceeding with introductions.

Torsten, a tall and wiry man with scraggly gray hair under a green cap, is a woodsman, son of a local local woman and a Sami hunter who spent the last few years in Kattinge after travelling far and wide. He spends more time out in the forest than under a roof and avoids town, as he tends not to get along with Hrothgar&#39;s thanes.

Ivar is a large man with a round face and belly, a ruddy complexion and warm, booming laugh. He describes himself as a retired fisherman and inveterate gossip, story-teller, and card-shark.

Eir is the village&#39;s herbalist and healer, a graceful woman with silver-hair and a strangely ageless face. Her knowing eyes and warm smile convey not just friendly curiosity but a strange feeling of gravity to this meeting, as if 

(set: $reputation&#39;s &quot;Village Elders&quot; to &quot;friendly&quot;)
[[Continue-&gt;Elders Hub]]</tw-passagedata><tw-passagedata pid="108" name="Elders Post Execution" tags="" position="5025,2225" size="100,100">(display: &quot;header&quot;)
You make your way to the well, hoping to speak with the elders. As you approach, the familiar group of elders is gathered, but their usual warmth is gone. Their faces are etched with sorrow and anger, a stark contrast to the peaceful setting.

Eir, the herbalist, is the first to notice you. Her eyes narrow, and she rises to her feet. “What do you want here, betrayer?” Her voice is sharp, cutting through the silence.

Bjorn, the storyteller, steps forward, his expression stern. “You led them to Torsten. You betrayed our trust and condemned an innocent man to death. Have you come to gloat over the pain you’ve caused?”

The other elders murmur in agreement, their eyes filled with hurt and mistrust. The bond you had hoped to build with them now seems irrevocably broken.

You raise your hands in a gesture of peace. “I only wanted to protect Heorot. I didn’t realize—”

“Didn’t realize?” Eir interrupts, her voice trembling with fury. “Torsten sought to understand the Sceadugenga to save us all, and you handed him over to Hrothgar’s wrath. Your actions have only sown more fear and division.”

Another elder, a woman with silver hair and sharp eyes, steps forward. “You’ve shown where your loyalties lie, bard. Leave us. We have no more to say to you.”

The atmosphere is thick with tension and disappointment. The elders turn their backs on you, resuming their quiet conversation, now laced with sorrow and caution. It’s clear that any chance of earning their trust again has been shattered.

As you walk away, the weight of your actions settles heavily on your shoulders. The road ahead in Heorot is now even more fraught with challenges and mistrust.

[[Drink yourself to sleep at Heorot-&gt;Grendel Attack]]
[[Drink yourself to sleep at the Inn-&gt;Inn Post Execution]]
[[Sleep at the Church-&gt;Church Post Execution]]</tw-passagedata><tw-passagedata pid="109" name="Elders dragon hub" tags="" position="2300,2100" size="100,100">[[Ask Eir about making a sleeping potion for a dragon]]</tw-passagedata><tw-passagedata pid="110" name="EnergyReset" tags="" position="150,1050" size="100,100">{(set: $energy to 100)(display:&quot;Initialize Larders&quot;)}
---
//Energy restored to (print:$energy)/100//
---</tw-passagedata><tw-passagedata pid="111" name="Enter the Underground Tunnel" tags="" position="3225,4875" size="100,100">(display: &quot;header&quot;)

spoooky!!!</tw-passagedata><tw-passagedata pid="112" name="Examine Thryth Scene" tags="" position="3025,3075" size="100,100">(display: &quot;header&quot;)(set:$ThrythInvestigation to it+20)

Thryth assigns one of the guards to lead you around. he shows you the wreckage fo the small, bare shack where the thralls lived, who were killed in the attack. It&#39;s one such shack in a row of several others, which are still intact.

the small shack was literally torn apart rather than broken into, with the door torn away from its hinges and another wall smashed in.

&quot;But why did they target //this// group and no other?&quot; muses Ciar.

[[Continue-&gt;Thryth Hub]]</tw-passagedata><tw-passagedata pid="113" name="Examine the horses" tags="" position="4125,4675" size="100,100">(display:&#39;header&#39;)(set:$effort to 10)(display:&quot;Effort&quot;)
(for: each _horse, ... $horses)[
---
(print:_horse&#39;s &quot;name&quot;)
(set: _statuses to _horse&#39;s &quot;statusSnippets&quot;)
(set: _status to _statuses&#39;s (1))
(print: _status)
(if: _status contains &quot;OK&quot;)[
](else:)[
(link:&quot;horse healing time&quot;)[]
]
]


---
(display: &quot;Back-link&quot;)</tw-passagedata><tw-passagedata pid="114" name="Execute Sir Thryth and his henchmen, release the thralls and innocents." tags="" position="3250,3875" size="100,100"></tw-passagedata><tw-passagedata pid="115" name="Exhausting flight back to town" tags="" position="125,3775" size="100,100">(display:&quot;header&quot;)(set:$energy to it - 12)(set:$effort to 9)(display:&quot;Effort&quot;)
The forest seems endless as you flee, your legs burning and lungs aching from the exertion. The trees blur past you, and the path becomes a treacherous obstacle course of roots and rocks. The others catch up eventually, their faces pale and strained with fear.

&quot;We need to keep moving!&quot; Hroald urges, his voice rough with exertion.

Ciar’s raven circles above, its caws frantic and disoriented. Edda’s shield is still raised, but her eyes betray her fear. The group pushes on, driven by the terror of what might be following.

The forest seems alive, the shadows dancing and shifting around you. Every step feels heavier, and the thought of Lothar’s fate haunts your mind. But there is no time to mourn; survival is the only priority.

Finally, the dense trees begin to thin, and the sight of the village walls in the distance brings a glimmer of hope. The group stumbles into town, breathless and exhausted, hearts still pounding with the adrenaline of the escape.

Once inside the safety of the walls, the reality of what just happened sinks in. You’ve lost Lothar, and the weight of that loss hangs heavily over the group. The once lively inn now feels like a refuge from the horrors outside.

Inside, you find a table in a corner, away from the noise and light of the hearth. The innkeeper brings mugs of ale, and the four of you drink in silence, trying to drown the shame and terror of the day’s events.

Hroald stares into his mug, his face a mask of grief and anger. &quot;We should have stayed and fought. Lothar didn&#39;t deserve to die like that.&quot;

Ciar nods, her raven now perched silently on her shoulder. &quot;We’ll honor his memory, but we need to be smarter if we’re going to survive this.&quot;

Edda raises her mug, her eyes glistening with unshed tears. &quot;To Lothar, a brave warrior. May his spirit find peace.&quot;

The fear and shame of your flight lingers, a stark reminder of the dangers that still loom outside the village walls. You all drink deeply, seeking respite at the bottom of the cup. 

[[Drink yourself to sleep-&gt;Grendel Attack]]</tw-passagedata><tw-passagedata pid="116" name="Explain that Unferth has tasked you with an official investigation of the facts around the attack." tags="" position="3425,3100" size="100,100">(display: &quot;header&quot;)
Sir Thryth&#39;s face seems to harden at Unferth&#39;s name, but his nod of acknowledgment seems grudging. 
&quot;Ah,&quot; he says flatly, &quot;Unferth wishes to... investigate. I was hoping to receive support in the form of reinforcements, as I carry out the King&#39;s fight on the very front of this war. But I suppose I must deal with a minister if the purse strings are to be loosened, pagan serpent though he may be. Tell me, what does //Unferth// wish to know?&quot;
{(set:$reputation&#39;s &quot;Thryth&quot; to &quot;suspicious&quot;)}
[[Continue-&gt;Thryth Hub]]</tw-passagedata><tw-passagedata pid="117" name="Explain that you are a Skald, investigating Grendel attacks so you can tell the true tale far and wide" tags="" position="3275,2775" size="100,100"></tw-passagedata><tw-passagedata pid="118" name="Explain that you have come to earn Hrothgar&#39;s favor by rooting out paganry and Grendel&#39;s influence." tags="" position="3300,2875" size="100,100">(display: &quot;header&quot;)
His stern face softens somewhat, and he straightens, and says graciously, &quot;Welcome then Thryth estate. It seems I have the pleasure of hosting another warrior in the struggle against the heathen darkness of this foul land.&quot;

[[Continue-&gt;Thryth Hub]]</tw-passagedata><tw-passagedata pid="119" name="Express Intentions" tags="" position="2800,2500" size="100,100">(display: &quot;header&quot;)
You take a deep breath, meeting the gaze of the being before you. &quot;I&#39;ve heard many tales, but I seek the truth. I wish to understand and find a way to restore harmony between our peoples.&quot;

Torsten translates your words. The Sceadugenga regard you silently. Then, the leader extends a hand, placing it gently over your heart. A flood of images and emotions washes over you—memories of tranquil forests, the pain of loss, the hope for coexistence.

They withdraw their hand, and you feel a profound connection. Torsten smiles softly. &quot;They see sincerity in you. There is hope yet.&quot;
(set: $expressedIntentions to true)
[[Ask about their perspective on the conflict-&gt;Seek Their Story]]
[[Express remorse for the harm caused by humans against the sceadugenga]]
[[Could this be Grendel himself? Take your chance and try to assassinate the Sceadugenga leader!]]
(if: $soughtStory and $expressedRemorse)[
[[Pledge your help in restoring the old balance]]
]</tw-passagedata><tw-passagedata pid="120" name="Express Your Desire to Aid Heorot" tags="" position="4000,1525" size="100,100">(display: &quot;header&quot;)
(set: $reputation&#39;s &quot;Unferth&quot; to &quot;trusted&quot;)
Unferth’s eyes soften slightly, his expression approving. “A noble sentiment. Heorot needs all the support it can gather. Use your talents wisely, and you may become a valued ally to our cause.”

[[Continue-&gt;Unferth Quest Hub]]</tw-passagedata><tw-passagedata pid="121" name="Express a Desire for Fame" tags="" position="3950,1225" size="100,100">(display: &quot;header&quot;)
&quot;I seek to unravel the truth behind the tales of Grendel and compose an epic that will be remembered for generations. My journey is one of discovery and storytelling,&quot; you say, meeting Unferth’s gaze with earnest determination.

Unferth nods, his expression thoughtful. “A noble quest. The truth often lies hidden beneath layers of legend and fear. Your perspective as an outsider could indeed shed new light on our plight.”

He pauses, then adds, “Be mindful, though. Not all are receptive to new interpretations of old stories.”

He considers you for a moment longer, then continues, “Your songs could inspire our warriors, boost their morale. Use your talent wisely, and it might earn you a place of respect here.”

[[Continue talking to Unferth-&gt;Unferth Convo Hub]]
[[Excuse yourself-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="122" name="Express remorse for the harm caused by humans against the sceadugenga" tags="" position="3050,2725" size="100,100">(display: &quot;header&quot;)
(set: $expressedRemorse to true)
[[Express your desire to restore harmony between peoples-&gt;Express Intentions]]
[[Ask about their perspective on the conflict-&gt;Seek Their Story]]
(if: $expressedIntentions and $soughtStory)[

[[Pledge your help in restoring the old balance]]
]

A profound sense of sorrow fills you as the weight of their story settles upon your heart. You meet the eyes of the Sceadugenga leader and bow your head respectfully.

&quot;I am deeply sorry for the suffering my people have caused,&quot; you say sincerely. &quot;I see now the harm we&#39;ve inflicted—the sacred places we&#39;ve defiled, the trust we&#39;ve broken. Please know that not all of us wish for conflict. Some of us seek understanding and peace.&quot;

The Sceadugenga regard you silently, their glowing eyes reflecting a mix of ancient wisdom and lingering hurt. Then, the leader steps forward, extending a hand toward you. In their palm rests a small, carved piece of wood shaped like an oak leaf.

Torsten speaks softly beside you. &quot;They offer this token as a symbol of tentative trust. Accepting it means you are committed to seeking harmony between our peoples.&quot;

(set: $misc to it + (a: (dm:
&quot;name&quot;,&quot;Sceadugenga Leaf Charm&quot;,
&quot;description&quot;,&quot;A tiny wooden statue of an oak leaf, given to you by the Sceadugenga&quot;
)))
(set: $expressedRemorse to true)
[[Express your desire to restore harmony between peoples-&gt;Express Intentions]]
[[Ask about their perspective on the conflict-&gt;Seek Their Story]]
[[Could this be Grendel himself? Take your chance and try to assassinate the Sceadugenga leader!]]
(if: $expressedIntentions and $soughtStory)[
[[Pledge your help in restoring the old balance]]
]</tw-passagedata><tw-passagedata pid="123" name="ExpressSympathy" tags="" position="3175,5875" size="100,100">(display: &quot;header&quot;)
&quot;I&#39;m sorry for what you&#39;ve endured,&quot; you say sincerely. &quot;No one should be forced into servitude against their will. Is there any way we can help you?&quot;

A flicker of surprise crosses Véfrøðr&#39;s features. &quot;You would offer aid to a creature such as I?&quot; It studies you intently. &quot;Perhaps there is a glimmer of hope yet.&quot;

[[Comment on the Folly of Greed and Its Consequences-&gt;CommentOnGreed]]
[[Continue-&gt;Dragon Convo Hub]]</tw-passagedata><tw-passagedata pid="124" name="Fen" tags="" position="1925,3600" size="200,100">(display: &quot;header&quot;)(set:$effort to 10)(display:&quot;Effort&quot;)
(if:(history:)&#39;s last is &quot;Patrol Hub&quot;)[
Your party moves carefully along a narrow, winding path barely visible through the  underbrush. The forest here is ancient, towering oaks and twisted yews looming overhead. As you progress, the undergrowth becomes thicker and the ground swampier, and a thin mist begins to weave its way between the trunks of the trees, curling around your ankles like ghostly tendrils.
]

The forest opens up to reveal a vast fen—a sprawling wetland shrouded in a low-lying mist that obscures the horizon. Pools of dark, still water reflect the graying sky, dotted with clusters of reeds and lily pads. Ancient willows bow toward the water, their long, wispy branches trailing across the surface. Massive boulders jut out from the mire

The air is full of the rustling of reeds, the croak and chitters of frogs and insects, and the occasional splash of something larger moving in the water. The scent of the fen is rich and earthy, a mixture of peat and decaying vegetation.

Deeper into the interior of the fen, you see a low hillock with what appears to be a ring of standing stones, and farther to the south you can make out the outline of some sort of raised structure, perhaps the ruins of a fort or settlement.

(if:$frogDefeated)[](else:)[
Ripples spread across the surface of the water out towards the center of the nearest pool. A pair of eyes breaks the surface—large, unblinking, set atop a massive, head that looms just beneath the surface. The creature itself must be easily the size of a small boat.

&quot;By the gods,&quot; Hroald breathes, eyes wide.

[[Observe the swamp creature-&gt;Fen observe creature]] ]
[[Back to the forest-&gt;Suggest Retreat]] 
[[Make for the standing stones]]
[[Make for the structure-&gt;Fen ruins approach]]</tw-passagedata><tw-passagedata pid="125" name="Fen Tower" tags="" position="1675,3125" size="100,100">(display: &quot;header&quot;)(set:$effort to 10)(display:&quot;Effort&quot;)
{
(set:_lore to &quot;&quot;)
(if:$knownLore contains _lore)[](else:)[
	(set:$knownLore to it +(a:_lore))
]
}
Inside, the air is cooler and carries the musty odor of the mosses and fungi that carpet most of the damp stone. The faint light filtering through the breaks in the walls casts long, gloomy shadows of the jumble of wreckage that fills the interior of the tower.


[[Climb back down]]</tw-passagedata><tw-passagedata pid="126" name="Fen observe creature" tags="" position="1975,3800" size="100,100">(display: &quot;header&quot;)(set:$effort to 3)(display:&quot;Effort&quot;)

&quot;By the gods,&quot; Hroald whispers again. &quot;By the //gods//, what manner of beast is that?&quot;

Edda grips her javelin tightly, her eyes narrowed. &quot;I&#39;ve never seen its like.&quot;

&quot;A handsome trophy its head would make,&quot; chuckles Lothar.

The great creature drifts silently toward you, its wide eyes calm and alien.

[[Observe the creature-&gt;Wait and watch fen creature]]
[[Tell Edda to attack-&gt;Tell Edda to attack the fen creature]]
[[Back to the forest-&gt;Suggest Retreat]] 
[[Attempt to communicate with the creature in some way-&gt;Attempt Communication]]</tw-passagedata><tw-passagedata pid="127" name="Fen ruins approach" tags="" position="1975,3375" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
{
(set:_lore to &quot;There fens contain the ruins of a mysterious tower (location known).&quot;)
(if:$knownLore contains _lore)[](else:)[
	(set:$knownLore to it +(a:_lore))
]
}
(if: last of (history:) is &quot;Fen&quot;)[You make your way carefully south toward the ruins, carefully following a ridge of dry land that juts up through the otherwise impassable bubbling murk.]

The remains of an ancient structure loom up out of the fen, what must at some point have been a sort of round tower. There is a sort of obscene, necrotic look to the ruin, so crumbled it should not be able to stand.

The solid pathway you have followed up to this point becomes uneven and gappy as you approach the structure, which seems to have sunken into the swamp, its foundation hidden beneath the water. Between you and the tower lie about 20 feet of water, with a series of boulders or broken foundation stones protruding up out of the water every few feet.

[[Observe the water]]
[[Observe the tower]]
(if:$misc contains $climbingRope)[
(link:&quot;Tie the climbing rope around yourself and give the other end to Lothar, in case you fall in the water.&quot;)[
You remove your armor and weapons, and secure the rope around your waist as a harness. Hroald, Edda, and Lothar grin and gives you the thumbs up, prepared to haul you out of the water in case you fall in. Ciar keeps watch, eyes scanning the horizon.
(set:$fenRuinRopeSecure to true)]](else:)[&quot;If only we had a rope, this would be a lot safer,&quot; muses Edda.]
[[Attempt to jump from stone to stone to reach the ruined tower]]
[[Back-&gt;Fen]]</tw-passagedata><tw-passagedata pid="128" name="Fen standing stones" tags="" position="2300,3500" size="100,100">(display: &quot;header&quot;)(set:$effort to 10)(display:&quot;Effort&quot;)
{

(set:$lore to $standingStonesLocation)(display:&quot;addLore&quot;)

}
(if:$misc contains $protectionCharm)[
Almost without thinking, your hand goes to the (print:&quot;name&quot; of $protectionCharm) hanging from your neck. It feels warm to the touch, and seems to be humming slightly.
]
The ring of stones looms before you in the mist, like a strange council of hunched giants.
Though the stones are made from the same material, a hard, white, unfamiliar stone, each is unique in shape, some rounder and more squat, others tall and graceful. Each is carved with runes.

As you stand there, you and your companions can hear disembodied voices, soft but as clear and distinct as the calls of birds and insects that ring across the swampy landscape.

(if:$food contains $seersMead)[
[[Drink some of the Seiðrmjöð you purchased from Eir-&gt;Drink Seersmead at the stones]]
]
[[Try to speak to the voices]]
[[Listen closely to the voices]]
[[Attempt to sketch the runes on the stones-&gt;Attempt to sketch the stone runes]]
[[Back-&gt;Fen]]</tw-passagedata><tw-passagedata pid="129" name="FenPigArrowLame" tags="" position="1675,4225" size="100,100">(set:$effort to 3)(display:&quot;Effort&quot;)

You loose an arrow, hoping to hobble the creature and deter it from attacking.
---
(display:&quot;archeryRoll&quot;)
---
(if: $success&gt; 5 )[

the arrow finds its mark deep in the creature&#39;s broad flank, and the beast pulls up short in its charge, bellowing furiously.

The creature is still dangerous, and still coming, but you have slowed it down enough to give your companions the chance to attack. Two more arrows find their mark from Ciar&#39;s and Hroald&#39;s bows, meeting with grunts from the beast. One arrow now protrudes from its head and another from its shoulder, along with yours in its left rear leg.

With a great groan, it turns back for the protection of the woods.(set:$pigDefeated to true)
[[Continue-&gt;Patrol Hub]]
](else:)[

Your arrow flies wide of the carefully chosen mark, burying itself in the thick armored flesh of the creatures shoulder instead of its vulnerable haunch.

The beast surges forward with an eager snarl, now looming huge before you, and you instinctively dive out of the line of its charge.

	(if: $totalArmorBonus &gt; 6)[(set:$pigDefeated to true)
Fortunately your armor protects you from the worst of the onslaught, and no part of your body seems to be punctured or broken.

As you scramble back to your feet, you see two arrows bury themselves in the creature&#39;s flank, followed by one of Edda&#39;s long Javelins, which sinks deep into the flesh of its back. With a pained, angry bellow, the creature turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.
    (set:$health to it - 10)
    [[Continue-&gt;Patrol Hub]]
    ](else:)[


You lie gasping on the ground, trying to orient yourself through the pain, unsure how much of the blood covering you is yours and how much is the creature&#39;s. It&#39;s ragged, outraged breath fills your ears as you stumble for your weapon, but then you hear one, then another //thwack// as your companions arrows find its flank, with little effect. 

A moment later you look up just as the length of one of Edda&#39;s javelins buries deep itself into the creature&#39;s back.

With a pained, angry bellow, the great beast turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.

Your companions come to your side and try to help you to your feet, but you can feel that critical things are broken inside you, and your time is short. In the last few moments as the darkness closes in, you reflect on what has brought you to this point, and what might be the true meaning of all of this. What is anyone&#39;s story really worth when everyone dies in the end, when all that remains are //words//, half-understood by unkown strangers, their true meaning forgotten.

//&#39;&#39;Game Over&#39;&#39;//
    ]
]
</tw-passagedata><tw-passagedata pid="130" name="FenPigAxe" tags="" position="1575,4450" size="100,100">(set:$effort to 3)(display:&quot;Effort&quot;)
The nightmare pig-thing lets out a strange, low, belching roar unlike the sound of any pig, and charges toward you, waggling its spiked head menacingly as it picks up speed.

The ground trembles beneath you as the creature comes. You draw your sword, aware that this is probably not the most conventional tool for the job, but prepared to trust to your skill.

---
(set: _success to (round: ( (random: 1, 10)+ $energy/10)/2))
(set: _success to it + $totalCombatBonus)
Your success: _success / 10!
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]
---
(if: _success &gt; 7 )[

You manage to twist sidways, avoiding the threshing spikes on the creature&#39;s head as it swipes at you, and the point of your sword just finds the beast&#39;s eye, prompting a great angry bellow of pain. It circles back to face you, spraying blood as it shakes its head wildly.

Then, with two satisfying //thwack// sounds, you one arrow and then another bury themselves in the creature&#39;s flank, followed by one of Edda&#39;s long Javelins, which sinks deep into the flesh of its back. With a pained, angry bellow, the creature turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.(set:$pigDefeated to true)
[[Continue-&gt;Patrol Hub]]
](else:)[

You twist sideways, attempting to catch the creature&#39;s eye with the point of your sword while avoiding the threshing spikes on its head. Instead, the blade slashes off to the side, leaving a bloody gauge across its face but not blinding it or doing significant injury. You manage to avoid the main force of the beast&#39;s charge, but it&#39;s huge slashing head smashes against you hard enough to lift you from your feet and knock you sprawling to the ground.

	(if: $totalArmorBonus &gt; 6)[(set:$pigDefeated to true)
Fortunately your armor protects you from the worst of the onslaught, and no part of your body seems to be punctured or broken.

As you scramble back to your feet, you see two arrows bury themselves in the creature&#39;s flank, followed by one of Edda&#39;s long Javelins, which sinks deep into the flesh of its back. With a pained, angry bellow, the creature turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.
    (set:$health to it - 10)
    [[Continue-&gt;Patrol Hub]]
    ](else:)[

You lie gasping on the ground, trying to orient yourself through the pain, unsure how much of the blood covering you is yours and how much is the creature&#39;s. It&#39;s ragged, outraged breath fills your ears as you stumble for your weapon, but then you hear one, then another //thwack// as your companions arrows find its flank, with little effect. 

A moment later you look up just as the length of one of Edda&#39;s javelins buries deep itself into the creature&#39;s back.

With a pained, angry bellow, the great beast turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.

Your companions come to your side and try to help you to your feet, but you can feel that critical things are broken inside you, and your time is short. In the last few moments as the darkness closes in, you reflect on what has brought you to this point, and what might be the true meaning of all of this. What is anyone&#39;s story really worth when everyone dies in the end, when all that remains are //words//, half-understood by unkown strangers, their true meaning forgotten.

//&#39;&#39;Game Over&#39;&#39;//
    ]
]
</tw-passagedata><tw-passagedata pid="131" name="FenPigKillArrow" tags="" position="1775,4425" size="100,100">(set:$effort to 3)(display:&quot;Effort&quot;)
The nightmare pig-thing lets out a strange, low, belching roar unlike the sound of any pig, and charges toward you, waggling its spiked head menacingly as it picks up speed.

The ground trembles beneath you as the creature comes. You decide to try to end the battle with a single brilliant shot from your bow, despite the extreme difficulty.
---
(display:&quot;archeryRoll&quot;)
---
(if: $success &gt; 8 )[
Time seems to slow as you draw back the string of your bow, and as the creature raises its head, a spot on its chest is revealed between the ridge of its jaw and the keel of its beast bone, which seems soft and vulnerable.

There is no gap between thought and deed as your arrow flies true, to bury itself so deeply it nearly disappears in the soft flesh. The beast staggers and seems to regard you with a look of surprise for a moment, swaying on its feet. Then you can actually see the moment when the light goes out of the creatures eyes, and it collapses, dead before it settles to the ground.(set:$pigDefeated to true)

{(link:&quot;Take the monster&#39;s head back to Heorot as a trophy&quot;)[

The five of you labor for some time to sever the beast&#39;s great head from its body, Lothar finally achieving it with a great swipe of his axe. The head itself is almost the size of a normal pig, and you are able to take it with you only by constructing a makeshift sling and taking turns to carrying it between you in pairs.
(set:$achievements to it + (a:&quot;Slew the giant reptilian pig-monster in the fen.&quot;))
(set:$misc to it + (a:$fenPigHead))
&lt;br&gt;[[Continue-&gt;Make for Heorot Hall]]&lt;br&gt;
]}
](else:)[

The arrow seems to barely penetrate the scaly armor of the animal&#39;s head, and it jerks with annoyance but continues its charge.

The beast surges forward with an eager snarl, now looming huge before you, and you instinctively dive out of the line of its charge.

	(if: $totalArmorBonus &gt; 6)[
Fortunately your armor protects you from the worst of the onslaught, and no part of your body seems to be punctured or broken.

As you scramble back to your feet, you see two arrows bury themselves in the creature&#39;s flank, followed by one of Edda&#39;s long Javelins, which sinks deep into the flesh of its back. With a pained, angry bellow, the creature turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.
    (set:$health to it - 10)
    [[Continue-&gt;Patrol Hub]]
    ](else:)[

You lie gasping on the ground, trying to orient yourself through the pain, unsure how much of the blood covering you is yours and how much is the creature&#39;s. It&#39;s ragged, outraged breath fills your ears as you stumble for your weapon, but then you hear one, then another //thwack// as your companions arrows find its flank, with little effect. 

A moment later you look up just as the length of one of Edda&#39;s javelins buries deep itself into the creature&#39;s back.

With a pained, angry bellow, the great beast turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.

Your companions come to your side and try to help you to your feet, but you can feel that critical things are broken inside you, and your time is short. In the last few moments as the darkness closes in, you reflect on what has brought you to this point, and what might be the true meaning of all of this. What is anyone&#39;s story really worth when everyone dies in the end, when all that remains are //words//, half-understood by unkown strangers, their true meaning forgotten.

//&#39;&#39;Game Over&#39;&#39;//
    ]
]</tw-passagedata><tw-passagedata pid="132" name="FenPigSpear" tags="" position="1325,4100" size="100,100">(set:$effort to 3)(display:&quot;Effort&quot;)
The nightmare pig-thing lets out a strange, low, belching roar unlike the sound of any pig, and charges toward you, waggling its spiked head menacingly as it picks up speed.

The ground trembles beneath you as the creature comes. You set your spear against the earth and prepare to meet the beast&#39;s charge, trusting to your skill and the strength of your steel.

---
(set: _success to (round: ( (random: 1, 10)+ $energy/10)/2))
Your success: _success / 10!
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]
---
(if: _success &gt; 6 )[

You raise your spear at just the right moment to catch the bulk of the charging creature&#39;s momentum on the point, just above its breast bone. The long, leaf-shaped blade buries itself deep in the monstrous flesh, and the animal lets out a great groan of surprise and dying rage, its breath hot in your face and wet with blood and spittle, as the momentum of the beast&#39;s charge snaps the spear and buries you under its great, bloody, dying mass.

Eventually, your companions are able to free you from beneath the bulk of the dead beast.(set:$pigDefeated to true)

{(link:&quot;Take the monster&#39;s head back to Heorot as a trophy&quot;)[

The five of you labor for some time to sever the beast&#39;s great head from its body, Lothar finally achieving it with a great swipe of his axe. The head itself is almost the size of a normal pig, and you are able to take it with you only by constructing a makeshift sling and taking turns to carrying it between you in pairs.
(set:$achievements to it + (a:&quot;Slew the giant reptilian pig-monster in the fen.&quot;))
(set:$misc to it + (a:$fenPigHead))
[[Continue-&gt;Make for Heorot Hall]] 
]}

](else:)[

You jerk your spear up, attempting to catch the creature under the throat. Instead, the blade slashes off to the side, slicing through the beast&#39;s hide but not penetrating deeply or stopping the animal&#39;s charge. You manage to roll slightly out of the way as the beast comes by, but it&#39;s huge slashing head smashes against you hard enough to lift you from your feet and knock you sprawling to the ground.

	(if: $totalArmorBonus &gt; 6)[
Fortunately your armor protects you from the worst of the onslaught, and no part of your body seems to be punctured or broken.

As you scramble back to your feet, you see two arrows bury themselves in the creature&#39;s flank, followed by one of Edda&#39;s long Javelins, which sinks deep into the flesh of its back. With a pained, angry bellow, the creature turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.
    (set:$health to it - 10)
    [[Continue-&gt;Patrol Hub]]
    ](else:)[


You lie gasping on the ground, trying to orient yourself through the pain, unsure how much of the blood covering you is yours and how much is the creature&#39;s. It&#39;s ragged, outraged breath fills your ears as you stumble for your weapon, but then you hear one, then another //thwack// as your companions arrows find its flank, with little effect. 

A moment later you look up just as the length of one of Edda&#39;s javelins buries deep itself into the creature&#39;s back.

With a pained, angry bellow, the great beast turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.

Your companions come to your side and try to help you to your feet, but you can feel that critical things are broken inside you, and your time is short. In the last few moments as the darkness closes in, you reflect on what has brought you to this point, and what might be the true meaning of all of this. What is anyone&#39;s story really worth when everyone dies in the end, when all that remains are //words//, half-understood by unkown strangers, their true meaning forgotten.

//&#39;&#39;Game Over&#39;&#39;//
    ]

]</tw-passagedata><tw-passagedata pid="133" name="FenPigSword" tags="" position="1425,4350" size="100,100">(set:$effort to 3)(display:&quot;Effort&quot;)
The nightmare pig-thing lets out a strange, low, belching roar unlike the sound of any pig, and charges toward you, waggling its spiked head menacingly as it picks up speed.

The ground trembles beneath you as the creature comes. You draw your sword, aware that this is probably not the most conventional tool for the job, but prepared to trust to your skill.

---
(set: _success to (round: ( (random: 1, 10)+ $energy/10)/2))
(set: _success to it + $totalCombatBonus)
Your success: _success / 10!
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]
---
(if: _success &gt; 7 )[

You manage to twist sidways, avoiding the threshing spikes on the creature&#39;s head as it swipes at you, and the point of your sword just finds the beast&#39;s eye, prompting a great angry bellow of pain. It circles back to face you, spraying blood as it shakes its head wildly.

Then, with two satisfying //thwack// sounds, you one arrow and then another bury themselves in the creature&#39;s flank, followed by one of Edda&#39;s long Javelins, which sinks deep into the flesh of its back. With a pained, angry bellow, the creature turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.
(set:$pigDefeated to true)
](else:)[

You twist sideways, attempting to catch the creature&#39;s eye with the point of your sword while avoiding the threshing spikes on its head. Instead, the blade slashes off to the side, leaving a bloody gauge across its face but not blinding it or doing significant injury. You manage to avoid the main force of the beast&#39;s charge, but it&#39;s huge slashing head smashes against you hard enough to lift you from your feet and knock you sprawling to the ground.

	(if: $totalArmorBonus &gt; 6)[
Fortunately your armor protects you from the worst of the onslaught, and no part of your body seems to be punctured or broken.

As you scramble back to your feet, you see two arrows bury themselves in the creature&#39;s flank, followed by one of Edda&#39;s long Javelins, which sinks deep into the flesh of its back. With a pained, angry bellow, the creature turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.
    (set:$health to it - 10)
    ](else:)[


You lie gasping on the ground, trying to orient yourself through the pain, unsure how much of the blood covering you is yours and how much is the creature&#39;s. It&#39;s ragged, outraged breath fills your ears as you stumble for your weapon, but then you hear one, then another //thwack// as your companions arrows find its flank, with little effect. 

A moment later you look up just as the length of one of Edda&#39;s javelins buries deep itself into the creature&#39;s back.

With a pained, angry bellow, the great beast turns and makes back for the forest at a limping trot, trailing blood and breathing in ragged grunts.

Your companions come to your side and try to help you to your feet, but you can feel that critical things are broken inside you, and your time is short. In the last few moments as the darkness closes in, you reflect on what has brought you to this point, and what might be the true meaning of all of this. What is anyone&#39;s story really worth when everyone dies in the end, when all that remains are //words//, half-understood by unkown strangers, their true meaning forgotten.

//&#39;&#39;Game Over&#39;&#39;//
    ]
]
[[Continue-&gt;Patrol Hub]]</tw-passagedata><tw-passagedata pid="134" name="Fight Thryth" tags="" position="3125,3625" size="100,100">[[Defeat Thryth]]</tw-passagedata><tw-passagedata pid="135" name="Fight!" tags="" position="325,4450" size="100,100">(display: &quot;header&quot;)

The clash is sudden and brutal. The creatures, far stronger and more ferocious than anticipated, meet your charge with terrifying force. The sounds of battle fill the air — the clash of weapons, the cries of the villagers, the guttural roars of the creatures. In the chaos, it&#39;s hard to tell friend from foe, shadow from flesh.

In the midst of the fray, you fight valiantly, but the creatures are overwhelming. One by one, you see your brave companion fall around you, their weapons slipping from lifeless hands. A deep sense of dread fills you as you realize the battle is lost. A massive creature, its eyes burning with a savage light, turns its attention to you. With a final, desperate effort, you strike, but your weapon seems useless against its hide.

The creature&#39;s counterattack is swift and merciless. Pain explodes through your body, and the forest spins around you. As you fall to the ground, the sounds of the forest dim, and the darkness closes in. Your last thoughts are filled with regret — for the lives lost, for the battle rashly joined, and for the mystery of Grendel, which remains unsolved, shrouded in the eternal whispers of the ancient forest.

The air is thick with tension, and the silence is almost deafening. The feeling of being watched intensifies, and you know that the Sceadugenga are out there, just beyond your sight. The shadows seem to shift and move, and every rustle of leaves sets your nerves on edge.

As you advance, you catch glimpses of movement—dark shapes flitting through the trees, barely visible against the gloom. The Sceadugenga are using some kind of camouflage, blending into the shadows and making it almost impossible to see them clearly.

Hroald swings his axe at a blur of movement, but his strike hits nothing but air. &quot;Damn it, they&#39;re fast!&quot;

Edda throws a javelin, her aim true, but the weapon vanishes into the darkness without a sound. &quot;Stay alert! They&#39;re toying with us!&quot;

Lothar roars, his massive axe cleaving through the air, but he too finds nothing. &quot;Come out and fight, you cowards!&quot;

The Sceadugenga respond with eerie, guttural growls, their voices echoing through the forest. The sound sends a shiver down your spine, and you grip your weapon tighter, trying to keep your fear in check.

Suddenly, one of the Sceadugenga emerges from the shadows, its form massive and imposing. Its eyes gleam with an unnatural light, and its claws glint menacingly. The creature lunges at Hroald, its movements almost too fast to follow.

Hroald manages to deflect the first strike with his axe, but the force of the blow sends him staggering back. &quot;They&#39;re strong! Watch out!&quot;

Another Sceadugenga appears, this one targeting Edda. She raises her shield just in time to block its swipe, but the impact nearly knocks her off her feet. &quot;They&#39;re all around us!&quot;

Ciar tries to cast a protective spell, but the Sceadugenga&#39;s presence seems to disrupt her magic. Her raven screeches in distress, circling above. &quot;Their magic is interfering with mine!&quot;

Lothar swings his axe at one of the creatures, but it ducks under his strike with uncanny agility. &quot;They&#39;re too fast! We need to retreat!&quot;

But retreat is no longer an option. The Sceadugenga have surrounded you, their forms barely visible in the darkness. The air is thick with their growls, and the smell of earth and musk fills your nostrils.

One of the creatures lunges at you, its claws slashing through the air. You barely manage to dodge, the force of the attack sending you stumbling. Another Sceadugenga swipes at Hroald, catching him across the chest. He cries out in pain, blood seeping through his tunic.

Edda tries to rally the group, her shield raised high. &quot;Stay together! Don&#39;t let them separate us!&quot;

But the Sceadugenga are relentless. They move with a terrifying grace, their attacks coordinated and brutal. One of them knocks Ciar to the ground, its claws raking across her arm. She screams, her raven diving at the creature in a futile attempt to protect her.

Lothar swings his axe in a desperate arc, but the Sceadugenga dodge effortlessly. They close in on him, their claws tearing through his defenses. His roar of defiance turns into a scream of pain as they overwhelm him.

Hroald tries to fight his way to Lothar, but another Sceadugenga blocks his path. The creature&#39;s eyes gleam with a predatory intelligence, and it swipes at Hroald with deadly precision. He manages to block one strike, but the second catches him across the leg, sending him to his knees.

Edda fights valiantly, her javelins flying through the air, but the Sceadugenga are too many and too fast. One of them knocks her shield aside, its claws raking across her side. She gasps in pain, struggling to stay on her feet.

You find yourself alone, the forest closing in around you. The Sceadugenga&#39;s growls are a constant, haunting presence, and their eyes gleam with a malevolent light. You swing your weapon wildly, trying to keep them at bay, but it&#39;s no use. They are too powerful, too relentless.

One of the creatures lunges at you, its claws slashing through the air. You feel a searing pain as they tear into your flesh, and you fall to the ground, your vision blurring. The last thing you hear is the guttural growls of the Sceadugenga and the screams of your companions, echoing through the dark forest.

As the darkness closes in, you realize the true horror of the Sceadugenga. They are not just powerful and relentless; they are intelligent, cunning, and driven by a purpose you can barely comprehend. The forest falls silent once more, the only sound the whisper of the wind through the trees.

&#39;&#39;GAME OVER!&#39;&#39;</tw-passagedata><tw-passagedata pid="136" name="Find Rest" tags="" position="325,200" size="100,100">{
(set:_q to &quot;Find somewhere to rest&quot;)
(if:$activeQuests contains _q)[
Quest complete: (print:_q)
	(set:$activeQuests to it - (a: _q))
    (set:$completedQuests to it + (a: _q))
]
}</tw-passagedata><tw-passagedata pid="137" name="Fishermen Convo Hub" tags="" position="1400,325" size="200,100">(display: &quot;header&quot;)(set:$effort to 3)(display:&quot;Effort&quot;)
(if: $reputation&#39;s &quot;Kattinge fishermen&quot; is &quot;unknown&quot;)[
An older fisherman with a gray beard and deep-set eyes broad  eyes pauses in his work to scrutinize you. The others, sensing his hesitation, stop their tasks and turn their attention towards you with a mix of suspicion and unease.

[[Inquire about Grendel-&gt;Fishermen Inquiry About Grendel]]
[[Crack a joke to ease the tension-&gt;Joke with fishermen]]
[[Offer them a gift to break the ice]]
[[Continue exploring the village-&gt;Village Hub]]
](else-if: $reputation&#39;s &quot;Kattinge fishermen&quot; is &quot;friendly&quot;)[
An older man with a gray beard and deep-set eyes pauses from his work to look up, and grins broadly.
&quot;Ahoy, bard,&quot; he chuckles, &quot;Have you brought us some more ale? Talking is thirsty work.&quot;
[[Inquire about Grendel-&gt;Fishermen Inquiry About Grendel]]
[[Continue exploring the village-&gt;Village Hub]]
](else-if: $reputation&#39;s &quot;Kattinge fishermen&quot; is &quot;hostile&quot;)[
A large man with a gray beard and deep-set eyes rises ponderously from his work to step forward squarely. &quot;We&#39;ve nothing to say to spies,&quot; he says loudly, &quot;We&#39;ll report you Hrothgar&#39;s guards if you keeping nosing around, outlander.&quot;

He spits aggressively onto the ground and goes back to his work.

[[Continue exploring the village-&gt;Village Hub]]
]</tw-passagedata><tw-passagedata pid="138" name="Fishermen Inquiry About Grendel" tags="" position="1575,500" size="100,100">(display: &quot;header&quot;)
In the sudden quiet, Grendel&#39;s name spoken in your voice hangs in the air. The fishermen exchange glances, a mix of caution and a shared, unspoken knowledge.
(if: $reputation&#39;s &quot;Kattinge fishermen&quot; is &quot;unknown&quot;)[
&quot;We&#39;ve much work at hand and little time for gossiping with outlanders,&quot; says an older man with a gray beard, deliberately keeping his eyes on the net he is mending.
[[Continue-&gt;Fishermen Convo Hub]]
[[Excuse yourself and continue exploring the village-&gt;Village Hub]]
](else-if: $reputation&#39;s &quot;Kattinge fishermen&quot; is &quot;friendly&quot;)[
 One man, his face weathered like the bark of an ancient tree, steps forward.
&quot;So the bard seeks tales of the darkness,&quot; he says in a gravelly voice. &quot;Grendel, you say? Aye, we&#39;ve seen signs. Strange ripples in the water at night, an eerie calm that falls over the sea. Some nights, it feels as though the sea itself holds its breath, as if waiting for something grim and dreadful.&quot;

Another fisherman chimes in, &quot;We&#39;ve found our nets torn, our catches taken. Never seen the beast ourselves, but what else could wield such malice and strength?&quot;

A younger one, barely more than a boy, adds with wide eyes, &quot;Some say it&#39;s not just one creature, but many. That they come from the depths of the sea or perhaps from some cursed place on land.&quot;

The older fisherman scoffs, his weathered face contorting with disdain. &quot;Enough of your nonsense, boy. Hrothgar&#39;s thanes won&#39;t take kindly to such talk. Remember the king’s words—Grendel is a single devil, not some tribe of creatures. Don&#39;t go spreading folly that will bring trouble upon us all.&quot;

He stomps off in the other direction as the younger man’s face falls, his enthusiasm dampened. Another elderly fisherma steps forward to place a gnarled hand on the boy’s shoulde.

&quot;Easy, lad,&quot; he says softly, &quot;best keep such thoughts close, and share them only with those who listen without fear.&quot;

He seems to consider a moment, seeming to study your face, and then says, &quot;if you want to know more of the old ways, which Hrothgar shuns... Speak to my cousin Eir. She trades herbs in the marketplace and like to gossip. Hrothgar&#39;s thanes are less likely to take offense at women&#39;s words, and Eir gets away with much, but be careful who overhears you speaking of such things...&quot;

(set: $knownLore to it + (a: &quot;Fishermen report strange weather phenomena and stolen fish/sabotaged equipment correlated with Grendel sightings&quot;))
(set: $knownLore to it + (a: &quot;Some same Grendel is not be a single creature, but one of a population or group. &quot;))
(set: $knownLore to it + (a: &quot;Eir, the herbalist in the marketplace, can share lore of the Old Ways.&quot;))

[[Continue-&gt;Fishermen Convo Hub]]
[[Excuse yourself and continue exploring the village-&gt;Village Hub]]
]</tw-passagedata><tw-passagedata pid="139" name="Flee at full speed" tags="" position="100,4450" size="100,100">(display:&quot;header&quot;)(set:$energy to it - 12)(set:$effort to 9)(display:&quot;Effort&quot;)
The sense of danger and the oppressive presence of the Sceadugenga becomes too much to bear. Panic seizes you, and without thinking, you take off at full speed, crashing through the underbrush. The sudden movement leaves the rest of the group flat-footed.

&quot;Wait!&quot; Edda shouts, but you are already too far ahead to hear her properly.

Ciar and Hroald exchange quick glances before they, too, decide to run. The sound of your own breathing and the pounding of your heart drown out everything else as you tear through the forest. Behind you, the eerie silence is broken by a blood-curdling battle yell from Lothar.

The last thing you hear before the forest swallows you entirely is Lothar&#39;s scream, followed by the terrible sounds of a fierce struggle—clashing weapons, guttural growls, and finally, Lothar’s agonizing cries. The noise sends a shiver down your spine, spurring you to run even faster.

[[Continue-&gt;Exhausting flight back to town]]</tw-passagedata><tw-passagedata pid="140" name="Flee from Dragon" tags="" position="4225,5475" size="100,100">(display: &quot;header&quot;)
Ha bad choice, you get burned up and die.
&#39;&#39;Game Over&#39;&#39;</tw-passagedata><tw-passagedata pid="141" name="Follow the arresting party" tags="" position="4575,1950" size="100,100">(display: &quot;header&quot;)
Determined to see the outcome of your information and to understand more about the situation with Torsten, you decide to follow the group of warriors as they march out of Heorot Hall. The atmosphere is tense, and the sense of urgency is palpable as you join the hastily assembled party.

The night is dark and cold, a stark contrast to the warmth of the hall. The torches carried by the warriors cast flickering shadows on the cobblestone paths of the village. The villagers watch silently from their homes, their faces etched with worry and curiosity.

As you make your way towards the outskirts of the village, you can hear the murmurs among the warriors. “Torsten, a traitor?” “What was he thinking, consorting with Grendel’s kin?” The gravity of the situation weighs heavily on everyone.

At the edge of the village, you find Torsten near the old oak, preparing for his ritual. The elder’s eyes widen in surprise and fear as he sees the approaching party. The leader of the warriors, a grizzled thane named Bjorn, steps forward.

“Torsten, by order of King Hrothgar, you are under arrest for attempting to make contact with the Sceadugenga,” Bjorn declares, his voice ringing with authority.

Torsten raises his hands, his voice trembling. “You don’t understand! This is the only way to stop Grendel! We need to communicate with them, to understand their demands. Violence will only bring more bloodshed!”

Bjorn’s expression hardens. “Your actions endanger us all. You will come with us, and you will answer to Hrothgar.”

The warriors move to apprehend Torsten, binding his hands and preparing to lead him back to Heorot Hall. As they do, Torsten continues to plead his case, but his words fall on deaf ears. The determination to protect the village overrides any consideration of his arguments.

Unferth turns to you, his expression unreadable. “You’ve seen now the lengths to which some will go in their desperation. Remember this moment, bard. The lines between hero and villain can blur in times of fear.”

With Torsten in custody, the party makes its way back to Heorot Hall, the tension still hanging heavy in the air. You’ve witnessed firsthand the dangers lurking within the village and the complex web of loyalties and fears that define life in Heorot.
[[Torsten&#39;s Execution]]</tw-passagedata><tw-passagedata pid="142" name="Forest Scea Hub" tags="" position="3025,2450" size="100,100">(display: &quot;header&quot;)
(if: $energy &gt; 10)[(set: $energy to $energy - 10)]
Torsten leads you into a clearing bathed in soft light. In the center stands a circle of stones adorned with offerings—feathers, bones, and small totems. The air hums with an otherworldly vibration.

Torsten suggest that you sit and listen to the forest sounds while you wait. Minutes turn to hours, but somehow your mind and body are still patient, resting in the soft embrace of wind through leaves and the song of woodland birds.

Finally, from the shadows, figures emerge—tall, enigmatic beings with eyes that glow like embers. Their forms are cloaked in fur and leaves, making them seem as much a part of the forest as the trees themselves. Torsten rises slowly to his feet, takes a step forward and bows deeply. One of the sceadugenga, its gaze fixed upon you, speaks deep rumbling words that seem to resonate within your chest and rather than your ears.

Torsten glances at you. &quot;They wish to know why you have come.&quot;
{
(set: $expressedIntentions to false)
(set: $soughtStory to false)
(set: $expressedRemorse to false)
}
[[Express your desire to restore harmony between peoples-&gt;Express Intentions]]
[[Ask about their perspective on the conflict-&gt;Seek Their Story]]
[[Express remorse for the harm caused by humans against the sceadugenga]]
[[Could this be Grendel himself? Take your chance and try to assassinate the Sceadugenga leader!]]</tw-passagedata><tw-passagedata pid="143" name="Forest wandering hub" tags="" position="4825,4025" size="200,200">(display: &quot;header&quot;)
You are in a small clearing in the deep forest. The moon hangs high in the sky, casting a silver glow over the landscape. You are alone, lost in the vast wilderness with only the artifact for company.

(set:$effort to 10)(display:&quot;Effort&quot;)
[[Continue Wandering]]: Keep moving through the forest, hoping to find a way out or a sign of the Sceadugenga.

[[Attempt to Play the Horn]]: Try playing the sacred horn, hoping its magic might guide you or draw the Sceadugenga to you.

[[Look for a Place to Rest]]: Find a sheltered spot to rest and gather your strength before continuing your journey.

[[Climb a Tree for a Better View]]: Climb a tree to get a better view of your surroundings and possibly spot a way out of the forest.</tw-passagedata><tw-passagedata pid="144" name="Games Dashboard" tags="" position="650,300" size="100,100">&lt;center&gt;&lt;h3&gt;Shadows of Grendel&lt;/h3&gt;&lt;/center&gt;
---
## Dashboard
---
[[Character Sheet]] | [[Plot log]] | [[About this game-&gt;Start]] | [[How to play-&gt;How to play this game]] 
{

(if: length of (history:) &gt; 1)[
#### Current Save Slot: $saveSlot
(if:$name is not 0)[
#### Name: $name]
(link-goto: &quot;Continue game&quot;, last of (history:))&lt;br&gt;
(link:&quot;Save game&quot;)[
  (if:(save-game:$saveSlot))[
	  (if: (saved-games:) contains $saveSlot)[
	   Game saved!
	  ]
  ](else: )[
    Sorry, I couldn&#39;t save your game.
  ]&lt;br&gt;
]
---
(link: &quot;Save game in new slot&quot;)[
(input-box:2bind _saveSlot,&quot;&lt;==&quot;,&quot;Save Slot 2&quot;) (link:&quot;Save&quot;)[
  (set:$saveSlot to _saveSlot)
  (if:(save-game:$saveSlot))[
        (if: (saved-games:) contains $saveSlot)[
         Game saved!
        ]
    ](else: )[
      Sorry, I couldn&#39;t save your game.
    ]&lt;br&gt;
  ]
]
(if:$saveSlot is in (data-names:(saved-games:)))[
&lt;br&gt;
(link: &quot;Reload from last save of current game&quot;)[(load-game:$saveSlot)]
]&lt;br&gt;
]&lt;br&gt;

### Load a previously saved game:

&lt;ul&gt;
(for: each _slot, ...(data-names:(saved-games:)))[
&lt;li&gt; (link: _slot)[
	(set: $saveSlot to _slot)
	(load-game: _slot)
  ]&lt;/li&gt;
]
&lt;/ul&gt;

}

### Start a new game 

#### Over-write current saved-game slot
[[Restart-&gt;Landfall]]&lt;br&gt;

#### Or enter name of new game slot
//Note: this will overwrite a pre-existing saved game with same name if one exists.//
{
(link:&quot;Create new slot&quot;)[
  (input-box:2bind _saveSlot,&quot;&lt;==&quot;,&quot;Save Slot 2&quot;) | (link:&quot;Create game&quot;)[
  (set:$saveSlot to _saveSlot)
  (go-to:&quot;Landfall&quot;)
  ]
]
}</tw-passagedata><tw-passagedata pid="145" name="Grendel Attack" tags="" position="6150,575" size="100,100">(display:&quot;header&quot;)
Grendel kills everyone GRAAAAAH!!!
---
THE END</tw-passagedata><tw-passagedata pid="146" name="Head back to town from the tree" tags="" position="550,4125" size="100,100">(display:&quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
The eerie atmosphere around the ancient tree weighs heavily on you. With the branch in hand, you turn to the others. &quot;We should head back to town and report what we&#39;ve found. This place is making me uneasy.&quot;

Hroald nods, his face grim. &quot;Agreed. Let&#39;s move out.&quot;

You gather your belongings, and the group begins the trek back towards Heorot. The dense forest, which felt mysterious before, now seems menacing. Every rustle of leaves and snap of a twig sets your nerves on edge. The shadows cast by the trees seem to move, as if watching your every step.

The deeper you go, the more oppressive the forest feels. The air grows colder, and an unnatural silence falls over the woods, broken only by your cautious footsteps. The sense of being watched is almost tangible, and you find yourself glancing over your shoulder repeatedly.

Ciar&#39;s raven takes flight, circling above the group, its caws echoing eerily through the trees. Ciar herself is tense, her eyes scanning the forest with a mixture of curiosity and fear. &quot;The magic here is strong,&quot; she whispers. &quot;The Sceadugenga might be closer than we think.&quot;

Hroald keeps his battle-axe ready, his muscles taut with readiness. &quot;Stay alert, everyone. We don&#39;t want to be caught off guard.&quot;

Lothar and Edda flank the group, their weapons drawn, eyes darting to every shadow. The tension is palpable, a thick blanket of unease that hangs over the group.

As you move further, the feeling of eyes watching intensifies. You hear a soft rustling behind you, and everyone stops, weapons at the ready. The silence that follows is deafening, the forest holding its breath along with you.

Suddenly, from the corner of your eye, you catch a glimpse of movement—a shadow shifting among the trees. You turn, heart pounding, but see nothing. The sensation of being surrounded becomes overwhelming.

&quot;We&#39;re not alone,&quot; Edda mutters, her voice barely audible. &quot;They&#39;re here, watching us.&quot;

The group forms a tight circle, backs to each other, weapons ready. The forest around you seems to close in, the shadows deeper and more oppressive. You can feel the presence of the Sceadugenga, hidden just out of sight, their eyes fixed on you.

Hroald&#39;s voice is a low growl. &quot;We need to decide our next move. Do we attack, flee, or retreat carefully?&quot;

The options weigh heavily on your mind, each fraught with danger. The presence of the Sceadugenga feels more real than ever, and you know that any misstep could lead to disaster.

The forest grows darker as you venture deeper, the thick canopy above filtering out the light and casting long shadows on the forest floor. The air is heavy with the scent of damp earth and decaying leaves, and every snap of a twig or rustle of leaves sets your nerves on edge.

Suddenly, an eerie call echoes through the trees. It&#39;s unlike any birdcall you&#39;ve ever heard—louder, deeper, and filled with an unsettling resonance. The sound seems to come from everywhere and nowhere at once, and is soon answered by another call from a different direction, creating a haunting symphony that reverberates through the forest.

The adventurers halt, their senses heightened and eyes scanning the surroundings. &quot;Did you hear that?&quot; Ciar whispers, his voice barely audible over the fading echoes.

Edda nods, her hand tightening around the hilt of her sword. &quot;We&#39;re being tracked,&quot; she says quietly, her eyes narrowed as she peers into the shadows.

You strain your eyes, trying to catch any movement among the trees. The forest seems to hold its breath, the silence oppressive and foreboding. Then, out of the corner of your eye, you catch a glimpse of something—dark, shadowy, moving with a fluid grace that seems almost otherworldly.

A shape materializes briefly between the trees, its form obscured by the dappled light and dense underbrush. You see a face, human yet distinctly inhuman, with deep-set eyes that glint with a malevolent intelligence. The creature is covered in dark, matted fur, its movements eerily silent as it disappears back into the shadows.

Hroald steps closer to you, his voice a low growl. &quot;Sceadugenga,&quot; he mutters. &quot;Grendel’s kin. We must be ready.&quot;


[[Attack the Sceadugenga]]

[[Flee at full speed]]

[[Retreat carefully in formation-&gt;Stand ground against Scea]]</tw-passagedata><tw-passagedata pid="147" name="Head back to town without disturbing the tree" tags="" position="675,3975" size="100,100">(display:&quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
(if:$energy &lt; 50 )[
A wave of panic washes over you, your breath coming in shallow gasps. Your vision blurs, and for a moment, you feel as though the forest is closing in on you.

Edda notices your distress and places a reassuring hand on your shoulder. &quot;Steady now. It’s just the exhaustion. Take a deep breath.&quot;

You nod, taking several deep breaths to calm yourself. The feeling of terror subsides, replaced by a heavy weariness. You realize that the combination of fatigue and the eerie atmosphere of the forest is playing tricks on your mind.
]
&quot;We should head back to town and report what we&#39;ve found. This place makes me uneasy.&quot;

Hroald nods, his face grim but visibly relieved. &quot;Agreed. Let&#39;s move out.&quot;

As the group begins the trek back to the village, the dense forest seems to loom in from all sides, full of menace and the energetic thrum of dark magic. Every rustle of leaves and snap of a twig sets your nerves on edge, and every tree&#39;s shadow seems to hide a lurking silhouette. The sense of being watched is almost tangible, and you find yourself glancing over your shoulder repeatedly.

Ciar&#39;s raven takes flight, circling above the group, its caws echoing eerily through the trees. Ciar herself is tense, her eyes scanning the forest with a mixture of curiosity and fear. &quot;The magic here is strong,&quot; she whispers. &quot;The Sceadugenga might be closer than we think.&quot;

Hroald keeps his battle-axe ready, his muscles taut with readiness. &quot;Stay alert, everyone. We don&#39;t want to be caught off guard.&quot;

Lothar and Edda flank the group, weapons ready, eyes darting to every shadow.

[[Continue-&gt;Back from tree 2]]</tw-passagedata><tw-passagedata pid="148" name="Head to the church" tags="" position="1750,2325" size="100,100">(display: &quot;header&quot;)(if: $energy &gt; 10)[(set: $energy to $energy - 7)]

You decide to head to the small church on the edge of the village. As you approach, the sounds of the bustling market fade behind you, replaced by the gentle rustling of leaves and the distant cawing of crows. The path is well-trodden but narrow, bordered by wildflowers and overgrown grass. The air is cooler here, carrying the faint scent of damp earth and moss.

The church stands humbly against the backdrop of dense forest, its wooden structure simple yet sturdy. The thatched roof and timber walls blend seamlessly with the natural surroundings. The walls are made of split logs, the bark still clinging in patches, giving the structure a rugged and rustic appearance. The church&#39;s roof is thatched with layers of straw, tied down with ropes to withstand the winds that sweep in from the coast.

As you walk through the gate, the gravel crunches softly under your boots. The fence, made of rough-hewn wooden planks, stands guard around the small vegetable garden where various herbs and vegetables grow in neat rows. The smell of freshly tilled earth and the faint aroma of mint and thyme fill the air. Nearby, a few chickens peck at the ground near a small coop, clucking softly to themselves.

The church door is slightly ajar, and you can hear the low murmer of voices within.

[[Enter-&gt;Church Hub]]</tw-passagedata><tw-passagedata pid="149" name="Heorot Hub" tags="" position="4225,275" size="200,200">(display: &quot;header&quot;)(set:$effort to 3)(display:&quot;Effort&quot;)(set: $achievements to (a:&quot;Arrived at Heorot Hall&quot;))
{&lt;br&gt;
Heorot Hall is a vast, awe-inspiring structure, a testament to the wealth and power of King Hrothgar. The long tables are laden with roasted meats, bread, and jugs of ale, filling the air with a hearty aroma. Thanes and warriors, their faces flushed with drink, engage in boisterous conversation.&lt;br&gt;
&lt;br&gt;
At the far end of the hall, seated at table on a tall throne carved from a single massive tree trunk, sit the King and Queen.&lt;br&gt;
---
Court reputation: (print: $reputation&#39;s &quot;Heorot Court&quot;)
---
(if: $misc contains $fenPigHead and $achievements does not contain &quot;Gave Hrothgar a pig-monster&#39;s head&quot;)[
A wave of gasps sweeps through Heorot and all eyes turn toward you you enter the hall, Lothar and Edda carrying the severed head of the fen creature between them on the makeshift sling.&lt;br&gt;
[[Present the slain monster to Hrothgar]]&lt;br&gt;

](else:)[

(if: $notFirstTimeMeetingUnferth and $achievements does not contain &quot;Watched Unferth slay the competition.&quot;)[As you survey the room, your attention is drawn to a cluster of guests near the center. A tall and fair-haired princeling holds court, resplendent in armor adorned with a golden cross and the black eagle insignia of Frankish royalty. His loud boasts and hearty chuckles have attracted a small audience.&lt;br&gt;&lt;br&gt;
]
(if: $reputation&#39;s &quot;Heorot Court&quot; is &quot;unknown&quot;)[ You notice the guards&#39; eyes following you, not hostile but certainly wary. The stewards pointedly ignore you.&lt;br&gt;&lt;br&gt; ]
(else-if: $reputation&#39;s &quot;Heorot Court&quot; is &quot;low&quot;)[ You notice the guards eyes following you, scornful and wary. You also can&#39;t help seeing one thane appear to recognize you and laugh, elbowing his neighbor and pointing you out. Apparently your performance at your previous visit to court has not been forgotten.  The stewards pointedly ignore you. &lt;br&gt;&lt;br&gt;]
(else-if: $reputation&#39;s &quot;Heorot Court&quot; is &quot;mid&quot;)[ The guards and servants recognize you and relax, signalling your acceptance into the court.&lt;br&gt;&lt;br&gt;]
(else-if: $reputation&#39;s &quot;Heorot Court&quot; is &quot;high&quot;)[
The guards appear to stand straighter when they feel your eyes upon them, and a steward obligingly welcomes you to partake of the feast.&lt;br&gt;&lt;br&gt;
]
(if: $notFirstTimeMeetingUnferth and $achievements does not contain &quot;Watched Unferth slay the competition.&quot;)[
[[Listen to the boasting nobleman]]&lt;br&gt;
]
(if: $reputation&#39;s &quot;Unferth&quot; is &quot;unknown&quot;)[](else:)[
[[Seek out Unferth-&gt;Unferth Convo Hub]]&lt;br&gt;
]
(if: $reputation&#39;s &quot;Aeschere&quot; is &quot;unknown&quot;)[](else:)[
[[Seek out Aeschere-&gt;Aeschere Convo Hub]]&lt;br&gt;
]
[[Observe the King and Queen]]&lt;br&gt;
[[Observe the royal advisors]]&lt;br&gt;
[[Observe the guests]]&lt;br&gt;
[[Observe the guards]]&lt;br&gt;
[[Observe the hall]]&lt;br&gt;
[[Observe the feast]]&lt;br&gt;
(if: $reputation&#39;s &quot;Heorot Court&quot; is &quot;high&quot;)[[[Enjoy the privileges of court favor with night&#39;s feasting and sound rest. -&gt;Heorot Night]]&lt;br&gt;]
[[Depart Heorot Hall-&gt;Village Hub]]&lt;br&gt;


]
}</tw-passagedata><tw-passagedata pid="150" name="Heorot Night" tags="" position="5925,75" size="100,100">(display:&quot;header&quot;)
As the night deepens, the lively atmosphere of Heorot Hall gradually transitions into a quieter, more subdued ambiance. The fire in the hearth still burns brightly, casting a warm glow across the hall, but the sounds of conversation and laughter have softened to murmurs as the guests prepare for rest.

King Hrothgar and Queen Wealhtheow, along with the high-ranking nobles, retire to their private chambers on the second-floor lofts. These chambers are separated from the main hall by thick curtains, providing a semblance of privacy. The lofts are supported by sturdy wooden beams and accessible by narrow staircases at each end of the hall. The curtains are made of rich, heavy fabrics, embroidered with intricate patterns and symbols that reflect their status and lineage.

You watch as the king and queen ascend to their chambers, their figures disappearing behind the heavy drapery. From the glimpses you catch as the curtains part briefly, you can see wooden beds covered in furs and linens, providing comfort and warmth against the cool night air. Small chests at the foot of each bed likely contain personal belongings and valuables. Candles in wrought-iron holders provide a soft, flickering light, adding to the sense of seclusion and comfort.

Downstairs, the warriors and lower-ranking thanes make their sleeping arrangements. The servants of Heorot bring out bundles of hay, which are spread across the floor and covered with blankets. The benches that were used for feasting now serve as makeshift beds. Some warriors use their cloaks as additional bedding, wrapping themselves tightly to keep warm. You find a spot among the warriors, spreading a blanket over the hay and settling in for the night. The hall is filled with the soft rustle of blankets and the quiet murmur of voices as the warriors settle in for the night.
Sensory Details

The scent of burning wood and lingering aromas from the feast mingle with the earthy smell of hay. The warmth from the hearth radiates through the hall, contrasting with the cool night air that seeps in from outside. The occasional crackle of the fire and the gentle snoring of warriors create a soothing, rhythmic background noise.

(if: $grendelComes)[
You settle down to bed with an ominous feeling
[[Continue-&gt;Grendel Attack]]
](else:)[
---
(display:&quot;Find Rest&quot;)
In the morning, you wake up and stumble outside to clear your head with some fresh air...
//Energy restored//
{(if: $energy &lt; 100)[(set: $energy to 100)]}

[[Continue-&gt;Village Hub]]
]</tw-passagedata><tw-passagedata pid="151" name="Heorot night before patrol" tags="" position="3225,1700" size="100,100">(display: &quot;header&quot;)

(if:$reputation&#39;s &quot;Heorot Court&quot; is &quot;high&quot;)[
](else:)[

]

You spend some time with the adventurers discussing what you&#39;ve each heard of the forest and its denizens, in fact rather little enough of substance. However, the excited mood is contagious, and you find yourself swept up. The innkeeper, sensing the festive mood, brings out a special cask of mead. &quot;This one&#39;s on the house, for such fine company,&quot; he says, pouring generous mugs of the golden liquid.

Hroald stands, raising his mug high. &quot;To our new comrade and to the battles ahead! May we find victory and glory!&quot; 

The adventurers echo his toast, and you join in, feeling a part of the group. As the night progresses, stories of past exploits are exchanged, each tale more daring and adventurous than the last. The inn&#39;s atmosphere grows even more festive as patrons join in the singing of old battle songs and drinking chants. The fire crackles merrily, casting flickering shadows on the walls, and the smell of roasting meat and fresh bread fills the air, mingling with the earthy scent of ale and mead.

As the hours pass, you find yourself sharing your own tales, earning nods of respect and laughter from your new companions. Eventually, the fire burns low, the inn&#39;s patrons begin to leave the inn or settle down for the evening, and you settle down for a night&#39;s rest.

[[Continue-&gt;Heorot wakeup morning of patrol]]</tw-passagedata><tw-passagedata pid="152" name="Heorot wakeup morning of patrol" tags="" position="1300,2525" size="100,100">(display: &quot;header&quot;)
(display:&quot;EnergyReset&quot;)
You wake up refreshed in Heorot on one of the nice fancy mats they have for fancy guests
[[Out the gates on patrol]]</tw-passagedata><tw-passagedata pid="153" name="How can we we use this knowledge against them?" tags="" position="1050,3725" size="100,100">(display: &quot;header&quot;)
Ciar runs her fingers over the carved symbols. &quot;These symbols are ancient and powerful,&quot; she says. &quot;They are wards meant to protect and conceal. The Sceadugenga have a deep connection to the land and its magic. This tree is likely a focal point of their power, a guardian of their secrets.&quot;

She gazes around the clearing. &quot;We need to observe and learn. The Sceadugenga aren&#39;t mindless beasts; they&#39;re connected to something greater. If we understand their motivations and their connection to this place, we might find a way to resolve this conflict without unnecessary bloodshed.&quot;
[[Search Perimeter]] 
[[continue-&gt;Investigate Tree]]</tw-passagedata><tw-passagedata pid="154" name="How to play this game" tags="" position="475,175" size="100,100">&lt;center&gt;&lt;h3&gt;GrendelverseRPG Chapter 1: Shadows of Grendel &lt;/h3&gt;&lt;/center&gt;
Read the text and click the links. As you proceed through the story, check your character sheet and plot log. Your energy level will decrease as you walk around and do things, which will effect your odds of success whenever you try something difficult, so look for opportunities to rest and eat. It&#39;s a dangerous world, so save frequently

Explore, and don&#39;t be afraid to die and start again!{
(if: &quot;Landfall&quot; is in (history:))[ &lt;br&gt;(display: &quot;Back-link&quot;) ]
(else:)[
&lt;br&gt;[[Start a new game-&gt;Landfall]] ]
(if: length of (data-names:(saved-games:)) &gt; 0)[
&lt;br&gt;[[Saved Games-&gt;Games Dashboard]]
]}
&lt;br&gt;[[About Grendelverse: Shadows of Grendel-&gt;Start]]</tw-passagedata><tw-passagedata pid="155" name="Hrothgar&#39;s Wrathful Response" tags="" position="3475,3850" size="100,100">After presenting your case and evidence before King Hrothgar in Heorot Hall, the atmosphere grows heavy with anticipation. The silvery wood with its shifting runes lies on the table before the king, alongside the overseer&#39;s journal and the peculiar pendant. The gathered thanes and warriors murmur among themselves, eyes flickering between you and Sir Thryth.

Hrothgar, his stern visage framed by a mane of graying hair, leans forward on his throne. His eyes blaze with a fervent intensity. &quot;You bring before me tales of pagan sorcery and heathen rituals,&quot; he declares, his voice resonating through the hall. &quot;You dare to suggest that my loyal thane, Sir Thryth, is responsible for these attacks because he rightfully purged this land of ungodly abominations?&quot;

He stands abruptly, towering over the assembly. &quot;Grendel is the spawn of Cain, a devil sent to test our faith and resolve! There can be no appeasement with such evil. To even entertain the notion borders on heresy.&quot;

The crowd reacts with a mix of shock and agreement. Some nod vigorously, while others cast uneasy glances. Whispers of &quot;witchcraft&quot; and &quot;blasphemy&quot; ripple through the hall.

Sir Thryth seizes the moment. &quot;My king, these outsiders consort with dark forces. They undermine your authority and spread dissent among your subjects. They attacked me and freed my thralls, disrupting the order you have established.&quot;

Unferth steps forward cautiously. &quot;My lord, perhaps there is merit in examining all aspects of this situation,&quot; he suggests, his tone measured. &quot;If there are forces at work that threaten your reign, we should consider all strategies to combat them.&quot;

Hrothgar&#39;s gaze snaps to Unferth. &quot;Do not speak to me of considering pagan rites! Our path is clear: we must eradicate this evil with the strength granted to us by the Almighty. There is no room for doubt or compromise.&quot;

He turns back to you, eyes narrowed. &quot;You come into my hall, accuse my thane, and propose witchcraft as a solution. Explain yourself, and choose your words carefully, for they may be your last.&quot;

[[ Defend Your Actions and Intentions-&gt;Stand Your Ground]]
[[Beg for Hrothgar&#39;s mercy]]</tw-passagedata><tw-passagedata pid="156" name="Inform Aeschere about pagan activities" tags="" position="4525,1650" size="100,100">(display: &quot;header&quot;)
(if: $reputation&#39;s &quot;Eir&quot; is &quot;unknown&quot;)[](else:)[
[[Inform Unferth that Eir is involved in Pagan activities-&gt;Rat Eir]]
]
(if: $reputation&#39;s &quot;Village Elders&quot; is &quot;unknown&quot;)[](else:)[
[[Inform Unferth that Torsten is involved in Pagan activities-&gt;Rat Torsten]]
]
</tw-passagedata><tw-passagedata pid="157" name="Initialize Food Shops" tags="" position="50,625" size="100,100">{(set: $foodForSaleMarket to (a:
	(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Fresh Baked Bread&quot;, 
   &quot;price&quot;, 1, 
   &quot;energy&quot;, 10, 
   &quot;description&quot;, &quot;A loaf of freshly baked bread, warm and crusty.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Dried Meat&quot;, 
   &quot;price&quot;, 2, 
   &quot;energy&quot;, 12, 
   &quot;description&quot;, &quot;A portion of salted and dried meat, ideal for sustaining a traveler on long journeys.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Smoked Fish&quot;, 
   &quot;price&quot;, 2, 
   &quot;energy&quot;, 14, 
   &quot;description&quot;, &quot;A piece of smoked fish, preserving the flavor of the sea.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Aged Cheese&quot;, 
   &quot;price&quot;, 3, 
   &quot;energy&quot;, 9, 
   &quot;description&quot;, &quot;A wedge of aged cheese, rich and savory.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Honeycomb&quot;, 
   &quot;price&quot;, 2, 
   &quot;energy&quot;, 7, 
   &quot;description&quot;, &quot;A piece of sweet honeycomb, a natural treat to brighten any meal.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Ale&quot;, 
   &quot;alcohol&quot;, true,
   &quot;price&quot;, 1, 
   &quot;energy&quot;, 11, 
   &quot;description&quot;, &quot;A hearty mug of ale to quench thirst and lift spirits.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Mead&quot;, 
   &quot;alcohol&quot;, true,
   &quot;price&quot;, 2, 
   &quot;energy&quot;, 12, 
   &quot;description&quot;, &quot;A flask of golden mead, sweet and invigorating.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Wild Berries&quot;, 
   &quot;price&quot;, 1, 
   &quot;energy&quot;, 5, 
   &quot;description&quot;, &quot;A handful of wild berries, fresh and slightly tart.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Roasted Nuts&quot;, 
   &quot;price&quot;, 1, 
   &quot;energy&quot;, 5, 
   &quot;description&quot;, &quot;A small pouch of roasted nuts, crunchy and satisfying.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Hardtack Biscuits&quot;, 
   &quot;price&quot;, 1, 
   &quot;energy&quot;, 20, 
   &quot;description&quot;, &quot;A few hardtack biscuits, durable and long-lasting.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Dried Fruit&quot;, 
   &quot;price&quot;, 1, 
   &quot;energy&quot;, 11, 
   &quot;description&quot;, &quot;Slices of dried fruit, sweet and chewy.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Smoked Sausage&quot;, 
   &quot;price&quot;, 2, 
   &quot;energy&quot;, 20, 
   &quot;description&quot;, &quot;A link of smoked sausage, flavorful and hearty.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Barley Soup&quot;, 
   &quot;price&quot;, 2, 
   &quot;energy&quot;, 15, 
   &quot;description&quot;, &quot;A bowl of hearty barley soup, warming and nutritious.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Stewed Lentils&quot;, 
   &quot;price&quot;, 1, 
   &quot;energy&quot;, 15, 
   &quot;description&quot;, &quot;A serving of stewed lentils, rich in flavor and sustenance.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Cured Ham&quot;, 
   &quot;price&quot;, 1, 
   &quot;energy&quot;, 10, 
   &quot;description&quot;, &quot;A slice of cured ham, salty and satisfying.&quot;
),
(dm: &quot;sku&quot;, (random:999),
   &quot;name&quot;, &quot;Wild Mushroom Stew&quot;, 
   &quot;price&quot;, 2, 
   &quot;energy&quot;, 15, 
   &quot;description&quot;, &quot;A bowl of wild mushroom stew, earthy and filling.&quot;
)
))

(set: $foodForSaleInn to (a:
	(dm: &quot;sku&quot;, (random:999),
	   &quot;name&quot;, &quot;Hearty Cod Stew&quot;, 
	   &quot;price&quot;, 2, 
	   &quot;energy&quot;, 25, 
	   &quot;description&quot;, &quot;A warm, hearty cod stew with potatoes and leeks, served with bread and ale. Perfect for satisfying a traveler&#39;s hunger.&quot;
	),
	(dm: &quot;sku&quot;, (random:999),
	   &quot;name&quot;, &quot;Roast Pork Feast&quot;, 
	   &quot;price&quot;, 2, 
	   &quot;energy&quot;, 15, 
	   &quot;description&quot;, &quot;Fine roast pork seasoned with herbs, turning slowly over the fire. Crispy skin and juicy meat inside. Served with bread and pickles—a meal fit for a thane.&quot;
	),
	(dm: &quot;sku&quot;, (random:999),
	   &quot;name&quot;, &quot;Fresh Bread&quot;, 
	   &quot;price&quot;, 1, 
	   &quot;energy&quot;, 10, 
	   &quot;description&quot;, &quot;A loaf of freshly baked bread, warm and crusty. A simple pleasure to complement any meal.&quot;
	),
	(dm:
        &quot;name&quot;, &quot;Ale&quot;,
        &quot;price&quot;, 1,
        &quot;alcohol&quot;, true,
        &quot;energy&quot;, 10, 
        &quot;description&quot;, &quot;Simple, straightforward. Delicious, nutritious, and mildly intoxicating.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Sweet mead&quot;,
        &quot;alcohol&quot;, true,
        &quot;price&quot;, 3,
        &quot;energy&quot;, 12, 
        &quot;description&quot;, &quot;Honey-based mead that is sweet and warming, perfect for relaxing by the fire.&quot;
    )
))
}</tw-passagedata><tw-passagedata pid="158" name="Initialize Larders" tags="" position="50,300" size="100,100">{
(set: $eldersHangLarder to (a:
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Tea&quot;,
        &quot;price&quot;, 0,
        &quot;energy&quot;, 5,   
        &quot;description&quot;, &quot;a rich potent brew with herbs and butter.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Cakes&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 10,         
        &quot;description&quot;, &quot;Tasty but surprisingly hearty little cakes with nuts and dried.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Walnuts&quot;,
        &quot;price&quot;, 0,
        &quot;energy&quot;, 10,   
        &quot;description&quot;, &quot;crack &#39;em and eat &#39;em.&quot;
    )
))

(set:$HrothgarPigRewardLarder to (a:
    (dm:
        &quot;name&quot;, &quot;Hrothgar&#39;s Favor: Golden Arm Ring&quot;,
        &quot;description&quot;, &quot;An intricately crafted arm ring made of pure gold, adorned with engravings of interwoven knots and symbols representing strength and loyalty. It glimmers warmly in the light, a testament to the king&#39;s appreciation.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 0
    ),
    (dm:
        &quot;name&quot;, &quot;Hrothgar&#39;s Favor: Jeweled Torc&quot;,
        &quot;description&quot;, &quot;A heavy neck torc studded with precious gemstones—rubies, sapphires, and emeralds—each reflecting the firelight in a dazzling array. The ends are fashioned into the heads of mythical beasts, signifying honor bestowed upon the bravest warriors.&quot;,
        &quot;price&quot;,0,
        &quot;style&quot;,&quot;&quot;
    ),
    (dm:
        &quot;name&quot;, &quot;Hrothgar&#39;s Favor: Silver Arm Band&quot;,
        &quot;description&quot;, &quot;A broad arm band made of sterling silver, etched with scenes of legendary battles and inset with precious stones.&quot;,
                &quot;price&quot;,0,
                        &quot;style&quot;,&quot;&quot;
    )
))


(set: $privateRoomLarder to (a:
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Walnuts&quot;,
        &quot;price&quot;, 0,
        &quot;energy&quot;, 10,   
        &quot;description&quot;, &quot;crack &#39;em and eat &#39;em.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Bread&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 10,         
        &quot;description&quot;, &quot;Simple, hearty bread made from barley and wheat, providing essential sustenance.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Butter&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 10,   
        &quot;description&quot;, &quot;A pot of rich, creamy butter, perfect for spreading on freshly baked bread.&quot;
    )
))
(set: $treeLarder to (a:
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Face fruit&quot;,
        &quot;bonus&quot;, &quot;unknown&quot;,
        &quot;description&quot;, &quot;a creepy fruit with a face on it&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Branch from the face fruit tree&quot;,
        &quot;bonus&quot;, &quot;unknown&quot;,
        &quot;description&quot;, &quot;A branch of wood, strangely warm to the touch and with a brittle, almost crystaline texture to the outer bark.&quot;
    )
))

(set: $churchLarder to (a:
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;gruel&quot;,
        &quot;price&quot;, 0,
        &quot;energy&quot;, 12,         
        &quot;description&quot;, &quot;A mixture of oats and scrap grains boiled to the point of being edible. Excellent for fending off starvation.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;watery vegetable soup&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 8,         
        &quot;description&quot;, &quot;A thin but palatable and nutritious broth of country vegetables.&quot;
    )
))


(set: $adventurersLarder to (a:
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Bread&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 5,         
        &quot;description&quot;, &quot;Simple, hearty bread made from barley and wheat, providing essential sustenance.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Walnuts&quot;,
        &quot;price&quot;, 0,
        &quot;energy&quot;, 11,   
        &quot;description&quot;, &quot;crack &#39;em and eat &#39;em.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Ale&quot;,
        &quot;price&quot;, 0,
        &quot;energy&quot;, 9,   
        &quot;alcohol&quot;, true,
        &quot;description&quot;, &quot;Simple, straightforward. Delicious, nutritious, and mildly intoxicating.&quot;
    )
))

(set: $basicFeastLarder to (a:
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Bread&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 5,           
        &quot;description&quot;, &quot;Simple, hearty bread made from barley and wheat, providing essential sustenance.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Roasted Mutton&quot;,
        &quot;price&quot;, 0,
        &quot;energy&quot;, 25,   
        &quot;description&quot;, &quot;Delicious and nutritious.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Ale&quot;,
        &quot;energy&quot;, 10,   
        &quot;price&quot;, 0,
        &quot;alcohol&quot;, true,
        &quot;description&quot;, &quot;Simple, straightforward. Delicious, nutritious, and mildly intoxicating.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Stewed Vegetables&quot;,
        &quot;energy&quot;, 8,   
        &quot;price&quot;, 0,
        &quot;description&quot;, &quot;Hearty stewed root vegetables seasoned with salt and basic herbs.&quot;
    )
))

(set: $fancyFoodLarder to (a:
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Dark rye bread&quot;,
        &quot;energy&quot;, 7,   
        &quot;price&quot;, 0,
        &quot;description&quot;, &quot;A freshly baked dark rye loaf with a crispy crust and soft interior.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Barley roll&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 3,   
        &quot;description&quot;, &quot;A soft and slightly sweet barley roll, perfect for pairing with meats and cheeses.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Sharp Cheese&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 6,   
        &quot;description&quot;, &quot;A wedge of sharp, tangy cheese that pairs wonderfully with fresh bread and hearty stews.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Roast of boar&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 17,   
        &quot;description&quot;, &quot;Roasted boar with crisp, glistening skin and tender, savory meat.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Venison&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 21,   
        &quot;description&quot;, &quot;Succulent venison, perfectly roasted with herbs and spices for a rich, savory flavor.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Roasted rabbit&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 17,   
        &quot;description&quot;, &quot;Tender roasted rabbit, seasoned with a blend of aromatic herbs.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Roasted fowl&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 12,   
        &quot;description&quot;, &quot;Juicy roasted fowl with a crispy exterior and moist interior, infused with herbs.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Fresh salmon&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 14,   
        &quot;description&quot;, &quot;Freshly caught salmon, cooked to perfection with sprigs of dill and slices of lemon.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Fresh herring&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 12,   
        &quot;description&quot;, &quot;Tender, flaky herring, expertly prepared with dill and lemon slices.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Root vegetables&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 9,   
        &quot;description&quot;, &quot;Carrots, turnips, and parsnips seasoned with salt and fresh herbs.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Apple&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 4,   
        &quot;description&quot;, &quot;A fresh, crisp apple offering a sweet and juicy bite.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Pear&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 6,   
        &quot;description&quot;, &quot;A ripe pear with a soft texture and sweet flavor.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Mixed nuts&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 9,   
        &quot;description&quot;, &quot;A selection of fresh and dried nuts, perfect for snacking.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Creamy butter&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 3,   
        &quot;description&quot;, &quot;A pot of rich, creamy butter, perfect for spreading on freshly baked bread.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Hearty ale&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 12,   
        &quot;alcohol&quot;, true,
        &quot;description&quot;, &quot;Dark, rich ale brewed with a blend of grains, offering a robust and satisfying drink.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Sweet mead&quot;,
        &quot;alcohol&quot;, true,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 11,   
        &quot;description&quot;, &quot;Honey-based mead that is sweet and warming, perfect for relaxing by the fire.&quot;
    )
))

(set: $InnStableInventory to (a:
    (dm:
        &quot;name&quot;, &quot;Sturdy Workhorse&quot;,
        &quot;description&quot;, &quot;A robust brown mare accustomed to hard labor. Ideal for pulling carts and plows, not particularly fast but reliable and strong.&quot;,
        &quot;age&quot;, &quot;8 years&quot;,
        &quot;temperament&quot;, &quot;Docile&quot;,
        &quot;price&quot;, 90,
        &quot;statusSnippets&quot;, (a:
            &quot;OK: Your Sturdy Workhorse trudges along steadily, her sturdy frame showing no signs of fatigue. She flicks her ears contentedly as she plods beside you.&quot;,
            &quot;OK: The Sturdy Workhorse munches on some wild grass during a brief stop. Her docile nature and reliable strength are evident as she calmly awaits the journey&#39;s continuation.&quot;,
            &quot;Needs Attention: You notice the Sturdy Workhorse limping slightly, favoring her front left hoof. It seems she may have picked up a stone; she might need you to check her hoof and give her some rest.&quot;
        )
    ),
    (dm:
        &quot;name&quot;, &quot;Swift Courser&quot;,
        &quot;description&quot;, &quot;A sleek black stallion bred for speed. Excellent for messengers or those needing to travel quickly over long distances.&quot;,
        &quot;age&quot;, &quot;5 years&quot;,
        &quot;temperament&quot;, &quot;Energetic&quot;,
        &quot;price&quot;, 175,
        &quot;statusSnippets&quot;, (a:
            &quot;OK: The Swift Courser moves with a spirited grace, his sleek black coat shimmering even under the overcast sky. His energetic strides make it clear he&#39;s eager for the journey ahead.&quot;,
            &quot;OK: Your Swift Courser snorts softly, eyes alert and ears perked. He seems full of energy, ready to cover more ground with his swift pace.&quot;,
            &quot;Needs Attention: The Swift Courser tosses his head impatiently and paws at the ground. His restless energy suggests he might benefit from a longer run or some calming before proceeding.&quot;
        )
    ),
    (dm:
        &quot;name&quot;, &quot;Gentle Palfrey&quot;,
        &quot;description&quot;, &quot;A calm gray mare with a smooth gait, suitable for nobles or ladies. Comfortable to ride and well-trained.&quot;,
        &quot;age&quot;, &quot;6 years&quot;,
        &quot;temperament&quot;, &quot;Calm&quot;,
        &quot;price&quot;, 90,
        &quot;statusSnippets&quot;, (a:
            &quot;OK: Your Gentle Palfrey walks beside you with a smooth and comfortable gait. Her calm demeanor brings a soothing presence to your travels.&quot;,
            &quot;OK: The Gentle Palfrey nuzzles your hand softly as you check her bridle. She appears content and well-rested, ready to continue the journey.&quot;,
            &quot;Needs Attention: You notice the Gentle Palfrey&#39;s head drooping slightly and her pace slowing. She may be feeling fatigued and could use a rest and perhaps some fresh water.&quot;
        )
    ),
    (dm:
        &quot;name&quot;, &quot;Young Colt&quot;,
        &quot;description&quot;, &quot;A spirited chestnut colt showing promise. Not yet fully trained but could become a fine steed with proper care.&quot;,
        &quot;age&quot;, &quot;2 years&quot;,
        &quot;temperament&quot;, &quot;Playful&quot;,
        &quot;price&quot;, 65,
        &quot;statusSnippets&quot;, (a:
            &quot;OK: The Young Colt frolics at the end of his lead, his playful antics bringing a smile to your face. His youthful energy seems boundless.&quot;,
            &quot;OK: Your Young Colt explores the path with curious eyes, stopping occasionally to sniff at wildflowers. He seems to be enjoying the adventure.&quot;,
            &quot;Needs Attention: You observe the Young Colt breathing heavier than usual, sweat darkening his chestnut coat. It appears he&#39;s overexerted and might need a rest and some water.&quot;
        )
    ),
    (dm:
        &quot;name&quot;, &quot;Strong Warhorse&quot;,
        &quot;description&quot;, &quot;A powerful bay stallion bred for battle. Trained to remain steady in combat and respond swiftly to commands.&quot;,
        &quot;age&quot;, &quot;7 years&quot;,
        &quot;temperament&quot;, &quot;Bold&quot;,
        &quot;price&quot;, 200,
        &quot;statusSnippets&quot;, (a:
            &quot;OK: The Strong Warhorse strides forward with confidence, his powerful muscles rippling under his bay coat. His bold eyes scan the surroundings vigilantly.&quot;,
            &quot;OK: Your Strong Warhorse stands steady as you adjust his gear, showing no signs of fatigue. His training is evident in his disciplined posture.&quot;,
            &quot;Needs Attention: The Strong Warhorse seems agitated, stomping his hoof and shaking his head. Perhaps he senses something amiss or requires calming words to settle.&quot;
        )
    ),
    (dm:
        &quot;name&quot;, &quot;Pack Mule&quot;,
        &quot;description&quot;, &quot;A reliable mule capable of carrying heavy loads over long distances. Not suitable for riding but invaluable for transport.&quot;,
        &quot;age&quot;, &quot;9 years&quot;,
        &quot;temperament&quot;, &quot;Stubborn but dependable&quot;,
        &quot;price&quot;, 65,
        &quot;statusSnippets&quot;, (a:
            &quot;OK: Your Pack Mule continues at a consistent pace, the heavy load secure on his back. His dependable nature eases your concerns about the supplies.&quot;,
            &quot;OK: The Pack Mule pauses briefly to nibble on some low-hanging leaves but resumes walking with a gentle tug. His stubborn yet reliable demeanor is unchanged.&quot;,
            &quot;Needs Attention: The Pack Mule has stopped in his tracks, refusing to move forward despite your encouragement. A short rest or a treat might be needed to coax him along.&quot;
        )
    ),
    (dm:
        &quot;name&quot;, &quot;Spotted Pony&quot;,
        &quot;description&quot;, &quot;A small, sturdy pony with a distinctive spotted coat. Suitable for a child or small adult, sure-footed and hardy.&quot;,
        &quot;age&quot;, &quot;4 years&quot;,
        &quot;temperament&quot;, &quot;Friendly&quot;,
        &quot;price&quot;, 65,
        &quot;statusSnippets&quot;, (a:
            &quot;OK: The Spotted Pony trots happily beside you, his friendly nature lifting everyone&#39;s spirits. His distinctive coat adds a touch of charm to the journey.&quot;,
            &quot;OK: Your Spotted Pony nickers softly, content with the pace of travel. His sure-footed steps handle the uneven terrain with ease.&quot;,
            &quot;Needs Attention: You notice the Spotted Pony is favoring his right hind leg, possibly from a minor sprain. A rest and a careful look might be necessary.&quot;
        )
    ),
    (dm:
        &quot;name&quot;, &quot;Old Nag&quot;,
        &quot;description&quot;, &quot;An elderly horse with a gentle disposition. Not fast or strong but a steady companion for short journeys.&quot;,
        &quot;age&quot;, &quot;12 years&quot;,
        &quot;temperament&quot;, &quot;Gentle&quot;,
        &quot;price&quot;, 50,
        &quot;statusSnippets&quot;, (a:
            &quot;OK: Your Old Nag walks at a leisurely pace, her gentle eyes observing the path ahead. Despite her age, she seems content and steady.&quot;,
            &quot;OK: The Old Nag whinnies softly when you approach, appreciative of a gentle pat on the neck. She appears in good spirits for the journey.&quot;,
            &quot;Needs Attention: You observe that the Old Nag is breathing heavily and sweating more than usual. It might be wise to give her an extended rest and some water.&quot;
        )
    ),
    (dm:
        &quot;name&quot;, &quot;Dappled Gray Gelding&quot;,
        &quot;description&quot;, &quot;A well-trained gelding with a calm demeanor. Suitable for both riding and light work.&quot;,
        &quot;age&quot;, &quot;6 years&quot;,
        &quot;temperament&quot;, &quot;Steady&quot;,
        &quot;price&quot;, 80,
        &quot;statusSnippets&quot;, (a:
            &quot;OK: The Dappled Gray Gelding moves with a calm and steady gait, his dappled coat catching the muted light. He appears well-suited for the day&#39;s travel.&quot;,
            &quot;OK: Your Dappled Gray Gelding stands patiently as you check his saddle, his steady temperament reassuring you that all is well.&quot;,
            &quot;Needs Attention: You notice a slight rubbing under the saddle causing discomfort to the Gelding. Adjusting the gear and applying a soothing balm would help.&quot;
        )
    ),
    (dm:
        &quot;name&quot;, &quot;Fiery Chestnut Mare&quot;,
        &quot;description&quot;, &quot;A spirited mare with a fiery temperament. Fast and strong but requires an experienced rider.&quot;,
        &quot;age&quot;, &quot;5 years&quot;,
        &quot;temperament&quot;, &quot;Fiery&quot;,
        &quot;price&quot;, 120,
        &quot;statusSnippets&quot;, (a:
            &quot;OK: The Fiery Chestnut Mare dances lightly on her feet, her fiery spirit evident but controlled under your experienced guidance. She&#39;s eager yet manageable.&quot;,
            &quot;OK: Your Fiery Chestnut Mare snorts and flicks her tail but responds well to your calming voice. Her energy is high, but she remains cooperative.&quot;,
            &quot;Needs Attention: The Mare is unusually agitated, pulling against the reins and refusing to settle. She may have sensed something unsettling or might need a moment to calm down.&quot;
        )
    )
)
)

(set: $thrythLarder to (a:
        (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Barley roll&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 3,   
        &quot;description&quot;, &quot;A soft and slightly sweet barley roll, perfect for pairing with meats and cheeses.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Sharp Cheese&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 6,   
        &quot;description&quot;, &quot;A wedge of sharp, tangy cheese that pairs wonderfully with fresh bread and hearty stews.&quot;
    ),
        (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Mixed nuts&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 9,   
        &quot;description&quot;, &quot;A selection of fresh and dried nuts, perfect for snacking.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Dark ale&quot;,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 12,   
        &quot;alcohol&quot;, true,
        &quot;description&quot;, &quot;Dark, rich ale brewed with a blend of grains, offering a robust and satisfying drink.&quot;
    ),
    (dm: &quot;sku&quot;, (random: 999),
        &quot;name&quot;, &quot;Dry wine&quot;,
        &quot;alcohol&quot;, true,
        &quot;price&quot;, 0,
	   &quot;energy&quot;, 11,   
        &quot;description&quot;, &quot;An excellent vintage&quot;
    )
))

}</tw-passagedata><tw-passagedata pid="159" name="Initialize Plot" tags="" position="25,525" size="100,100">(set:$ThrythInvestigation to 0)
(set:$fenRuinRopeSecure to false)
(set:$fenCiarRuinRopeSecure to false)
(set:$frogDefeated to false)
(set:$pigDefeated to false)
(set: $grendelComes to false)
(set: $betrayedTorsten to false)
(set:$ThrythReleasedMarta to false)
(set: $notFirstTimeMeetingUnferth to false)
(set:$activeQuests to (a:
&quot;Find somewhere to rest&quot;,
&quot;Make a name for yourself at Heorot Hall&quot;,
&quot;Investigate the mystery of Grendel&quot;
))
(set:$completedQuests to (a:&quot;Arrived at Kattinge Village&quot;))

(set: $knownLore to (a:&quot;Grendel has been attacking Heorot hall.&quot;))
(set: $achievements to (a:&quot;Arrived at Kattinge Village&quot;))


(set:$standingStonesLocation to &quot;There are really spooky and mysterious standing stones in the fen (location known)&quot;)
(set:$standingStonesComms to &quot;The standing stones in the fen act as a communication portal.&quot;)</tw-passagedata><tw-passagedata pid="160" name="Initialize items" tags="" position="150,425" size="100,100">(set:$fenPigHead to (dm:
&quot;name&quot;, &quot;Severed head of monstrous pig-creature from the fen&quot;,
&quot;description&quot;, &quot;A huge, bloody severed head from a strange beast, of which none of you have seen the like.&quot;,&quot;bonus&quot;,&quot;heorot esteem&quot;
))
(set:$cursedRelic to (dm:
&quot;name&quot;, &quot;Cursed Relic&quot;,
&quot;description&quot;, &quot;A locked box locked up tight on that thing whatever it is.&quot;
))

(set:$holyWater to (dm:
&quot;name&quot;, &quot;Aeschere&#39;s Holy Water&quot;,
&quot;description&quot;, &quot;A tiny crystal vial of colorless liquid, which Aeschere instructed you to slip into Unferth&#39;s drink.&quot;
))</tw-passagedata><tw-passagedata pid="161" name="Initialize smithy" tags="" position="25,425" size="100,100">{
(set: $smithInventory to (a: ))

(set: _fineSwordDescription to &quot;The sword is a masterpiece of craftsmanship. The blade gleams with a subtle, wave-like pattern running along its length, a result of the layering and folding technique used to create a simple yet resilient steel. The iron, mixed with ash during the smelting process, has been transformed into a blade that is both strong and flexible. The double-edged blade is razor-sharp, tapering to a lethal point, perfect for both cutting and thrusting.
As you hold the sword, you can feel the balance in your hand, the weight distributed evenly along its length. The hilt features a straight crosspiece, forged from a single piece of iron, offering excellent protection and balance. The grip is wrapped in dark, richly dyed leather, stitched with precision to ensure a comfortable and secure hold.
The sword&#39;s scabbard is made of wood, covered in leather and reinforced with metal fittings, and hangs easily at your side. The sword&#39;s draw is incredibly smooth.&quot;)

(set: $smithInventory to it + (a: (dm: 
&quot;name&quot;, &quot;Fine Sword&quot;,
&quot;price&quot;, 30,
&quot;description&quot;, _fineSwordDescription,
&quot;combat&quot;,5,
&quot;armor&quot;, 0,
&quot;type&quot;,&quot;weapon&quot;

)))

(set: _spearDescription to &quot;The spearhead is a marvel of iron forging, featuring a long, leaf-shaped blade that is both wide and sharp. The blade, created by mixing ash into the iron to form steel, is designed to penetrate armor and flesh with ease. The edges are honed to a keen sharpness, and the central ridge is reinforced to provide strength and prevent bending upon impact.

The shaft of the spear is crafted from strong, flexible wood, carefully shaped and sanded to ensure a smooth, straight surface. The wood has been treated with oil to enhance its durability. The length of the shaft, around seven feet, provides excellent reach and maneuverability. The spearhead is securely fastened to the shaft with iron rivets and reinforced with leather bindings, ensuring it remains firmly attached during use. The butt end features a metal spike, adding balance and functionality, and the shaft is adorned with carved patterns, reflecting the craftsmanship of its maker.&quot;)

(set: $smithInventory to it + (a: (dm: 
&quot;name&quot;, &quot;Spear&quot;,
&quot;price&quot;, 6,
&quot;description&quot;, _spearDescription,
&quot;combat&quot;,3,
&quot;armor&quot;, 1,
&quot;type&quot;,&quot;weapon&quot;
)))

(set: _axeDescription to &quot;The axe head is a robust piece of iron, transformed into a formidable weapon through the skilled mixing of ash into the iron to create steel. The broad, curved blade is designed for powerful chopping and cutting blows, with a sharpened edge capable of cleaving through wood, armor, and bone. The slightly asymmetrical head, with a longer lower edge, increases the cutting surface area, making it even more effective in combat.

The handle of the axe is made from resilient wood, such as ash or oak, chosen for its strength and shock-absorbing properties. The handle is about three feet long, providing the leverage needed for powerful strikes. It is sanded smooth and treated with oil to enhance its grip and durability. The end of the handle is slightly flared to prevent slipping, and leather strips are wrapped around the grip area for additional security.&quot;)
(set: $smithInventory to it + (a: (dm: 
&quot;name&quot;, &quot;Axe&quot;,
&quot;price&quot;, 3,
&quot;description&quot;, _axeDescription,
&quot;combat&quot;,2,
&quot;armor&quot;, 0,
&quot;type&quot;,&quot;weapon&quot;
)))

(set: _mailShirtDescription to &quot;The mail shirt is an impressive piece of armor, meticulously crafted from countless interlocking iron rings. Each ring has been individually riveted, creating a flexible yet strong mesh that offers excellent protection against cuts and thrusts.

Despite its substantial protection, the mail moves with surprising fluidity, allowing for ease of movement in battle. The rings are tightly woven, providing minimal gaps for an enemy&#39;s weapon to penetrate. The shirt reaches down to mid-thigh and has short sleeves, offering comprehensive coverage without hindering mobility. The edges of the sleeves and hem are reinforced with leather bindings, preventing fraying and adding to the overall durability of the armor.&quot;)

(set: $smithInventory to it + (a: (dm: 
&quot;name&quot;, &quot;Mail Shirt&quot;,
&quot;price&quot;, 20,
&quot;description&quot;, _mailShirtDescription,
&quot;combat&quot;,0,
&quot;armor&quot;, 5,
&quot;type&quot;,&quot;armor&quot;
)))

(set: _bowDescription to &quot;launches arrows&quot;)
(set: $smithInventory to it + (a: (dm:
&quot;name&quot;, &quot;Bow&quot;,
&quot;price&quot;, 7,
&quot;description&quot;, _bowDescription,
&quot;combat&quot;,3,
&quot;armor&quot;, 0,
&quot;type&quot;,&quot;weapon&quot;
)))


(set: _helmetDescription to &quot;Forged from iron mixed with ash to create a robust steel, the helmet features a rounded dome that deflects blows from above. The surface is polished to a dull sheen, and you can see the faint traces of hammer marks, a testament to the blacksmith&#39;s hard work.

The helmet includes a sturdy nose guard, which extends down the center of the face, providing additional protection without obstructing vision. The sides of the helmet come down to cover the ears and are lined with leather on the inside for comfort. Attached to the bottom edge is a chainmail aventail, which drapes over the shoulders and neck, adding an extra layer of defense against strikes. The interior is padded with leather and cloth, ensuring a snug fit and cushioning against impacts.&quot;)

(set: $smithInventory to it + (a: (dm: 
&quot;name&quot;, &quot;Helmet&quot;,
&quot;price&quot;, 7,
&quot;description&quot;, _helmetDescription,
&quot;combat&quot;,0,
&quot;armor&quot;, 2,
&quot;type&quot;,&quot;armor&quot;
)))

(set: _shieldDescription to &quot;Made from thin pine planks shaped into a sturdy circular form, covered with stretched hide. The central boss is a sturdy iron dome with a comfortable handle.&quot;)

(set: $smithInventory to it + (a: (dm: 
&quot;name&quot;, &quot;Shield&quot;,
&quot;price&quot;, 8,
&quot;description&quot;, _helmetDescription,
&quot;combat&quot;,1,
&quot;armor&quot;, 3,
&quot;type&quot;,&quot;armor&quot;
)))

(set:$climbingRope to (dm:
        &quot;name&quot;, &quot;Hempen Rope&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A sturdy hemp rope, 50 feet in length, suitable for climbing or securing loads.&quot;,
        &quot;price&quot;, 20
    )
)

(set: $unferthArrows to (a: (dm:
&quot;name&quot;, &quot;Unferth&#39;s Poisoned Arrow&quot;,
&quot;description&quot;, &quot;A finely crafted arrow of dark ash, fletched with raven feathers. The arrowhead is coated with &#39;Niðdraca&#39;s Bane,&#39; a deadly poison formulated by Unferth to be especially lethal against the Sceadugenga.&quot;,&quot;combat&quot;,3, &quot;sn&quot;, 123, &quot;armor&quot;, 0
	),
    (dm:
&quot;name&quot;, &quot;Unferth&#39;s Poisoned Arrow&quot;,
&quot;description&quot;, &quot;A finely crafted arrow of dark ash, fletched with raven feathers. The arrowhead is coated with &#39;Niðdraca&#39;s Bane,&#39; a deadly poison formulated by Unferth to be especially lethal against the Sceadugenga.&quot;,&quot;combat&quot;,3, &quot;sn&quot;, 234, &quot;armor&quot;, 0
	),
    (dm:
&quot;name&quot;, &quot;Unferth&#39;s Poisoned Arrow&quot;,
&quot;description&quot;, &quot;A finely crafted arrow of dark ash, fletched with raven feathers. The arrowhead is coated with &#39;Niðdraca&#39;s Bane,&#39; a deadly poison formulated by Unferth to be especially lethal against the Sceadugenga.&quot;,&quot;combat&quot;,3, &quot;sn&quot;, 345, &quot;armor&quot;, 0
	)
    ))
(set: $GeneralShopInventory to (a:
    (dm:
        &quot;name&quot;, &quot;Jar of Pitch&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A clay jar filled with thick, sticky pitch, ideal for lighting torches or preparing fire arrows.&quot;,
        &quot;price&quot;, 25
    ),
    (dm:
        &quot;name&quot;, &quot;Torch staves (5)&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;Wooden batons for lighting torches (requires pitch and firestarter kit).&quot;,
        &quot;price&quot;, 1
    ),
    $climbingRope,
    (dm:
        &quot;name&quot;, &quot;Firestarter kit&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A firestarter kit consisting of a piece of flint and steel striker.&quot;,
        &quot;price&quot;, 15
    ),
    (dm:
        &quot;name&quot;, &quot;Oil Lantern&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A simple iron lantern with a shutter to control the light. Requires oil to function.&quot;,
        &quot;price&quot;, 15
    ),
    (dm:
        &quot;name&quot;, &quot;Leather Water Skin&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A durable water skin made from goat hide, holds up to 2 liters of liquid.&quot;,
        &quot;price&quot;, 4
    ),
    (dm:
        &quot;name&quot;, &quot;Small Sack&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A simple burlap sack that can hold up to 20 pounds of goods.&quot;,
        &quot;price&quot;, 1
    ),
    (dm:
        &quot;name&quot;, &quot;Whetstone&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A flat stone used to sharpen blades and tools.&quot;,
        &quot;price&quot;, 2
    ),
    (dm:
        &quot;name&quot;, &quot;Iron Nails (10 pcs)&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A bundle of ten iron nails, useful for repairs or construction.&quot;,
        &quot;price&quot;, 3
    ),
    (dm:
        &quot;name&quot;, &quot;Fishing Hooks and Line&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A set of hooks and a length of line for catching fish.&quot;,
        &quot;price&quot;, 2
    ),
    (dm:
        &quot;name&quot;, &quot;Candles (5 pcs)&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;Five tallow candles to provide light in the darkness.&quot;,
        &quot;price&quot;, 3
    ),
    (dm:
        &quot;name&quot;, &quot;Charcoal Sticks&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A handful of charcoal sticks suitable for writing or drawing.&quot;,
        &quot;price&quot;, 7
    ),
    (dm:
        &quot;name&quot;, &quot;Empty Vials (3 pcs)&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;Three small glass vials with cork stoppers, for holding liquids.&quot;,
        &quot;price&quot;, 10
    ),
    (dm:
        &quot;name&quot;, &quot;Herbal Poultice&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A prepared poultice made from local herbs, aids in healing minor wounds.&quot;,
        &quot;price&quot;, 6
    ),
    (dm:
        &quot;name&quot;, &quot;Wooden Bowl and Spoon&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A simple bowl and spoon carved from oak, for meals on the go.&quot;,
        &quot;price&quot;, 1
    ),
    (dm:
        &quot;name&quot;, &quot;Tin Whistle&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A small flute-like instrument made of tin, for making music.&quot;,
        &quot;price&quot;, 6
    ),
    (dm:
        &quot;name&quot;, &quot;Lantern Oil&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A bottle of oil suitable for use in lanterns or lamps.&quot;,
        &quot;price&quot;, 15
    ),
    (dm:
        &quot;name&quot;, &quot;Sewing Kit&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A small kit containing needles, thread, and patches for repairing clothing.&quot;,
        &quot;price&quot;, 2
    ),
    (dm:
        &quot;name&quot;, &quot;Iron Pot&quot;,        &quot;bonus&quot;, &quot;&quot;,
        &quot;description&quot;, &quot;A small iron pot for cooking over a fire.&quot;,
        &quot;price&quot;, 2
    ),
    (dm:
        &quot;name&quot;, &quot;Clay Mug&quot;,
        &quot;description&quot;, &quot;A sturdy clay mug, perfect for enjoying ale or mead.&quot;,
        &quot;bonus&quot;, &quot;&quot;,
        &quot;price&quot;, 1
    )
))

(set: $ClothingShopInventory to (a:
    (dm:
        &quot;name&quot;, &quot;Woolen Cloak&quot;,
        &quot;description&quot;, &quot;A heavy cloak made from thick wool, dyed in natural earthy tones. Ideal for keeping warm during travel.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 8
    ),
    (dm:
        &quot;name&quot;, &quot;Linen Tunic&quot;,
        &quot;description&quot;, &quot;A comfortable linen tunic suitable for everyday wear. Comes in various sizes.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 5
    ),
    (dm:
        &quot;name&quot;, &quot;Leather Boots&quot;,
        &quot;description&quot;, &quot;Sturdy boots made from tanned leather, designed for long journeys and harsh terrain.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 1
    ),
    (dm:
        &quot;name&quot;, &quot;Woven Belt&quot;,
        &quot;description&quot;, &quot;A belt woven from wool and reinforced with leather accents, used to secure garments.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 2
    ),
    (dm:
        &quot;name&quot;, &quot;Woolen Cap&quot;,
        &quot;description&quot;, &quot;A knitted cap made from sheep&#39;s wool, keeping the head warm in cold climates.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 1
    ),
    (dm:
        &quot;name&quot;, &quot;Fur-lined Gloves&quot;,
        &quot;description&quot;, &quot;Gloves made from soft leather and lined with rabbit fur for added warmth.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 4
    ),
    (dm:
        &quot;name&quot;, &quot;Traveler&#39;s Vest&quot;,
        &quot;description&quot;, &quot;A sleeveless vest with multiple pockets, made from durable canvas.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 6
    ),
    (dm:
        &quot;name&quot;, &quot;Woolen Leggings&quot;,
        &quot;description&quot;, &quot;Comfortable leggings woven from wool, providing warmth and flexibility.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 3
    ),
    (dm:
        &quot;name&quot;, &quot;Embroidered Shawl&quot;,
        &quot;description&quot;, &quot;A finely woven shawl adorned with intricate embroidery patterns, showcasing skilled craftsmanship.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 7
    ),
    (dm:
        &quot;name&quot;, &quot;Leather Bracers&quot;,
        &quot;description&quot;, &quot;Protective wrist guards made from hardened leather, often worn by archers.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 5
    ),
    (dm:
        &quot;name&quot;, &quot;Fur Cloak&quot;,
        &quot;description&quot;, &quot;A luxurious cloak lined with fox fur, providing exceptional warmth and style.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 1
    ),
    (dm:
        &quot;name&quot;, &quot;Simple Sandals&quot;,
        &quot;description&quot;, &quot;Open-toed sandals crafted from leather straps, suitable for indoor wear.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 2
    ),
    (dm:
        &quot;name&quot;, &quot;Linen Undergarments&quot;,
        &quot;description&quot;, &quot;Basic undergarments made from soft linen for comfort.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 2
    ),
    (dm:
        &quot;name&quot;, &quot;Wide-brimmed Hat&quot;,
        &quot;description&quot;, &quot;A hat with a broad brim to shield the wearer from sun and rain.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 3
    ),
    (dm:
        &quot;name&quot;, &quot;Child&#39;s Woolen Cloak&quot;,
        &quot;description&quot;, &quot;A smaller woolen cloak designed for a child, offering warmth and protection.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 5
    ),
    (dm:
        &quot;name&quot;, &quot;Leather Belt Pouch&quot;,
        &quot;description&quot;, &quot;A small pouch that attaches to a belt, perfect for carrying coins or small items.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 2
    ),
    (dm:
        &quot;name&quot;, &quot;Woolen Scarf&quot;,
        &quot;description&quot;, &quot;A long scarf knitted from wool, wrapped around the neck for warmth.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 1
    ),
    (dm:
        &quot;name&quot;, &quot;Embroidered Headband&quot;,
        &quot;description&quot;, &quot;A decorative headband featuring colorful embroidery, worn as an accessory.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 1
    ),
    (dm:
        &quot;name&quot;, &quot;Leather Apron&quot;,
        &quot;description&quot;, &quot;A heavy-duty apron made from thick leather, used by blacksmiths or craftsmen.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 6
    ),
    (dm:
        &quot;name&quot;, &quot;Woolen Socks&quot;,
        &quot;description&quot;, &quot;Thick socks knitted from wool, keeping feet warm in cold weather.&quot;,
        &quot;style&quot;,&quot;&quot;,
        &quot;price&quot;, 1
    )
))


}</tw-passagedata><tw-passagedata pid="162" name="Inn Hub" tags="" position="675,1150" size="200,200">(display: &quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)

The tavern bustles with activity, and the air is thick with the mingled scents of sweat, ale, and roasted meat.

The low ceiling amplifies the noise, a cacophony of laughter, shouts, and the clinking of mugs. A large hearth dominates one wall, its flames crackling and popping, casting a warm, orange glow over the nearest patrons. The walls are adorned with faded tapestries and crude paintings, depicting scenes of hunts and seafaring adventures.

At the far end of the room, a long bar stretches across, behind which a burly innkeeper pours drinks and shouts orders to the kitchen. The bar is lined with barrels and bottles of various sizes. The floor is sticky with ale and no doubt other less pleasant substances.

{
(if:&quot;Adventurers&quot; of $reputation is &quot;friendly&quot; or &quot;Adventurers&quot; of $reputation is &quot;allied&quot;)[
Lothar waves you over eagerly, pouring a drink from the large pitcher on the table between himself and Ciar.&lt;br&gt;
&lt;br&gt;
[[Approach the adventurers-&gt;Adventurers Hub]]&lt;br&gt;
]
[[Observe the patrons]]&lt;br&gt;
[[Find a quiet seat at the hearth-&gt;Sit at the hearth]]&lt;br&gt;
(if: $reputation&#39;s &quot;Innkeeper&quot; is &quot;valued customer&quot;)[
[[Retire to your private chambers-&gt;Private Room]]&lt;br&gt;
]
[[Talk to the innkeeper-&gt;Innkeeper]]&lt;br&gt;
[[Attempt to make some coin by playing a song-&gt;Play a tune to make some coin]]&lt;br&gt;
[[Depart the inn-&gt;Village Hub]]&lt;br&gt;
}&lt;br&gt;&lt;br&gt;</tw-passagedata><tw-passagedata pid="163" name="Inn Post Execution" tags="" position="5375,2200" size="100,100">(display: &quot;header&quot;)
The inn, usually a place of warmth and camaraderie, feels different as you enter. The buzz of conversation is subdued, and the air is thick with tension. The recent events surrounding Torsten’s execution have cast a shadow over the village, and the inn’s patrons reflect that unease.

You make your way to the bar, where the innkeeper, a burly man with a grizzled beard, is polishing mugs with a somber expression. He looks up as you approach, his eyes narrowing slightly. “What’ll it be?” he asks, his tone curt.

You order a drink and take a seat at an empty table near the hearth. The warmth of the fire does little to dispel the chill in the room. Around you, small groups of villagers and warriors speak in hushed tones, casting wary glances in your direction.

A group of fishermen at a nearby table mutter amongst themselves, one of them shaking his head. “Torsten was a fool, but he didn’t deserve to die like that,” one says, his voice tinged with anger.

Another replies, “Hrothgar’s justice is swift and brutal. We must be careful what we say and to whom.”

You notice a few of the inn’s regular patrons, their usual cheerful demeanor replaced by guarded expressions. The mercenaries and adventurers who had been so lively before now sit quietly, nursing their drinks and avoiding eye contact.

As you sip your ale, a shadow falls over your table. You look up to see one of the warriors, a tall man with a scar across his cheek, glaring down at you. “You’re the bard, aren’t you? The one who brought Torsten to his doom?”

You nod, unsure of how to respond. The warrior’s eyes flash with anger. “Be careful who you cross here. We remember our friends, and we remember our enemies.”

He turns and walks away, leaving you with a sense of foreboding. The inn, once a place of refuge, now feels fraught with danger and mistrust.

Nearby, you overhear a group of Christians and Hrothgar loyalists. One of them, a burly man with a crucifix hanging around his neck, raises his mug in your direction. “Here’s to the bard who helped rid us of a pagan menace! Torsten was a danger to us all, and we’re better off without him.”

His companions nod in agreement, murmuring their approval. “The king’s justice is righteous and swift,” one of them says, raising his mug in a toast. “Long live Hrothgar!”

The mixed reactions in the room create an atmosphere of unease and tension. While some view you with suspicion and hostility, others see you as an ally in their fight against paganism and chaos. The inn, once a place of fellowship, is now a microcosm of the broader conflicts tearing at the fabric of Heorot.

You take another sip of your drink, the weight of your actions heavy on your mind. It’s clear that earning the trust of Heorot’s people will be a long and difficult path, and the allegiances here are as divided as the village itself.
[[Drink yourself to sleep-&gt;Grendel Attack]]</tw-passagedata><tw-passagedata pid="164" name="Inn wakeup morning of patrol" tags="" position="1150,2775" size="100,100">(display: &quot;header&quot;)

You wake to the the morning sun filtering through the wooden slats of the inn&#39;s windows and a slight throbbing in your head from from the previous night&#39;s revelry. Anticipation of the day&#39;s mission quickly sobers you.

Fastening your cloak and checking your gear one last time, you follow the group out of the inn, the crisp morning air an invigorating change after the closeness of the tavern. The village is quiet, and you walk in silence, the gravity of the task ahead settling in.

(display:&quot;EnergyReset&quot;)
[[Continue-&gt;Out the gates on patrol]]</tw-passagedata><tw-passagedata pid="165" name="Innkeeper" tags="" position="50,1800" size="100,100">(display: &quot;header&quot;)
You make your way through the throng of patrons, dodging serving girls and sidestepping men deep in their cups, until you reach the bar. Leaning against it, you watch as the innkeeper, fills several mug from a large barrel and brings them to a patron, before looking your way.

[Your current silver: (print: $sp)]&lt;sp|&lt;br&gt;
(if:$reputation&#39;s &quot;Innkeeper&quot; is &quot;valued customer&quot;)[
Upon noticing you, the innkeeper pours a mug of ale and makes his way over to greet you obsequiously.

---
Ale added to inventory! (set: $food to it + (a: (dm: 
   &quot;name&quot;, &quot;Ale&quot;, 
   &quot;alcohol&quot;, true,
   &quot;price&quot;, 1, 
   &quot;energy&quot;, 10, 
   &quot;description&quot;, &quot;A hearty mug of ale to quench thirst and lift spirits.&quot;
)))
---

[[Retire to your private chambers-&gt;Private Room]]
](else:)[
&quot;Evening, traveler,&quot; he says with a practiced and slightly weary heartiness, eyeing your clothing and appearance apprasingly.

&quot;If you&#39;re hungry we&#39;ve got a hearty cod stew with potatoes, and leeks. Served with a  bread and ale, it&#39;ll satisfy your guts for only a penny. We&#39;ve also got a fine roast pork, seasoned with herbs and turning slowly over the fire. The skin is crispy, and the meat inside is juicy and tender. Served with bread and picked, it&#39;s a meal fit for a thane.&quot;

&quot;As for board,&quot; he begins hopefully, &quot;We’ve got a select few private rooms open for discerning gentry such as yourself. It&#39;s 20 penningar for the week, and that includes your meals. Finest public accomodations in the area.

We’ve also got a hayloft out back, if you’re not too fussy. It’s dry and warm, and the stable boy keeps it clean. One silver penny for the night.

If you don’t mind the noise, you can always sleep here by the hearth. Plenty of benches and the fire keeps the chill away. No charge for that, just keep an eye on your belongings.&quot;

[[Claim the room upstairs (20sp)-&gt;Private Room]]
[[Sleep in the hayloft (1sp)-&gt;Sleep in Hayloft]]
]
[[Sit at the hearth]]
[[Excuse yourself and circulate-&gt;Inn Hub]]

{(display: &quot;Initialize Food Shops&quot;)
(for: each _item, ...$foodForSaleInn)[
---
Name: (print: &quot;name&quot; of _item) |  Price: (print: &quot;price&quot; of _item) silver penningar | (link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] | (link:&quot;purchase&quot;)[(set: $purchaseItem to _item)(display: &quot;Purchase confirmation&quot;)(replace: ?sp)[ [Your current silver: (print: $sp)]&lt;sp|]]

]
}</tw-passagedata><tw-passagedata pid="166" name="Inquire About the Other Threats" tags="" position="3950,1350" size="100,100">(display: &quot;header&quot;)
Unferth’s expression darkens slightly. “Grendel is the most immediate threat, but the land is rife with dangers. Political unrest, rival factions, and old enemies all vie for power and influence. We must remain ever vigilant.”

He continues, his tone serious. “There are whispers of old feuds rekindling, of warriors plotting in the shadows. The old ways clash with the new, and even within Heorot, not everyone is united in purpose.

&quot;This land also contains myriad dormant threats that could be awakened. Histories tell of ancient magics or creatures that have lain sleeping, being awakened to disastrous consequence. In these times, as the ambitious seek ever more power, such possibilities cannot be ignored.&quot;

Unferth pauses, his gaze piercing. “Be cautious in your interactions. Allies and enemies are not always obvious. Your songs and stories have power, but power can destroy as well as create.”

[[Continue talking to Unferth-&gt;Unferth Convo Hub]]
[[Excuse yourself-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="167" name="Inquire Eir about the village&#39;s ancient traditions" tags="" position="2625,1975" size="100,100">(display: &quot;header&quot;)
[[Continue-&gt;Elders Hub]]
[[Excuse yourself and return to the village-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="168" name="Inquire Marta Attack" tags="" position="2350,3325" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
&quot;Can you tell us what you saw that night?&quot; you ask gently. &quot;Anything you remember could be helpful.&quot;

Marta closes her eyes, shuddering at the memory. &quot;It was dark, but there was a chill—colder than any night I&#39;ve known. I woke to the sound of splintering wood. My husband—he went to check, but before he reached the door, it burst open.&quot;

Her voice trembles. &quot;They were... enormous. Taller than any man, their forms cloaked in shadows that seemed to swallow the light. Their eyes glowed faintly, like embers. I... I grabbed the children and hid.&quot;

Edda leans in. &quot;Did they speak? Make any sounds?&quot;

She shakes her head. &quot;Silent, except for the creaking of the floorboards under their weight. My husband tried to fight—he swung his sword, but it passed through them as if they were mist.&quot;

Ciar&#39;s expression is grave. &quot;And then?&quot;

&quot;Then they took him. Just lifted him like a doll and carried him into the night. They were gone, just like that.&quot;

[[Continue-&gt;Marta Hub]]</tw-passagedata><tw-passagedata pid="169" name="Inquire Marta Shed" tags="" position="2725,3350" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
Marta hesitates but then gestures toward a partially burned structure nearby. &quot;Take whatever you need.&quot;

You approach the shed cautiously. The door hangs loosely, the wood charred around the edges. Inside, the air is thick with the scent of smoke and an undercurrent of something sweeter, almost floral.

Inside the Shed:

    Strange Wood: Stacked against one wall are logs of the peculiar wood. Even in the dim light, they emit a subtle glow. The bark is etched with intricate runes that seem to shift when viewed from different angles.

    Tools: Axes and saws lie scattered, their blades notched and dulled. One axe head is cracked entirely, as if broken against something harder than steel.
[[Continue-&gt;Marta Hub]]
[[Thryth Hub]]</tw-passagedata><tw-passagedata pid="170" name="Inquire about Grendel and the attacks" tags="" position="4200,1250" size="100,100">(display: &quot;header&quot;)
Unferth&#39;s eyes narrow slightly at your question. Without a word, he motions for you to follow him. He leads you through the bustling hall, past tables filled with warriors and the loud clatter of drinking vessels. You ascend a narrow staircase, the creak of the wooden steps almost drowned out by the din below. At the top, a small loft area overlooks the main hall, providing a sense of privacy while still being connected to the life of Heorot.

Unferth takes a moment to look out over the hall, his expression unreadable in the flickering firelight. The warm, smoky air carries the scents of roasted meat and spilled ale.

&quot;Grendel,&quot; Unferth begins, his voice low and measured. &quot;The scourge of our land. King Hrothgar holds firmly to the belief that Grendel is a single, monstrous being—spawn of Cain, cursed by God. I do not know whether this idea originated with Hrothgar&#39;s, or that of the priest, Aeschere. They hold long mystical consultations, from which I am excluded, and from which the king often returns with new, unshakeable convictions. Apparently my lack of standing with the Christian god makes me incapable of understanding these revelations,&quot; he says with a sardonic sneer.

&quot;In any case,&quot; Unferth continues, &quot;the idea of Grendel as a lone actor has become ironclad doctrine. I warn you expressly, more than one advisor has learned the folly of questioning it at the point of Hrothgar&#39;s sword.&quot;

He hesitates, as if weighing his words carefully. &quot;The local peasants speak of the Sceadugenga—shadow walkers, they call them. Intelligent, magical beings that dwell in the deep forests. I heard such tales from my own wetnurse as a child. Indeed, the persistence of such reports, and... the overall weight of evidence, make it unlikely that they are mere tales.&quot;

Unferth&#39;s gaze pierces you, his expression a mix of frustration and determination. &quot;We must tread carefully.  For Hrothgar, and Aeschere, Grendel has come to symbolize and embody the resistence to their vision: namely, that all of the wilderness of Sjælland must someday be converted to farmland, and that every worshipper of the pagan gods be converted to Christianity.&quot;

The sounds of laughter and conversation from below fill the brief silence that follows. Unferth&#39;s eyes remain fixed on you, waiting for your response.

[[Inquire further about the Sceadugenga]]
[[Continue talking to Unferth-&gt;Unferth Convo Hub]]
[[Excuse yourself-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="171" name="Inquire about Grendel&#39;s weaknesses" tags="" position="1450,2700" size="100,100">(display: &quot;header&quot;)
&quot;Father Aelfric,&quot; you say, your voice low and steady, &quot;do you know of any weaknesses that Grendel might have? Anything that could help us fight him?&quot;

Father Aelfric&#39;s eyes widen, and he takes a step back, his fingers drumming nervously against his worn robes. &quot;Weaknesses?&quot; he repeats, almost as if testing the word. He rubs his chin thoughtfully, his expression a mix of fear and curiosity. &quot;Grendel... he&#39;s a creature of darkness, a product of sin and paganism. Fighting him is not just a physical battle but a spiritual one.&quot;

He glances around the dimly lit church, the flickering candlelight casting eerie shadows on the rough-hewn wooden walls. The scent of incense mingles with the earthy aroma of the wooden benches and the faint tang of old stone. The few travelers seeking refuge here murmur softly among themselves, their voices hushed and filled with anxiety.

Father Aelfric&#39;s voice drops to a conspiratorial whisper. &quot;I&#39;ve heard stories,&quot; he says, his eyes darting to the corners of the room as if fearing eavesdroppers. &quot;Some say that Grendel fears the light, that he is weakened by the presence of the holy. But more than that, they say his connection to the old ways is his greatest strength—and his greatest vulnerability.&quot;

He leans closer, his breath smelling faintly of herbs and something metallic. &quot;There are relics, sacred items from the old faith, that he treasures. They give him power. Destroying them might weaken him, make him vulnerable. But it is dangerous to seek these out. They are guarded fiercely by those who still practice the old ways.&quot;

Aelfric’s eyes take on a distant, haunted look. &quot;I&#39;ve also heard whispers,&quot; he continues, his voice trembling slightly, &quot;of a place deep in the forest, a sacred ground where Grendel draws his strength. If you can find it and desecrate it, perhaps you could strip him of his power. But beware, for such a place would be heavily protected by dark magic and the Sceadugenga.&quot;

The priest grips your arm tightly, his nails digging into your skin. &quot;But remember this,&quot; he says, his voice urgent. &quot;You must keep your faith strong. Grendel thrives on fear and doubt. Stand firm in your belief, and you might just survive. The light of Christ is your greatest weapon against the darkness he brings.&quot;

He releases your arm, his eyes searching yours for understanding. &quot;Go with God,&quot; he says, his voice a mix of hope and desperation. &quot;And may His light guide you.&quot;

[[Offer to help with the Grendel problem]]
[[Continue-&gt;Church Hub]]</tw-passagedata><tw-passagedata pid="172" name="Inquire about Unferth’s unusual armor" tags="" position="4000,1150" size="100,100">(display: &quot;header&quot;)

Unferth’s lips curl into a faint smile, clearly pleased by your observation. &quot;You have a discerning eye, my friend. This armor is indeed special, made for me by the finest smith of Byzantion. The metallurgy is unmatched, combining both beauty and strength in ways that our smiths are yet to master.&quot;

He gestures to his chest plate, where the intricate patterns of interwoven black metal catch the light. &quot;It’s as light as it is strong, providing unparalleled protection without sacrificing mobility.&quot;

As you admire the craftsmanship, Unferth reaches into his cloak and pulls out a dagger, its blade gleaming with a cold, blue sheen. The hilt is adorned with strange runes and inlaid with small, glittering gemstones.

&quot;This dagger,&quot; he says, holding it out for you to see, &quot;was a gift from one of the wealthiest traders of the Persian empire. See the wave pattern on the blade? This results from an arcane forging technique which our own smiths, and even those of the Sassanids, have been unable to recreate.&quot;

You take a closer look at the dagger, noting the intricate patterns on the blade and the fine balance it possesses.

Unferth nods, clearly enjoying your interest. &quot;Such items are not merely for show. They serve as reminders that the world is vast and full of secret knowledge we can scarcely imagine. It is always wise to keep an open mind and to learn from those who excel in their crafts.&quot;

He tucks the dagger back into his cloak and straightens, his eyes meeting yours with a thoughtful expression. &quot;You have a keen sense for such things. Perhaps that will serve you well in the times to come.&quot;

[[Continue talking to Unferth-&gt;Unferth Convo Hub]]
[[Excuse yourself-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="173" name="Inquire about purchasing a horse" tags="" position="600,975" size="100,100">(display: &quot;header&quot;)
(set:$effort to 5)(display:&quot;Effort&quot;)

The stablehand shows you back into the pasture, where you are free to examine the horses.

[Your current silver: (print: $sp)]&lt;sp|&lt;br&gt;
[[Back to the crossroads-&gt;Village Hub]]
{
(for: each _item, ...$InnStableInventory)

[
---
Name: (print: &quot;name&quot; of _item)&lt;br&gt;
Price: (print: &quot;price&quot; of _item) silver penningar &lt;br&gt;
Temperament: (print: &quot;temperament&quot; of _item )&lt;br&gt;
Age: (print: &quot;age&quot; of _item )&lt;br&gt;
(link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] &lt;br&gt;(link:&quot;purchase&quot;)[(set: $purchaseItem to _item)(display: &quot;Purchase confirmation&quot;)(replace: ?sp)[ [Your current silver: (print: $sp)]&lt;sp|]]&lt;br&gt;
]
}

[[Back to the crossroads-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="174" name="Inquire about the Relic Quest" tags="" position="3975,2175" size="100,100">(display: &quot;header&quot;)
(if: $reputation&#39;s &quot;Adventurers&quot; is &quot;allied&quot;)[

He steps closer, lowering his voice to a confidential whisper. &quot;Now, listen carefully. You must take the artifact, locked in a secure, weighted chest, to a secluded cove up the coast—Shadowdeep Cove. It is hidden beyond the Whispering Cliffs, a place known only to a few. There, you will meet a boatman, Bjorn.&quot;

&quot;He has been instructed to ferry you out to the Midnight Trench, an area of the sea where the waters are unfathomably deep. Once there, you are to cast the chest into the abyss. The depths will ensure that it remains beyond the reach of anyone—or anything—that might seek it.&quot;

&quot;This task is //not// to be taken lightly,&quot; he says, &quot;the artifact we must dispose of is too dangerous to keep here, even under the most vigilant watch.&quot;

He motions for you and your companions to follow him. &quot;Come, I will show you.&quot; 


He leads you through a narrow corridor in Heorot Hall, the noise of the feast fading behind you. The air grows cooler as you descend a stone staircase, the walls lined with flickering torches casting long, eerie shadows.

&quot;The chest is kept in the catacombs beneath Heorot, under constant guard,&quot; Unferth explains as you walk. &quot;Its power is such that even the slightest exposure could bring calamity upon us. That is why we must rid ourselves of it completely.&quot;

You feel a chill as you reach the bottom of the stairs, stepping into a dimly lit passageway. The stone walls are damp, and the air smells of earth and old iron. Unferth leads you past several armored guards, their eyes following your every move.

&quot;Beyond this point, very few have ventured,&quot; Unferth continues, his tone serious. &quot;The relic is stored in a chamber warded with the strongest spells and the most skilled warriors. Even Hrothgar himself rarely comes here.&quot;

You enter a large, vaulted chamber at the end of the passage. In the center of the room, surrounded by a ring of glowing runes, rests a small, intricately carved wooden chest. The chest is bound with iron bands and inscribed with ancient symbols that pulse faintly in the torchlight.

Two guards stand on either side of the chest, their expressions stern and unyielding. Unferth nods to them, and they step aside, allowing you to approach.

&quot;This is the cursed artifact,&quot; Unferth says, his voice barely above a whisper. &quot;A dangerous pagan weapon, valuable to the Shadow Walkers. If it were to fall into their hands, it could spell disaster for us all. We must ensure it is either destroyed or at least placed beyond their reach. You must not open the chest, to do so would exposure you to the foulest and deadliest of magics.&quot; he pauses, &quot;As well as Hrothgar&#39;s equally dangerous disfavor.&quot;

You feel the weight of the moment as you stand before the chest, the faint hum of its power sending a shiver down your spine.

&quot;Are you ready to accept this burden?&quot; Unferth asks, his eyes locking onto yours.
&quot;You will need to ride for several days .&quot; Unferth explains.

(if:length of $horses &gt;= 5)[
[[Accept-&gt;Accept the Cursed Artifact]]
](else:)[
//You must acquire enough horses for your party.//
]

[[Tell Unferth You Need More Time to Prepare-&gt;Unferth Quest Hub]]
](else:)[
Unferth&#39;s face tightens in an almost imperceptible hint of impatience. &quot;I believe I made it clear that this job will acquire additional musle?&quot;
[[Tell Unferth you will find some followers.-&gt;Unferth Quest Hub]]
]</tw-passagedata><tw-passagedata pid="175" name="Inquire further about the Sceadugenga" tags="" position="4200,1375" size="100,100">(display: &quot;header&quot;)
Unferth’s eyes flicker with mingled caution and curiosity as you press further. His voice is barely more than a whisper, the noise of the hall below creating a constant background hum.

&quot;You have a keen interest, I see,&quot; he begins, choosing his words with care. &quot;The Sceadugenga are not mere tales. They are beings of flesh and blood, like men, although their race is likely far older. They possess intelligence and magic, and they do not take kindly to our intrusions.&quot;

He pauses, glancing around to ensure no one is within earshot. The dim light of the loft casts long shadows, adding to the secrecy of the conversation. &quot;These creatures, these //shadow walkers//, are deeply tied to the land. They see our expansion, our logging and farming, as a threat to their existence, as no doubt it is. The attacks are their way of defending their territory.&quot;

Unferth’s voice drops even lower. &quot;There are few who know this, fewer still who dare to speak of it. Hrothgar’s stance cannot be questioned openly—Grendel is a lone monster, a blighted creature turned from God who attacks for no other reason, and who has no rightful claim to this or any other land. //This land//,&quot; he shakes his head wearily, &quot;is of course supposed to be an empty //wasteland// that must be populated by Christians. But it were already occupied, how could that be? Therefore there can be no Sceadugenga. For Hrothgar, there is only //Grendel//, accursed by God, living only to be killed by the warrior devout enough.&quot;

&quot;For Hrothgar, this war is a //spiritual// contest. The men and women, and Sceadugenga for that matter, who fight and die are secondary to the struggle of ideas.&quot;  

His voice hardens as he continues, &quot;so it is left to //me// to plan our stance against this foe as it shall unfold in the flesh. The Sceadugenga are many, and cunning, and we do not known the extent of their magical and military capabilities.&quot;

He straightens slightly, his eyes intense. &quot;We must be careful. To speak openly of the Sceadugenga is to invite suspicion and possible retribution. But knowledge is our greatest weapon. Understanding our enemy is the first step in defeating them.&quot;

The flickering light from the hall below casts moving shadows across Unferth&#39;s face, emphasizing the seriousness of his words. He leans back, giving you a moment to digest the information.

[[Continue-&gt;Unferth Convo Hub]]</tw-passagedata><tw-passagedata pid="176" name="InquireCurse" tags="" position="3150,6275" size="100,100">(display: &quot;header&quot;)



&quot;These magics Eirikr used,&quot; you say, &quot;do you know more about them? How did he gain such power to bind a dragon and corrupt his own soul?&quot;

Véfrøðr&#39;s gaze turns thoughtful. &quot;Eirikr sought knowledge from the darkest corners of existence. He communed with entities best left undisturbed—spirits of the Nine Worlds who dwell beyond the sight of gods and men.&quot;

&quot;He delved into seiðr—a form of magic practiced by the völur, the seeresses who could shape fate and converse with the dead. But where they sought harmony with the threads of destiny, Eirikr sought to dominate them.&quot;

The dragon&#39;s voice deepens. &quot;He inscribed runes of binding and compulsion, using blood sacrifices to empower his spells.&quot;

Véfrøðr&#39;s eyes meet yours. &quot;Such power comes at a terrible price. It corrupted his spirit, twisting his desires into a malignant force. In attempting to cheat death and secure his legacy, he doomed himself and all bound to him.&quot;

Options:

    [[Ask If There Is Knowledge Here That Could Help Undo the Curse-&gt;inquireCurseBreak]]
    [[Inquire About the Risks of Facing Such Dark Magic-&gt;AskAboutRisks]]</tw-passagedata><tw-passagedata pid="177" name="Instruct Ciar, the stealthiest of you, to scout the fort while the rest of you stay behind" tags="" position="3150,4500" size="100,100">(display: &quot;header&quot;)</tw-passagedata><tw-passagedata pid="178" name="Instruct Lothar to chop down the tree" tags="" position="725,4325" size="100,100">(display: &quot;header&quot;)(set:$energy to it - 10)(set:$effort to 5)(display:&quot;Effort&quot;)
(set: $grendelComes to true)

The tree obviously has magical properties. Its wood and fruit might be of value. 
{(set: _rep to &quot;Unferth&quot; of $reputation)}
(if: _rep is &quot;in confidence&quot;)[Perhaps you could present them to Unferth at court.]

You turn to Lothar, your voice steady and commanding. &quot;Lothar, chop down the tree. We need to take it back with us, along with those strange fruits. This might hold the key to understanding the Sceadugenga&#39;s magic.&quot;

Lothar raises an eyebrow but nods, gripping his axe. &quot;If you think it&#39;s worth the risk, I&#39;ll do it.&quot; The air grows tense as he approaches the tree, his movements careful and deliberate. The silvery bark gleams in the dim light, its texture almost metallic as Lothar&#39;s axe makes contact. The blade bites into the wood with loud crack in the tense silence of the grove. The tree shudders under the impact, its branches swaying violently. The coppery leaves rustle loudly, their metallic sheen catching the light in a dazzling display.

As Lothar chops away, you notice a strange, dark sap oozing from the wounds in the tree. It has a thick, viscous consistency, and its scent is both sweet and pungent, like a mixture of honey and decay. The sight of it sends a shiver down your spine, and you can&#39;t shake the feeling that the tree is reacting to the intrusion.

Ciar steps closer, her eyes wide with concern. &quot;Be careful, Lothar. This tree is alive in more ways than one. The sap could be dangerous.&quot;

Lothar nods, his expression grim as he continues his task. The tree finally begins to fall, its slender trunk cracking under the weight of its branches. You step back as it crashes to the ground, fruits tumbling down around it.

As the fruits fall from the branches, you notice Ciar reach down to pick up one of the strange, dark fruits. She gasps in surprise and horror, her eyes widening as she holds it up for everyone to see. &quot;These... these are face fruits,&quot; she murmurs.

You step closer, examining the fruit in her hand. The fruit is dark and glossy, with a smooth, leathery surface. As you look closer, you realize with a start that it has a faint, almost human-like face. The features are eerily detailed and lifelike, yet closed and unmoving, as if the fruit is in some kind of dormant state, waiting to be awakened.

You reach down to pick up one of the fruits, feeling its smooth surface under your fingers. The dark sap clings to your skin, its scent overpowering. The fruit is surprisingly heavy, and you can&#39;t shake the feeling that it holds a great deal of power within it.

Edda and Hroald stand guard, their eyes scanning the forest for any signs of movement. The atmosphere is thick with tension, the forest seeming to hold its breath in anticipation.

Ciar kneels beside one of the fallen fruits, her face a mixture of awe and apprehension. &quot;I&#39;ve heard tales of these in old legends,&quot; she says, her voice barely above a whisper. &quot;They are said to be linked to powerful magic, capable of great good or great harm.&quot;

Lothar, wiping the sweat from his brow, examines the tree&#39;s remains. &quot;What do we do now? Do we take these back with us?&quot;

{

(for: each _item, ...$treeLarder)[

(set: _descriptionLabel to &quot;Description of &quot; + _item&#39;s &quot;name&quot;)
	(set:_label to &quot;take &quot; + &quot;name&quot; of _item)
	(set: _descriptionLabel to &quot;description of &quot; + _item&#39;s &quot;name&quot;)
---
Name: (print: &quot;name&quot; of _item) | [_label]&lt;br&gt;
(click:_label)[
	(set: $misc to it + (a: _item))
    	(set: $treeLarder to it - (a: _item))
   (replace: _label)[ (print: &quot;name&quot; of _item) &quot;added to inventory&quot; ]
]
[_descriptionLabel]&lt;br&gt;
(click: _descriptionLabel )[(print: &quot;description&quot; of _item)]
]
}

[[Head back to town-&gt;Head back to town from the tree]]</tw-passagedata><tw-passagedata pid="179" name="Instruct the party to follow you up to the fort" tags="" position="3025,4500" size="100,100">(display: &quot;header&quot;)
as you approach its very suspiciously queit, no wildlife or anything on the hill, there are signs of passage, the trails are well worn and neat, but no clear signs of inhabitants

as you near the entrance up top, Ciar says she spots movement, a figure, so you think there are watchers.

if yo uapproach and go inside it&#39;s all quiet and then you get ambushed ina. particularly crappy spot to get ambushed, and all prob killed...

[[Draugr encounter]]</tw-passagedata><tw-passagedata pid="180" name="Introduce yourself as a humble skald" tags="" position="4650,1475" size="100,100">(display:&quot;header&quot;)
Aeschere smiles, a gesture that doesn&#39;t quite reach his eyes. &quot;A purveyor of tales and songs, weaving the threads of history into tapestries of sound. Yes, your kind holds a certain... utility. The forces at work here are beyond the ken of men. Darkness seeps into the hearts of the unwary. But perhaps, with the right guidance, even a wandering minstrel can serve the greater good.&quot;
[[Continue-&gt;Aeschere Convo Hub]]</tw-passagedata><tw-passagedata pid="181" name="Introduce yourself to the priest" tags="" position="1825,2850" size="100,100">(display:&quot;header&quot;)
(set:$reputation&#39;s &quot;Aelfric&quot; to &quot;friendly&quot;)
The priest notices you, sets down his candle carefully, and approaches with a kind, yet wary smile. &quot;Good afternoon, traveler,&quot; he says, his voice warm but edged with a hint of anxiety. &quot;What brings you to our humble church?&quot;

You explain your journey and your need for a place to rest.

Father Aelfric, as he introduces himself, nods understandingly, though his eyes flicker with a hint of suspicion. &quot;You are welcome to stay here,&quot; he says. &quot;Our church offers sanctuary to those in need. As you must understand, these are dangerous times. The spawn of Cain, Grendel, roams these lands, bringing fear and death. We must remain vigilant.&quot;

&quot;We have simple meals and fresh water,&quot; Father Aelfric continues, his voice now. &quot;If you require anything else, do not hesitate to ask.&quot;

[[Continue-&gt;Church Hub]]</tw-passagedata><tw-passagedata pid="182" name="Inventory" tags="" position="75,750" size="100,100">{
### Inventory

&#39;&#39;Silver:&#39;&#39; $sp penningar&lt;br&gt;
&#39;&#39;Weapons and Armor&#39;&#39;
&lt;ul&gt;
(if: $weaponsAndArmor&#39;s length is 0)[
 &lt;li&gt;nothing.&lt;/li&gt;
](else:)[(for: each _item, ...$weaponsAndArmor)[
&lt;li&gt;(print:_item&#39;s &quot;name&quot;) |  Combat bonus: (print: &quot;combat&quot; of _item) | Armor bonus: (print:&quot;armor&quot; of _item) | (link: &quot;description&quot;)[ | (print: _item&#39;s &quot;description&quot;) ]&lt;/li&gt;
]]
&lt;/ul&gt;
&lt;br&gt;
&#39;&#39;Survival Gear&#39;&#39;
&lt;ul&gt;
(if: $survivalGear&#39;s length is 0)[
 &lt;li&gt;nothing.&lt;/li&gt;
](else:)[(for: each _item, ...$survivalGear)[
&lt;li&gt;(print: &quot;name&quot; of _item) | (link: &quot;description&quot;)[(print: _item&#39;s &quot;description&quot;) ]&lt;/li&gt;
]]
&lt;/ul&gt;
&lt;br&gt;

&#39;&#39;Food&#39;&#39;
&lt;ul&gt;
(if: $food&#39;s length is 0)[
 &lt;li&gt;nothing.&lt;/li&gt;
](else:)[ (for: each _item, ...$food)[
(set: _eatLabel to &quot;consume &quot; + _item&#39;s &quot;name&quot;) 
(set: _foodEnergy to 10)
(if: _item contains &quot;energy&quot;)[(set: _foodEnergy to &quot;energy&quot; of _item)]
&lt;li&gt;(print: &quot;name&quot; of _item) |  Energy: (print: _foodEnergy) | (link: &quot;description&quot;)[(print: _item&#39;s &quot;description&quot;) ] | (link:&quot;eat&quot;)[
(set: $foodToEat to _item)
(display: &quot;eat something&quot;)
(replace: ?energy)[ [Current Energy: (print: $energy)]&lt;energy|]

]
&lt;/li&gt;
]]
&lt;/ul&gt;
&lt;br&gt;
&#39;&#39;Craft and Letters&#39;&#39;
&lt;ul&gt;
(if: $craftAndLetters&#39;s length is 0)[
 &lt;li&gt;nothing.&lt;/li&gt;
](else:)[ (for: each _item, ...$craftAndLetters)[
&lt;li&gt;(print: &quot;name&quot; of _item) | (link: &quot;description&quot;)[(print: _item&#39;s &quot;description&quot;) ]&lt;/li&gt;
]]
&lt;/ul&gt;
&lt;br&gt;
&#39;&#39;Clothing and Accessories&#39;&#39;
&lt;ul&gt;
(if: $clothingAndAccessories&#39;s length is 0)[
 &lt;li&gt;nothing.&lt;/li&gt;
](else:)[ (for: each _item, ...$clothingAndAccessories)[
&lt;li&gt;(print: &quot;name&quot; of _item) | (link: &quot;description&quot;)[(print: _item&#39;s &quot;description&quot;) ]&lt;/li&gt;
]]
&lt;/ul&gt;
&#39;&#39;Horses&#39;&#39;
&lt;ul&gt;
(if: $horses&#39;s length is 0)[
 &lt;li&gt;none.&lt;/li&gt;
](else:)[ (for: each _item, ...$horses)[
&lt;li&gt;(print: &quot;name&quot; of _item) | Temperament: (print: &quot;temperament&quot; of _item) | (link: &quot;description&quot;)[(print: _item&#39;s &quot;description&quot;) ]&lt;/li&gt;
 ]]
 &lt;/ul&gt;
&lt;br&gt;
&#39;&#39;Miscellaneous&#39;&#39;
&lt;ul&gt;
(if: $misc&#39;s length is 0)[
 &lt;li&gt;nothing.&lt;/li&gt;
](else:)[ (for: each _item, ...$misc)[
&lt;li&gt;(print: &quot;name&quot; of _item) | (link: &quot;description&quot;)[(print: _item&#39;s &quot;description&quot;) ]&lt;/li&gt;
 ]]
 &lt;/ul&gt;
 }</tw-passagedata><tw-passagedata pid="183" name="Investigate Tree" tags="" position="975,4025" size="100,200">(display:&quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
Curiosity draws you toward the ancient tree standing at the center of the clearing. Its silvery bark gleams faintly in the dim light, giving it an otherworldly aura. The tree is tall, but slender rather than massive. Its branches soar skyward with a graceful ease, like shapely, reaching arms, adorned with leaves like polished copper. The leaves rustle softly in the breeze, with a high, tinkling sound like a running stream. The air around the tree feels dense and charged, as if the very essence of magic and history is concentrated here.

Looking up, you notice strange, dark fruits hanging from the branches. They resemble figs, but they are much larger, each about the size of a human head. 

Ciar watches you closely, her raven perched on her shoulder, its eyes gleaming with an eerie intelligence. &quot;Be careful,&quot; she warns. &quot;This place is imbued with old magic. We don&#39;t know what forces we might be dealing with.&quot;

Hroald stands guard, his axe at the ready, while Edda and Lothar keep a vigilant watch on the perimeter. The forest feels alive around you, every rustle of leaves and snap of a twig heightening your senses. The canopy above casts long shadows, creating a dappled pattern of light and darkness on the forest floor.

As you inspect the tree more closely, you notice strange markings carved into the bark. They are unlike any runes or symbols you have seen before, their intricate patterns seeming to shift and change as you study them. The air is thick with a faint, sweet scent, like wildflowers mixed with the earthy aroma of moss and damp wood.

You feel a connection to the tree, as if it is trying to communicate with you. Closing your eyes, you focus on the sensations around you—the cool breeze, the distant call of a bird, the steady heartbeat of the forest. A sense of calm washes over you, and for a moment, you feel as though you are part of something much larger, a tapestry of nature and magic woven together through time.

Hroald  grunts, his grip on his boy tightening, &quot;What&#39;s the plan, then? Do we stay and investigate further, or head back to report what we&#39;ve found?&quot;

&quot;We know precious little,&quot; Lothar scoffs, &quot;All we&#39;ve seen is a strange tree in the forest...&quot;

The air grows heavier, and you sense an unseen presence watching you from the shadows. The forest seems to hold its breath, waiting for your next move. The ancient tree stands silent and imposing, its secrets locked within its weird silvery bark and coppery leaves.

[[Look for leaves or fruit fallen from the tree]]
[[Attempt to sketch the runes on the bark-&gt;Attempt to sketch the tree runes]]
[[Suggest that you head back to town without disturbing the tree-&gt;Head back to town without disturbing the tree]]
[[Instruct Lothar to chop down the tree so you can collect some branches and fruit-&gt;Instruct Lothar to chop down the tree]]
[[Order the others to search the perimeter-&gt;Search Perimeter]]
[[Consult Ciar about the magic-&gt;Consult Ciar grove]]</tw-passagedata><tw-passagedata pid="184" name="Join the Party" tags="" position="1025,2325" size="100,100">(display: &quot;header&quot;)
{
(display: &quot;updateCombatBonus&quot;)

(if:$totalArmorBonus &gt; 6 and  $totalCombatBonus &gt; 10)[

Hroald&#39;s eyes gleam with approval as he takes in your sturdy gear. &quot;Aye, you look like you can handle yourself. Fine with me if you tag along.&quot;

The other agree after conferring briefly. Lothar grins broadly, raising his mug. &quot;To new companions and future victories!&quot; he declares, his booming voice drawing glances from around the inn.

Edda and Ciar nod in agreement, and soon you find yourself caught up in a night of celebration. The inn fills with laughter and the clinking of mugs as the camaraderie of the group envelops you.

(set: $reputation&#39;s &quot;Adventurers&quot; to &quot;allied&quot;)
[[continue-&gt;Adventurers Hub]]
](else-if: $totalArmorBonus &gt; 1 and  $totalCombatBonus &gt; 1)[
&quot;Well,&quot; says Hroald, eyeing your gear and finding it somewhat lacking &quot;You can tag along, just try not to get to get yourself killed. You might want to find yourself another weapon and some more armor before we find ourselves in battle.&quot;

The other agree after conferring briefly. Lothar grins broadly, raising his mug. &quot;To new companions and future victories!&quot; he declares, his booming voice drawing glances from around the inn.

Edda and Ciar nod in agreement, and soon you find yourself caught up in a night of celebration. The inn fills with laughter and the clinking of mugs as the camaraderie of the group envelops you.
[[continue-&gt;Adventurers Hub]]
](else:)[
Hroald looks you up and down, noting your lack of sufficient armor and weaponry. &quot;You seem eager, but you&#39;ll need better gear if you want to survive out there. Head over to the blacksmith and get yourself some proper armor and at least one sturdy weapon. Once you&#39;re equipped, we might reconsider.&quot;

Edda nods in agreement. &quot;We can&#39;t afford to have anyone unprepared. Get what you need and then seek us out again.&quot;

With a sense of purpose, you thank them and set off for the blacksmith, determined to equip yourself properly for the venture.

[[Continue-&gt;Inn Hub]]
]</tw-passagedata><tw-passagedata pid="185" name="Joke with fishermen" tags="" position="1725,350" size="100,100">(display: &quot;header&quot;)

Bucking up your courage, you launch into a tight, practiced five minute routine of jokes and folksy schtick...

(Untranslatable into modern English)

---
(set: $success to  (random: 1, 10) + $energy/10)
(set: $success to it /2)
(display:&quot;silvertongueBonus&quot;)
(set:$success to (round:it))
Your success: $success / 10!
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]
---
(if: $success &gt; 5 )[
(set: $achievements to it + (a:&quot;Got laughs from the fishermen.&quot;))
(set: $reputation&#39;s &quot;Kattinge fishermen&quot;  to &quot;friendly&quot;)

The tension seems to melt from the air as first one, then another of the fishermen soften to your easy, relatable humor.

](else:)[
(set: $reputation&#39;s &quot;Kattinge fishermen&quot;  to &quot;hostile&quot;)

Your material evidently fails to resonate among the fishermen. Their faces harden in scorn.
]

[[Continue-&gt;Fishermen Convo Hub]]
[[Excuse yourself and continue exploring the village-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="186" name="Journey Into the Forest" tags="" position="2950,2300" size="100,100">(display: &quot;header&quot;)
(if: $energy &gt; 10)[(set: $energy to $energy - 10)]
At dawn, you meet Torsten beneath the sprawling branches of the ancient oak. The morning air is crisp, and a thin mist clings to the ground. Torsten carries a simple satchel and leans on a staff adorned with carvings of intertwining vines and ancient symbols.

Together, you step into the shadowed embrace of the forest. The canopy above filters the sunlight into dappled patterns, and the sounds of the village fade, replaced by the rustle of leaves and the distant call of birds.

As you walk, Torsten speaks softly. &quot;This forest is old—older than any of us. It has witnessed the rise and fall of kingdoms, the turning of countless seasons. The Sceadugenga have been its guardians long before our people settled these lands.&quot;

He pauses to place a small offering—a woven wreath of herbs and flowers—at the base of a gnarled rowan tree, murmuring words in a language you don&#39;t recognize.

&quot;They are not monsters,&quot; he continues. &quot;They are beings of flesh and spirit, just as we are, and they belong in this land just as we do. Our ancestors knew this and lived in harmony with them, respecting their territories and honoring sacred agreements.&quot;

You listen intently. &quot;What happened to change that?&quot;

Torsten sighs. &quot;Hrothgar&#39;s thirst for expansion led to deforestation and the desecration of sacred sites. The balance was broken, and fear took root on both sides.&quot;

Deeper into the forest, the atmosphere shifts. The air grows thick with the scent of moss and damp earth. Strange symbols carved into the bark of ancient trees catch your eye—runes pulsating with a subtle energy.

Torsten stops and turns to you. &quot;From here on, we are in their domain. Remember, respect and humility are our allies.&quot;

[[Continue-&gt;Forest Scea Hub]]
[[Make some excuses and ask to return to the village-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="187" name="KnownLore" tags="" position="50,1175" size="100,100">**Known Lore:**
&lt;ul&gt;(if:$knownLore is (a:))[ no known lore.](for: each _known, ...$knownLore)[ &lt;li&gt;(print: _known)&lt;/li&gt;]
&lt;/ul&gt;</tw-passagedata><tw-passagedata pid="188" name="Landfall" tags="" position="750,100" size="100,100">&lt;center&gt;&lt;h3&gt;GrendelverseRPG Chapter 1: Shadows of Grendel &lt;/h3&gt;&lt;/center&gt;

//Thus begins your legend!//
(set: $name to (prompt: &quot;Enter your character&#39;s name:&quot;, &quot;Rando&quot;))
You are $name, a Skald (bard) of the Scylding people, wandering musician, adventurer and entertainer, teller of tales, shaper of myth and history.

The stories of Grendel have spread throughout the the Scylding lands, a terrifying monster that defies all authority, attacking farmsteads and keeps, tearing grown men from their beds in the dark of night. Even in a domain where dark magic, witches, and ghosts are felt as ever-present threats to civilized folk, the brazen ferocity of the fiend Grendel has gripped the popular imagination. It&#39;s a //fantastic// idea for an epic saga, if you can just find the right angle...

And so, seeking the dark heart of this fearsome legend, you have voyaged by sea from your home to Heorot, the kingdom shadowed by the terror of Grendel. Your wobbly sea legs slowly adjust once more to the steadiness of land as you take in the scenery before you.

[[Explore...-&gt;Village Hub]](display: &quot;initialize&quot;)</tw-passagedata><tw-passagedata pid="189" name="Legend of the Lindworm" tags="" position="3150,2050" size="100,100">(display: &quot;header&quot;)
&quot;Long ago, in the shadowed depths of Göinge Forest, there dwelled a creature unlike any other—a Lindworm, a sea serpent as large as a ship, with scales that shimmered like moonlight on water and eyes that glowed with otherworldly fire.&quot;

&quot;The Lindworm was no ordinary beast. It was said to possess the wisdom of ages, speaking in riddles and prophecies to those brave or foolish enough to seek it. But beware—its temper was as unpredictable as the shifting winds, and most who ventured into its domain were never seen again.&quot;

Ivar pauses for a sip of tea, letting the weight of his words settle. &quot;One day, a young hunter named Leif, driven by courage or perhaps folly, ventured down the coast toward the lair of the Lindworm,  armed with only his wits and a silver-tipped spear.&quot;

&quot;Upon finding the creature, Leif did not raise his weapon. Instead, he spoke a riddle, for Leif was a master of riddles, and had traveled far and wide in his life, seeking the best riddle in every town and village in all the Scylding lands.&quot;

Ivar&#39;s eyes shine as he continues. &quot;The dragon answered each riddle Leif asked, but with each one, the Lindworm became hungrier for more riddles. Hours turned to days, but neither yielded. Finally, just as Leif was about to succomb to starvation, after weeks of riddling the dragon, he told his last riddle, which the dragon answered easily, as it was a simple riddle for children. Utterly defeated, Leif collapsed, expecting to be devoured.

However, the Lindworm was so enamored by his cleverness that he revived Leif, and told him to go forth and gather more riddles. As long as Leif returned each year to riddle with the Lindworm, he would be kept alive by its magic. He would not age, and no blade could slay him as long as he remained faithful to his quest.


[[Ask Ivar another tale-&gt;Ask Ivar about the lore of the land]]
[[Continue-&gt;Elders Hub]]</tw-passagedata><tw-passagedata pid="190" name="Legend of the Whispering Wind" tags="" position="2925,2050" size="100,100">(display: &quot;header&quot;)

Ivar settles back into his seat, the crackling fire casting dancing shadows across his weathered face. &quot;Styrbjörn was a young wanderer, a man of the forests and mountains, who roamed far and wide across the lands we now call home. One evening, as the sun dipped below the horizon and the sky blazed with the colors of twilight, he found himself at the edge of a vast, mist-covered lake.&quot;

&quot;From the mists emerged **Näcken**, the mysterious spirit who plays enchanting melodies upon his fiddle, luring listeners to watery depths. But Styrbjörn was clever. Instead of falling under the spell, he took out his own simple flute and began to play—a tune learned from the birds and the rustling leaves.&quot;

&quot;The two melodies entwined, filling the air with a hauntingly beautiful harmony. Impressed by Styrbjörn&#39;s skill and respect for nature&#39;s music, Näcken paused his enchantment. He spoke in a voice like the echo of distant waves, &#39;You are unlike the others who seek me. Ask of me one boon, and if it is within my power, it shall be yours.&#39;&quot;

Ivar&#39;s voice softens. &quot;Styrbjörn did not ask for riches or eternal life. Instead, he asked for the wisdom to understand the languages of the natural world—the whispers of the wind, the songs of the birds, the stories told by the rivers and stones. Näcken, moved by this humble request, granted it.&quot;

He spreads his hands wide. &quot;Armed with this newfound understanding, Styrbjörn became a great healer and guide. He could predict storms by the sigh of the breeze, find safe passages by listening to the river&#39;s murmur, and heal the sick with remedies whispered to him by the forest itself. People came from distant lands seeking his counsel, and he never turned away a soul in need.&quot;

Ivar concludes, his eyes reflecting the flicker of the flames. &quot;The tale of Styrbjörn teaches us that true power lies not in dominion over others, but in harmony with the world around us. In these times of turmoil, perhaps we, too, can learn to listen—to the land, to each other, and to the quiet truths that lie beneath the surface.&quot;

[[Ask Ivar another tale-&gt;Ask Ivar about the lore of the land]]
[[Continue-&gt;Elders Hub]]</tw-passagedata><tw-passagedata pid="191" name="Lie about what happened against Datrub" tags="" position="3275,3600" size="100,100"></tw-passagedata><tw-passagedata pid="192" name="Listen to the boasting nobleman" tags="" position="3150,1000" size="100,100">(display:&quot;header&quot;)

“You see,” the prince declares, his voice rich with pride, “these lands are teeming with resources just waiting to be developed. The locals are backward pagan sluggards who would rather live in a wilderness than work a farm and pay their proper tithe to the church. In Jutland,&quot; he chuckles, &quot;we have quite the reverse issue; far too many peasants. They become troublesome and forget their place. My father and Hrothgar have forged an agreement to relocate some of our... excess population to the fertile grounds near Heorot. With God&#39;s blessing,&quot; he crosses himself, &quot;we&#39;ll transform this blighted wilderness into thriving Christian settlements.”

The young man carries on in grandiose terms, discussing the many ways his family&#39;s blessing will shine out upon the people of Heorot. &quot;Hrothgar&#39;s hall is mighty,&quot; he declares, &quot;but some of his thanes seem... lacking. Take Unferth, for instance. Does that one even embrace the Christian faith? I heard he clings to pagan ways, skulking in shadows and whispering to spirits. A true warrior wields a sword, not witchraft.&quot;

Murmurs and scandalized titters ripple through the crowd.
The nobleman turns, mock apologetic, to his friend, a confident smirk on his face. &quot;I speak only truth. My people, the Salian Franks, excel in battle //and //in righteousness. Hrothgar deserves thanes who embody both virtues. I dare say it would be small challenge for me to best Unferth myself and prove a worthier addition to his court. Perhaps I shall do so.&quot;

Suddenly, with a collective gasp, the crowd parts for Unferth.
&quot;Bold words,&quot; he says in a soft voice that carries through the suddenly silent hall. &quot;Some might consider them a mortal insult.&quot;

The Salian prince squares his shoulders, not backing down. &quot;Hrothgar&#39;s hall needs warriors who are both skilled in combat and righteous. Perhaps it&#39;s time for new blood.&quot;

&quot;I believe you said that you think you could defeat me in combat?&quot; Unferth tilts his head quizzically.

&quot;Without a doubt I //could//,&quot; the nobleman boasts. &quot;And when I //do//, it will be clear who truly deserves a place at Hrothgar&#39;s side.&quot;

A faint smile touches Unferth&#39;s lips. &quot;Is that a formal challenge then? I won&#39;t deny you. I am Hrothgar&#39;s trusted thane,&quot; he bows toward the throne, &quot;and must prove my worth.&quot;

He pauses, turning back to the young prince, and then adds, &quot;Should you succeed, you must take my place. My sword, Hrunting, also will be yours.&quot;

A collective gasp rises from the onlookers, followed by a rush of puzzled whispers as Unferth unbelts the legendary sword and hands it, with a courteous little bow, to a stunned-looking serving woman.

&quot;I&#39;ll not have it dirtied it with such sordid business,&quot; he concludes, turning back to the prince with an impatient look, &quot;Well then?&quot; 

&quot;Will you fight me with only your dirk then?&quot; cries the prince, face now flushed with outrage at Unferth&#39;s implied insult. The crowd draws back to all sides as he tears his sword from its sheath, brandishing it savagely.

King Hrothgar watches from his high seat, a subtle gleam of amusement in his eyes but offering no intervention. The Frankish prince, spurred by pride and the prospect of claiming such a prize, accepts eagerly. &quot;So be it,&quot; he declares. &quot;Let all witness as I prove my worth.&quot; He pauses as an attendant comes forward to strap a shield to his left arm, heavy and adorned with gold trimming and the black eagle of Frankish royalty.

Unferth draws a long, straight, sturdy looking dagger with his right hand, twirls it artfully and squares off like a fencer. The taller Frank, armed with long sword and shield, storms forward, armor clanging. His attacks are swift and powerful, but Unferth sidesteps with minimal effort, his footwork precise and economical. Attack after attack, the young prince presses on, his frustration mounting as each strike meets only air or the faint check of Unferth&#39;s parry.

Unferth&#39;s demeanor remains almost languid, his eyes never leaving his opponent. The Frank suddenly lunges forward with a particularly wild overhand strike, and, quick as a viper, Unferth&#39;s left hand darts to his belt and sends a small throwing knife whistling through the air to finds its mark in the young prince&#39;s throat.

Silence engulfs the hall as the man staggers back, dropping his weapon. His hands grasping futilely at his neck, his mouth and eyes round with surprise as blood wells between his fingers and pours down the front of his armor. Within moments, he collapses to the floor.

Gasps and murmurs ripple through the crowd. Women avert their gazes, some stifling cries, while the men exchange uneasy glances.
(set: $achievements to it + (a:&quot;Watched Unferth slay the competition.&quot;))
[[continue-&gt;Unferth duel aftermath]]</tw-passagedata><tw-passagedata pid="193" name="Look for a Place to Rest" tags="" position="4900,4400" size="100,100">(display: &quot;header&quot;)</tw-passagedata><tw-passagedata pid="194" name="Look for a Safer Route Down" tags="" position="5200,4000" size="100,100">(display: &quot;header&quot;)</tw-passagedata><tw-passagedata pid="195" name="Look for leaves or fruit fallen from the tree" tags="" position="875,4375" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
Strangely, as you look around, you can find not a single leaf or piece of fruit fallen from the tree.

[[Instruct Lothar to chop down the tree so you can collect some branches and fruit-&gt;Instruct Lothar to chop down the tree]]

[[Continue-&gt;Investigate Tree]]</tw-passagedata><tw-passagedata pid="196" name="Magic Tree Hub" tags="" position="950,3500" size="200,100">(display:&quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
As you push through a particularly dense thicket, the forest opens up into a small clearing. In the center of the clearing is an large, ancient tree, its gnarled branches stretching out like twisted fingers. The air around the tree feels charged with unseen energy.

Ciar&#39;s raven caws loudly, circling above the clearing. She steps forward, her eyes wide with wonder. &quot;This place is sacred. I can feel it. The old magic is strong here.&quot;

Hroald nods, his gaze fixed on the tree. &quot;This could be a place of significance to the Sceadugenga. We need to tread carefully.&quot;

Edda raises her shield, her eyes scanning the perimeter of the clearing. &quot;Stay alert. We don&#39;t know what might be watching us.&quot;

The forest is silent, the only sound the gentle rustling of leaves in the wind.
{
(set:_lore to &quot;The Sceadugenga tend a magic tree in the forest (location known).&quot;)
(if:$knownLore contains _lore)[](else:)[
	(set:$knownLore to it +(a:_lore))
]
}

[[Investigate the tree-&gt;Investigate Tree]]
[[Search the perimeter-&gt;Search Perimeter]]
[[Consult Ciar about the magic-&gt;Consult Ciar grove]]</tw-passagedata><tw-passagedata pid="197" name="Make for Heorot Hall" tags="" position="3375,225" size="100,100">(display: &quot;header&quot;)(set:$energy to it - 9)(set:$effort to 9)(display:&quot;Effort&quot;)
{
(if:$reputation&#39;s &quot;Unferth&quot; is &quot;trusted&quot;)[(set: $notFirstTimeMeetingUnferth to true)]
}
The walk up to Heorot from the village offers breathtaking views of the sea and land.

As you approach the grand doors of Heorot Hall, you&#39;re met by the watchful eyes of the king&#39;s guards. Clad in chainmail and bearing the king&#39;s crest, they stand as silent sentinels, their gazes assessing every entrant for potential threats. The seriousness on their faces speaks of the gravity of their duty, especially in these troubled times.

The vibrant sounds of life within echo faintly through the massive doors, which are carved with warding runes and intricate figures of warriors figures battling against sea serpents.

(if:$misc contains $fenPigHead )[
The guards goggle in surprise as your party approaches, Edda and Lothar holding the great beast&#39;s bloody head on a sling between them,  and quickly open the doors for you.

](else-if: $reputation&#39;s &quot;Heorot Court&quot; is &quot;unknown&quot;)[
One of the guards steps forward, his hand resting on the hilt of his sword. &quot;State your business in Heorot,&quot; he demands.

You introduce yourself and produce your letter of patronage from the Jarl of Skjolden, which the guard scans without comprehension for a full minute before nodding seriously and allowing you entry.

](else-if: $reputation&#39;s &quot;Heorot Court&quot; is &quot;low&quot;)[
The guards snicker as if amused by the memory of your last visit to court. But they allow you entry without question, apparently considering not considering you a threat.
](else-if: $reputation&#39;s &quot;Heorot Court&quot; is &quot;mid&quot;)[
The guards nod in recognition and allow you entry.
](else-if: $reputation&#39;s &quot;Heorot Court&quot; is &quot;high&quot;)[
]
[[Enter the hall-&gt;Heorot Hub]]
[[Return to the village-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="198" name="Make for the standing stones" tags="" position="2200,3600" size="100,100">(display: &quot;header&quot;)(set:$effort to 10)(display:&quot;Effort&quot;)
You make your way over toward the standing stones, carefully following a ridge of dry land that juts through the otherwise impassable bubbling murk.

As you approach, you begin to hear faint whispering sounds. At first you dismiss them as just the wind (although there is little wind), but they become more definite and clear. Though it is strange, as you approach the ring of stones you can distinguish a number of voices. You see neither creature nor spirit.

Hroald chuckles nervously, &quot;Wouldn&#39;t want to be out here on your own, would you? You&#39;d think you were going mad.&quot;

&quot;You&#39;ve got to be mad to be out here in the first place,&quot; scoffs Edda.

[[Continue-&gt;Fen standing stones]]
[[Back-&gt;Fen]]</tw-passagedata><tw-passagedata pid="199" name="Market Hub" tags="" position="2000,775" size="200,200">(display: &quot;header&quot;)(set:$effort to 3)(display:&quot;Effort&quot;)

 The market is a lively place, filled with the clamor of vendors hawking their wares and villagers bartering for goods. The air is thick with the scents of fresh produce, baked bread, and salted fish. Amidst the bustle, whispers and furtive glances hint at the undercurrent of fear and speculation.

A number of merchants are selling bread, salted fish, meat pies, and ale, as well as vegetables and dry goods.

The rhythmic clanking of a smith&#39;s hammer cuts through the din. The blacksmith, central to the village&#39;s defense, could have valuable information about the attacks. His forge might also be a gathering place for warriors discussing strategies against Grendel. Perhaps you should be better armed, as well. 

At the edge of the market, an herbalist’s stall is adorned with bundles of dried herbs and vials of tinctures. The herbalist, a woman with long silver hair and a kindly face, offers remedies and potions for various ailments. The sharp, fresh scents of herbs create a calming aura around her stall.

[[Browse the food vendors-&gt;Buy some food]]
[[Approach the blacksmith&#39;s forge-&gt;Blacksmith]]
[[Browse the general goods]]
[[Browse the clothing for sale]]
[[Approach the herbalist-&gt;Eir Hub]]
[[Return to the village crossroads-&gt;Village Hub]]
[[Make for Heorot Hall]]</tw-passagedata><tw-passagedata pid="200" name="Marta Hub" tags="" position="2550,3225" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)(set:$ThrythInvestigation to it+20)

Marta, a woman in her thirties with weary eyes and disheveled hair, sits outside on a rough bench, her arms wrapped tightly around herself. Two children cling to her skirts, their faces pale.

She looks up, her eyes rimmed with red. &quot;My children&quot; she whispers bitterly, &quot;what will become of us now? Sir Thryth has told me nothing. Will he turn us out into the wilds? Put us to work in the fields, or to some other use?&quot;

[[Offer to help Marta]]
[[Ask directly about the night of the attack-&gt;Inquire Marta Attack]]
[[Ask about anything unusual in the days before the attack-&gt;Ask Marta foreshadow]]
[[Ask Marta about the tree]]
[[Ask to examine shed-&gt;Inquire Marta Shed]]
[[Thryth Hub]]</tw-passagedata><tw-passagedata pid="201" name="Mention a Personal Quest" tags="" position="4050,1075" size="100,100">(display: &quot;header&quot;)
&quot;I am on a personal quest for knowledge and understanding of the old ways, seeking wisdom that might aid me in my own endeavors,&quot; you reply, hoping to connect with Unferth’s evident wisdom.

Unferth’s eyes narrow slightly, as if assessing the depth of your words. “The old ways hold much wisdom, but also many dangers. Knowledge is a double-edged sword, as valuable as it is perilous.”

He nods thoughtfully. “Your quest aligns with the deeper currents that flow through Heorot. There are those who remember the old ways and their power, but one must be prudent and adjust to the times. Be cautious whom you trust, but do not shy away from seeking the truths you desire.”

[[Continue talking to Unferth-&gt;Unferth Convo Hub]]
[[Excuse yourself-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="202" name="Observe roused fen creatures" tags="" position="1950,4150" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
The water begins to bubble as more creatures surface—some resembling massive serpents with glistening scales, others like grotesque hybrids of fish and reptile, their jaws lined with razor-sharp teeth. They surge toward the disturbance, eyes reflecting a primal fury.

[[Suggest Retreat]]</tw-passagedata><tw-passagedata pid="203" name="Observe the King and Queen" tags="" position="4725,400" size="100,100">(display: &quot;header&quot;)

At the head of the hall, seated on a raised dais, is King Hrothgar. His presence dominates the room, a figure of authority and power. Hrothgar is dressed in a richly adorned tunic of dark wool, embroidered with intricate patterns of gold and silver thread. A heavy fur cloak drapes over his broad shoulders, signifying his status and providing warmth against the chill that creeps into the hall. Rings of gold and gemstones adorn his fingers, and a heavy, ornate brooch fastens his cloak at the shoulder. A large, ornate cross hangs from his neck.

In front of Hrothgar, the table is laden with the finest fare the kingdom has to offer. Platters of roasted boar and venison, bowls of stewed vegetables, and loaves of fresh bread are within his reach. Goblets of polished silver, filled with ale and mead, glisten in the firelight. The king eats heartily, yet his eyes constantly scan the hall, ever watchful and alert.

Seated beside Hrothgar is Queen Wealhtheow, pale and severe. The queen is dressed in a long, flowing gown of rich wool, dyed a deep, regal blue and embroidered with silver thread. The intricate patterns depict scenes of nature and mythology, showcasing the craftsmanship of the kingdom&#39;s finest weavers. Over her gown, she wears a finely woven mantle, fastened with a brooch of silver and adorned with semi-precious stones.

Her neck is adorned with a simple yet elegant necklace of silver and amber, and her wrists bear bracelets of finely worked metal. Her hair, a striking auburn, is braided and coiled into a sophisticated style, held in place with silver pins and ribbons. Her posture is regal, and she carries herself with serene confidence. Her piercing green eyes observe the hall with a keen intelligence, always aware of the dynamics and undercurrents among the people.
(set:$effort to 3)(display:&quot;Effort&quot;)
[[Offer your services to the king and queen-&gt;Throne Intro]]
[[Back-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="204" name="Observe the feast" tags="" position="3450,375" size="100,100">(display:&quot;header&quot;)

In the middle of the hall, dozens of richly dressed aristocrats dine in splendor at long tables, draped with fine linen and weighed down with with an assortment of dishes that reflects the prosperity of Hrothgar&#39;s kingdom.

The centerpiece of the great table is a roasted boar, surrounded by smaller platters of venison, rabbit, and fowl. Freshly caught fish, likely salmon and herring, are garnished with sprigs of dill and slices of lemon. Several types of bread, from dark rye loaves to lighter barley and wheat rolls, are placed along side tables with wedges of cheese and pots of butter, bowls of stewed root vegetables, candied fruits, and nuts. Jugs of ale and mead are plentiful. 

Around the periphery of the hall, men-at-arms and lower ranked guests enjoy their own feast of plentiful but rougher fare..

---
Court reputation: (print: $reputation&#39;s &quot;Heorot Court&quot;)
---
{
(if: $reputation&#39;s &quot;Heorot Court&quot; is &quot;high&quot;)[
Obliging servants rush to clear a place for you at a well-apportioned table.&lt;br&gt;

[[Explore the rest of the hall-&gt;Heorot Hub]]
(for: each _item, ...$fancyFoodLarder)[
---
(print: &quot;name&quot; of _item) | (link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] | (link:&quot;take&quot;)[(set: $purchaseItem to _item)(set: $purchaseCategory to $food)    (set: $fancyFoodLarder to it - (a:_item))(display: &quot;Purchase confirmation&quot;)]

]
](else-if: $reputation&#39;s &quot;Heorot Court&quot; is &quot;mid&quot;)[

As you eye the delicacies of the great table, a servant approaches you and makes a polite but pointed throat clearing sound and guides you back towards the more modest tables.

[[Explore the rest of the hall-&gt;Heorot Hub]]

(for: each _item, ...$basicFeastLarder)[
---
(print: &quot;name&quot; of _item) | (link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] | (link:&quot;take&quot;)[(set: $purchaseItem to _item)(set: $purchaseCategory to $food)(set: $basicFeastLarder to it - (a:_item))(display: &quot;Purchase confirmation&quot;)]

]
]
(else:)[
The steward eyes you suspiciously, as if you are a dog that cannot be trusted not to leap onto the table. It is clear that the feast is invitation only.&lt;br&gt;
[[Back away politely-&gt;Heorot Hub]]
]
}</tw-passagedata><tw-passagedata pid="205" name="Observe the fort" tags="" position="3150,4375" size="100,100">(display: &quot;header&quot;)
The ruined fort looms atop the hill like a silent sentinel. The air is thick with anticipation, and the sounds of the night begin to stir—distant hoots of owls, the rustling of unseen creatures in the underbrush.

Once a formidable stronghold, Drekaborg&#39;s stone walls are now partially collapsed, and ivy creeps over the ruins. Crumbled battlements suggest it was designed to repel invaders long ago.

The wind whistles through the cracks in the stone, creating an eerie, mournful tune. Occasional rockfalls send pebbles skittering down the slopes, their clatter amplified in the quiet.

The fort&#39;s silhouette is stark against the backdrop of the mountain, its shadows deepening as daylight fades. The stones are darkened by age, with gaps where masonry has fallen away, revealing the skeletal structure beneath.

The hill is covered with dense vegetation—gnarled trees and thick bushes that could conceal dangers. Jagged rocks protrude from the ground, offering vantage points but also potential hazards. Narrow paths suggest the movement of wildlife, and perhaps other creatures.

The air carries the scent of damp earth and faint, acrid whiff of sulfur.

[[Instruct the party to follow you up to the fort]]
[[Instruct Ciar, the stealthiest of you, to scout the fort while the rest of you stay behind]]
[[Remain at a cautious distance-&gt;Drekaborg Quest Hub]]</tw-passagedata><tw-passagedata pid="206" name="Observe the guards" tags="" position="3175,550" size="100,100">(display:&quot;header&quot;)(set:$effort to 0)(display:&quot;Effort&quot;)
The guards of Heorot Hall are a formidable presence, their primary role to protect the king and maintain order. They are stationed at strategic points around the hall, ever vigilant and ready to act at a moment&#39;s notice.

The guards wear chainmail shirts over woolen tunics, with leather belts and sturdy boots. Fur-lined cloaks hang from their shoulders, fastened with plain brooches.

Each guard is armed with a long spear and a round shield adorned with the king&#39;s emblem. Their weapons are well-maintained, the metal polished and sharp.

The guards stand at attention, their eyes scanning the hall for any sign of trouble. They are trained to notice even the slightest disturbance and are prepared to intervene if necessary.

They move with military precision, their training evident in their disciplined demeanor and sober focus. Conversations among them are brief and to the point, focused on the task at hand.

[[Step back-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="207" name="Observe the guests" tags="" position="3200,875" size="100,100">(display: &quot;header&quot;)

Heorot Hall buzzes with life as a mix of high-ranking thanes, warriors, guests, and servants fill the grand space. The most prestigious guests are seated near the king and queen, enjoying the finest foods and drinking from polished silver goblets. They wear clothing of finely woven wool and linen, richly dyed in hues of deep burgundy, indigo, or forest green, and adorned with embroidery and fur trim. Precious metals and jewels sparkle from rings, necklaces, clasps, cuffs, chains, and other accessories.

Longer wooden tables seat men-at-arms and lower-ranking guests sitl, the atmosphere here more boisterous with laughter, rough-housing, and animated conversation. The tables are laden with hearty dishes and an ample supply of ale.

Several large shaggy dogs move through the throng of people, sitting under tables and gnawing on scraps. The sounds of conversation and laughter blend with the clinking of goblets and the crackling of the fire.
(if: $reputation&#39;s &quot;Unferth&quot; is &quot;unknown&quot; or $achievements contains &quot;Watched Unferth slay the competition.&quot;)[](else:)[

As you survey the room, your attention is drawn to a cluster of guests near the center. A tall and fair-haired princeling holds court, resplendent in armor adorned with a golden cross and the black eagle insignia of Frankish royalty. His loud boasts and hearty chuckles have attracted a small audience.

[[Listen to the boasting nobleman]]
]

(if:$reputation&#39;s &quot;Heorot Court&quot; is &quot;high&quot;)[

](else-if:$reputation&#39;s &quot;Heorot Court&quot; is &quot;mid&quot;)[

](else:)[

]

[[Continue-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="208" name="Observe the hall" tags="" position="3675,525" size="100,100">(display: &quot;header&quot;)

The hall is a vast rectangular chamber, supported by massive wooden beams, darkened by age and smoke, that disappear into the cavernous ceiling.

The walls are constructed from thick wooden planks, reinforced with iron bands and adorned with numerous tapestries and banners.

The floor is covered in fresh rushes, but underneath, the flagstones are worn smooth by generations of feet. The main doors are heavy oak, bound with iron and fitted with intricate metalwork that tells of both artistry and strength. Smaller exits are scattered around the hall, subtly designed for quick escapes or strategic retreats.

Raised lofts, screened off with curtains, encircle the perimeter of the hall, accessible by wooden staircases. The hall has several other exits, apparently leading down to cellars and tunnels beneath the hall.

[[Back-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="209" name="Observe the patrons" tags="" position="775,1400" size="100,100">(display: &quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)

The inn&#39;s patrons are a diverse mix. Interspersed with the local fishermen and craftspeople of the village are groups of mercenaries and hunters, out-of-towners whose demeanor and attire mark them as opportunists and adventurers. They sit together in boisterous clusters, sharing stories and jests, their laughter louder and more carefree than the locals&#39;. Many wear armor, and weapons are stacked at the ends of several of the long tables.

The crowd includes not just Danes and other Scyldings from nearby regions, but a variety of people apparently drawn from far and wide by the promise of Hrothgar’s bounties and the lurid tale of Grendel. Gauls with their distinctive braided hair and colorful tunics, Goths with their intricate tattoos and fierce expressions, and even a few Lombards.

(if: &quot;Adventurers&quot; of $reputation is &quot;unknown&quot;)[
One party of four adventurers grabs your attention. Their clothing reveal an unlikely combination of origins, and most unusually, the group appears to include two armed female adventurers. A tall Norseman with a broad smile and a voice that booms above the din holds court at the head of the table, entertaining his companions with a tale tale about his exploits. Their faces show a mixture of admiration, mirth, and skepticism. As their conversation shifts, you hear them speak of bold plan to scour the forest in search of Grendel, intent on destroying the creature’s hiding places and earning the king&#39;s favor.

[[Observe the adventurers-&gt;Adventurers observe]]
]
[[Continue-&gt;Inn Hub]]</tw-passagedata><tw-passagedata pid="210" name="Observe the royal advisors" tags="" position="4600,950" size="100,100">(display: &quot;header&quot;)

The grand hall of Heorot pulses with life, a tapestry of flickering torchlight and murmuring voices. Warriors boast of their exploits, their armor gleaming under the glow of hearth fires. Nobles negotiate alliances over goblets of mead, while servants weave through the crowd with practiced grace.

Among the throng, your eyes are drawn to two contrasting figures whose mere presence seems to command the room.

The first is (if:$reputation&#39;s &quot;Aeschere&quot; is &quot;unknown&quot;)[evidently some sort of Christian priest](else:)[the Christian priest, Brother Aeschere], a slight, fair-hared man of middle age with fine features and a somewhat airy look. He is draped in voluminous crimson robes  embroidered in gold. His icey eyes scan the room with a strange intensity, as if searching for something invisible to most people. A silver mitre rests upon his head, encrusted with jewels that catch the light and cast prismatic glimmers around him.

The priest clutches a heavy tome bound in dark leather, strange symbols etched into its cover. Around his neck hangs an ornate golden crucifix cross dripping with precious stones. As he moves, he gestures dramatically, his long fingers tracing symbols in the air as if warding off unseen evils.

Across the hall you notice (if: $reputation&#39;s &quot;Unferth&quot; is not &quot;unknown&quot;)[Unferth, ]a tall thane with a pale face framed by long black hair, stands cloaked in shadows under an archway. Clad in dark leather armor accented with obsidian and silver, his demeanor is stoic and enigmatic. His jet-black hair falls to his shoulders, framing a face marked by a perpetual sardonic sneer. He observes the room with a keen, analytical gaze, missing nothing, and even as he sips from a silver gauntlet, one hand rests lightly on the hilt of his sword.

As you watch, (if:$reputation&#39;s &quot;Aeschere&quot; is &quot;unknown&quot;)[the priest](else:)[Brother Aeschere] approaches King Hrothgar, who eagerly turns to receive him. The priest opens a tome, revealing pages filled with arcane script and diagrams of celestial bodies, his gestures grandiose and theatrical. The king listens intently, his face tense with restrained awe and apprehension.

After a few moments, the priest retires to an alcove, draped with curtains and appointed with candles and strange instruments.
(if: $reputation&#39;s &quot;Unferth&quot; is &quot;unknown&quot;)[The dark-clad thane&#39;s](else:)[Unferth&#39;s] eyes narrow as he watches the exchange from a distance.

(if: $reputation&#39;s &quot;Aeschere&quot; is &quot;unknown&quot;)[
[[Seek an audience with the priest-&gt;Aeschere Convo Hub]]
](else:)[
[[Seek out Aeschere-&gt;Aeschere Convo Hub]]
]
[[Continue-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="211" name="Observe the servants" tags="" position="3625,1325" size="100,100">(display: &quot;header&quot;)

Heorot Hall bustles with staff, men and women in various roles who moving swiftly and efficiently to keep the feast running smoothly. They carry heavy platters of food and jugs of ale and mead to fro, and refill goblets and plates with practiced ease, their movements quick and precise to avoid the ire of the warriors.

Others clear away the remnants of previous courses, wiping down the tables and sweeping the rush-covered floor. Several firetender carry logs and stoke the flames of the great roaring hearths, soot and sweat marking their faces.

[[Back-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="212" name="Observe the tower" tags="" position="1800,3400" size="100,100">(display: &quot;header&quot;)(set:$effort to 2)(display:&quot;Effort&quot;)
The tower is made from large blocks of black stones, with a raised interior held up by thick round columns that hold their shape despite much of the walls having been torn away by some terrible catastrophe. The floor of the raised level has crumbled, and the middle of the tower is a jumble of submerged rock.

Much of the tower is covered in thick moss, and ropey vines hang down from the top all the way to the water along one side.

(display:&quot;Back-link&quot;)</tw-passagedata><tw-passagedata pid="213" name="Observe the water" tags="" position="1750,3250" size="100,100">(display: &quot;header&quot;)(set:$effort to 2)(display:&quot;Effort&quot;)
The water is dark and murky with algae and covered with wide, round plants. You glimpse a long, slender shape moving in the water, perhaps a large fish or snake, as well as a number of smaller fish. The visibility is low, and you cannot tell how deep the water might be.

Looking around at the water further out in the pool, you see can see other signs of movement beneath the water, slow-moving ripples along the surface of the water, and occaisional bubbles breaking the surface.

The air vibrates with the calls of insects and frogs, and the occasional low call of a waterbird.

(display:&quot;Back-link&quot;)</tw-passagedata><tw-passagedata pid="214" name="Offer gift" tags="" position="1175,400" size="100,100">(display:&quot;header&quot;)
{(set: _foodEnergy to 10)
}
You offer (print: $foodToEat&#39;s &quot;name&quot;).
(if: $foodToEat contains &quot;alcohol&quot;)[
The fishermen gladly accept your offering. As they pass around the (print:&quot;name&quot; of $foodToEat), the tension seems to go out of the air.
(set: $reputation&#39;s &quot;Kattinge fishermen&quot; to &quot;friendly&quot;)
](else:)[
The fishermen seem pretty unimpressed with the (print: $foodToEat&#39;s &quot;name&quot;).
](set: $food to it - (a: $foodToEat))

[[Continue-&gt;Fishermen Convo Hub]]
[[Excuse yourself and continue exploring the village-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="215" name="Offer king advice" tags="" position="5075,575" size="100,100">(display: &quot;header&quot;)
You approach the dais, and Hrothgar’s gaze fixes on you. It&#39;s a look that&#39;s seen countless battles, a stare that&#39;s pierced through the veil of ambition and now rests heavily on the shadow of a dream unfulfilled.

&quot;Your Majesty,&quot; you begin, your voice steady. &quot;I am a bard, drawn here by the tales of your struggle with the Grendel folk. My training

I offer my insights and my service in understanding this threat that undermines your reign.&quot;

He gestures broadly, encompassing the hall and the lands and people beyond. &quot;I seek to unite the Scyldings under Christ, to be a king remembered for bringing salvation and civilization to a wilderness haunted by superstition and monsters. But Grendel, the spawn of Cain, has oozed out of the bowles of hell, called forth by the folly of those who cling to the old pagan ways. This folly is a blemish on my legacy, a challenge to my rule that cannot go unanswered. It must be exterminated&quot;

Hrothgar leans forward, fixing you with a glacial, menacing gaze, his face a landscape of deep lines carved by frustration and rage. &quot;You speak of understanding,&quot; he says, his voice a low growl. &quot;So tell me... what do you &#39;understand&#39; of these abominations?&quot;
(set:$effort to 9)(display:&quot;Effort&quot;)
[[Beg for Hrothgar&#39;s mercy]]
[[Propose a diplomatic approach]]</tw-passagedata><tw-passagedata pid="216" name="Offer them a gift to break the ice" tags="" position="1425,500" size="100,100">(display: &quot;header&quot;)
{
[[Hold out several silver coins-&gt;Offer them silver for information]]
&lt;ul&gt;
(if: $food&#39;s length is 0)[
 &lt;li&gt;nothing.&lt;/li&gt;
](else:)[ (for: each _item, ...$food)[
(set: _eatLabel to &quot;Offer &quot; + _item&#39;s &quot;name&quot;) 
(set: _foodEnergy to 10)
(if: _item contains &quot;energy&quot;)[(set: _foodEnergy to &quot;energy&quot; of _item)]
&lt;li&gt;(print: &quot;name&quot; of _item) | (click: &quot;name&quot; of _item)[(print: _item&#39;s &quot;description&quot;) | ](print: _eatLabel)
(click: _eatLabel)[
(set: $foodToEat to _item)(goto: &quot;Offer gift&quot;)
]&lt;/li&gt;
]]
&lt;/ul&gt;
}</tw-passagedata><tw-passagedata pid="217" name="Offer them silver for information" tags="" position="1250,500" size="100,100">(display:&quot;header&quot;)
The man&#39;s eyes do not lower from yours for a long moment, as the suspicion on face hardens into hostility. He slowly and deliberately traces the mark of the cross in the air in front of him, as if warding off an evil aura you were radiating.

&quot;Hrothgar deals harshly with spies. We&#39;ve nothing to say to outlanders about such matters.&quot; (set: $reputation&#39;s &quot;Kattinge fishermen&quot; to &quot;hostile&quot;)
[[Continue-&gt;Fishermen Convo Hub]]
[[Excuse yourself and continue exploring the village-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="218" name="Offer to help Marta" tags="" position="2700,3525" size="100,100">(display:&quot;header&quot;)
{
(set:$newQuest to &quot;Help Marta and her children&quot;)(display:&quot;getNewQuest&quot;)
}

(if: not $ThrythReleasedMarta)[
She pauses for a long moment... &quot;I... don&#39;t even know if Sir Thryth will allow us to leave. Will you talk to him?&quot;
{
(set:$newQuest to &quot;Secure the release of Marta and her children from Sir Thryth&quot;)(display:&quot;getNewQuest&quot;)
}
](else:)[

&quot;Thank for persuading Sir Thryth to release us,&quot; she begins in a tearful rush, &quot;but where can we go? We have little money. My husband said that Sir Thryth would make us rich some day, give us a little farm of our own. But that&#39;s all gone now, if ever there was truth to it.&quot;



(if:$reputation&#39;s &quot;Aelfric&quot; is &quot;friendly&quot;)[
(link:&quot;Propose to take them to Aelfric&#39;s church in Kattinge Village&quot;)[
She agrees gratefully, blessing you!
[[Depart to take Marta to the Church]]

]]
(if:$reputation&#39;s &quot;Village Elders&quot; is not &quot;unknown&quot;)[
(link:&quot;Propose to take them to the Kattinge Village elders&quot;)[
She agrees gratefully, blessing you!
[[Depart to take Marta to the village elders]]
]]
(if:$reputation&#39;s &quot;Innkeeper&quot; is &quot;valued customer&quot;)[
(link:&quot;Say that you&#39;ll put them up in the inn for the time being&quot;)[
She agrees gratefully, blessing you!
[[Depart to take Marta to the inn]]
]]
]
[[Promise that you will search for a solution and return for them-&gt;Marta Hub]]</tw-passagedata><tw-passagedata pid="219" name="Offer to help with the Grendel problem" tags="" position="1675,2775" size="100,100">(display: &quot;header&quot;)
&quot;Father Aelfric,&quot; you say, meeting his intense gaze, &quot;I want to help in the fight against Grendel. Tell me what I can do.&quot;

Father Aelfric&#39;s eyes light up with a mixture of relief and gratitude. He clasps his hands together, his expression earnest. &quot;Bless you, traveler. Your willingness to aid us is a beacon of hope in these dark times.&quot;

He takes a deep breath, his demeanor becoming more resolute. &quot;Listen to me carefully,&quot; he begins, his voice low and fervent. &quot;I can sense that you have the potential to be a great warrior and a leader in the fight against the darkness that plagues this land. But the fight against Grendel is more than just a struggle of swords and shields. It is a battle for the soul of this land. Hrothgar, our king, is a man of great strength and determination. He stands as a bulwark against the darkness, yet he cannot do it alone.&quot;

Father Aelfric crosses himself and continues, &quot;Grendel is beyond the king&#39;s power. The lord must send us another hero to slay this beast.&quot;

Aelfric leans closer, his eyes boring into yours. &quot;You must go to King Hrothgar. Pledge yourself to him, offer your skills and your bravery in service of his cause. The king&#39;s hall, Heorot, is where the fight for this land will be decided. It is a place of light amidst the encroaching shadows. There, you will find others who share your resolve, and together, you can make a stand against the terror that grips us.&quot;

The priest&#39;s voice grows more impassioned, almost fervent. &quot;But beware, for there are those who still cling to the old ways, who fear the light and embrace the darkness. And there are those who live among us, but serve the enemy. They may look like men and women, but if they serve the devil Grendle, then they are accursed. Their whispers can undermine the courage of even the strongest hearts. But stay true to your faith, and the light of Christ will be your strength.&quot;

[[Inquire about Grendel&#39;s weaknesses]]
[[Continue-&gt;Church Hub]]</tw-passagedata><tw-passagedata pid="220" name="Onward for Drekaborg" tags="" position="3900,4950" size="100,100">(display:&quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
The rhythmic clopping of hooves on packed earth sets a steady pace. The landscape unfolds around you:

    Forests: Towering beech and oak trees line sections of the road, their leaves whispering secrets as the wind rustles through them.
    Farmlands: Fields of barley and rye stretch out, tended by farmers who pause to watch your passage.
    Villages: Small clusters of thatched-roof houses, where children play and elders share stories by the hearth.

The journey is not without its challenges. The road is long, and the weight of your mission hangs over the group. Yet, there is also camaraderie:

    Conversations: Ciar shares tales of her homeland, and Hroald points out landmarks steeped in local lore.
    Moments of Levity: Lothar hums a warrior&#39;s song, his deep voice resonating over the plains.

---

some decision or random encounter or something?

---
As the sun begins to set on the second day, the terrain grows more rugged. Rolling hills give way to rocky outcrops, and a sense of ancient mystery permeates the air.

[[Continue toward Drekaborg]]</tw-passagedata><tw-passagedata pid="221" name="Open the chest and give the artifact to the serpent" tags="" position="4700,2400" size="100,100">(display: &quot;header&quot;)
so dramatic! they love it</tw-passagedata><tw-passagedata pid="222" name="Aeschere Convo Hub" tags="" position="4550,1250" size="200,100">(display:&quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)(if:$reputation&#39;s &quot;Aeschere&quot; is &quot;unknown&quot;)[(set: $reputation&#39;s &quot;Aeschere&quot; to &quot;friendly&quot;)]
The rich perfume of frankincense and myrrh envelop you as you approach.
(if:$reputation&#39;s &quot;Aeschere&quot; is &quot;uknown&quot;)[The priest](else:)[Aeschere] notices your approach and turns to face you, his eyes alight with an intense curiosity. &quot;Ah, a seeker steps forward,&quot; he declares, his voice carrying a melodious yet unsettling cadence. &quot;What brings you to the sanctum of divine insight?&quot;

Glancing around dramatically as if to ensure he is not being overheard, he lowers his voice conspiratorially. &quot;Tell me, have you witnessed any unusual occurrences in your travels? Signs of the Devil&#39;s handiwork? Those who consort with dark forces? Wickedness must be brought to light, and the church rewards those who perform its works faithfully. &quot;

[[Introduce yourself as a humble skald]]
[[Offer your assistance-&gt;Aeschere Quest Hub]]
[[Excuse yourself and circulate the hall-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="223" name="Aeschere Quest Hub" tags="" position="4825,1275" size="100,200">(display:&quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)
Aeschere&#39;s smile widens. &quot;Excellent. Then perhaps you are willing to assist me in matters of grave importance. The very soul of this kingdom hangs in the balance, threatened by darkness both seen and unseen.&quot;

He begins to pace, his robes rustling softly. &quot;There are those who would see King Hrothgar&#39;s reign crumble, who consort with pagan filth and dabble in heretical practices. They hide in plain sight, poisoning the minds of the righteous.&quot;

He stops and fixes you with a penetrating stare. &quot;I require someone of discretion and resourcefulness to aid me. Someone who can move unnoticed and root out these weeds growing in our gardent.&quot;

[[Discuss quest: Root out paganry among the villagers]]
[[Discuss Quest: Shadow over the Queen]]
[[Discuss Quest: Unveil Unferth]]
[[Discuss Quest: The Lost Relic of St. Cuthbert]]
[[Discuss quest: Hunt the Bandit Leader]]
[[ Quest: The Herb of Insight]]
[[Continue-&gt;Aeschere Convo Hub]]</tw-passagedata><tw-passagedata pid="224" name="Out the gates on patrol" tags="" position="1125,2925" size="100,100">(display: &quot;header&quot;)

You pass through the village gates and follow the Old Boundary Road south from Heorot for a couple of miles. The mottled green farms and pastures of the Heorot&#39;s settled hinterlands stretch out to the East in the misty dawn. To the West, the dense forest looms above you, full of shadows, guarded by craggy ridges and peaks, and massive old growth trees from the sun spilling warmly across the valley.

Hroald takes the lead, his axe bouncing on his shoulder and a bow hanging comfortably in his grip. Edda moves with practiced ease, her sharp eyes scanning the surroundings for any sign of danger, her quiver of javelins at the ready. Ciar walks beside you, her own bow in hand. Her raven, Morrigan, circles over head, occaisionally letting out clucking or cawing noises, which Ciar returns in kind. Lothar brings up the rear.

After an hour or so of walking, you come to a crossroads. The boundary road, wide and well-trodden, continues along to the south, dividing civilization from the dark, dense, misty inscrutability of deep and high elevation fens. A narrow path, barely marked by a stack of black, round river stones, leads West, into the forest, dense trees closing in on either side.

As you venture deeper into the forest, the atmosphere changes. The air is cool, damp, and heavy with the scent of decaying leaves. The canopy above blocks out much of the sunlight, casting long shadows on the forest floor. Every snap of a twig and rustle of leaves seems to carry in the stillness.
(set:$energy to it - 9)(set:$effort to 9)(display:&quot;Effort&quot;)
[[Continue-&gt;Patrol Hub]]</tw-passagedata><tw-passagedata pid="225" name="Outskirts" tags="" position="1725,75" size="100,100">(display: &quot;header&quot;)
(set:$effort to 7)(display:&quot;Effort&quot;)
Beyond the village’s edge, the forest looms, dark and foreboding, as the safety of the homes gives way to the wild.

The shadows of the forest stretch long, and the ground is uneven, covered in a mix of fallen leaves and soft moss. The air is cool and carries the faint, unsettling scent of decay. Every rustle and crack in the underbrush sets your nerves on edge.

[[Back to the village -&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="226" name="Party night before patrol" tags="" position="1125,2625" size="100,100">(display: &quot;header&quot;)
You spend some time with the adventurers discussing what you&#39;ve each heard of the forest and its denizens, in fact rather little enough of substance. However, the excited mood is contagious, and you find yourself swept up. The innkeeper, sensing the festive mood, brings out a special cask of mead. &quot;This one&#39;s on the house, for such fine company,&quot; he says, pouring generous mugs of the golden liquid.

Hroald stands, raising his mug high. &quot;To our new comrade and to the battles ahead! May we find victory and glory!&quot; 

The adventurers echo his toast, and you join in, feeling a part of the group. As the night progresses, stories of past exploits are exchanged, each tale more daring and adventurous than the last. The inn&#39;s atmosphere grows even more festive as patrons join in the singing of old battle songs and drinking chants. The fire crackles merrily, casting flickering shadows on the walls, and the smell of roasting meat and fresh bread fills the air, mingling with the earthy scent of ale and mead.

As the hours pass, you find yourself sharing your own tales, earning nods of respect and laughter from your new companions. Eventually, the fire burns low, the inn&#39;s patrons begin to leave the inn or settle down for the evening, and you settle down for a night&#39;s rest.

[[Continue-&gt;Inn wakeup morning of patrol]]</tw-passagedata><tw-passagedata pid="227" name="Past Battles" tags="" position="475,1975" size="100,100">(display: &quot;header&quot;)
Hroald grins, his eyes lighting up with the thrill of recounting past glories. &quot;Well, our paths first crossed in the eastern campaigns of the Byzantine Empire. We were all hired as mercenaries, each of us seeking fortune and fame. The battles there were fierce, fighting against the Sassanid Empire and various barbarian incursions.&quot;

Edda nods, her voice calm and measured. &quot;I remember our first skirmish together. It was a harsh, unforgiving terrain, and we were ambushed by a group of Sassanid warriors. Hroald&#39;s axe was a blur, cutting through their ranks.&quot;

 &quot;And who could forget the battle at Dara?&quot; Begins Lothar, bringing a solem nod from the others. &quot;It was dirty work getting past those defensive lines, but once inside we fought like demons. Remember that arrow that Hroald here almost took in the eye? Edda caught it on her shield like swatting a fly.&quot;

Hroald toasts Edda before drinking deeply. &quot;Aye, we&#39;ve been through much together. And now, we stand ready to face Grendel and whatever else this land has to throw at us.&quot;

[[Continue-&gt;Adventurers Hub]]
[[Ask about their current quest-&gt;Current Quest]]</tw-passagedata><tw-passagedata pid="228" name="Patrol Hub" tags="" position="1250,3225" size="200,200">(display:&quot;header&quot;)(set:$effort to 3)(display:&quot;Effort&quot;)

After a while, your party pauses to confer.
Ciar confers with her raven, Morrigan, in a series of low chucks, rattles, and gurgling sounds. (if:(history:) does not contain (passage:)&#39;s name)[Lothar laughs at your surprise as ]Ciar explains matter-of-factly that the bird has identified several areas of potential interest: An unusual fen dotted with ruins and inhabited by strange creatures, and what looks like a tended grove with a single tree bearing strange fruit .

(if:$health &gt; 90)[](else-if:$health &gt; 50)[](else:)[
Your breath comes in ragged, pained gasps and you walk with difficulty.
Edda eyes you with concern, and finally Hroald says, &quot;Come one, we&#39;ve got to get you back to town and get you patched up.&quot;
]

[[Investigate the grove-&gt;Magic Tree Hub]]
[[Investigate the fen-&gt;Fen]]
[[Head back to town and rest at the Inn-&gt;Inn Hub]]</tw-passagedata><tw-passagedata pid="229" name="Patrol plans" tags="" position="1175,2150" size="100,100">(display: &quot;header&quot;)
(if:$reputation&#39;s &quot;Adventurers&quot; is &quot;friendly&quot;)[
Hroald leans back in his chair, his expression contemplative. The hum of conversation and clinking of tankards fills the inn, but your table holds a more serious tone.

&quot;Truth be told,&quot; he says, &quot;King Hrothgar won&#39;t grant an audience to just anyone these days—not unless you&#39;ve something to show for it.  His mind is consumed by worries over these &#39;Children of Cain.&#39; He&#39;s offering bounties and glory to those who can bring proof of slaying trolls, elves, or any other creatures causing strife.&quot;

Edda nods grimly, her fingers tracing the edge of her short sword. &quot;Many have ventured into the Whispering Forest seeking such trophies. Few return. The woods are treacherous, and not just because of the creatures that dwell there.&quot;

Ciar strokes the feathers of her raven, her gaze distant. &quot;There&#39;s an imbalance in these lands. The creatures act out of desperation, not malice. The encroachment on their territories has stirred ancient forces.&quot;

Lothar takes a hearty swig of ale, wiping his mouth with the back of his hand. &quot;All the more reason to head out and make a name for ourselves! Imagine the songs they&#39;ll sing when we return victorious.&quot;

Hroald chuckles softly. &quot;We were considering setting out at dawn&quot;

[[Ask to join the patrol]]
](else:)[
[[Propose a patrol into the forest in the morning-&gt;Party night before patrol]]
]
{(if: $recruitedParty)[
[[Propose that the group accompanies you to Heorot to speak with Unferth about work-&gt;Make for Heorot Hall]] 
](else-if: $activeQuests contains &quot;Recruit a party&quot;)[
[[Propose that the adventurers join you in working for Unferth]]
]
(if: $activeQuests contains &quot;Investigate Thryth Farmstead&quot;)[
[[Propose that you all set out for Thryth farmstead in the morning, to investigate the recent Grendel attacks-&gt;Set out for Thryth farmstead]]
]
}
[[Back-&gt;Adventurers Hub]]</tw-passagedata><tw-passagedata pid="230" name="Play a tune to make some coin" tags="" position="1150,1625" size="100,100">You approach the bard in the corner and request to play a tune. The bard looks you over and, seeing the lute in your hand, steps aside. You begin to play, the familiar melody flowing from your fingers and filling the room.
---
{(set: $success to  (random: 1, 10) + $energy/10)
(set: $success to it /2)
(display:&quot;silvertongueBonus&quot;)
(set:$success to (round:it))
//Your success: (print:$success)/10//&lt;br&gt;
//(print:$success) silver added to inventory//&lt;br&gt;
(set: $sp to $sp + $success)
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]}
---



Your song, a lively tune about brave warriors and epic battles, gradually draws the attention of the patrons. The noise in the inn decreases as more people turn to listen, their conversations pausing.
{
(if:$success &gt; 7)[The fishermen set aside their mugs and listen intently, their weathered faces softening as they lose themselves in the tale. The mercenaries and hunters, initially boisterous and dismissive, soon find themselves tapping their feet and nodding along. Even the innkeeper pauses in his duties to listen, a rare smile spreading across his grizzled face.

As you finish your song, the room erupts in applause and cheers. Coins clink onto the table in front of you, a generous reward for your performance. The innkeeper approaches, clapping you on the back. &quot;A fine performance, bard! Your music is welcome here anytime.&quot;
(set: $sp to $sp + $success)
(set: $bardReputation to &quot;high&quot;)

]
(else-if: $success &gt; 4)[
(set: $bardReputation to &quot;mid&quot;)

The fishermen nod in time with the music, their expressions softening as they enjoy the distraction. The mercenaries and hunters, though not fully captivated, give you nods of appreciation and the occasional cheer. The innkeeper watches with a keen eye, noting the positive effect your music has on his patrons.

When you finish, a smattering of applause greets you, and a few coins are tossed onto the table. The innkeeper gives you a nod of approval. &quot;Not bad, bard. You livened up the place.&quot;]
(else:)[
(set: $bardReputation to &quot;low&quot;)
The patrons barely notice your attempt, their conversations continuing unabated. The fishermen glance your way but quickly return to their animated discussions. The mercenaries and hunters, more interested in their own stories and boasts, pay you little heed. Even the innkeeper, busy with his duties, seems unimpressed by your performance.

As you finish your song, only a few polite claps greet you, and no coins are forthcoming. The bard steps back up, taking his lute with a sympathetic nod. The innkeeper gives you a curt nod. &quot;Maybe next time, bard.&quot;]
}
[[Continue hanging out in the bar-&gt;Inn Hub]]</tw-passagedata><tw-passagedata pid="231" name="Pledge your help in restoring the old balance" tags="" position="2375,2775" size="100,100">(display: &quot;header&quot;)
The leader inclines their head, and for a moment, you sense a shared understanding—a flicker of hope amidst the shadows.

Torsten smiles faintly. &quot;They believe there may yet be a path to reconciliation. But actions speak louder than words. The journey ahead requires courage and steadfastness.&quot;

As the Sceadugenga fade back into the depths of the woods, the forest seems to breathe around you, a world full secrets and possibilities you had never imagined.
(set:$a to &quot;Close encounter: parlayed with the Sceadugenga and Torsten&quot;)(display:&quot;addAchievement&quot;)
[[Return to the village-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="232" name="Plot log" tags="" position="325,550" size="100,100">---
### Game Progress
---
(display: &quot;Back-link&quot;) | [[Character Sheet]] |  [[Games Dashboard]] | [[How to play-&gt;How to play this game]] 
---
**Active Quests**:
(if:$activeQuests is (a:))[
no active quests.
]&lt;ul&gt;(for: each _quest, ...$activeQuests)[&lt;li&gt;(print: _quest)&lt;/li&gt;]&lt;/ul&gt;
---
**Reputation:**
{

(set: _knowAnyone to false)
(set: _knownParties to (a:))
(for: each _party, ...(dm-names: $reputation))[
	(if: $reputation&#39;s _party is not &quot;unknown&quot;)[
		(set: _knownParties to it + (a: _party))
		(set: _knowAnyone to true)
	]
]
}
(if: _knowAnyone)[
&lt;ul&gt;(for: each _party, ..._knownParties)[&lt;li&gt;(print:_party) : (print: $reputation&#39;s _party)&lt;/li&gt;]&lt;/ul&gt;](else:)[
You are unknown in town.
]
{
(set: _scenes to (history:) - (a: &quot;Character Sheet&quot;, &quot;eat something&quot;))
(set: _lastScene to last of _scenes)
}
---
(display: &quot;Achievements&quot;)
---
(display: &quot;KnownLore&quot;)
**Completed Quests**
(if:$completedQuests is (a:))[
no completed quests.
]&lt;ul&gt;(for: each _quest, ...$completedQuests)[&lt;li&gt;(print: _quest)&lt;/li&gt;]
&lt;/ul&gt;
---
(display: &quot;Back-link&quot;)</tw-passagedata><tw-passagedata pid="233" name="Present the slain monster to Hrothgar" tags="" position="4825,250" size="100,100">(display: &quot;header&quot;)(set:$effort to 13)(display:&quot;Effort&quot;)

The crowd parts as you make your way toward the raised dais upon which Hrothgar and Wealhtheow hold court. (if:$reputation&#39;s &quot;Unferth&quot; is &quot;trusted&quot;)[You spot Unferth and nod to him with a cocky smirk at his look of frank interest.] 

&quot;Great King Hrothgar,&quot;  you begin, (if:$reputation&#39;s &quot;Heorot Court&quot; is &quot;unknown&quot;)[&quot;I am (print:$name) the skald.&quot;][&quot;My party encountered this monster while patroling the fens beyond the old boundary. It attacked without provocation and fought fiercely, surely a danger to man and livestock alike. I know not whether it be a demon out of hell or a beast of some other time or place conjured here by unnatural magic. I present it here to your majesty as a token of my service to your court,&quot; you conclude with a bow.

The court is full of speculative whispers, some impressed, some scandalized. Hrothgar strokes his thick golden beard and nods pensively for a moment before standing.
&quot;My good (print:$name), if you are half as skilled with a lute as with a spear, your name will echo through the ages.&quot;

He claps his great bejeweled hands, and lets loose a great, hearty bellow of laughter that rings through the hall, and suddenly the court erupts with applause and jubliation. After a long moment, Hrothgar raises his cup, and again the hall falls silent. 

&quot;An impressive feat indeed, and a most awesome trophy! You have shown your skills worthy of Heorot, and you and your followers are welcome here, (print:$name). We shall have this monster&#39;s skull mounted so all can marvel at the terror of those monstrous beings forsaken by God.&quot;

He gestures to his personal steward, who comes forward and opens a small chest of fine lacquered wood.
&quot;Now come forward and receive a token of my favor. You may choose one.&quot;
{
(set:$achievements to it + (a:&quot;Gave Hrothgar a pig-monster&#39;s head&quot;))(set:$reputation&#39;s &quot;Heorot Court&quot; to &quot;high&quot;)
(set:$misc to it - (a:$fenPigHead))
(for: each _item, ...$HrothgarPigRewardLarder)[(set:_label to &quot;claim &quot; + &quot;name&quot; of _item)
(set: _descriptionLabel to &quot;Description of &quot; + _item&#39;s &quot;name&quot;)
---
Name: (print: &quot;name&quot; of _item) | (link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] | (link:&quot;Claim&quot;)[
(set: $purchaseItem to _item)
(display: &quot;Purchase confirmation&quot;)]

]

(set:$doneQuest to &quot;Make a name for yourself at Heorot Hall&quot;)(display:&quot;questComplete&quot;)
}

(if: $reputation&#39;s &quot;Unferth&quot; is &quot;unknown&quot;)[
[[Continue-&gt;Unferth sword introduction]]
](else:)[
[[Continue-&gt;Heorot Hub]]
]</tw-passagedata><tw-passagedata pid="234" name="Private Room" tags="" position="200,1950" size="100,100">(display: &quot;header&quot;)

(if: $reputation&#39;s &quot;Innkeeper&quot; is not &quot;valued customer&quot;)[
{	(if: $sp&lt;20)[
    	(set: $reputation&#39;s &quot;Innkeeper&quot; to &quot;Riff-raff&quot;)
You lack sufficient funds	
[[Continue-&gt;Innkeeper]]	
	](else:)[
            {
            (set: _str to &quot;Rented the private room at the inn&quot;)
            (set: $reputation&#39;s &quot;Innkeeper&quot; to &quot;valued customer&quot;)
            (set: $sp to it - 20)
            (set: $misc to it + (a: (dm:
            &quot;name&quot;,&quot;Inn room keys&quot;,
            &quot;description&quot;,&quot;keys to the door and chest in the private room in the inn&quot;
            )))
              }
You hand over the coins, and the innkeeper&#39;s demeanor shifts to one of more pronounced hospitality. He smiles broadly, pocketing the silver. &quot;Ah, a discerning guest! Follow me, please.&quot;

The innkeeper leads you through the bustling tavern and up a narrow wooden staircase. The steps creak underfoot, a testament to their age. As you ascend, the noise from the tavern below fades, replaced by the soft flicker of a torch mounted on the wall, casting warm, dancing shadows.

At the top of the stairs, the innkeeper stops at a door made of sturdy oak, its surface polished to a warm sheen. He unlocks it with a key and swings it open, revealing your room.

&quot;Here we are, finest room in the house,&quot; he says with a hint of pride.
&lt;br&gt;(Room keys added to inventory)
&lt;br&gt;(display:&quot;Find Rest&quot;)
	]}
](else:)[The familiar sight of the room is comforting.]
(if: $reputation&#39;s &quot;Innkeeper&quot; is &quot;valued customer&quot;)[
The room is small but meticulously clean. The walls are paneled with dark, polished wood, and the floor is covered with a woven rush mat, softening your steps. A single straw mattress rests on a wooden frame, covered with a thick woolen blanket. 

A sturdy chest made of oak sits at the foot of the bed. A small window fitted with wooden shutters opens onto  a view of the village below and allows the cool evening breeze to filter in. 

On a wooden stand near the door, a ceramic washbasin filled with fresh water and a neatly folded linen towel await your use. A simple wooden chair and a small table complete the furnishings. On the table is a dish of walnuts and a loaf of fresh bread with butter, and a jug of fresh drinking water.

{
(for: each _item, ...$privateRoomLarder)[
---
(print: &quot;name&quot; of _item) | (link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] | (link:&quot;take&quot;)[
	(set: $purchaseItem to _item)
    (set: $purchaseCategory to $food)
    (set: $privateRoomLarder to it - (a:_item))
    (display: &quot;Purchase confirmation&quot;)
    ]

]
---
}

The scent of beeswax from the polished wood mingles with the faint aroma of lavender from the blanket, creating a soothing atmosphere. You can faintly hear the low hum of conversation and occaisional clink of cups from tavern below.

You stretch out on the mattress, feeling the weight of your travels begin to lift as you close your eyes, ready to face whatever the next day brings.

[[Drift off to sleep-&gt;Wake up in the private room]]
[[Return the public room-&gt;Inn Hub]]
]</tw-passagedata><tw-passagedata pid="235" name="Probe Unferth’s Role" tags="" position="4100,1000" size="100,100">(display: &quot;header&quot;)
Unferth’s smile broadens slightly, and he nods with approval. “Perceptive. My role extends beyond the battlefield and the drinking hall, unlike many of Hrothgar&#39;s thanes. I am responsible for the stability and security of Heorot in all its phases, regarding both external threats and internal discord. Essentially, I have authority over everything that is beneath Hrothgar&#39;s dignity to attend to personally, and everything his Majesty finds distasteful.”

He leans in slightly, “In times such as these, vigilance is paramount. Newcomers such as yourself are both potential allies and risks. I seek to understand your intentions, your loyalties, and your potential contributions to our cause.”

[[Continue talking to Unferth-&gt;Unferth Convo Hub]]
[[Excuse yourself-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="236" name="Propose a diplomatic approach" tags="" position="5175,825" size="100,100">(display: &quot;header&quot;)
With a sense of purpose, you address King Hrothgar. &quot;Your Majesty, perhaps a new strategy is needed in dealing with the Grendel threat. Understanding them might be the key to overcoming them. A direct confrontation has brought loss and suffering. Maybe it&#39;s time to consider a different approach.&quot;

The moment the words leave your lips, you sense a shift in the hall. Hrothgar&#39;s face hardens, his eyes narrowing into slits of barely contained rage. The murmur of the hall falls silent, the air thick with tension.

&quot;A different approach?&quot; Hrothgar&#39;s voice booms through the hall, his anger palpable. &quot;You dare suggest that I, King of the Danes, do not know how to protect my own kingdom? That I should cower and scheme rather than face my enemy with the strength and valor of a true warrior?&quot;

The warriors and thanes around the hall grip their weapons tighter, their loyalty to Hrothgar awakening a protective aggression. The atmosphere is electric, a single spark away from igniting into violence.

&quot;Your &#39;strategic approach&#39; reeks of cowardice,&quot; Hrothgar continues, rising from his throne, towering over you. &quot;I have fought and bled for this land, and I will not be lectured on matters of warfare and honor by a wandering bard!&quot;

Your suggestion, meant to offer a new perspective, has inadvertently struck a nerve in Hrothgar, challenging his deeply held beliefs and pride. The reaction is more severe than anticipated, and now you must navigate this precarious situation with care to avoid further inflaming the king&#39;s wrath.
(set:$effort to 3)(display:&quot;Effort&quot;)
[[Beg his majesty&#39;s pardon-&gt;Beg for Hrothgar&#39;s mercy]]
[[Stand Your Ground]]
[[Appeal to the Queen-&gt;Beg for Hrothgar&#39;s mercy]]</tw-passagedata><tw-passagedata pid="237" name="Propose that the adventurers join you in working for Unferth" tags="" position="1375,2025" size="100,100">(display: &quot;header&quot;)

(if:$totalArmorBonus &gt; 1 and  $totalCombatBonus &gt; 1)[
{(set: $reputation&#39;s &quot;Adventurers&quot; to &quot;allied&quot;)
(set:$recruitedParty to true)}
The four agree after conferring briefly, clearly impressed that you have so quickly gained favor among the inner circle of Heorot&#39;s elite.

Lothar grins broadly, raising his mug. &quot;To new companions and future victories!&quot; he declares, his booming voice drawing glances from around the inn.

Edda and Ciar nod in agreement, and soon you find yourself caught up in a night of celebration. The inn fills with laughter and the clinking of mugs as the camaraderie of the group envelops you.

//&#39;&#39;Note:&#39;&#39; The group will accompany you when you next visit Unferth at Heorot//
](else:)[
Hroald looks you up and down, noting your lack of sufficient armor and weaponry. &quot;You seem eager, but you&#39;ll need better gear if you want to survive out there. Head over to the blacksmith and get yourself some proper armor and at least one sturdy weapon. Once you&#39;re equipped, we might reconsider.&quot;

Edda nods in agreement. &quot;We can&#39;t afford to have anyone unprepared. Get what you need and then seek us out again.&quot;

With a sense of purpose, you thank them and head towards the blacksmith, determined to prove your worth.
]
[[Continue-&gt;Adventurers Hub]]</tw-passagedata><tw-passagedata pid="238" name="Purchase Confirmation" tags="" position="275,725" size="100,100">(display: &quot;header&quot;)
(set: _slink to (history:)&#39;s last)
(set: _price to &quot;price&quot; of $purchaseItem) 
(if: $sp &gt;= _price)[
(print: &quot;name&quot; of $purchaseItem) added to inventory.
[[Continue-&gt;_slink]]
(set: $sp to $sp - _price)
(if: (history:)&#39;s last is &quot;Smith weapons&quot;)[
  (set:$weaponsAndArmor to it + (a: $purchaseItem))
](else:)[
 (if: $purchaseItem contains &quot;energy&quot;)[(set:$food to it + (a: $purchaseItem))]
  (if: $purchaseItem contains &quot;bonus&quot;)[(set:$misc to it + (a: $purchaseItem))]
]
](else:)[
You have insufficient funds!
[[Continue-&gt;_slink]]
]</tw-passagedata><tw-passagedata pid="239" name="Purchase confirmation" tags="" position="425,725" size="100,100">{
(set: _price to &quot;price&quot; of $purchaseItem) 
(if: $sp &gt;= _price)[
//(print: &quot;name&quot; of $purchaseItem) added to inventory.//
(set: $sp to $sp - _price)

(if: $purchaseItem contains &quot;armor&quot; or $purchaseItem contains &quot;combat&quot;)[
  (set:$weaponsAndArmor to it + (a: $purchaseItem))
]
(if: $purchaseItem contains &quot;energy&quot;)[
(set:$food to it + (a: $purchaseItem))
]
 (if: $purchaseItem contains &quot;bonus&quot;)[
 	(set:$misc to it + (a: $purchaseItem))
]
(if: $purchaseItem contains &quot;style&quot;)[
(set:$clothingAndAccessories to it + (a: $purchaseItem))
]
 (if: $purchaseItem contains &quot;temperament&quot;)[
 (set:$horses to it + (a: $purchaseItem))
]

](else:)[
You have insufficient funds!
]

}</tw-passagedata><tw-passagedata pid="240" name="Purchase herbs or other goods" tags="" position="1375,1650" size="100,100">(display: &quot;header&quot;)

Eir&#39;s face brightens as she gestures to her wares. &quot;I have many herbs that might be of use,&quot; she says. &quot;Please tell me ails you, or what manner of healing or enhancement you seek. Remember that the answers often lie within the land itself. Listen every day to the whispers of the trees and the songs of the birds—they carry the wisdom of the ages.&quot;

[[Continue speaking with Eir-&gt;Eir Hub]]
[[Continue exploring the market-&gt;Market Hub]]

{
(set:$protectionCharm to (dm:
    &quot;name&quot;, &quot;Freya&#39;s Guardian Amulet&quot;,
    &quot;price&quot;, 85,
    &quot;description&quot;, &quot;An amulet blessed by Freya, the Norse goddess of love and war, offering enhanced protection against dark magic.&quot;,    &quot;bonus&quot;,&quot;Magical defense +3&quot;
  ))
(set:$seaCharm to (dm:
    &quot;name&quot;, &quot;Njörðr&#39;s Charm&quot;,
    &quot;price&quot;, 95,
    &quot;description&quot;, &quot;An amulet engraved with the symbol of Njord, the Norse god of the sea and seafaring, enhancing your skills in navigation and sea travel.&quot;,    &quot;bonus&quot;,&quot;Seafaring and navigation +3&quot;
  ))
(set: $archeryCharm to (dm:
    &quot;name&quot;, &quot;Ullr&#39;s Archery Amulet&quot;,
    &quot;price&quot;, 35,
    &quot;description&quot;, &quot;A sleek token representing Ullr, the Norse god of archery and hunting, boosting your accuracy and skill with the bow.&quot;,
    &quot;bonus&quot;,&quot;Archery +3&quot;
))
(set:$seersMead to  (dm:
    &quot;name&quot;,&quot;Seiðrmjöð&quot;,
    &quot;description&quot;, &quot;A potion that grants seer-sight and heightened sensitivy to magical energies. Do not combine with alcohol.&quot;,
    &quot;price&quot;, 75,
    &quot;energy&quot;, -25
))
(set:$silvertongueCharm to   (dm:
    &quot;name&quot;, &quot;Bragi&#39;s Silvertongue Charm&quot;,
    &quot;price&quot;, 25,
    &quot;description&quot;, &quot;Blessed by Bragi, the Norse god of poetry and music, enhancing your musical prowess and charisma.&quot;,    &quot;bonus&quot;,&quot;Music and persuasion +3&quot;
))
(set: $potions to (a:

  (dm:
    &quot;name&quot;,&quot;minor restorative&quot;,
    &quot;description&quot;,&quot;A fragrant elixir infused with chamomile and thyme, restores half of your energy.&quot;,
    &quot;price&quot;, 8,
    &quot;energy&quot;, 30
  ),
  (dm:
    &quot;name&quot;,&quot;major restorative&quot;,
    &quot;description&quot;, &quot;A potent blend of wormwood, and sage, and more exotic ingredients, replenishes most of your energy and makes you fee great.&quot;,
    &quot;price&quot;, 15,
    &quot;energy&quot;, 70
  ),
  (dm:
    &quot;name&quot;,&quot;superior restorative&quot;,
    &quot;description&quot;, &quot;A concentrated essence of lavender and rosemary, accelerating the healing process and easing pain. Good for what ails you and then some!&quot;,
    &quot;price&quot;, 25,
    &quot;energy&quot;, 125
  ),
  $seersMead
))

(set: $charms to (a:
  $silvertongueCharm,
  $archeryCharm,
  (dm:
      &quot;name&quot;, &quot;Tyr&#39;s Battle Emblem&quot;,
      &quot;price&quot;, 45,
      &quot;description&quot;, &quot;A sturdy emblem engraved with the symbol of Tyr, the Norse god of war.&quot;,
          &quot;bonus&quot;,&quot;Melee weapon attacks +3&quot;
  ),
  $seaCharm,
  $protectionCharm
))



&lt;br&gt;
[Your current silver: (print: $sp)]&lt;sp|&lt;br&gt;
### Potions:
(for: each _item, ...$potions)[(set:_label to &quot;purchase &quot; + &quot;name&quot; of _item)
(set: _descriptionLabel to &quot;Description of &quot; + _item&#39;s &quot;name&quot;)
---
(print: &quot;name&quot; of _item) |  Price: (print: &quot;price&quot; of _item) silver penningar | (link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] | (link:&quot;purchase&quot;)[
(set: $purchaseItem to _item)
(set: $purchaseCategory to $food)
(display: &quot;Purchase confirmation&quot;)
(replace: ?sp)[ [Your current silver: (print: $sp)]&lt;sp|]
]

]
### Charms:
(for: each _item, ...$charms)[(set:_label to &quot;purchase &quot; + &quot;name&quot; of _item)
(set: _descriptionLabel to &quot;Description of &quot; + _item&#39;s &quot;name&quot;)
---
(print: &quot;name&quot; of _item) |  Price: (print: &quot;price&quot; of _item) silver penningar | (link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] | (link:&quot;purchase&quot;)[
(set: $purchaseItem to _item)
(set: $purchaseCategory to $misc)
(display: &quot;Purchase confirmation&quot;)
(replace: ?sp)[ [Your current silver: (print: $sp)]&lt;sp|]
]

]
}</tw-passagedata><tw-passagedata pid="241" name="QuestionDangers" tags="" position="3900,5925" size="100,100">(display: &quot;header&quot;)
&quot;What dangers should we be aware of in these ruins?&quot; you inquire. &quot;We wish to avoid unnecessary conflict.&quot;

Véfrøðr&#39;s expression darkens. &quot;The Draugr patrol these grounds—undead guardians bound to protect the treasure for eternity. They are relentless and merciless, attacking any who trespass.&quot;

It pauses, then adds, &quot;I, too, am compelled to defend the hoard against those who seek it. Though I retain my mind, the curse forces my hand should you threaten the treasure.&quot;
[[Continue-&gt;Dragon Convo Hub]]</tw-passagedata><tw-passagedata pid="242" name="Rat Eir" tags="" position="4375,1600" size="100,100">(display: &quot;header&quot;)
You lean in slightly, lowering your voice. “Father Aeschere, there is something you should know. Eir, the herbalist in the marketplace, has been spreading subversive pagan rumors. She speaks of old rituals and customs, potentially undermining the new faith and the unity of Heorot.”

The priest nods sagely, looking down at his crossed hands. &quot;Yes,&quot; he begins, &quot;I have known of Eir&#39;s activities for some time. You are on the right track, but you must dig deeper if you want to strike gold. Use her as a starting point and bring me more names. Observe meetings and do your best to find out what subversive activities they are planning.&quot; 

&quot;In the meantime,&quot; he says smugly &quot;here is something for your effort.&quot;
{(set:_x to 25)(set:$sp to it + _x)}
//(print: _x) silver added to inventory//

[[Continue-&gt;Aeschere Quest Hub]]</tw-passagedata><tw-passagedata pid="243" name="Rat Torsten" tags="" position="4350,1725" size="100,100">(display: &quot;header&quot;)

You lean in closer to  Aeschere, your voice low and cautious. “Father, there’s something else you should be aware of. Torsten, one of the village elders, is planning to offer a ritual sacrifice to the Shadow Walkers, or Sceadugenga. He believes this will make contact with them. You know they are Grendel&#39;s kin, even if Hrothgar won&#39;t publicly acknowledge it.”

Unferth’s eyes widen, a mix of surprise and concern crossing his face. “A ritual sacrifice to the Sceadugenga? This is far more serious than I imagined. Grendel’s kin are dangerous, and any attempt to contact them through such means could have catastrophic consequences.”


He straightens, his expression becoming resolute. “This must be stopped immediately. We cannot allow such heretical practices to take root, especially given the threat that Grendel and his kin already pose.”

Without another word, Aeschere rises and strides towards Hrothgar. He leans in to whisper urgently into the king’s ear. Hrothgar’s face darkens with anger, and he slams his fist on the arm of his throne.

“Guards!” Hrothgar’s voice booms through the hall, silencing all conversation. “Gather a party and apprehend Torsten at once. He must be stopped before he brings ruin upon us all.”

The hall erupts into action. Thanes and warriors scramble to arm themselves, their faces set in grim determination. Within moments, a group is assembled, ready to depart and arrest Torsten before his plans can come to fruition.

Aeschere turns back to you, his expression stern but grateful. “Your information has likely averted a disaster. Stay vigilant, and continue to serve Heorot well. This kingdom needs all the allies it can get.”

[[Follow the arresting party]]</tw-passagedata><tw-passagedata pid="244" name="Request Audience with Sir Thryth" tags="" position="3500,2825" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
As the guard leads you toward the house, you see at least eight men at arms patrolling the grounds, watching the laboring thralls and supervising their contrustrions. Many of them look up at you in suspicion.

Sir Thryth is tall and broad-shouldered, clad in fine garments adorned with the symbols of his faith—a silver cross prominently displayed around his neck. His hair and beard are dark and neatly trimmed, his eyes cold and calculating. He is flanked by a pair of large, capable-looking men at arms with halberds.

&quot;I am Sir Thryth,&quot; he announces, his tone measured. &quot;What has brought you to my estate?&quot;
{
(if:$hrothgarsFavor)[(set:$reputation&#39;s &quot;Thryth&quot; to &quot;high&quot;)]
(if:$reputation&#39;s &quot;Unferth&quot; is &quot;trusted&quot;)[
[[Explain that Unferth has tasked you with an official investigation of the facts around the attack.]]&lt;br&gt;
]
[[(Lie/bluff) Say that Hrothgar himself has tasked you with assessing Sir Thryth&#39;s response to the attack]]&lt;br&gt;
[[Explain that you have come to earn Hrothgar&#39;s favor by rooting out paganry and Grendel&#39;s influence.]]&lt;br&gt;
[[Explain that you are a Skald, investigating Grendel attacks so you can tell the true tale far and wide]]&lt;br&gt;
}
[[Excuse yourself and head back to Kattinge/Heorot-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="245" name="Retreat carefully in formation" tags="" position="575,3625" size="100,100">(display:&quot;header&quot;)(set:$energy to it - 12)(set:$effort to 9)(display:&quot;Effort&quot;)
You feel the oppressive presence of the Sceadugenga all around you, but you manage to keep your fear in check. &quot;We need to retreat, but let&#39;s do it carefully, in formation,&quot; you say, your voice steady despite the tension.

Hroald nods, approving of your cautious approach. &quot;Agreed. Everyone, stay close and keep your eyes sharp.&quot;

The group forms a tight circle, backs to each other, weapons at the ready. Hroald leads the way, moving slowly and deliberately, his battle-axe poised for any sudden attack. Edda follows closely, her shield raised and javelins at the ready. Ciar and her raven bring up the rear, her eyes scanning the darkening forest for any signs of movement. Lothar stays vigilant, his massive axe held firmly.

Step by step, you retreat through the forest, every rustle of leaves and snap of a twig heightening your senses. The shadows seem to shift and move, but maddeningly, you are never able to clearly see your pursuers. The feeling of being watched is almost unbearable, but you force yourself to stay calm and focused.

(set:$effort to 5)(display:&quot;Effort&quot;)
(if:$energy &lt; 50 )[
A wave of panic washes over you, your breath coming in shallow gasps. Your vision blurs, and for a moment, you feel as though the forest is closing in on you.

Edda notices your distress and places a reassuring hand on your shoulder. &quot;Steady now. It’s just the exhaustion. Take a deep breath.&quot;
]

The journey is slow and tense, each minute stretching out into an eternity. The forest grows darker as the sun dips below the horizon, casting long, eerie shadows that play tricks on your eyes. The air grows colder, and the sounds of the forest become more distant, as if the very trees are holding their breath.

As you near the edge of the forest, the village walls come into view, a reassuring sight in the gathering gloom. The sense of being hunted remains, but the sight of safety spurs you on. You maintain your formation, moving steadily towards the gates.

[[Continue back to the inn to rest]]</tw-passagedata><tw-passagedata pid="246" name="Return to King Hrothgar to report Thryth&#39;s actions and the situation." tags="" position="3125,3875" size="100,100">After the confrontation at Thryth Farmstead, the air is thick with tension. Sir Datrub, though disarmed and humiliated, insists on facing King Hrothgar to defend his actions and accuse you of insurrection. Recognizing the importance of addressing the matter officially, you and your companions agree to accompany him to Heorot Hall for arbitration.

Journey to Heorot:

The journey back is somber. Sir Thryth rides ahead, flanked by a few loyal guards who survived the skirmish. You and your companions follow, vigilant for any treachery. The landscape shifts from the scarred fields of the farmstead to the rolling hills and dense forests surrounding Hrothgar&#39;s seat of power.

As you approach Heorot, the grand hall rises against the horizon—a majestic structure of timber and gold, its intricate carvings telling tales of heroes and gods. The sound of merriment and the glow of torchlight spill out into the twilight, a stark contrast to the gravity of your purpose.

Inside Heorot Hall:

The interior of the hall is warm, filled with the scent of roasted meat and spiced ale. Warriors and nobles gather at long tables, their conversations a mix of boasts and laughter. At the far end, upon a raised dais, sits King Hrothgar—a man of advanced years but imposing presence, his silver beard flowing over rich robes.

Beside him stands Unferth, his trusted advisor, and a few other notable thanes. As you enter, a hush falls over the crowd. All eyes turn toward the unusual procession: Sir Datrub with his guards, and you with your companions.

Hrothgar raises a hand. &quot;What brings this assembly before me in such a state?&quot;

The Accusations Begin:

Sir Thryth steps forward, his voice dripping with indignation. &quot;My king, I come before you to report a grievous act of rebellion. These outsiders,&quot; he gestures toward you, &quot;have assaulted me, undermined my authority granted by you, and incited unrest among the laborers at my farmstead.&quot;

Murmurs ripple through the hall. Hrothgar&#39;s gaze shifts to you. &quot;And what say you to these accusations?&quot;

[[Defend your actions against Datrub]]
[[Lie about what happened against Datrub]]</tw-passagedata><tw-passagedata pid="247" name="Roll: Bard it up in Heorot!" tags="" position="5000,375" size="100,100">You take a deep breath, steadying your nerves as you approach the center of Heorot Hall. The raucous noise of conversation and laughter begins to fade as you step into the circle of firelight, your lute cradled in your hands. The king himself sits at the head of the hall, his eyes narrowing with curiosity as he gestures for silence.
---
{(set: $success to  (random: 1, 10) + $energy/10)
(set: $success to it /2)
(display:&quot;silvertongueBonus&quot;)
(set:$success to (round:it))
//Your success: (print:$success)/10//&lt;br&gt;
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]}
---
(if: $success &gt; 7 )[{
//(print:$success) silver added to inventory//&lt;br&gt;
(set: $sp to $sp + $success + $success)
(set: $reputation&#39;s &quot;Heorot Court&quot; to &quot;high&quot;)
(set: $reputation&#39;s &quot;Unferth&quot; to &quot;high&quot;)
(set: $achievements to it + (a:&quot;Rocked Heorot!&quot;))
(set:$doneQuest to &quot;Make a name for yourself at Heorot Hall&quot;)(display:&quot;questComplete&quot;)
}
}
You begin with a ringing chord that fills the air and immediately captures the room’s attention. You choose the Ballad of Grettir, the tale of valiant hero who struggled against a cursed fate. Your fingers dance fluidly across the strings, and your voice rises above the murmurs.

The court listens intently, conversations paused and many a drink hanging in the air, forgotten, mid-way to being sipped. A serving girl catches your eye, her gaze so full of earnest wonder it almost makes laugh aloud. Even Hrothgar leans forward, head turned to one side and eyes closed in pleasure. The queen, Wealhtheow, nods in time, her gaze never leaving you as the music fills the hall.

At the song’s crescendo you strum the final chord with wreckless bravado, allowing your voice to break with emotion. The final notes linger in the air, a beautiful echo of the past and a promise for the future. The silence that follows is profound, a collective breath held in awe of the story you have spun.

Then, the hall erupts in applause and cheers. Coins and small trinkets are tossed at your feet, tokens of the court’s appreciation. Hrothgar himself stands, raising his goblet in a toast. “//To the bard!// May his songs inspire us and his tales remind us of the glory we seek!”


[[Continue-&gt;Unferth music introduction]]
]
(else-if: $success &gt; 4 )[ 
//(print:$success) silver added to inventory//&lt;br&gt;
(set: $sp to $sp + $success + $success)

You begin to play, the familiar melody flowing from your fingers. Your voice rises, clear and strong, as you sing a tale of heroes and battles. The song is well-practiced, and the notes come together in harmony. The court listens politely, their attention wavering but respectful.

The warriors and thanes nod along to the rhythm, their expressions a mix of mild interest and distraction. The song reaches its midpoint, and you notice a few smiles among the crowd, but the enthusiasm is muted.

Hrothgar, his expression impassive, turns to speak quietly with one of his advisors, seemingly uninterested in your performance. The queen, however, offers you a terse nod and a bored smile, her eyes reflecting a hint of appreciation despite her otherwise indifferent demeanor.

As you finish, the hall responds with polite applause. It’s not the rousing ovation you had hoped for, but it’s enough to acknowledge your effort. A few coins are tossed your way, a modest reward for your performance.

{
(set: $reputation&#39;s &quot;Heorot Court&quot; to &quot;mid&quot;)
(set: $reputation&#39;s &quot;Unferth&quot; to &quot;mid&quot;)
(set: $sp to $sp + (random: 3, 7))
(set: $energy to $energy - 20)
}
[[Continue-&gt;Unferth music introduction]]
]
(else: )[ 
With a mix of excitement and trepidation, you step into the center of Heorot Hall, your lute in hand. The din of conversation slowly subsides as the court turns its attention to you, curious to see what this traveling bard has to offer. King Hrothgar sits at the head of the hall, his eyes fixed on you, a critical look on his face.

Taking a deep breath, you begin to play, strumming the strings of your lute. Your voice rises above the murmurs, attempting to weave a tale of ancient heroes and epic battles. However, the notes come out strained, and your fingers stumble over the strings. The melody is disjointed, lacking the harmony and grace you intended.

The warriors and thanes exchange glances, their expressions shifting from curiosity to irritation. A few chuckles ripple through the hall, quickly growing louder as your performance continues to falter. You try to push through, hoping to salvage the song, but the atmosphere has already turned against you.

Hrothgar&#39;s face darkens with displeasure, and the queen, Wealhtheow, looks away, clearly embarrassed on your behalf. The once attentive audience is now restless, their patience wearing thin. 

Suddenly, a jeer cuts through the air, followed by another. &quot;This is no song for warriors!&quot; someone shouts. &quot;Get off the stage!&quot; another voice demands. The jeers grow louder, and soon, bits of food and scraps of bread are hurled in your direction. A rotten apple hits your shoulder, and a crust of bread glances off your lute.

&quot;Enough!&quot; Hrothgar&#39;s voice booms through the hall, silencing the crowd. He stands, his face a mask of anger. &quot;You disgrace this hall with your feeble attempts at music. Begone, before we throw you out ourselves!&quot;
{
(set: $reputation&#39;s &quot;Heorot Court&quot; to &quot;low&quot;)
(set: $reputation&#39;s &quot;Unferth&quot; to &quot;low&quot;)

(set: $energy to $energy - 20)
}

The court erupts in laughter and mockery as you scramble to gather your things. Thanes shove you as you make your way to the exit, their boots and kicks hastening your departure. The once warm and inviting hall now feels hostile and unforgiving. You stumble out into the night, the sound of ridicule ringing in your ears, your dreams of impressing Hrothgar’s court shattered.

[[Flee the hall in disgrace-&gt;Village Hub]]

]</tw-passagedata><tw-passagedata pid="248" name="Roll: Combat skills boast" tags="" position="5300,425" size="100,100">Hrothgar&#39;s stern expression softens slightly, a hint of amusement playing at the corners of his mouth. He leans back in his chair, stroking his beard thoughtfully. &quot;Bold words, traveler. Let us see if your deeds match your boasts.&quot;

He gestures to a young man standing nearby, his posture straight and his eyes sharp. &quot;Hrothulf, my nephew and squire, will be your opponent. You will spar with training swords.&quot;

A young man, tall, brawny and golden-haired, very much a younger image of Hrothgar himself, straightens suddenly, a look of startlement momentarily marring his haughty features before he recomposes himself, and turns to glare at you with icy intensity.

You realize suddenly that the stakes must be rather high for this young man, as being defeated by a little-known traveler would be a significant embaressment and threat to his standing at court.

Hrothulf picks up two wooden swords from a rack and tosses one to you with a nod. An attendant comes to your side with a wooden shield, as another straps one to Hrothulfs left arm.

Now prepared, you swing the sword in a few cuts to test its balance, and move to the center of the hall, feeling every eye in the hall upon you. The murmur of conversation dies down as everyone focuses on the upcoming contest.
---
{(set: $success to  (random: 1, 10) + $energy/10)
(set: $success to it /2)
(display:&quot;tyrsEmblemBonus&quot;)
(set:$success to (round:it))
//Your success: (print:$success)/10//&lt;br&gt;
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]}
---
(if: _success &gt; 7 )[
{(set: $achievements to it + (a:&quot;defeated Hrothulf!&quot;))
(set: $reputation&#39;s &quot;Heorot Court&quot;  to &quot;high&quot;)
(set:$doneQuest to &quot;Make a name for yourself at Heorot Hall&quot;)(display:&quot;questComplete&quot;)
}
(set: $reputation&#39;s &quot;Unferth&quot;  to &quot;friendly&quot;)
(set: $reputation&#39;s &quot;Hrothulf&quot;  to &quot;rival&quot;)}
Hrothulf takes a ready stance, and you mirror his posture, your mind sharp and focused. The hall falls silent as Hrothgar gives the command, &quot;begin!&quot;.

Hrothulf moves quickly, his strikes swift and precise, yet you parry each blow with practiced ease, your movements feeling smooth and effortless, the rhythm of his attacks predictable.

Becoming frustrated, Hrothulf tries to overmatch you with power, and puts his weight behind a driving, unbalanced thrust. You easily side-step the clumsy maneuver, and manage to jab the tip of your wooden sword into his armpit, under his leather gambeson. 

Hrothulf staggers forward, off-balance and in pain, before recovering and attempting to knock you off your feet with a powerful shield strike, that is so clearly telegraphed that you have ample time to move aside and slash your wooden sword across the back of his knee, further keeping him off balance. Aeschere tries to regain his footing, but you are relentless, and with a final, decisive blow, you knock his clattering to the ground, sending a wave of surprised gasps through the crowd. 

Hrothgar rises to his feet, his laughter echoing through the hall. &quot;Well done, traveler! You have exceeded my expectations. Your skills are indeed formidable. Welcome to Heorot.&quot;

The hall erupts in cheers and applause, the thanes and warriors pounding their fists on the tables in approval.

Hrothulf&#39;s face is red with an uncertain mixture of exertion and humiliation as he stiffly bows and offers his hand. &quot;You fight very well,&quot; he admits grudgingly.

(set:$doneQuest to &quot;Make a name for yourself at Heorot Hall&quot;)(display:&quot;questComplete&quot;)
[[Continue-&gt;Unferth sword introduction]]
](else-if: _success &gt; 4 )[
(set: $reputation&#39;s &quot;Heorot Court&quot;  to &quot;mid&quot;)
(set: $reputation&#39;s &quot;Unferth&quot;  to &quot;friendly&quot;)
(set: $reputation&#39;s &quot;Hrothulf&quot;  to &quot;friendly&quot;)
Hrothulf takes a ready stance, and you mirror his posture, studying the way he moves. The hall falls silent as Hrothgar gives the command, &quot;begin!&quot;.

Hrothulf moves quickly, his strikes swift and precise. For a while you manage to parry each blow, and even temporarily sieze the momentum with a clever parry that puts him off balance, but soon Hrothulf&#39;s skill and power begin to take their toll, and your arms begin to ache. Sensing you begin to tire, his attack become more punishingly forceful, driving you back and rattling your bones.

With a final, powerful strike, Aeschere knocks your sword from your hand, sending it clattering to the ground. The hall erupts in cheers and applause, the thanes and warriors pounding their fists on the tables in approval.

Hrothgar rises to his feet, a smile on his face. &quot;Well fought, traveler. Though you did not win, you have shown great courage and skill. Welcome to Heorot.&quot;

Aeschere picks up your fallen sword, a respectful nod in your direction. &quot;You fought well,&quot; he says, offering his hand. &quot;I look forward to learning from you.&quot;

You clasp his hand firmly, the respect of the hall washing over you. Though you did not win, you have earned the respect and admiration of Heorot.
[[Continue-&gt;Unferth sword introduction]]
](else:)[
(set:  $reputation&#39;s &quot;Heorot Court&quot; to &quot;low&quot;)
Aeschere moves quickly, his strikes swift and precise. You try to predict the timing of the attack enough to take the momentum, but Hrothulf is a seasoned warrior, and his experience quickly shows as each strike, powerful as well as skillful, rattles your bones and leaves you little scope for advantage.

You struggle to keep up, your own strikes clumsy and ineffective against his onslaught as you begin to tire. Sweat pours down your face, stinging your eyes, and your breath comes in ragged gasps.

The hall watches in silence, the weight of their gaze pressing down on you like a physical burden. Every missed strike, every faltering step, amplifies the growing sense of failure.

With a final, powerful blow and an arrogant, victorious laugh, Hruthulf knocks your sword from your hand, sending it skittering across the floor. You fall to one knee, breathless and defeated, the world narrowing to the sight of Aeschere’s triumph and the sound of the court’s collective derision.

Laughter erupts from the gathered thanes, their jeers and taunts filling the hall with a cacophony of scorn. “Is this the great warrior?” one mocks.

King Hrothgar&#39;s expression hardens, his disappointment clear. “We have no need for empty boasts,” he says coldly. “Leave Heorot, and do not return until you have something of worth to offer.”

As you rise to your feet, the court jeers and pelts you with food and small objects. The sting of their rejection is sharper than any blade, your face burning with humiliation. Your boast has backfired spectacularly, and your place in Heorot is now in serious doubt.

You make a hasty retreat, the echoes of laughter and the weight of your failure following you out of the hall.

[[Flee Heorot Hall in disgrace-&gt;Village Hub]]
]</tw-passagedata><tw-passagedata pid="249" name="Run from frog" tags="" position="2475,4050" size="100,100">(display: &quot;header&quot;)
---
(set: _success to (round: ( (random: 1, 10)+ $energy/10)/2))
Your success: _success / 10!
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]
---
(if: _success &gt; 4 )[

Success: (print:_success)/10 !
You scamper backwards, narrowly avoiding the terrible, siezing jaws and grasping tongue of the fen creature as it hurtles its bulk onto the shore. You feel Hroald and Edda grab your arms from behind and pull you back, up the bank and away from hungry death.

Fortunately the creature seems unable or unwilling to leave the water&#39;s edge, and only stares at you for a long moment, it&#39;s sides heaving as its breathing slows, before wriggling its tail side to side to pull itself backwards down into the water.

[[Continue-&gt;Fen]] 
](else:)[
Failure: (print:_success)/10 !

You attempt to dash backwards but trip over the protruding root of a tree, falling in a tangle. With a surprising quickness, the huge beast lunges its head forward farther than you thought it capable, and grabs hold of your right leg just below the knee.

&quot;No!&quot; Shouts Hroald, who siezes your should from behind as the creatures starts to wriggle backwards into the water, dragging you along with it.

Edda lets loose a war cry along with a javelin, which arcs high and pierces down into creature&#39;s shoulder. It gives a great shuddering bellow, and for a moment you hope that it will release you, but then it clamps down and shrugs itself backwards into the water.

You are engulfed in cold blackness, which floods into your nose and mouth, even as the creature releases you momentarily, only to adjust its grip and bite down into your torso. Your body, along with your gear, crackles and breaks, and then are swallowed down into darkness.

&#39;&#39;Game Over!&#39;&#39;

]</tw-passagedata><tw-passagedata pid="250" name="Scout Drekaborg Surroundings" tags="" position="3225,4750" size="100,100">(display:&quot;header&quot;)
Determined to gather evidence of the dragon&#39;s presence, you and your companions set out to scout the surrounding area. The morning mist clings to the landscape, shrouding the world in a veil of gray.

The terrain is uneven, with patches of loose rocks and dense underbrush. The remnants of an ancient, overgrown path occasionally emerge beneath your feet—smooth stones worn by time and partially swallowed by nature.

An eerie stillness pervades the air. The usual sounds of wildlife are absent. No birds sing, no insects buzz. It&#39;s as if the land itself is holding its breath.

As you delve deeper into the foothills surrounding Drekaborg, you begin to notice unsettling signs:

 Patches of the ground are blackened, the soil brittle and ashen. Upon closer inspection, you realize these burn marks are ancient—weathered by centuries yet still evident. The plants in these areas are sparse or strangely twisted.

You come across the ruins of what once might have been small dwellings or outposts. Stone walls reduced to rubble, arches that appear warped as if exposed to intense heat. The stone surfaces are smooth and fused in places, bearing the unmistakable signs of having been melted.

Fragmented sections of a paved road emerge intermittently, hinting at a time when this area was traversed regularly. The road is overgrown with moss and grasses, but the craftsmanship suggests a bygone era of prosperity.


    Edda crouches beside a melted archway, running her fingers over the smooth stone. &quot;No natural fire does this,&quot; she remarks. &quot;It&#39;s as if the stone itself wept and froze in place.&quot;

    Ciar closes her eyes, her hand resting on the earth. &quot;There&#39;s a lingering energy here,&quot; she whispers. &quot;A memory of great heat and fury.&quot;

    Lothar kicks a piece of charred wood. &quot;Whatever happened here happened long ago. But it doesn&#39;t mean it can&#39;t happen again.&quot;

    Hroald examines the remnants of the road. &quot;This was a well-traveled path once. These ruins suggest a settlement or outpost—perhaps destroyed when the dragon first arrived.&quot;




The further you explore, the more pronounced the eerie atmosphere becomes. The lack of wildlife is unsettling. No tracks, no droppings, no signs of recent animal activity. It&#39;s as if the natural world avoids this place.

A Significant Find

Amid the ruins, you discover a building that is more intact than the others. Its stone walls, though weathered, still stand to shoulder height. Vines and ivy drape over the structure, but an entrance remains accessible.

    Exploring the Building

    You enter cautiously, weapons at the ready. Inside, the air is stale but dry. The floor is covered in debris—broken tiles, rotted wood, and dust. In the far corner, partially concealed by rubble, you notice a wooden trapdoor that appears surprisingly intact.

        Edda tests the trapdoor, checking for traps or signs of recent use. &quot;It seems untouched,&quot; she notes.

        Lothar grins. &quot;Only one way to find out what&#39;s below.&quot;

        Ciar places a hand on the door. &quot;There&#39;s a faint draft coming from beneath. This might lead somewhere.&quot;

        Hroald adds, &quot;If we&#39;re lucky, it could be part of the tunnel network shown on the map.&quot;

Decision Point

You consider your options. The trapdoor could lead to valuable information—or danger.

Options

   
[[ Open the Trapdoor and Descend-&gt;Enter the Underground Tunnel]]
[[Mark the Location on the map for Later Exploration-&gt;Drekaborg Quest Hub]]</tw-passagedata><tw-passagedata pid="251" name="Scream" tags="" position="475,4450" size="100,100">(display: &quot;header&quot;)

There is nothing to do but scream, to try to drown out the sounds of gutteral growls, tearing flesh, the shrieks of your companions, and the regret for your own folly.

As the darkness closes in, you realize the true horror of the Sceadugenga. They are not just powerful and relentless; they are intelligent, cunning, and driven by a purpose you can barely comprehend. The forest falls silent once more, the only sound the whisper of the wind through the trees.

&#39;&#39;Game Over!&#39;&#39;</tw-passagedata><tw-passagedata pid="252" name="Search Perimeter" tags="" position="850,3775" size="100,100">(display: &quot;header&quot;)(set:$energy to it - 10)
(set:$effort to 5)(display:&quot;Effort&quot;)
You start by searching the edges of the clearing, looking for any signs of movement or hidden dangers.  Ciar joins you, keen eyes scanning. She suddenly stops, crouching to point at the ground, &quot;Look here,&quot; she says &quot;Footprints, like those of a barefoot man, but see how large. And here!&quot; she whispers excitedly, &quot;This one, this one, this one, all different sizes. There were definitely multiple individuals moving through this area. They&#39;re large and likely very strong. We need to be extremely careful.&quot;

You kneel beside her, studying the tracks. The prints are deep and well-defined, indicating a significant weight. Nearby, you find a few strands of hair or fur caught on a low branch. You pick them up, bringing them closer to your face. The smell is strange—earthy and musky, unlike anything you&#39;ve encountered before.

(if:$energy &lt; 50 )[
A wave of panic washes over you, your breath coming in shallow gasps. Your vision blurs, and for a moment, you feel as though the forest is closing in on you.

Edda notices your distress and places a reassuring hand on your shoulder. &quot;Steady now. It’s just the exhaustion. Take a deep breath.&quot;

You nod, taking several deep breaths to calm yourself. The feeling of terror subsides, replaced by a heavy weariness. You realize that the combination of fatigue and the eerie atmosphere of the forest is playing tricks on your mind.
]

[[continue-&gt;Investigate Tree]]</tw-passagedata><tw-passagedata pid="253" name="Seek Their Story" tags="" position="2925,2625" size="100,100">(display: &quot;header&quot;)
&quot;I wish to hear your side of the story,&quot; you say respectfully. &quot;Only by understanding can we hope to find peace.&quot;

Torsten conveys your request. The Sceadugenga nod, and the air fills with a melodic hum. Images form in your mind—a shared vision of the past:

You see the forest as it once was—vast and untouched. The Sceadugenga and humans coexist, trading knowledge and honoring the land. Then, scenes of trees felled, sacred sites destroyed, and a growing darkness of mistrust and fear.

The vision fades. A heavy silence hangs in the air. Torsten speaks softly, &quot;They have shown you their truth.&quot;
(set: $soughtStory to true)
[[Express your desire to restore harmony between peoples-&gt;Express Intentions]]
[[Express remorse for the harm caused by humans against the sceadugenga]]
[[Could this be Grendel himself? Take your chance and try to assassinate the Sceadugenga leader!]]
(if: $expressedIntentions and $expressedRemorse)[
[[Pledge your help in restoring the old balance]]
]</tw-passagedata><tw-passagedata pid="254" name="Set Up Drekaborg Camp" tags="" position="3525,4825" size="100,100">(display: &quot;header&quot;)
As dusk settles over the rugged landscape, you decide to establish a concealed campsite from which you can observe Drekaborg without drawing attention. The mission is delicate: scout the area, confirm the dragon&#39;s presence, and gather any evidence—all while ensuring the beast remains undisturbed.

Choosing the Campsite

Guided by Hroald&#39;s keen eye for terrain, you find a secluded spot nestled among a cluster of large boulders and dense underbrush on the eastern slope of the hill. The location offers natural camouflage, shielding you from any prying eyes that might survey the area from the fort or its surroundings.

Setting Up

    Edda swiftly moves to set up silent alarms around the perimeter. Using thin cords and small bells muted with cloth, she creates a network that will alert you to any approach without revealing your position. &quot;This should give us enough warning without compromising our location,&quot; she whispers.

    Ciar tends to the horses, leading them deeper into the thicket where the foliage is thickest. She removes their bridles to make them more comfortable and pats each one reassuringly. &quot;They&#39;ll remain quiet,&quot; she assures you. Morrigan, her raven, takes flight to perch on a high branch, keeping a vigilant watch.

    Lothar lays out bedrolls on the soft ground, taking care to brush away any leaves or twigs that might crunch underfoot. &quot;No fire tonight,&quot; he notes, a hint of disappointment in his voice. &quot;But better a cold night than a hot encounter with a dragon.&quot;

    Hroald distributes rations—dried meats and hard biscuits that require no preparation. &quot;We&#39;ll make do,&quot; he says pragmatically. &quot;It&#39;s not a feast, but it&#39;ll keep our stomachs from rumbling.&quot;

The Atmosphere

The twilight deepens, and the shadows stretch long across the hillside. The silhouette of Drekaborg looms above, its ruined towers stark against the indigo sky. Stars begin to emerge, pinpricks of light in the vast darkness. The air is crisp and carries a subtle chill, along with an undercurrent of sulfur that raises the hairs on the back of your neck.

An eerie silence blankets the area. The usual sounds of nocturnal wildlife are conspicuously absent—no chirping of insects, no rustling of small creatures in the underbrush. It&#39;s as if the land itself holds its breath in the dragon&#39;s domain.

Around the Camp

Gathered in a tight circle, you and your companions speak in hushed tones.

    Edda adjusts the straps on her armor, her eyes scanning the darkness. &quot;We need to keep our senses sharp. Without a fire, the cold will creep in, but we can&#39;t risk being seen.&quot;

    Ciar sits cross-legged, her hands resting lightly on her knees. &quot;Morrigan senses unease in the air,&quot; she murmurs. &quot;There&#39;s a heaviness here, a lingering aura.&quot;

    Lothar wraps his cloak tighter around himself. &quot;Feels like we&#39;re being watched,&quot; he mutters. &quot;But by what, I can&#39;t say.&quot;

    Hroald nods in agreement. &quot;The absence of wildlife is unsettling. It&#39;s as if they&#39;ve fled or... been driven away.&quot;

Consulting the Map

You unroll the ancient map, careful not to let it rustle loudly. In the faint starlight, aided by a small hooded lantern that emits only a sliver of light, you examine the markings.

    Map Details: The map shows the region with remarkable detail. You notice subtle annotations—perhaps notes from a previous explorer. There are symbols indicating cave entrances on the southern face of the mountain, as well as what appears to be an old network of tunnels beneath Drekaborg.

&quot;These tunnels might provide access to the fort without being exposed,&quot; you suggest. &quot;If we can find an entrance, we could observe the dragon&#39;s lair from a safe distance.&quot;



[[Settle in for the night&#39;s rest-&gt;Sleep Drekaborg]]</tw-passagedata><tw-passagedata pid="255" name="Set out for Drekaborg" tags="" position="4300,4650" size="100,100">(display:&quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
Unferth sends word, and preparations are made for your departure.
You, Ciar, Hroald, Edda, and Lothar, spend the rest of the evening as guests of the hall, dining well and sleeping on comfortable mats.

In the morning, sun casts a golden hue over the mustering yard outside Heorot Hall, as you and your companions prepare to embark on the quest to Drekaborg. The air is crisp, filled with the scent of dew-kissed grass and the distant brine of the sea. Stable hands lead out five horses, each a fine specimen bred for endurance and temperament, suited for the journey ahead.

Villagers from Kattinge gather to see you off, their faces a mix of curiosity, and apprehension.

Hroald takes the lead, his knowledge of the land invaluable. &quot;We&#39;ll follow the Old King&#39;s Road westward,&quot; he explains, pointing toward the distant horizon where the path disappears into a stand of ancient oaks. &quot;It will lead us past Roskilde Fjord, and from there we&#39;ll turn south toward the hills where Drekaborg lies.&quot;

[[Examine the horses]]
[[Onward for Drekaborg]]</tw-passagedata><tw-passagedata pid="256" name="Set out for Thryth farmstead" tags="" position="3500,2175" size="100,100">(display:&#39;header&#39;)(set:$effort to 10)(display:&quot;Effort&quot;)

From the crossroads of Kattinge Village, your party sets out inland along the old boundary road. The path meanders through gently rolling hills, the remnants of ancient forests clinging to the edges. Wildflowers dot the landscape, their colors muted under a sky heavy with clouds.

To the east, the gentle hills are a green mottle of pasture, orchards, and untended stretches of meadowland, dotted with small villages. Smoke curls from thatched roofs, and you catch glimpses of people moving about and tending to their land.

A woman leading a small her of goats across a meadow stops to raise her hand in greeting.

[[Hail the woman for conversation-&gt;Shephard convo]]
[[Wave but continue walking-&gt;Continue toward Thryth]]</tw-passagedata><tw-passagedata pid="257" name="Shephard Christian Yes mean" tags="" position="3300,2450" size="100,100"></tw-passagedata><tw-passagedata pid="258" name="Shephard Christian Yes nice" tags="" position="3275,2650" size="100,100">(display:&quot;header&quot;)
&quot;Hmm,&quot; she says thoughtfully, &quot;then I suppose not all Christians are like Sir Thryth.&quot;
[[Continue-&gt;Shephard Thryth briefing]]</tw-passagedata><tw-passagedata pid="259" name="Shephard Christian no" tags="" position="3125,2575" size="100,100">(display:&quot;header&quot;)
&quot;Hmm,&quot; she says thoughtfully, &quot;then I should warn you to prepare yourself to choose your words carefully with Sir Thryth. Even asking the wrong question can be very dangerous.&quot;
[[Continue-&gt;Shephard Thryth briefing]]</tw-passagedata><tw-passagedata pid="260" name="Shephard Sir Thryth info" tags="" position="3125,2375" size="100,100"></tw-passagedata><tw-passagedata pid="261" name="Shephard Thryth briefing" tags="" position="3175,2450" size="100,100">(display: &quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)

//&quot;Sir Thryth// is a foreigner from beyond the Southern Sea who despises our ways and hopes to force us to his own beliefs.&quot;

She spits at the sound of the name and looks off into the distance for a long moment, as if considering her words, before turning back to you. &quot;I&#39;ve sympathy for the men taken. No doubt they were thralls, forced to their work by the devil that commands them.  But any fool could tell that something would happen, t&#39;was only a matter of time. Men waged war across the old boundary, of course the Sceadugenga would attack back. That is their forest.&quot;

[[What do you mean, they waged war?]]
[[What can you tell me of Sir Thryth?-&gt;Shephard Sir Thryth info]]
[[Back-&gt;Shephard convo]]</tw-passagedata><tw-passagedata pid="262" name="Shephard convo" tags="" position="3375,2325" size="100,100">(display:&quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)

Her goats bleat and eye you suspiciously, but the shephard clomps toward you across the meadow with no apparent anxiety. &quot;What brings such fine and noble folk out this way I wonder?&quot; She eyes the unusual appearance of your party. &quot;You&#39;ve come from abroad? What news have you?&quot;

(if: $achievements contains &quot;Saw Unferth slay the competition.&quot;)[
[Tell her of Unferth&#39;s duel against the Frankish prince]
]
(if:$reputation&#39;s &quot;Véfrøðr&quot; is not &quot;unknown&quot; )[
[I met a dragon at Drekaborg]
]

[[Ask about the attacks on Thryth farmstead]]
[[Excuse yourself and continue on toward Thryth-&gt;Continue toward Thryth]]</tw-passagedata><tw-passagedata pid="263" name="Sigrid and the Dragon of Jelling" tags="" position="3050,2175" size="100,100">(display: &quot;header&quot;)


&quot;In ancient times, the Kingdom of Jelling was home to a magnificent temple dedicated to //Freyja// goddess of love and abundance. Pilgrims from distant realms would journey to this sacred site, seeking blessings and leaving offerings. The temple stood beside towering rune stones, inscribed with the wisdom of the gods and the history of our people.&quot;

Ivar&#39;s voice lowers, drawing you into the narrative. &quot;But darkness fell upon Jelling when a fearsome dragon descended from the northern mountains. This beast, with scales shimmering like obsidian and eyes burning like embers, took residence within Freyja&#39;s temple. Its presence desecrated the holy ground, and its fiery breath scorched the earth, making it impossible for the faithful to worship.&quot;

&quot;Many valiant warriors attempted to slay the dragon,&quot; he continues, &quot;but all met a grim fate. The people&#39;s prayers went unanswered, and despair hung over the village like a shroud.&quot;

&quot;Amidst this turmoil, a young woman named Sigrid stepped forward. She was not a warrior but a keeper of ancient lore and a healer versed in the old ways. Determined to restore the temple, she studied the rune stones by moonlight, seeking any knowledge that might help her confront the beast.&quot;

Ivar leans in, his eyes reflecting the flickering flames. &quot;Sigrid discovered an old prophecy inscribed upon the stones—a verse hinting that only through compassion could the dragon be subdued. Armed with this wisdom, her harp, and a satchel of sacred herbs, she approached the temple at dawn.&quot;

&quot;As the dragon emerged, its massive form blocking out the sun, Sigrid began to play her harp,&quot; Ivar says, his voice taking on a melodic tone. &quot;Her music was infused with the essence of Freyja&#39;s grace, each note a plea for harmony. The melody wove through the air, calming the dragon&#39;s fury and stirring something deep within its ancient soul.&quot;

He pauses dramatically. &quot;The dragon, entranced by the music, revealed that it was not a mindless beast but a guardian spirit, wounded by men who had defiled its sacred resting place in the mountains and driven it away. The dragon still bore a spear buried deep in its flank—a weapon of strange, shimmering metal, etched with powerful runes of dark sorcery.&quot;

&quot;Sigrid listened with a compassionate heart,&quot; Ivar continues. &quot;She offered to heal the dragon&#39;s wounds using her knowledge of herbs and the blessings of Freyja. The dragon, weary of pain and solitude, agreed. As she approached the beast, she realized that to remove the cursed spear would require great sacrifice.&quot;

&quot;Summoning all her courage, Sigrid grasped the spear. The dark runes flared to life, and a searing pain shot through her. Yet she held firm, reciting ancient incantations to counteract the curse. With a final, desperate pull, she freed the spear from the dragon&#39;s flesh. But the malevolent magic, unleashed, turned upon her.&quot;

Ivar&#39;s voice softens, laden with sorrow. &quot;The cursed runes exacted their toll, and Sigrid fell mortally wounded. The dragon gazed upon her with profound gratitude and grief. In a gesture of deep honor, it gently lifted her with its massive claws and took to the skies.&quot;

&quot;They say the dragon carried Sigrid&#39;s body to the realms beyond, granting her passage to the afterlife. But the story doesn&#39;t end there. Sigrid and the dragon merged their spirits, becoming celestial guardians who watch over the land to this day. In times of great need, it&#39;s said they appear to those pure of heart, offering guidance and healing.&quot;

Ivar&#39;s eyes shimmer with emotion. &quot;The temple at Jelling was rebuilt, not just to honor Freyja, but also to commemorate Sigrid&#39;s sacrifice and the dragon&#39;s redemption. The rune stones bear new inscriptions now—symbols of unity, compassion, and the enduring bond between beings once thought adversaries.&quot;

He concludes, his gaze meeting yours. &quot;The tale of Sigrid teaches us that true heroism lies in selflessness and understanding. She bridged the divide between mortal and myth, leaving a legacy that transcends time. In these troubled days, perhaps we, too, can find inspiration in her story to seek harmony where there is strife.&quot;

[[Ask Ivar another tale-&gt;Ask Ivar about the lore of the land]]
[[Continue-&gt;Elders Hub]]</tw-passagedata><tw-passagedata pid="264" name="Sit at the hearth" tags="" position="275,1575" size="100,100">(display: &quot;header&quot;)
The fire’s warmth seeps into your bones, a welcome contrast to the chill that clings to the late afternoon air outside.

From this vantage point, the room unfurls before you like a tapestry. The firelight flickers across the faces of the patrons, casting shadows that dance and play on the rough wooden walls. The mingled scents of roasted meat, stale ale, and woodsmoke create a heady atmosphere that speaks of countless evenings spent in revelry and camaraderie.

To your left, a group of local fishermen sits huddled around a table, their faces weathered by the sea and their hands calloused from years of toil. They speak in low, earnest tones, their conversation punctuated by bursts of laughter and the occasional clatter of a mug on the table. You catch snippets of their talk—tales of the day&#39;s catch, the treacherous weather, and the ever-present threat of the deep, dark waters that lie just beyond the safety of the shore.


[[Drift off to sleep-&gt;Wake up at the hearth]]
[[Rise from the hearth-&gt;Inn Hub]]</tw-passagedata><tw-passagedata pid="265" name="Sleep Drekaborg" tags="" position="3450,5000" size="100,100">(display:&quot;header&quot;)
As you settle into your bedroll, the ground feels cold and unyielding beneath you. The absence of a fire makes the chill more pronounced, but you draw your cloak tightly around you. The vast expanse of the night sky stretches above, a tapestry of stars that seem both distant and comforting.

Questions swirl in your mind: Unferth&#39;s true intentions, the nature of the dragon you&#39;re seeking, the eerie silence of this place. Yet, amid the uncertainty, a sense of purpose steadies you. The soft breathing of your companions and the whisper of the wind through the trees lull you toward sleep.

Energy restored! (set:$energy to 100)
[[Continue-&gt;Draconic Surprise]]</tw-passagedata><tw-passagedata pid="266" name="Sleep at the church" tags="" position="2025,2500" size="100,100">(display:&quot;header&quot;)
(display:&quot;Find Rest&quot;)
The priest smiles gently. &quot;Of course. We have a small room at the back where travelers can find refuge. It’s not much, but it is warm and safe.&quot;

He leads you through a side door into a small, simple room. A narrow bed with a straw mattress sits against one wall, and a small wooden table holds a basin of water and a cloth. A single candle flickers on the table, casting a soft light that dances on the stone walls.

&quot;You are welcome to stay here for the night,&quot; the priest says, handing you a thick woolen blanket. &quot;Rest well, and may you find peace in this place.&quot;

You thank him sincerely and settle onto the bed, the warmth of the blanket and the quiet of the church a soothing balm after your travels. The faint sound of the priest’s murmured prayers drifts through the walls, and you close your eyes, feeling the weight of fatigue begin to lift.

As you drift off to sleep, the comforting presence of the church surrounds you, a sanctuary in the midst of a troubled land. You know that whatever challenges the next day brings, you will face them with renewed strength and a spirit bolstered by the kindness you have encountered.

You wake up feeling refreshed after your night at the church.
{(set: $energy to 100)(display:&quot;Initialize Larders&quot;)}
//Energy restored to (print:$energy)/100//

[[Continue-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="267" name="Sleep in Hayloft" tags="" position="0,2050" size="100,100">(if:$sp&lt;1)[
The innkeeper frowns down at you with pity or perhaps boredom.
&quot;Sorry, it costs a silver piece, can&#39;t let you crowd the paying customers,&quot; he says, &quot;You can stay by the hearth here for tonight, but you best find some coin if you want to be hanging about. We can&#39;t take in strays.&quot;

[[Continue-&gt;Innkeeper]]
](else:)[
Exhausted, you make your way to the hayloft. Finding an unoccupied spot, you unroll the blanket from your pack and settle in for a night&#39;s rest.(display:&quot;Find Rest&quot;)

[[Drift off to sleep-&gt;Wake up in the Inn]]
]</tw-passagedata><tw-passagedata pid="268" name="Smith Grendel Inquiry" tags="" position="1275,1075" size="100,100">(display: &quot;header&quot;)

The smith, overhearing from his place at the anvil, glances up briefly and replies in a rumbling voice without breaking the rhythm of his work, &quot;Fishermen whisper of shadows in the deep, farmers speak of creatures stalking the fields. Rumors flow through this market like water, but little enough is of substances.&quot;

A middle aged man with a long well oiled mustache and a silver-capped walking stick, well-dressed in a dyed-green wool cloak and jaunty cap, objects, &quot;More than mere rumors, my good fellow. Seven men taken in the last attack, on Thryth farmstead, just last week.&quot;

&quot;Ay, something happened out at Thryth, men went missing, mostly indentured thralls from what I hear,&quot; interjects a stout fellow in a leather jerkin, &quot;but //what// happened? Grendel ate them, or they cleverly escaped their bondage and convinced their master not to pursue? Which is really more likely, I ask you?&quot;

A wave of scandalized cries and murmers passes through the surrounding crowd, and the man in instantly taken up in debate by the mustached man in green.

The smith laughs. &quot;The only sure thing is the strength of good steel.&quot; His voice carries the weight of conviction, punctuated by the ring of his hammer. &quot;If you&#39;re wise, you&#39;ll put your trust in something real.&quot;

He cools the blade in a trough of oil, the metal hissing like a serpent. Finally turning to face you, he adds, &quot;How well armed and armored are you, friend? We&#39;ve wares to suit your needs.&quot;

[[Examine the wares-&gt;Smith weapons]]
[[Continue-&gt;Market Hub]]</tw-passagedata><tw-passagedata pid="269" name="Smith weapons" tags="" position="1300,825" size="100,100">(display: &quot;header&quot;)
[[Continue exploring the market-&gt;Market Hub]]

[Your current silver: $sp]&lt;sp|
{
(for: each _item, ...$smithInventory)[(set:_label to &quot;purchase &quot; + &quot;name&quot; of _item)
(set: _descriptionLabel to &quot;Description of &quot; + _item&#39;s &quot;name&quot;)
---
(print: &quot;name&quot; of _item) |  Price: (print: &quot;price&quot; of _item) silver penningar | (link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] | (link:&quot;purchase&quot;)[
(set: $purchaseItem to _item)
(display: &quot;Purchase confirmation&quot;)
(replace: ?sp)[ [Your current silver: (print: $sp)]&lt;sp|]
]

]
}</tw-passagedata><tw-passagedata pid="270" name="Stand Your Ground" tags="" position="5075,1000" size="100,100">(display: &quot;header&quot;)
In the tense silence of the hall, you choose to stand your ground. &quot;Your Majesty,&quot; you begin, your voice steady despite the rising hostility, &quot;true strength also lies in wisdom and the ability to adapt. Facing the Grendel threat requires more than bravery; it requires understanding and perhaps a different tactic.&quot;

The words hang heavy in the air, and the reaction is immediate and fierce. King Hrothgar&#39;s face contorts with fury, his voice thundering through the hall. &quot;Insolence! You challenge not only my methods but my very honor as king!&quot;

He turns to his guards, his command ringing with finality. &quot;Seize this bard! Such disrespect cannot go unpunished.&quot;

The guards, loyal and unflinching, move swiftly towards you, their intentions clear and deadly. The warriors and thanes echo Hrothgar&#39;s anger, their shouts filling the hall as they close in around you. There&#39;s no room for escape, no chance for further words. The situation has escalated beyond repair.

In moments, you&#39;re overpowered and dragged away. The last sights and sounds of Heorot Hall are a blur of motion and noise, a cacophony of anger and betrayal that drowns out your pleas for reason.

As you&#39;re led to your grim fate, the realization hits you: your journey, your story, ends here. In seeking to bring a new perspective to King Hrothgar, you&#39;ve inadvertently sealed your doom. The hall of Heorot fades into the distance, along with the untold tales and secrets you hoped to uncover.

**Game Over**</tw-passagedata><tw-passagedata pid="271" name="Stand ground against Scea" tags="" position="400,4650" size="100,100">(display:&quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)
(display: &quot;updateCombatBonus&quot;)

Your comrades cluster nervously around you, clutching their weapons. The air is thick with the scent of moss and an electric buzz of dread. As the last rays of sunlight retreat, the shadows cast by the ancient trees grow longer, more menacing.

You feel the oppressive presence of the Sceadugenga all around you, and your heart pounds with fear, but you steel yourself and take heart in the strength of your steel and your comrades.

&quot;Let&#39;s show these Shadow Walkers that we&#39;re not afraid,&quot; says Hroald, close by your side.

Edda nods, gripping her shield tightly. &quot;Let&#39;s do it. Stay close and watch each other&#39;s backs.&quot;

Lothar raises his axe, a grim smile on his face. &quot;We&#39;ll make them regret stalking us.&quot;

Ciar&#39;s expression is more cautious, but she nods in agreement, her raven taking flight with a sharp caw. &quot;Be careful. These are no ordinary foes.&quot;

An eerie howl suddenly pierces the night quickly answered by another from the other side, and then another, surrounding you in a chorus of primal fury. Forms emerge from the trees, long arms, great shaggy heads and torsos covered in fur like a bear’s. They carry long staves or spears and you see charms of stone or bone woven into their coats, as well as the sheen of some strange leather or metal scales worn as armor. 

Suddenly you lock eyes with one of the creatures, and you understand your folly in coming here.
---
Current Energy: $energy
Current combat bonus: $totalCombatBonus

(if: $energy &gt; 50)[
[[Curl into a ball and play dead-&gt;Scream]]
[[Scream]]
[[Flee at full speed]]
[[Fight!]]
](else:)[
Exhaustion overtakes your courage, and your martial training abandons you.
[[Curl into a ball and play dead-&gt;Scream]]
[[Scream-&gt;Scream]]
]</tw-passagedata><tw-passagedata pid="272" name="Start" tags="" position="500,25" size="100,100">&lt;center&gt;&lt;h3&gt;Grendelverse Chapter 1: Shadows of Grendel &lt;/h3&gt;&lt;/center&gt;

Welcome to **Grendelverse**! This is a dynamic text role-playing game (RPG) set in the world of the epic saga **Beowulf**, one of the earliest and gnarliest literary works in (Old) English, and a major influence on Tolkein and basically all modern fantasy.

Now you can explore the surreal and mysterious world of Grendel and the Ring-Danes of Heorot as never before, influencing events and digging beneath the surface of the morally simplistic victor&#39;s narrative we are taught in school. Who or what is the monster Grendel, and what drives his campaign of terror? Can you look into the shadows and find the truth?
(set:$saveSlot to &quot;Save Slot 1&quot;)
[[How to play this game]]
[[Begin a new game-&gt;Landfall]](set:$reputation to 0)
[[Saved Games Dashboard-&gt;Games Dashboard]] 

(click: &quot;Beowulf&quot;)[(goto-url: &#39;https://oldenglishpoetry.camden.rutgers.edu/beowulf/&#39;)]</tw-passagedata><tw-passagedata pid="273" name="Status" tags="" position="50,1025" size="100,100">**Vitals**: //Health// (if: $energy &gt; 125)[(set: $energy to 125)](print: $health)/100 | [//Energy//: (print: $energy)/100]&lt;energy|
Current armor bonus: $totalArmorBonus</tw-passagedata><tw-passagedata pid="274" name="Stay in the Tree to Rest" tags="" position="5100,4250" size="100,100">(display: &quot;header&quot;)</tw-passagedata><tw-passagedata pid="275" name="Step forward and tell Unferth you’ve succeeded in drawing out the traitors as he assigned you!" tags="" position="5575,3000" size="100,100">(display: &quot;header&quot;)
Step forward and tell Unferth you’ve succeeded in drawing out the traitors as he assigned you!

You step forward confidently, raising your voice to address Unferth and Hrothgar. &quot;My lords,&quot; you begin, trying to project a sense of assurance. &quot;As Unferth assigned me, I have succeeded in drawing out the traitors. We have identified those who still practice the old ways and harbor sympathies for the Sceadugenga.&quot;

Unferth narrows his eyes, a mixture of curiosity and suspicion in his gaze. &quot;Is that so?&quot; he asks, his tone carefully measured. &quot;And who, pray tell, are these traitors?&quot;

You motion towards Torsten and your companions, choosing your words carefully. &quot;These individuals were attempting to transport the artifact back to the forest to aid the Sceadugenga. We managed to intercept them and seize the artifact.&quot;

Hrothgar&#39;s grip tightens on his sword, and he takes a step forward, his eyes blazing with intensity. &quot;You have done well to bring this to our attention. Traitors in our midst cannot be tolerated. Unferth, what do you propose we do with them?&quot;

Unferth&#39;s gaze flickers between you, your companions, and Torsten. &quot;We must be thorough,&quot; he says slowly. &quot;If these people truly intend to betray us, they must face justice. However, we must also verify the truth of these claims.&quot;

You nod, trying to maintain your composure. &quot;We can question them and learn more about their plans. It will help us root out any further threats.&quot;

Hrothgar considers this, then nods decisively. &quot;Very well. Guards, take them into custody. We will get to the bottom of this.&quot;

The guards step forward, seizing Torsten and your companions. You feel a pang of guilt as they are led away, but you know that your actions have bought you time and potentially saved your own life.

Unferth approaches you, his expression unreadable. &quot;You have done well to bring this to our attention,&quot; he repeats. &quot;But be cautious. Trust is a fragile thing, and deception can only take you so far.&quot;
[[Continue-&gt;Torsten&#39;s Execution]]</tw-passagedata><tw-passagedata pid="276" name="Step forward and try to explain to Hrothgar and Unferth the importance of returning the horn" tags="" position="5325,3800" size="100,100">(display: &quot;header&quot;)
Step Forward and Try to Explain to Hrothgar and Unferth the Importance of Returning the Horn

You step forward, taking a deep breath to steady your nerves. &quot;My lords, please listen,&quot; you begin, addressing both Hrothgar and Unferth. &quot;This artifact is not merely a weapon; it is a sacred horn of the Sceadugenga. It was stolen from them, and returning it could help us make peace and prevent further bloodshed.&quot;

Hrothgar&#39;s eyes narrow, his grip tightening on his sword. &quot;Peace with the Sceadugenga? You would have us negotiate with those monsters? They are the enemies of our people!&quot;

Unferth steps closer, his expression cold and calculating. &quot;You speak of peace, but how do we know this is not a ruse to further their cause? Why should we trust your judgment over our own?&quot;

You try to remain calm, aware that every word counts. &quot;Please, hear me out. If we can show them respect by returning what was taken, it could be the first step towards ending this conflict. We cannot continue to fight them without considering other ways to resolve our differences.&quot;

Hrothgar&#39;s face hardens, his eyes blazing with anger. &quot;Enough! Your words are nothing but the prattling of a fool. Guards, seize them!&quot;

Before you can react, the guards surge forward, grabbing you and your companions. Torsten tries to resist, but he is quickly overpowered. You feel rough hands binding your wrists and forcing you to the ground.

Unferth&#39;s voice cuts through the chaos, icy and commanding. &quot;You have chosen to defy the king and harbor sympathy for our enemies. Such treachery will not go unpunished.&quot;

You are dragged to your feet, your hands tightly bound, and marched towards Heorot. The reality of your situation sinks in as you are hauled through the village, the stares of the villagers filled with a mix of curiosity and fear.

At Heorot, you are thrown into a dank, dark cell, the heavy door slamming shut behind you. The smell of damp stone and decay fills your nostrils, and you hear the distant murmur of the court above.

Hours pass in a haze of despair, the weight of your impending fate pressing down on you. You know that you and your companions are scheduled for execution, your attempt to explain the importance of the horn having failed spectacularly.

As the light outside the small, barred window fades, you hear the footsteps of guards approaching. The door creaks open, and you are roughly pulled to your feet and led out of the cell. The cold night air chills your skin as you are brought before Hrothgar and Unferth once more, their expressions stern and unyielding.

Hrothgar raises his voice, addressing the assembled crowd. &quot;These traitors sought to undermine our strength and betray our people. Let their fate serve as a warning to all who would consider such folly.&quot;

The guards force you and your companions to kneel, the sharp edge of the executioner&#39;s blade glinting in the torchlight. You close your eyes, bracing for the inevitable.

In that final moment, you cannot help but wonder if there was another way, another path you could have taken to avoid this grim fate.
**Game Over**</tw-passagedata><tw-passagedata pid="277" name="Suggest Retreat" tags="" position="1575,3850" size="100,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)

(if:$pigDefeated)[
&quot;Quickly, back to the forest,&quot; you decide, turning to make your way back up the bank toward toward the return path, passing the spot where you fought the monstrous pig-like animal.

[[Continue-&gt;Patrol Hub]]
](else:)[
As you make your way back to the forest and the path back toward Heorot, you are suddenly pulled up short by the gleam of a beady eye and the profile of a long bestial snout lined with jagged protruding tusks. The creature, a nightmarish thing like a huge boar but somehow lower, more reptilian, emerges at a slow, stalking gate from the trees in front of you. It swipes its heavy, armored-looking head back and forth in a clear gesture of menace, and gives forth a series of great, barking grunts, it&#39;s sides bellowing visibly.

&quot;A second one,&quot; hisses Ciar, pointing off to your left, where indeed you see a slightly smaller creature, still probably the weight of a small horse, a few yards back into the trees.

The larger and closer of the nightmare pig-things lets out a strange, low, belching roar, unlike the sound of any pig, and charges toward you, waggling its spiked head menacingly as it picks up speed.

The creature is angled slightly to the left as it comes down the path, and it&#39;s rear haunch is exposed as it&#39;s head sways to the other side.

---
Current energy: (print:$energy)(display: &quot;updateCombatBonus&quot;)
Armor bonus: $totalArmorBonus
---

[[Try to dodge the charge-&gt;DodgePig]]
{
(for: each _weapon, ...$weaponsAndArmor)[
	(if: _weapon&#39;s &quot;name&quot; is &quot;Bow&quot;)[
    	[[Shoot the beast with an arrow, aiming to kill-&gt;FenPigKillArrow]]
        [[Shoot the beast in the flank with an arrow, aiming to hobble it-&gt;FenPigArrowLame]]
    ]
    (if: _weapon&#39;s &quot;name&quot; is &quot;Fine Sword&quot;)[
    [[Draw your sword and let it come-&gt;FenPigSword]]&lt;br&gt;
    ]
    (if: _weapon&#39;s &quot;name&quot; is &quot;Axe&quot;)[
    [[Ready your axe-&gt;FenPigAxe]]&lt;br&gt;
    ]
    (if: _weapon&#39;s &quot;name&quot; is &quot;Spear&quot;)[
	[[Ready your spear-&gt;FenPigSpear]]&lt;br&gt;
    ]
]
}]</tw-passagedata><tw-passagedata pid="278" name="Tell Edda to attack the fen creature" tags="" position="1950,3975" size="100,100">(display: &quot;header&quot;)(set:$effort to 3)(display:&quot;Effort&quot;)
&quot;Edda,&quot; you whisper, barely more than a breath. &quot;Can you hit it from here?&quot;

She assesses the distance, her gaze calculating. &quot;It&#39;s a fair throw, but I can make it.&quot;

Ciar places a hand on your arm, her expression wary. &quot;Are you sure this is wise? We know nothing of this beast or its kind.&quot;

Lothar smirks, the hint of a challenge in his eyes. &quot;A well-placed strike might show it we&#39;re not to be trifled with.&quot;

Hroald glances around nervously. &quot;Just be prepared for the consequences. We don&#39;t know what else lurks in these waters.&quot;

Edda steps forward, positioning herself for the throw. The muscles in her arm tense as she draws back, the javelin poised like an extension of her will. For a moment, time seems to slow—the mists swirl lazily, the reeds sway in languid motion, and the creature&#39;s unblinking eyes remain fixed upon you.

With a swift, fluid motion, Edda releases the javelin. It slices through the air with a faint whistle, a streak of steel and wood cutting across the monochrome backdrop of the fen.

The weapon strikes true, embedding itself in the creature&#39;s back with a dull, resonant thud. A shudder runs through its massive form, and for an instant, it remains motionless, as if stunned by the audacity of the attack.

Then, all at once, the beast erupts into motion. It thrashes violently, sending waves crashing against the banks and churning the water into a frothy maelstrom. The javelin protrudes from its back like a menacing quill, and each movement only drives it deeper into its flesh.

The disturbance ripples outward, both literally and figuratively. From the surrounding pools and hidden depths, other shapes begin to stir. Dark silhouettes glide beneath the surface, serpentine forms twisting and coiling with newfound agitation. The air fills with a cacophony of hisses and low, guttural sounds that reverberate through the mist.

Ciar&#39;s raven takes flight with an alarmed cry, circling overhead before disappearing into the fog. &quot;You&#39;ve roused the whole fen!&quot; Ciar exclaims, her voice edged with urgency.

[[Suggest Retreat]]
[[Observe roused fen creatures]]</tw-passagedata><tw-passagedata pid="279" name="Tell Unferth about Sceadugenga magic" tags="" position="3400,1650" size="100,100">(display: &quot;header&quot;)
{(for: each _item, ...$misc)[
  (if: _item&#39;s &quot;name&quot; is &quot;Face fruit&quot;)[
  (link:&quot;Give Unferth the fruit of the sacred tree&quot;)[
  Unferth&#39;s eyes hungrily scan the sketch as soon as you lay it on the table, and he nods to himself, looking satisfied.
	(set:$misc to it - (a:_item))
&quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;&lt;br&gt;
    //Reward: 100sp//&lt;br&gt;
(set:$sp to it + 100)

  ]
  ]
  (if: _item&#39;s &quot;name&quot; is &quot;Branch from the face fruit tree&quot;)[
    (link:&quot;Give Unferth the branch from the face fruit tree&quot;)[
  Unferth&#39;s eyes hungrily scan the sketch as soon as you lay it on the table, and he nods to himself, looking satisfied.&lt;br&gt;
	(set:$misc to it - (a:_item))
&quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;&lt;br&gt;
    //Reward: 100sp//&lt;br&gt;
(set:$sp to it + 100)
  ]
  ]
   
  (if: _item&#39;s &quot;name&quot; is &quot;Forest rune sketch&quot;)[
  (link:&quot;Give Unferth the sketch of the runes on the sacred tree&quot;)[
  Unferth&#39;s eyes hungrily scan the sketch as soon as you lay it on the table, and he nods to himself, looking satisfied.&lt;br&gt;
	(set:$misc to it - (a:_item))
&quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;&lt;br&gt;
    //Reward: 100sp//&lt;br&gt;
(set:$sp to it + 100)
  ]
  ]
  
  (if: _item&#39;s &quot;name&quot; is &quot;Standing stone rune sketch&quot;)[
  (link:&quot;Give Unferth the sketch of the runes on the standing stones in the fen&quot;)[
  Unferth&#39;s eyes hungrily scan the sketch as soon as you lay it on the table, and he nods to himself, looking satisfied.&lt;br&gt;
	(set:$misc to it - (a:_item))
    (set:$sp to it + 100)
&quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;&lt;br&gt;
    //Reward: 100sp//&lt;br&gt;
  ]    
  ]
  
  
    (if: _item&#39;s &quot;name&quot; is &quot;Tower rune sketch&quot;)[
  (link:&quot;Give Unferth the sketch of the runes on the tower&quot;)[
  Unferth&#39;s eyes hungrily scan the sketch as soon as you lay it on the table, and he nods to himself, looking satisfied.&lt;br&gt;
	(set:$misc to it - (a:_item))
    (set:$sp to it + 100)
&quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;&lt;br&gt;
    //Reward: 100sp//&lt;br&gt;
  ]    
  ]
]

(if: $knownLore contains &quot;The Sceadugenga tend a magic tree in the forest (location known).&quot; and $completedQuests does not contain &quot;Locate Sources of Sceadugenga Magic (The Sacred Grove)&quot;)[

  (set:_anythingToTell to true)
  (link:&quot;Tell Unferth of the Sceadugenga&#39;s sacred grove&quot;)[
  Quest Complete: &quot;Locate Sources of Sceadugenga Magic (The Sacred Grove)&quot;&lt;br&gt;
	(set:$completedQuests to it + (a:&quot;Locate Sources of Sceadugenga Magic (The Sacred Grove)&quot;))
    	  Unferth&#39;s eyes are uncharacteristically wide with candid interest as you relate the story of your discovery the tree, and carefully mark its location on a map for him.
 &quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;   &lt;br&gt;
    
    //Reward: 100sp//&lt;br&gt;
(set:$sp to it + 100)
  ]
]
(set:$stoneLocationQuest to &quot;Locate Sources of Sceadugenga Magic--The Standing Stones (1/2)&quot;)
(if: $knownLore contains $standingStonesLocation and $completedQuests does not contain $stoneLocationQuest)[

  (link:&quot;Tell Unferth of the standing stones in the fen&quot;)[
  Quest Complete: (print:$stoneLocationQuest)&lt;br&gt;
	(set:$completedQuests to it + (a:$stoneLocationQuest))
    	  Unferth&#39;s eyes are uncharacteristically wide with candid interest as you relate the story of your discovery the standing stones, and carefully mark its location on a map for him.&lt;br&gt;
 &quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;   &lt;br&gt;
    
    //Reward: 100sp//&lt;br&gt;
(set:$sp to it + 100)
  ]
]

(set:$stoneCommsQuest to &quot;Locate Sources of Sceadugenga Magic--The Standing Stones (2/2)&quot;)
(if: $knownLore contains $standingStonesComms and $completedQuests does not contain $stoneCommsQuest)[

  (link:&quot;Tell Unferth of the standing stones in the fen&quot;)[
  Quest Complete: (print:$stoneCommsQuest)&lt;br&gt;
	(set:$completedQuests to it + (a:$stoneCommsQuest))
    	  Unferth&#39;s eyes are uncharacteristically wide with candid interest as you relate the story of your discovery the standing stones, and carefully mark its location on a map for him.&lt;br&gt;
 &quot;This is an extrememly valuable discovery,&quot; he says earnestly. &quot;Thank you for bringing it to me.&quot;   &lt;br&gt;
    
    //Reward: 100sp//&lt;br&gt;
(set:$sp to it + 100)
  ]
]

}&lt;br&gt;
[[Continue-&gt;Unferth Quest Hub]]</tw-passagedata><tw-passagedata pid="280" name="Tell Unferth bandit info" tags="" position="4450,1375" size="100,100">(display: &quot;header&quot;)

You currently have no information on the bandit leader.

[[Back-&gt;Unferth Quest Hub]]</tw-passagedata><tw-passagedata pid="281" name="Throne Intro" tags="" position="5200,250" size="100,100">(display: &quot;header&quot;)(set:$effort to 7)(display:&quot;Effort&quot;)
You take a deep breath and make your way through the bustling hall, weaving between tables and stepping over the rushes on the floor. The atmosphere is thick with the mingling scents of roasted meat, spiced ale, and burning wood. The closer you get to the dais, the more aware you become of the weight of eyes on you. Conversations hush, and curious glances follow your progress. As you approach the thrones, you catch sight of King Hrothgar, his presence imposing even amidst the grandeur of the hall. Beside him, Queen Wealhtheow watches with an air of serene authority.

Stopping a respectful distance from the thrones, you bow deeply, introducing yourself and offering your services to the court.

Hrothgar leans forward, his sharp eyes scrutinizing you. His lips curl into a faint smile, perhaps amused by your boldness or intrigued by your potential. “And what skills do you bring? What makes you think you can help where others have failed?”

You straighten, feeling the weight of the moment. The hall is silent now, all attention focused on you. With a steady voice, you respond, ready to declare your prowess in the way that you think will most impress the king.

[[Boldly approach the King and declare yourself a great skald, here to entertain the court and compose an ode to the greatness of Heorot-&gt;Roll: Bard it up in Heorot!]]
[[Offer your skills as a warrior-&gt;Roll: Combat skills boast]]
[[Offer your skills as a diplomat in seeking a peaceful solution-&gt;Offer king advice]]</tw-passagedata><tw-passagedata pid="282" name="Thryth Hub" tags="" position="2900,2875" size="200,100">(display: &quot;header&quot;)(set:$effort to 5)(display:&quot;Effort&quot;)

Thryth farmstead consists of a single timber  great house and a bunch of long barracks and smaller outlying sheds, vast fields planted to neat rows of bright green barley, rye, and wheat.

The fields are worked by dozens of men, clearly thralls, who work in rows, bound together with rope, and supervised by mounted overseers who wander among them.

(if:$reputation&#39;s &quot;Thryth&quot; is &quot;high&quot;)[

You are led into a spatious parlor in a high-ceilinged wooden hall, not huge but finely appointed. 
](else:)[

]
Sir Thryth is tall and broad-shouldered, clad in fine garments and wearing a large silver cross around his neck. He faces you with a neutral expression, his eyes cold and calculating. He is at all times flanked by a pair of burly and capable-looking men at arms.

(if:$reputation&#39;s &quot;Thryth&quot; is &quot;high&quot;)[
there are servants and stuff and they serve you nice food

{
(for: each _item, ...$thrythLarder)[
---
(print: &quot;name&quot; of _item) | (link: &quot;description&quot; )[(print: &quot;description&quot; of _item)] | (link:&quot;take&quot;)[ 
	(set: $purchaseItem to _item)
    (set: $purchaseCategory to $food)
    (set: $churchLarder to it - (a:_item))
    (display: &quot;Purchase confirmation&quot;)
    ]

]
---
}

](else:)[
]

[[Ask Sir Thryth about the attack]]
[[Ask to speak with the thralls]]&lt;br&gt;
[[Ask to examine the scene-&gt;Examine Thryth Scene]]
{
(if:$completedQuests contains &quot;Help Marta and her children&quot;)[](else:)[
[[Ask to speak with the overseer&#39;s family-&gt;Ask Marta]]&lt;br&gt;
]
(if:$activeQuests contains &quot;Help Marta and her children&quot;)[
[[Ask to take Marta and her children back to the village]]&lt;br&gt;
]
(if: $ThrythInvestigation &gt; 80)[
()
[[Return to Heorot to report to Unferth-&gt;Make for Heorot Hall]]&lt;br&gt;
[[Confront Sir Thryth about his cruelty]]&lt;br&gt;
]
[[Depart for Kattinge/Heorot-&gt;Village Hub]]&lt;br&gt;
}
</tw-passagedata><tw-passagedata pid="283" name="Torsten Forest Trip Prep" tags="" position="2325,2325" size="100,100">(display: &quot;header&quot;)

Torsten tells you to take your time and prepare yourself mentally and physically. Whenever you are ready, you can meet him here at the great oak at dawn.

[[Continue-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="284" name="Torsten Forest Trip Query" tags="" position="2525,2225" size="100,100">(display: &quot;header&quot;)
Intrigued by Torsten&#39;s connection to the land and his observations, you ask if he would be willing to guide you to the forest, to show you firsthand the changes he&#39;s noticed.

Torsten looks at you for a long moment, his eyes reflecting a lifetime of knowledge and respect for the natural world. Finally, he nods slowly. &quot;I will take you,&quot; he says, his voice carrying a note of solemnity. &quot;But you must tread lightly and with respect. The forest, especially now, is a place of deep mystery and ancient energies. What we find there may not always welcome human intrusion.&quot;

Torsten eyes the weapon at your belt and meets your eyes. “A show of drawn steel or malicious magic is likely to make a very bad impression, do you understand? Perhaps fatally bad.&quot;

&quot;I will offer certain gifts and incantations, as prescribed by the ancient agreements between our elders and the sceadugenga in old times. Please follow my lead and we should meet with no harm.”
(set:$effort to 3)(display:&quot;Effort&quot;)
[[Isn&#39;t paganry forbidden by law?-&gt;Torsten pagan pushback]]

[[Tell Torsten you need more time to prepare for the trip-&gt;Torsten Forest Trip Prep]]

[[Agree to follow Torsten’s lead and not bare a weapon in the Shadow Walksers’ domain-&gt;Journey Into the Forest]]</tw-passagedata><tw-passagedata pid="285" name="Torsten Guide" tags="" position="2725,2075" size="100,100">(display: &quot;header&quot;)
You ask Torsten about any changes in the natural world that might be attributed to Grendel. His eyes, reflecting years of observing the land, grow distant as he replies, &quot;The land speaks, for those who listen. The forests grow quieter, the animals more restless. It&#39;s as if the earth itself senses a disturbance, a disharmony. It&#39;s subtle, but it&#39;s there, like a faint echo of something ancient and troubled.&quot;


[[Ask Torsten to Guide you in the forest-&gt;Torsten Forest Trip Query]]</tw-passagedata><tw-passagedata pid="286" name="Torsten pagan pushback" tags="" position="2675,2400" size="100,100">(display:&quot;header&quot;)
&quot;Torsten, isn&#39;t what you&#39;re proposing forbidden paganry and witchcraft? Hrothgar has declared such practices punishable by death.&quot;

Torsten meets your gaze steadily, the lines on his weathered face deepening. &quot;I understand your hesitation,&quot; he replies softly. &quot;But consider this: before Hrothgar&#39;s edicts, before the rise of new faiths and laws, our people lived in harmony with these lands. The old ways are not mere superstition; they are the threads that weave us into the fabric of this world.&quot;

He gestures toward the distant forest, its edge shrouded in mist. &quot;The trees, the rivers, the very stones under our feet—they all hold memories and spirits older than any king&#39;s decree. The Sceadugenga are part of that ancient balance. They are not demons or beasts, but guardians of the wild places.&quot;

Torsten steps closer, his eyes reflecting a deep-seated passion. &quot;Hrothgar&#39;s fear stems from what he does not understand. In his quest for power and control, he seeks to reshape the world to fit his vision, disregarding the wisdom of our ancestors. But some knowledge should not be cast aside so lightly.&quot;

He pauses, his gaze searching yours. &quot;I am not asking you to defy the king openly, nor to abandon your beliefs. I only ask that you open your heart to possibilities beyond what you&#39;ve been told. Together, we can perhaps bridge the divide that threatens to consume us all.&quot;

&quot;If we persist in ignorance and aggression, more blood will be shed—on both sides,&quot; Torsten continues, &quot;But if we are brave enough to seek a different way, to listen instead of command, perhaps we can still avert the darkness that looms over this lands.&quot;

(set:$effort to 3)(display:&quot;Effort&quot;)
[[Agree to follow Torsten&#39;s lead and journey into the forest-&gt;Journey Into the Forest]]
[[Ask for more time to consider-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="287" name="Torsten&#39;s Execution" tags="" position="5300,1900" size="100,100">(display: &quot;header&quot;)
(set: $grendelComes to true)
Back at Heorot the air is thick with anticipation and unease as word of Torsten&#39;s arrest spreads. Hrothgar, his face a mask of grim determination, orders the gathering of villagers in the marketplace for the public judgment. You follow the throng of people, the weight of what is to come heavy in the air.

The marketplace, usually bustling with trade and conversation, falls into an eerie silence as the villagers gather. Torches cast a flickering light on the scene, and the cold night air bites at your skin. Torsten, bound and flanked by guards, stands before King Hrothgar, who is seated on a makeshift dais, his expression one of unyielding resolve.

Hrothgar rises, his voice echoing through the marketplace. “People of Heorot, we stand united against the threats that seek to destroy us. Grendel and his kin, the Sceadugenga, are but one of many dangers we face. Yet even within our walls, there are those who would betray us.”

He gestures to Torsten, his voice growing colder. “This man, Torsten, an elder of our village, sought to consort with our enemies through pagan rituals. Such actions endanger us all and cannot be tolerated.”

Torsten, his face pale but resolute, speaks up. “I only sought to understand, to find a way to protect us without further bloodshed. Violence alone will not save us, Hrothgar. We need to find another way!”

Hrothgar’s eyes blaze with anger. “Your methods threaten to undermine our strength and unity. We cannot afford to show weakness or indecision. For your betrayal, there is only one punishment.”

The crowd holds its breath as Hrothgar raises his hand. “Torsten, you are sentenced to death. May this serve as a warning to all who would endanger Heorot with their reckless actions.”

Torsten&#39;s eyes meet yours briefly as, with a single swift motion, Hrothgar draws his own sword and, taking a long step forward, makes a long sweeping arc. The crowd is caught unaware at the suddenness of the execution, and several gasps and a loud scream are heard as Torsten&#39;s head rolls free in a gout of blood, his body falling to its knees before slumping to the side.

“Let this be a lesson to all,&quot; Hrothgar declares in a ringing, sonorous voice. He draws a crimson handkerchief from his belt hand wipes the blood from his sword before dropping it.

&quot;Heorot will not tolerate betrayal or weakness. We stand strong against our enemies, both within and without.”

The crowd begins to disperse, some murmuring in puzzlement and surprise, others righteous and angry, some laughing drunkenly.

(if:$reputation&#39;s &quot;Unferth&quot; is not &quot;unknown&quot;)[
Then Unferth is at your side, his face ashen. “You’ve seen now the harsh realities of our struggle. Remember this, bard. Heorot’s survival depends on our strength and unity, even when the choices are difficult.”
]

[[Visit the Elders-&gt;Elders Post Execution]]
[[Drink yourself to sleep at Heorot-&gt;Grendel Attack]]
[[Drink yourself to sleep at the Inn-&gt;Inn Post Execution]]
[[Sleep at the Church-&gt;Church Post Execution]]

[[Continue-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="288" name="Try to navigate back to Heorot" tags="" position="4125,2575" size="100,100">(display: &quot;header&quot;)
You must try and sail back to shore! rough times. 

---
{(set: _success to (round: ( (random: 1, 10)+ $energy/10)/2))(if: $misc contains (dm:
    &quot;name&quot;, &quot;Njörðr&#39;s Charm&quot;,
    &quot;price&quot;, 95,
    &quot;description&quot;, &quot;An amulet engraved with the symbol of Njord, the Norse god of the sea and seafaring, enhancing your skills in navigation and sea travel.&quot;,    &quot;bonus&quot;,&quot;Seafaring and navigation +3&quot;
))[(set:_success to it + 3)]}
Your success: _success / 10!
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]
---
(if: _success &gt; 5 )[
(set: $achievements to it + (a:&quot;Captained the boat safely back to shore.&quot;))

[[Inn Hub]]
](else:)[

So sad, you drowned in the sea and/or were eaten by monsters :&#39;(
**Game Over try again!**


]</tw-passagedata><tw-passagedata pid="289" name="Try to speak to the voices" tags="" position="2150,3425" size="100,100">(display: &quot;header&quot;)(set:$effort to 10)(display:&quot;Effort&quot;)

&quot;Hello?&quot; you call out to the voices. It is hard to tell in the indistinct jumble, but it seems to you that some of the voices pause, as if they heard you, but many continue along unchanged, and the continuous shifting of the soundscape makes it hard to tell if there was any genuine response.

You experiment a few more times, but are unable to tell conclusively whether the unseen speakers can hear you.</tw-passagedata><tw-passagedata pid="290" name="Try to wrestle the chest from Bjorn and throw it into the sea, hoping to appease the serpents and rid yourself of the cursed artifact." tags="" position="4225,2725" size="100,100">You know you must act quickly. The serpents&#39; presence is making the situation more dangerous by the moment, and Bjorn&#39;s madness could get everyone killed. You nod to your companions, and they understand immediately. It&#39;s time to take decisive action.

&quot;Get ready,&quot; you whisper to Ciar, Edda, and Hroald. They move into position, ready to back you up. You grab the chest, trying to wrestle it from Bjorn&#39;s grip. His eyes widen in surprise and anger, and he tightens his hold, snarling.

&quot;No, you don&#39;t!&quot; Bjorn shouts, struggling to keep control of the chest.

You take a deep breath and summon all your strength, preparing for a contest of sheer will and power.

---
(set: _success to (round: ( (random: 1, 10)+ $energy/10)/2))
(if: $misc contains   (dm:
&quot;name&quot;, &quot;Tyr&#39;s Battle Emblem&quot;,
&quot;price&quot;, 45,
&quot;description&quot;, &quot;A sturdy emblem engraved with the symbol of Tyr, the Norse god of war.&quot;,
&quot;bonus&quot;,&quot;Melee weapon attacks +3&quot;
))[(set:_success to it + 3)]

Your success: _success / 10!
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]
---
(if: _success &gt; 7 )[
(set: $achievements to it + (a:&quot;defeated Bjorn at wrestling!&quot;))


With a final surge of effort, you manage to rip the chest from Bjorn&#39;s grasp. He stumbles back, nearly losing his balance as the boat rocks from the movement. You and your companions quickly move to the edge of the boat.

&quot;Now!&quot; you shout, and with a concerted effort, you heave the chest overboard. It splashes into the water, and the serpents immediately turn their attention to it, diving after the sinking box.

Bjorn wails, sobbing and waving his fist at the disappearing artifact. &quot;You fools! What have you done?&quot;

Ciar steps forward, her expression stern but compassionate. She pulls out a flask and hands it to Bjorn. &quot;Here, take this. It will help.&quot;

Bjorn snatches the flask and takes a long, trembling swig. The strong liquor seems to calm him down, and he finally lowers his fist, his shoulders slumping in defeat.

&quot;You... you did the right thing,&quot; he mutters, his voice choked with emotion. &quot;I just... I couldn&#39;t...&quot;

&quot;It&#39;s over now,&quot; you say gently. &quot;We did what we had to. Let&#39;s get back home.&quot;

Bjorn nods, wiping his eyes and taking another swig from the flask. He moves to the helm and begins steering the Seabird back towards the shore. The sea serpents have disappeared into the depths, following the chest, and the water is calm once more.

[[Back to shore]]

](else:)[

Despite your efforts, Bjorn&#39;s grip is unyielding. With a sudden, powerful shove, he knocks you backward. You stumble, losing your balance as the chest slams into your chest, knocking the wind out of you. You feel a sharp pain in your side as a rib cracks under the impact, and you fall to the deck, gasping for breath.

&quot;Stay down!&quot; Bjorn growls, his eyes wild with a mix of fury and madness. He yanks open the chest, revealing the horn inside. His eyes widen in rapture as he lifts it out, the strange translucent material glinting in the dim light.

&quot;Bjorn, no!&quot; Ciar shouts, but it&#39;s too late. Bjorn brings the horn to his lips and blows a long, haunting note. The sound is otherworldly, echoing across the water and sending a chill down your spine.

Suddenly, one of the massive eels, attracted by the sound, leaps out of the water. Its huge maw opens wide, revealing rows of sharp teeth, and it grabs Bjorn right off the deck. His scream is cut short as he&#39;s dragged into the depths, the horn falling from his grasp and clattering to the deck.

The boat rocks violently from the sudden movement, and you struggle to your feet, clutching your side. Your companions rush to your aid, their faces pale with shock and fear.

&quot;What do we do now?&quot; Edda asks, her voice trembling.

You look around, the reality of your situation sinking in. Bjorn is gone, and the boat is drifting aimlessly on the open sea. The serpents are still out there, their dark shapes moving beneath the surface.

&quot;We have to get back to Heorot,&quot; you say, your voice firm despite the pain. &quot;We can&#39;t stay out here.&quot;

Your companions nod, their resolve hardening. Together, you move to the helm, trying to recall the basic navigation skills you&#39;ve picked up over the years. The waves are growing rougher, and the wind is picking up, making the task even more challenging.

Despite the loss of Bjorn and the threat of the sea serpents, you must find a way to navigate back to the safety of the village. With no other choice, you take the helm and begin steering the boat back towards the distant shore, hoping against hope that you can make it back safely.

[[Try to navigate back to Heorot]]
]</tw-passagedata><tw-passagedata pid="291" name="Under Attack at Torsten&#39;s" tags="" position="5525,4000" size="100,100">(display: &quot;header&quot;)
Unferth steps forward, his gaze fixed on you. &quot;What is the meaning of this? Where do you think you are going with that chest?&quot;

Hrothgar&#39;s expression is equally severe, his hand resting on the hilt of his sword. &quot;Explain yourselves, or face the consequences.&quot;

You glance at your companions, tension radiating from each of them. The situation is precarious, and you know that your next move will determine your fate.

Options:

[[Step forward and tell Unferth you’ve succeeded in drawing out the traitors as he assigned you!]]

[[Step forward and try to explain to Hrothgar and Unferth the importance of returning the horn]]

[[You see a weak point in their defenses leading to the forest, although you’ll be exposed to arrows as you flee. Draw your weapon, order your companions to charge, perhaps you can survive and escape]]</tw-passagedata><tw-passagedata pid="292" name="Unferth Convo Hub" tags="" position="4250,1000" size="200,200">(display: &quot;header&quot;)(set:$effort to 0)(display:&quot;Effort&quot;)

Unferth gestures to a quieter corner of the hall, away from the noise and bustle. His demeanor is calm and collected, a stark contrast to the boisterous warriors and the stern Hrothgar. “Walk with me, if you will. I’d like to know more about you and your journey.”

[[Express your ambition for glory as a skald-&gt;Express a Desire for Fame]]
[[Mention a personal quest to understand the Grendel conflict-&gt;Mention a Personal Quest]]
[[Inquire about the nature of Unferth’s role at court-&gt;Probe Unferth’s Role]]
[[Inquire about Unferth’s unusual armor]]
(if: $achievements contains &quot;Watched Unferth slay the competition.&quot; and $reputation&#39;s &quot;Unferth&quot; is &quot;trusted&quot;)[
[[Discuss the duel with Unferth]]
]
(if:$activeQuests contains &quot;Slip Aeschere&#39;s holy water into Unferth&#39;s drink&quot;)[
[[Tell Unferth about Aeschere&#39;s plot to poison him]]
]
[[Inquire about Grendel and the attacks]]
[[Inquire About the Other Threats-&gt;Inquire About the Other Threats]]
(if:$reputation&#39;s &quot;Unferth&quot; is &quot;trusted&quot;)[
[[Discuss business...-&gt;Unferth Quest Hub]] ](else:)[
[[Express a desire to aid Heorot-&gt;Express Your Desire to Aid Heorot]]]
[[Excuse yourself and circulate the hall-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="293" name="Unferth Quest Hub" tags="" position="3725,1650" size="200,200">(display: &quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)

&quot;It is so rare to find someone with both the will and the capability to assist,&quot; Unferth reflects dramatically, pausing to nod slowly as if musing over something ironic. &quot;There are several ways you might aid Heorot. Each task comes with its own risks. The rewards are commensurate with the dangers involved.&quot;

He leans in slightly, his voice dropping to a confidential tone. &quot;However, you must not let the priest, Aeschere, know of our arrangements. He is... zealous, and our methods might not align with his rigid doctrines.&quot;

(set: _quest to &quot;Recruit a party&quot;)
(if: $completedQuests does not contain _quest)[
[[Discuss quest: Recruit a party]]  ]
[[Discuss quest: Locate sources of Sceadugenga magic]]
(if: $completedQuests contains _quest) [
[[Discuss quest: Investigate the attack on Thryth farmstead]]
[[Discuss quest: Find the Dragon&#39;s Lair]]
[[Discuss quest: Dispose of the Relic]]

]

[[Continue-&gt;Unferth Convo Hub]]</tw-passagedata><tw-passagedata pid="294" name="Unferth duel aftermath" tags="" position="3075,1225" size="100,100">(display:&quot;header&quot;)
Gasps and murmurs ripple through the crowd. Women avert their gazes, some stifling cries, while the men exchange uneasy glances. A few offer polite applause, but there&#39;s a palpable distance—a recognition of Unferth&#39;s lethal skill mingled with a discomfort at the cold efficiency of his actions.

Unferth does not even glance at the fallen nobleman, but turns back toward the servant, who stands with a stunned look on her face, holding Unferth&#39;s legendary sword in front of her stiff armed, as if it might turn into a snake.
&quot;Thank you, my dear,&quot; he says, taking the sword with another bow.
Without another word, he turns with a sweep of his black cloak and makes toward the periphery of the hall.

King Hrothgar observes the scene, a faint smile playing on his lips. He makes no comment, his eyes reflecting a complex mix of amusement and tacit approval. The hall gradually resumes its prior activity, though the atmosphere remains subdued.

The prince&#39;s retinue gather his body, their faces contorted with suppressed anger and helplessness. They cast wary glances at Unferth but make no move against him. The laws of the hall—and the undeniable outcome of a fair duel—leave them with little recourse.

[[Continue-&gt;Heorot Hub]]</tw-passagedata><tw-passagedata pid="295" name="Unferth music introduction" tags="" position="4550,650" size="100,100">(display: &quot;header&quot;)
As the hall settles back to its usual revelry following the attention, a tall, pale man wearing a black cloak over gleaming black armor approaches you through the crowd, several thanes stepping aside in deference. His sharp eyes study yours.’

“Your song was impressive,” he says, his voice measured and calm. “It’s rare to hear such skill and artistry in these parts. May I ask, from whence you hail?”

You get the sense that this conversation carries more weight than simple curiosity. He seems to be evaluating you, measuring your worth beyond the music.

You nod, grateful for the recognition. “I am a skald from the Scylding lands, a wanderer who seeks to share stories and songs of valor and history.”

The man smiles slightly, his eyes never leaving yours. “Ah, a fellow lover of tales. I am Unferth, one of King Hrothgar’s thanes. It is my duty to keep an eye on the happenings within the hall and beyond, to ensure the safety and prosperity of our kingdom.”

[[Continue-&gt;Unferth Convo Hub]]</tw-passagedata><tw-passagedata pid="296" name="Unferth sword introduction" tags="" position="4600,725" size="100,100">As the hall settles back to its usual revelry, a tall, pale man wearing a black cloak over gleaming black armor approaches you through the crowd, several thanes stepping aside in deference. His sharp eyes study yours.

“Your skills are impressive,” he says, his voice measured and calm.  May I ask, from whence you hail?”

You get the sense that this conversation carries more weight than simple curiosity. He seems to be evaluating you, measuring your worth beyond the battle.

You nod, grateful for the recognition. “I am a warrior from the Scylding lands, a wanderer who seeks to lend my strength to those in need and to prove my valor in the face of danger.”

The man smiles slightly, his eyes never leaving yours. “Ah, a fellow warrior. I am Unferth, one of King Hrothgar’s thanes. It is my duty to keep an eye on the happenings within the hall and beyond, to ensure the safety and prosperity of our kingdom.”

[[Continue-&gt;Unferth Convo Hub]]</tw-passagedata><tw-passagedata pid="297" name="Village Hub" tags="" position="2050,275" size="200,200">(display: &quot;header&quot;)(set:$effort to 3)(display:&quot;Effort&quot;)
(set: _loreKey to &quot;The elders of Kattinge Village gather near the well.&quot;)
You stand at the crossroads at the edge of Kattinge Village. The sky hangs low with heavy gray clouds, and the cries of gulls pierce the distant rush of waves against the rocky shore beyond the protection of the small harbor.

The fortified bulk of Heorot Hall, famed mead hall of King Hrothgar, looms atop the seacliffs.

Along the docks, fishermen mend nets and clean their catch. From the harbor, traders make their way up the road toward the castle-town market.

Not far up the road you notice a long building bearing a sign with a drinking horn, evidently an inn or public house. Beside it is a stable, with a number of horses grazing in a small pasture behind.

In the other direction, a small stone church stands at the far edge of the village, away from the bustle of the docks and the road to the castle.

{
(if:$knownLore contains _loreKey)[In the distance, up the hill, an old oak towers against the sky, and you can make out the outline of an old well. A thin waft of smoke rises from a small cook-fire.&lt;br&gt;]

(if: $knownLore contains _loreKey)[
  (if: $betrayedTorsten is true)[
	[[Make for the Elder&#39;s meeting spot atop the hill-&gt;Elders Post Execution]]&lt;br&gt;
  ](else:)[
	[[Make for the Elder&#39;s meeting spot atop the hill-&gt;Elders Approach]]&lt;br&gt;
  ]
]
}
[[Make for Heorot Hall]]
[[Head for the castle town market-&gt;Market Hub]]
[[Visit the inn and stable-&gt;Visit the inn]]
[[Approach the fishermen]]
[[Head toward the church-&gt;Head to the church]]
[[Explore the outskirts of the village-&gt;Outskirts]]
(if: $activeQuests contains &quot;Investigate Thryth Farmstead&quot;)[
[[Set out for Thryth farmstead]]
]</tw-passagedata><tw-passagedata pid="298" name="Visit the inn" tags="" position="625,825" size="100,100">(display: &quot;header&quot;)
(set:$effort to 5)(display:&quot;Effort&quot;)
The public drinking house stands prominently along the road, a beacon of warmth and revelry against the gathering dusk. The entrance is marked by a simple sign, a wooden board hanging from an iron bracket. The sign bears the image of a drinking horn, a common symbol for a place of gathering and refreshment. The path leading to the door is well-trodden.

The building itself is a sturdy, timber-framed structure, its weathered wooden beams darkened by age and the elements, the roof is steeply pitched and covered with thatch. The heavy wooden door is slightly ajar, allowing the sounds of merriment to escape.

Outside the drinking house, a few villagers linger, conversing in low tones. A couple of horses are tied to a nearby post, their harnesses jingling softly as they shift and snort.

The sounds from inside grow louder as you approach—the laughter and chatter of patrons, the clinking of mugs, and the occasional burst of song. The air carries the scent of roasted meat.

Next to the inn is a stable. Though it is small, quite a few horses graze in the pasture visible from the road.
[[Enter the inn-&gt;Inn Hub]]
[[Inquire about purchasing a horse]]
[[Continue exploring the village-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="299" name="Vow to defeat Eirkr and free Véfrøðr" tags="" position="2300,4925" size="100,100">(display: &quot;header&quot;)
&quot;We agree to your plan,&quot; you tell Véfrøðr. &quot;If we can render you docile with the potion, it will remove a significant threat and give us the element of surprise. We&#39;ll need to return to Heorot to acquire the sleeping draught.&quot;

&quot;Camp again here upon your return,&quot; Véfrøðr says. &quot;I will check here each night.&quot;

(set:$activeQuests to it + (a:&quot;Liberate Véfrøðr&quot;))
(set:$reputation&#39;s &quot;Véfrøðr&quot; to &quot;trusted&quot;)
[[Ask another question...-&gt;Dragon Convo Hub]]
[[Set Out for Heorot Immediately-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="300" name="Wait and watch fen creature" tags="" position="2175,4125" size="100,100">(display: &quot;header&quot;)
The creature continues to glide forward, now only 20 feet feet from the water&#39;s edge.

&quot;(print:$name), watch out!&quot; cries Ciar, but you are entranced by the sight of the creature&#39;s form now visible beneath the water. It&#39;s skin is smooth and covered in rippling patterns, and you can see its tremendous bulk looming in the murk below the surface of the water. It&#39;s head is wide and spade-shaped, and traced with strange ridges.

As you watch, the creature&#39;s head rises from the water, so smoothly it makes barely a splash. A row of teeth, uniform and razor sharp, are barely visible the edge of it&#39;s huge mouth, which is easily as wide as the span of your outsretched arms.

Suddenly there is a great sideways thrashing as the creature pumps it&#39;s tell, and it comes forward, upward and out of the water towards you in a great wave, it&#39;s cavernous mouth yawning open to sieze you.

[[Retreat!-&gt;Run from frog]]</tw-passagedata><tw-passagedata pid="301" name="Wake up at the hearth" tags="" position="300,1825" size="100,100">(display:&quot;header&quot;)

You wake up at the hearth in the inn&#39;s common room, to the sound of the inn-keeper&#39;s daughter sweeping the night&#39;s refuse out of the open front door. The smell of fresh baking bread and the distant sounds of conversation waft in from the street.
//Energy restored to 100/100//
{
(set: $energy to 100)
(display:&quot;Find Rest&quot;)
}

[[Continue-&gt;Sit at the hearth]]</tw-passagedata><tw-passagedata pid="302" name="Wake up in the Inn" tags="" position="500,1600" size="100,100">(display:&quot;header&quot;)

You wake up in the inn and stumble outside to get some fresh air...
//Energy restored to 100/100//
{(set: $energy to 100)
(display:&quot;Find Rest&quot;)
}

[[Continue-&gt;Village Hub]]</tw-passagedata><tw-passagedata pid="303" name="Wake up in the private room" tags="" position="225,2150" size="100,100">(display:&quot;header&quot;)

You wake up in your swanky private room, feeling extremely refreshed!
//Energy restored to 125//
{(set: $energy to 125)(display:&quot;Initialize Larders&quot;)}

[[Continue-&gt;Private Room]]</tw-passagedata><tw-passagedata pid="304" name="What do you mean, they waged war?" tags="" position="3200,2300" size="100,100">(display: &quot;header&quot;)(set:$effort to 1)(display:&quot;Effort&quot;)
&quot;You&#39;ll see for yourself when you crest the next hill yonder,&quot; she says sadly. &quot;Our people have known for ages that this road you walk is the boundary between the valley, here, and the forest, there.&quot; She points carefully at the boundary as she speaks, as if explaining something to a child, not unkindly.

&quot;It&#39;s plain as day, but if you continue into the forest, you&#39;ll find even clearer signs, markers and warnings. The Sceadugenga do not intrude in our affairs if we leave them to theirs, but Thryth&#39;s men have ventured across the boundary, hunting, clearing and even burning the woods on other side. I have seen the smoke myself, although I have no notion why they would do such a thing.&quot;

[[Continue-&gt;Shephard convo]]</tw-passagedata><tw-passagedata pid="305" name="Wouldn&#39;t that render you very vulnerable? Why would you trust us that much?" tags="" position="3400,6425" size="100,100">(display:&quot;header&quot;)

Véfrøðr cocks his long head thoughtfully, weighing his words.
&quot;Well,&quot; he begins awkwardly, &quot;Yes, it really does. You might be able to kill me, although you should know it&#39;s not all that easy or all that safe to kill a dragon even if it can&#39;t wake up... But essentially, as you may have deduced, I&#39;m fairly desperate to escape this situation. Fairly desperate.

&quot;However, I don&#39;t think you will to kill me. I&#39;ll explain my reasoning. First, as you must realize, a living dragon allied to you and in your life-debt is much more valuable than a dead dragon. Infinitely so,&quot; he draws out the word. &quot;Infinitely.&quot;

&quot;Secondly, I think you&#39;ll be too prudent regarding the definite possibly that killing me before ending the curse would expose you its effects. I doubt that you are eager to end up serving Eirkr as one of his eternal guard? And you&#39;re surely knowledgable enough about curse lore to realize the danger there. I doubt that someone capable of defeating Eirkr would be so dishonorable to break an alliance and slay a friend while they llie sleeping. That itself would probably stick you with some kind of curse. I&#39;m a dragon after all.

&quot;Finally, I don&#39;t think you would have pointed out that it would make me vulnerable if you really wanted to kill me, would you? You&#39;d have acted like you would never think to attack me now that we are allies. But I do have to trust you, don&#39;t i? I won&#39;t actually know what you&#39;re going to do until it&#39;s too late; it&#39;s the essential irony of the plan.&quot;

[[Continue-&gt;Dragon Convo Hub]]</tw-passagedata><tw-passagedata pid="306" name="You see a weak point in their defenses leading to the forest, although you’ll be exposed to arrows as you flee. Draw your weapon, order your companions to charge, perhaps you can survive and escape" tags="" position="4875,3850" size="100,100">(display: &quot;header&quot;)
You See a Weak Point in Their Defenses Leading to the Forest, Although You’ll Be Exposed to Arrows as You Flee. Draw Your Weapon, Order Your Companions to Charge, Perhaps You Can Survive and Escape.

You assess the situation quickly, your eyes darting to a weak point in the enemy&#39;s formation where the guards seem less concentrated. With a deep breath, you draw your weapon and shout to your companions, &quot;Charge! Head for the forest!&quot;

The suddenness of your movement catches the guards off-guard, and you and your companions rush towards the gap. Arrows whiz through the air, one glancing off your helmet, making you see stars but leaving you otherwise unharmed.

Hroald lets out a fierce battle cry, swinging his axe as he fends off the guards. Edda uses her shield to deflect arrows, while Ciar calls to her raven to create a distraction. Lothar&#39;s imposing presence clears a path through the chaos.

You push through the gap, the sounds of battle echoing behind you. The forest looms ahead, dark and foreboding, but offering the promise of escape. You sprint towards the trees, your breath coming in ragged gasps, your heart pounding in your chest.

As you plunge into the dense underbrush, the shouts of the guards fade into the distance. You can no longer hear the clash of steel or the cries of your companions. The forest closes around you, the thick canopy above casting eerie shadows in the moonlight.

You clutch the artifact tightly, the weight of its importance driving you forward. The others&#39; sacrifice must not be in vain. You must return the horn to the Sceadugenga and hope it brings the peace you seek.

The forest is a labyrinth of twisted trees and dense foliage. You stumble over roots and push through thick undergrowth, every step taking you deeper into the unknown. The moonlight filters through the leaves, providing just enough light to navigate by.

Hours pass, and you realize you are hopelessly lost. The forest is silent except for the occasional rustle of leaves and the distant hoot of an owl. The air is cool and carries the earthy scent of moss and decay. You are in a small clearing and stop to catch your breath, the weight of your exhaustion pressing down on you. 

[[Continue-&gt;Forest wandering hub]]</tw-passagedata><tw-passagedata pid="307" name="_slink" tags="" position="275,1000" size="100,100"></tw-passagedata><tw-passagedata pid="308" name="addAchievement" tags="" position="325,1175" size="100,100">{
(if:$achievements does not contain $a)[
//Achievement: (print:$a)//
(set: $achievements to it + (a: $a))
]
}</tw-passagedata><tw-passagedata pid="309" name="destroy the cursed artifact" tags="" position="4375,2600" size="100,100">(display: &quot;header&quot;)
(set: $grendelComes to true)
The sun is just beginning to rise as you and your companions make your way down to the docks. The sky is painted with streaks of orange and pink, reflecting off the calm waters of the harbor. The air is crisp and salty, a welcome change from the musty confines of Heorot. The docks are quiet at this early hour, with only a few fishermen preparing their boats for the day&#39;s work.

You spot your contact, standing beside his boat. His skin is weathered from years at sea, and his hair, streaked with gray, falls in tangled waves over his broad shoulders. His eyes are a piercing blue, sharp and inquisitive, and he exudes a confident, almost reckless energy.

&quot;Good morning,&quot; Bjorn calls out, his voice carrying easily over the sound of the waves lapping against the dock. &quot;Are you ready for our little adventure?&quot;

You nod, stepping forward to greet him. &quot;Yes, we&#39;re ready. The sea is calm, and we should have a smooth journey.&quot;

Bjorn chuckles, clapping you on the shoulder. &quot;Calm seas are a rarity around here. We&#39;ll see how long that lasts.&quot; He gestures to his boat, a sturdy vessel with high sides and a wide deck. &quot;This is the Seabird. She&#39;ll take us where we need to go.&quot;

As you and your companions board the Seabird, you can&#39;t help but feel a sense of foreboding. The chest containing the cursed artifact is securely strapped under a seat near the bow. You recall Unferth&#39;s warning not to open the chest under any circumstances, and you feel a chill run down your spine.

Bjorn notices your discomfort and raises an eyebrow. &quot;You&#39;re carrying something important, aren&#39;t you? I&#39;ve seen that look before. Don&#39;t worry, I&#39;ve handled my fair share of precious cargo.&quot;

You nod, trying to maintain a calm demeanor. &quot;It&#39;s a task given to us by Unferth. We&#39;re to take this artifact out to sea and dispose of it. It&#39;s... dangerous.&quot;

Bjorn&#39;s eyes gleam with curiosity. &quot;Dangerous, you say? Now you&#39;ve piqued my interest. What sort of artifact are we talking about?&quot;

You hesitate, remembering Unferth&#39;s strict instructions. &quot;It&#39;s best not to discuss it. Just know that it&#39;s crucial we get it far from here.&quot;

Bjorn shrugs, seemingly satisfied for the moment. &quot;Fair enough. Let&#39;s get underway then.&quot; He begins to prepare the boat for departure, moving with the practiced ease of a seasoned sailor. You and your companions settle in, stowing your gear and taking up positions around the deck.

The Seabird glides out of the harbor, cutting through the water with surprising speed. The gentle rocking of the boat and the sound of the waves create a soothing rhythm, but you remain on edge, the weight of the chest a constant reminder of your mission.

As the shoreline fades into the distance and the sea stretches out before you, Bjorn&#39;s demeanor begins to change. He becomes more restless, his eyes darting to the chest on your back with increasing frequency. The calm, confident sailor you met at the docks is giving way to something more intense, almost predatory.

&quot;Tell me,&quot; Bjorn says, his voice low and insistent, &quot;what&#39;s really in that chest? I&#39;m the captain of this vessel, and I have a right to know what I&#39;m transporting.&quot;

You swallow hard, feeling the tension rise. &quot;Unferth instructed us not to open it. It&#39;s dangerous, Bjorn. It&#39;s best if we don&#39;t know more than that.&quot;

Bjorn&#39;s eyes narrow, and he steps closer, his presence suddenly intimidating. &quot;I&#39;m not just some errand boy, you know. If I&#39;m risking my life out here, I deserve to know what for. Show me the artifact. I can hear it... whispering to me. I need to see it.&quot;

You glance at your companions, who are equally on edge. Ciar, Edda, and Hroald exchange worried looks, their hands instinctively moving towards their weapons. The air is thick with tension, the gentle rocking of the boat now feeling more like a prelude to a storm.

&quot;Bjorn, please,&quot; you say, trying to keep your voice steady. &quot;My orders, from Hrothgar himself, are clear. We can&#39;t open the chest.&quot;

Bjorn&#39;s face darkens, his eyes flashing with anger. &quot;Orders be damned! I&#39;m the captain here, and I say we open it. Now!&quot;

He reaches out, his hand closing around the chest&#39;s latch, but you step back, pulling it out of his reach. &quot;No, Bjorn. We can&#39;t do that.&quot;

Bjorn&#39;s grip tightens on the edge of the chest, and his voice drops to a dangerous whisper. &quot;You&#39;re not listening to me, you can&#39;t even here the horn, the vessel of Grendel himself. It&#39;s calling to me! Now give it to me or I&#39;ll throw you all overboard and take it myself.&quot;

The threat hangs in the air, the tension palpable. You and your companions are skilled fighters, but none of you are sailors. Overpowering Bjorn might be possible, but navigating the Seabird back to shore in the increasingly choppy waters would be a different challenge altogether.

The water around the Seabird starts to churn, and you notice large, dark shapes moving just beneath the surface. The shapes are long and sinuous, reminiscent of gigantic eels or sea serpents, their movements sending shivers down your spine.

Bjorn&#39;s eyes widen with a mad gleam as he notices the creatures. &quot;Look there!&quot; he cackles, pointing at the water. &quot;We&#39;re not the only ones curious about what&#39;s in that chest. Seems the sea serpents want a look too!&quot;

The boat rocks violently as one of the massive serpents noses against the hull, the force nearly knocking you off your feet. The creature&#39;s enormous, dark eye peers up at you through the water, and you feel a cold dread settle in your stomach.

Bjorn&#39;s cackling grows louder, his grip on sanity seeming to slip. &quot;Show me the artifact! If you don&#39;t, these beasts will tear us apart!&quot;

The tension is at a breaking point. You can either try to throw the chest overboard despite Bjorn&#39;s resistance or give in to his demand and show him the artifact, hoping it will appease the sea serpents.


{
(set: _hasSword to false)
(set: _hasMail to false)
(for: each _w, ...$weaponsAndArmor)[
(if: _w&#39;s &quot;name&quot; is &quot;Fine Sword&quot;)[(set: _hasSword to true)]
(if: _w&#39;s &quot;name&quot; is &quot;Mail Shirt&quot;)[(set: _hasMail to true)]
]

Current energy: $energy
(if: _hasSword)[
[[Draw your sword and attempt to run Bjorn through]]
]
[[Try to wrestle the chest from Bjorn and throw it into the sea, hoping to appease the serpents and rid yourself of the cursed artifact.]]
[[Open the chest and give the artifact to the serpent]]
}</tw-passagedata><tw-passagedata pid="310" name="eat something" tags="" position="175,600" size="100,100">(if: $energy &lt; 100)[
{(set: _foodEnergy to 10)
(if: $foodToEat contains &quot;energy&quot;)[(set: _foodEnergy to $foodToEat&#39;s &quot;energy&quot;)]}
You consume a (print: $foodToEat&#39;s &quot;name&quot;) and gain (print: _foodEnergy) energy!
{
(set: $food to it - (a: $foodToEat))
(set: $energy to $energy + _foodEnergy)
}
](else:)[
You are already full (at max energy).
]</tw-passagedata><tw-passagedata pid="311" name="getNewQuest" tags="" position="50,1325" size="100,100">{
(set: $activeQuests to it + (a: $newQuest))
//Quest acquired: (print:$newQuest)//
}</tw-passagedata><tw-passagedata pid="312" name="go to torsten" tags="" position="4025,2900" size="100,100">(display: &quot;header&quot;)
Arriving at Torsten&#39;s Hut

As you approach Torsten&#39;s modest home, the early morning light casts long shadows across the cobblestone path. The scent of herbs and freshly turned earth fills the air, and a faint smoke rises from the chimney. You knock on the wooden door, and after a moment, it creaks open to reveal Torsten, his face lined with age and wisdom.

&quot;Ah, travelers,&quot; he greets you warmly, his eyes alight with curiosity. &quot;What brings you to my door at this early hour?&quot;

You explain the situation, showing him the chest and relaying Unferth&#39;s warnings. Torsten&#39;s expression grows serious as he listens, his eyes narrowing in thought.

&quot;This is indeed a grave matter,&quot; Torsten says, his voice somber. &quot;Come inside, and let us see what we can learn.&quot;

Torsten leads you into his home, a cozy space filled with the scent of herbs and the soft glow of candles. Shelves lined with ancient texts and artifacts adorn the walls, and a sturdy wooden table at the center of the room serves as his workspace. You place the chest on the table, its carvings and runes glowing faintly in the dim light.

Torsten examines the chest closely, his fingers tracing the intricate designs. &quot;These markings are of an ancient design,&quot; he murmurs. &quot;Pagan in origin, as Unferth mentioned. It is said that such artifacts were created to harness and control great power, often at a terrible cost.&quot;

He turns to you, his gaze serious. &quot;Let us open the chest and see what lies within.&quot;

With careful hands, Torsten unlatches the chest and lifts the lid. Inside, nestled in a bed of dark velvet, is a musical horn made of a strange, translucent substance. It gleams softly in the candlelight, the material appearing like metal but softer to the touch.

Torsten&#39;s eyes widen in recognition. &quot;This is no mere weapon. It is a sacred artifact, a musical horn belonging to the Sceadugenga. It must have been stolen by Hrothgar.&quot;

He lifts the horn gently, holding it up to the light. &quot;The Sceadugenga use these horns in their rituals to communicate with their ancestors and the spirits of the land. Returning it to them could be a gesture of goodwill, perhaps even a step towards peace.&quot;

Ciar, who has been silently observing, steps forward. &quot;The Sceadugenga are deeply connected to their traditions. If we return this horn, it might show them that we respect their ways and wish to avoid further conflict.&quot;

Hroald grunts in agreement. &quot;Aye, better to make peace than to face their wrath. But it won&#39;t be an easy journey. The Sceadugenga won&#39;t trust us right away.&quot;

Edda nods, her eyes serious. &quot;We must be careful and respectful. If we succeed, it could change everything.&quot;

Torsten places the horn back in the chest and looks at you. &quot;The decision is yours, but I believe returning this artifact is the right course of action. It may not be easy, but it could bring about a much-needed peace.&quot;

Options:

[[Agree to Return the Horn]]: Decide to undertake the journey to return the sacred horn to the Sceadugenga, hoping to foster peace between the two groups.

[[Decline and Seek Another Solution]]: Choose to find another way to deal with the artifact, wary of the potential dangers of approaching the Sceadugenga.</tw-passagedata><tw-passagedata pid="313" name="header" tags="" position="425,425" size="100,100">&lt;center&gt;&lt;h3&gt;Shadows of Grendel&lt;/h3&gt;&lt;/center&gt;
(align:&quot;==&gt;&quot;)[
 [[Character Sheet]] [[Plot log]] [[Games Dashboard]] 
]</tw-passagedata><tw-passagedata pid="314" name="initialize" tags="" position="50,175" size="100,100">{
(display:&quot;Initialize Plot&quot;)
(set: $lastScene to &quot;Start&quot;)
(set:$recruitedParty to false)
(set: $health to 100)
(set: $energy to 65)
(set: $sp to 25)


(set:$horses to (a:))
(set: $food to (a: 
(dm: &quot;name&quot;, &quot;a crumb of stale bread&quot;, &quot;description&quot;,&quot;tough but still edible&quot;),
(dm: &quot;name&quot;, &quot;a bit of old cheese&quot;, &quot;description&quot;, &quot;what kind of cheese even was this originally?&quot;)
))

(set: $weaponsAndArmor to (a:))
(set: _knife to (dm:  &quot;name&quot;, &quot;Simple dirk&quot;, &quot;description&quot;, &quot;Sturdy-bladed dagger for general utility and basic self-defense.&quot;, &quot;type&quot;, &quot;utility&quot;, &quot;combat&quot;,1, &quot;armor&quot;, 0))
(set: $weaponsAndArmor to it + (a: _knife))

(set: $survivalGear to (a:
(dm: &quot;name&quot;, &quot;Bed roll&quot;, &quot;description&quot;, &quot;a thick wool blanket that smells a lot like you.&quot;),
(dm: &quot;name&quot;, &quot;Water skin&quot;, &quot;description&quot;, &quot;Crafted from the hide of a reindeer, this water skin is supple yet durable. Its surface is adorned with faded runes meant to ward off thirst and flux. The stopper is a carved piece of antler, fitting snugly to prevent leaks.&quot;)
))

(set: $craftAndLetters to (a:

(dm: &quot;name&quot;, &quot;Lyre of Yew&quot;, &quot;description&quot;, &quot;Your most prized possession, this lyre is carved from the heartwood of an ancient yew tree believed to hold mystical properties. Its curved frame is smooth to the touch, and the arms are delicately inlaid with bits of mother-of-pearl forming swirling designs reminiscent of the northern lights. The seven strings, made from sheep gut, produce a haunting and melodious sound that captivates listeners. The lyre has not only been your tool for storytelling but also a key to unlocking doors and hearts otherwise closed to strangers.&quot;),

(dm: &quot;name&quot;, &quot;Writing Kit&quot;, &quot;description&quot;, &quot;Contained within a slender leather case, your writing kit includes a finely cut goose feather quill, a small ceramic ink pot sealed with wax to prevent spills, and several sheets of vellum made from calfskin. The parchment is of good quality, suitable for composing important verses or recording significant events. A strip of red ribbon keeps everything neatly bundled. This kit allows you to immortalize stories, ensuring that deeds of valor and tales of wonder are not lost to time.&quot;),

(dm: &quot;name&quot;, &quot;Letter of patronage from Jarl Erik Wolfsson of Skjolden&quot;, &quot;description&quot;, &quot;A parchment bearing the seal of a wolf&#39;s head howling at the moon, stamped in silver wax. The letter expresses appreciation for your performances during the Jarl&#39;s winter feast, and urges any who read the letter to grant you the hospitality and respect befitting a Skald of great talent.&quot;),

(dm: &quot;name&quot;, &quot;Letter of patronage from Astrid, Queen of Ytre Sula&quot;, &quot;description&quot;, &quot;An elegant scroll sealed with a golden sun rising over the sea. Queen Astrid personally thanks you for composing and performing a moving elegy for her late husband, King Harald. She notes that your song brought comfort to her and her court in a time of mourning. The queen officially declares you a favored guest in any of her island territories.&quot;),

(dm: &quot;name&quot;, &quot;Map of the Northlands&quot;, &quot;description&quot;, &quot;An expansive map drawn on weathered parchment, edges slightly tattered from constant use. It details the rugged coastlines, dense forests, and towering mountains of the region.  Marginal notes in your own careful script indicate safe passages, friendly villages, and warnings about treacherous paths.&quot;),
))
(set: $misc to (a:
(dm: &quot;name&quot;, &quot;Silver Signet Ring&quot;, &quot;description&quot;, &quot;Worn on the middle finger of your left hand, this ring is unadorned save for the engraving of a raven in flight—a symbol associated with Odin Allfather, patron of Skalds. The silver is slightly tarnished but still gleams when it catches the light. The ring was bestowed upon you by your mentor upon completing your apprenticeship.&quot;)
))
(set: $clothingAndAccessories to (a:
(dm: &quot;name&quot;, &quot;Linen Tunic and Woolen Trousers&quot;, &quot;description&quot;, &quot;Your tunic is made of sturdy flax linen, dyed a deep indigo blue, your trousers are of thick wool, undyed and practical, tucked into your boots to keep out the chill.&quot;),

(dm: &quot;name&quot;, &quot;Heavy Wool Cloak&quot;, &quot;description&quot;, &quot;This cloak, woven from dark green wool, drapes heavily over your shoulders, providing warmth and a measure of concealment. The hood is deep, capable of shadowing your features—a useful feature when you prefer to move unnoticed. Its hem shows signs of wear, frayed slightly from countless adventures.&quot;),

(dm: &quot;name&quot;, &quot;Leather Traveling Boots&quot;, &quot;description&quot;, &quot;Crafted years ago by the cobbler of your home town, these tough leather boots have carried you across rugged mountains, muddy trails, and the streets of many towns and cities. Inside, they are lined with soft rabbit fur for warmth.&quot;)

))
(set: $inventory to (a: $clothingAndAccessories, $survivalGear, $craftAndLetters, $weaponsAndArmor, $Misc))

(set: $rolls to (a:))
(set: $reputation to (dm:
    &quot;Heorot Court&quot;, &quot;unknown&quot;,
    &quot;Unferth&quot;, &quot;unknown&quot;,
    &quot;Village Elders&quot;, &quot;unknown&quot;,
    &quot;Adventurers&quot;, &quot;unknown&quot;,
    &quot;Eir&quot;, &quot;unknown&quot;,
    &quot;Aeschere&quot;, &quot;unknown&quot;,
    &quot;Hrothulf&quot;, &quot;unknown&quot;,
    &quot;Aelfric&quot;, &quot;unknown&quot;,
    &quot;Innkeeper&quot;, &quot;unknown&quot;,
    &quot;Kattinge fishermen&quot;, &quot;unknown&quot;,
    &quot;Véfrøðr&quot;, &quot;unknown&quot;,
    &quot;Sceadugenga&quot;, &quot;unknown&quot;,
	&quot;Thryth&quot;, &quot;unknown&quot;
))
(display:&quot;Initialize items&quot;)
(display: &quot;Initialize smithy&quot;)
(display: &quot;Initialize Larders&quot;)
}</tw-passagedata><tw-passagedata pid="315" name="inquireCurseBreak" tags="" position="3050,6075" size="100,100">(display:&quot;header&quot;)

&quot;Is there a way to break the curse and free you from this bondage?&quot; you ask.

Véfrøðr&#39;s gaze holds a glimmer of hope tempered by resignation. &quot;There is a way, though it is fraught with peril. The curse is sustained by Eirikr&#39;s undead existence. As a Draugr Lord, he wields formidable dark magic and commands the Draugr. To break the curse, he must be destroyed.&quot;

It pauses, then continues solemnly. &quot;But know this: many have tried. All have failed. Eirikr&#39;s power has only grown over the centuries. Confronting him is no simple task.&quot;

[[Inquire About the Risks of Facing Such Dark Magic-&gt;AskAboutRisks]]
[[Continue-&gt;Dragon Convo Hub]]</tw-passagedata><tw-passagedata pid="316" name="questComplete" tags="" position="175,1225" size="100,100">{
&lt;br&gt;//Quest completed: (print:$doneQuest)//&lt;br&gt;
(set: $activeQuests to it - (a: $doneQuest))
(if:$completedQuests does not contain $doneQuest)[
(set:$completedQuests to it + (a:$doneQuest))
]
}
&lt;!--(set:$doneQuest to &quot;&quot;)(display:&quot;questComplete&quot;)--&gt;</tw-passagedata><tw-passagedata pid="317" name="updateCombatBonus" tags="" position="200,100" size="100,100">{
(set: $totalCombatBonus to 0)
(set: $totalArmorBonus to 0)
(for: each _item, ...$weaponsAndArmor)[
	(set: $totalCombatBonus to it + &quot;combat&quot; of _item)
    (set: $totalArmorBonus to it + &quot;armor&quot; of _item)
]
}</tw-passagedata><tw-passagedata pid="318" name="archeryRoll" tags="" position="1925,4350" size="100,100">(set: $success to  (random: 1, 10) + $energy/10)
(set: $success to it /2)
(set:$success to (round:it))
(if:$misc contains $archeryCharm)[(set:$success to it + 3)]
Your success: $success / 10!
(if: $energy &gt; 20)[(set: $energy to $energy - 20)]</tw-passagedata><tw-passagedata pid="319" name="silvertongueBonus" tags="" position="225,1375" size="100,100">(if:$misc contains $silvertongueCharm)[(set:$success to it+3)
//+3 bonus added from (print:$silvertongueCharm&#39;s &quot;name&quot;)//
]</tw-passagedata><tw-passagedata pid="320" name="tyrsEmblemBonus" tags="" position="100,1500" size="100,100">(if:$misc contains $tyrsEmblem)[(set:$success to it+3)
//+3 bonus added from (print:$tyrsEmblem&#39;s &quot;name&quot;)//
]
</tw-passagedata><tw-passagedata pid="321" name="Tell Unferth about Aeschere&#39;s plot to poison him" tags="" position="4325,1275" size="100,100">(display: &quot;header&quot;)(set:$reputation&#39;s &quot;Unferth&quot; to &quot;trusted&quot;)

He&#39;s really grateful!

[[Continue talking to Unferth-&gt;Unferth Convo Hub]]
</tw-passagedata><tw-passagedata pid="322" name="Ask Sir Thryth about the workers who were attacked" tags="" position="3050,3225" size="100,100"></tw-passagedata><tw-passagedata pid="323" name="Drink Seersmead at the stones" tags="" position="2300,3200" size="100,100">(display: &quot;header&quot;)(set:$effort to 10)(display:&quot;Effort&quot;)
{

(set: $food to it - (a: $seersMead))
(set: $energy to $energy +$seersMead&#39;s &quot;energy&quot;)
//Seiðrmjöð removed from inventory//
}

As the strange beverage burns its way from your stomach into your blood and brain, the colors and sounds in the fen around you seem to become more intense and vivid, and in particular the voices become more crisp and loud.

Almost at once the voices become more distinct, and all around you, you begin to see figures, translucent and silvery, emerge from nothing in the misty air around you. Now you are surrounded by speakers and singers, scholars and spell-casters, from times and places beyond your reckoning, cast into an ocean of stories and knowledge.

(if:$misc contains $protectionCharm)[

You grip the (print:&quot;name&quot; of $protectionCharm) tightly, although it now burns and thrums in your hand like the heart of a demon. You can feel the hungry wills behind many of the voices, predatory, calling out to you with false promises, luring you into the depths. Shielded from the deceptive magic laced through some of the voices in the stream, you are able to distinguish certain speakers as malevolent, others as apparently benign, expressing intent to share knowledge or curiosity about others.
{

(set:$lore to $standingStonesComms)(display:&quot;addLore&quot;)
}
[[Continue-&gt;Fen standing stones]]
](else:)[
You do your best to stay oriented, to recall your own story, your identity and the reality of your world, but the deluge of //other// stories, //other// realities sweeps them up and carries them along.

You are sucked down into the depths of madness by the whispering voices of hungry spirits calling through the void.
&#39;&#39;//Game Over//&#39;&#39;

]
</tw-passagedata><tw-passagedata pid="324" name="Draugr encounter" tags="" position="2775,4525" size="100,100"></tw-passagedata><tw-passagedata pid="325" name="Listen closely to the voices" tags="" position="2200,3275" size="100,100">(display: &quot;header&quot;)(set:$effort to 10)(display:&quot;Effort&quot;)

As you focus your intention on the faint voices and pace slowly around the circle, you can distinguish that some voices appear to be louder in some places, as though the speaker of each voice were located somewhere in the circle. The voices vary greatly, some masculine, some feminine, some old, some young, some strange and inhuman sounding. In a few places there is music or other strange sounds, a strange, rapid high pitched sqwuak of metallic tones. 
(set:$energy to it - 20)
As you listen, you pick up more and more streams of sound, but in no case are you able to keep hold of any stream for very long; as soon as you catch hold of it, it slips away, or is overshadowed by another.
[[Continue-&gt;Fen standing stones]]</tw-passagedata><tw-passagedata pid="326" name="addLore" tags="" position="375,1300" size="100,100">{
(if:$knownLore does not contain $lore)[
//Known lore added: (print:$lore)//
(set: $achievements to it + (a: $lore))
]
}</tw-passagedata></tw-storydata>
<script title="Twine engine code" data-main="harlowe">(function(){"use strict";
var require,define;!function(){var e={},r={};require=function(i){var n=e[i];return n&&(r[i]=n[1].apply(void 0,n[0].map(require)),e[i]=void 0),r[i]},(define=function(r,i,n){if("function"==typeof r)return r();e[r]=[i,n]}).amd=!0}();/*!
 * https://github.com/paulmillr/es6-shim
 * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
 *   and contributors,  MIT License
 * es6-shim: v0.35.4
 * see https://github.com/paulmillr/es6-shim/blob/0.35.3/LICENSE
 * Details and documentation:
 * https://github.com/paulmillr/es6-shim/
 */
(function(e,t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){"use strict";var e=Function.call.bind(Function.apply);var t=Function.call.bind(Function.call);var r=Array.isArray;var n=Object.keys;var o=function notThunker(t){return function notThunk(){return!e(t,this,arguments)}};var i=function(e){try{e();return false}catch(t){return true}};var a=function valueOrFalseIfThrows(e){try{return e()}catch(t){return false}};var u=o(i);var f=function(){return!i(function(){return Object.defineProperty({},"x",{get:function(){}})})};var s=!!Object.defineProperty&&f();var c=function foo(){}.name==="foo";var l=Function.call.bind(Array.prototype.forEach);var p=Function.call.bind(Array.prototype.reduce);var v=Function.call.bind(Array.prototype.filter);var y=Function.call.bind(Array.prototype.some);var h=function(e,t,r,n){if(!n&&t in e){return}if(s){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:r})}else{e[t]=r}};var b=function(e,t,r){l(n(t),function(n){var o=t[n];h(e,n,o,!!r)})};var g=Function.call.bind(Object.prototype.toString);var d=typeof/abc/==="function"?function IsCallableSlow(e){return typeof e==="function"&&g(e)==="[object Function]"}:function IsCallableFast(e){return typeof e==="function"};var m={getter:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:r})},proxy:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function getKey(){return e[t]},set:function setKey(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r;Object.defineProperty(e,t,n)}else{e[t]=r}},defineByDescriptor:function(e,t,r){if(s){Object.defineProperty(e,t,r)}else if("value"in r){e[t]=r.value}},preserveToString:function(e,t){if(t&&d(t.toString)){h(e,"toString",t.toString.bind(t),true)}}};var O=Object.create||function(e,t){var r=function Prototype(){};r.prototype=e;var o=new r;if(typeof t!=="undefined"){n(t).forEach(function(e){m.defineByDescriptor(o,e,t[e])})}return o};var w=function(e,t){if(!Object.setPrototypeOf){return false}return a(function(){var r=function Subclass(t){var r=new e(t);Object.setPrototypeOf(r,Subclass.prototype);return r};Object.setPrototypeOf(r,e);r.prototype=O(e.prototype,{constructor:{value:r}});return t(r)})};var j=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("unable to locate global object")};var S=j();var T=S.isFinite;var I=Function.call.bind(String.prototype.indexOf);var E=Function.apply.bind(Array.prototype.indexOf);var P=Function.call.bind(Array.prototype.concat);var C=Function.call.bind(String.prototype.slice);var M=Function.call.bind(Array.prototype.push);var x=Function.apply.bind(Array.prototype.push);var N=Function.call.bind(Array.prototype.join);var A=Function.call.bind(Array.prototype.shift);var _=Math.max;var R=Math.min;var k=Math.floor;var L=Math.abs;var F=Math.exp;var D=Math.log;var z=Math.sqrt;var q=Function.call.bind(Object.prototype.hasOwnProperty);var W;var G=function(){};var H=S.Map;var V=H&&H.prototype["delete"];var B=H&&H.prototype.get;var U=H&&H.prototype.has;var $=H&&H.prototype.set;var J=S.Symbol||{};var X=J.species||"@@species";var K=Number.isNaN||function isNaN(e){return e!==e};var Z=Number.isFinite||function isFinite(e){return typeof e==="number"&&T(e)};var Y=d(Math.sign)?Math.sign:function sign(e){var t=Number(e);if(t===0){return t}if(K(t)){return t}return t<0?-1:1};var Q=function log1p(e){var t=Number(e);if(t<-1||K(t)){return NaN}if(t===0||t===Infinity){return t}if(t===-1){return-Infinity}return 1+t-1===0?t:t*(D(1+t)/(1+t-1))};var ee=function isArguments(e){return g(e)==="[object Arguments]"};var te=function isArguments(e){return e!==null&&typeof e==="object"&&typeof e.length==="number"&&e.length>=0&&g(e)!=="[object Array]"&&g(e.callee)==="[object Function]"};var re=ee(arguments)?ee:te;var ne={primitive:function(e){return e===null||typeof e!=="function"&&typeof e!=="object"},string:function(e){return g(e)==="[object String]"},regex:function(e){return g(e)==="[object RegExp]"},symbol:function(e){return typeof S.Symbol==="function"&&typeof e==="symbol"}};var oe=function overrideNative(e,t,r){var n=e[t];h(e,t,r,true);m.preserveToString(e[t],n)};var ie=typeof J==="function"&&typeof J["for"]==="function"&&ne.symbol(J());var ae=ne.symbol(J.iterator)?J.iterator:"_es6-shim iterator_";if(S.Set&&typeof(new S.Set)["@@iterator"]==="function"){ae="@@iterator"}if(!S.Reflect){h(S,"Reflect",{},true)}var ue=S.Reflect;var fe=String;var se=typeof document==="undefined"||!document?null:document.all;var ce=se==null?function isNullOrUndefined(e){return e==null}:function isNullOrUndefinedAndNotDocumentAll(e){return e==null&&e!==se};var le={Call:function Call(t,r){var n=arguments.length>2?arguments[2]:[];if(!le.IsCallable(t)){throw new TypeError(t+" is not a function")}return e(t,r,n)},RequireObjectCoercible:function(e,t){if(ce(e)){throw new TypeError(t||"Cannot call method on "+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e==="function"||typeof e==="object"||e===se},ToObject:function(e,t){return Object(le.RequireObjectCoercible(e,t))},IsCallable:d,IsConstructor:function(e){return le.IsCallable(e)},ToInt32:function(e){return le.ToNumber(e)>>0},ToUint32:function(e){return le.ToNumber(e)>>>0},ToNumber:function(e){if(ie&&g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return+e},ToInteger:function(e){var t=le.ToNumber(e);if(K(t)){return 0}if(t===0||!Z(t)){return t}return(t>0?1:-1)*k(L(t))},ToLength:function(e){var t=le.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return K(e)&&K(t)},SameValueZero:function(e,t){return e===t||K(e)&&K(t)},GetIterator:function(e){if(re(e)){return new W(e,"value")}var t=le.GetMethod(e,ae);if(!le.IsCallable(t)){throw new TypeError("value is not an iterable")}var r=le.Call(t,e);if(!le.TypeIsObject(r)){throw new TypeError("bad iterator")}return r},GetMethod:function(e,t){var r=le.ToObject(e)[t];if(ce(r)){return void 0}if(!le.IsCallable(r)){throw new TypeError("Method not callable: "+t)}return r},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=le.GetMethod(e,"return");if(r===void 0){return}var n,o;try{n=le.Call(r,e)}catch(i){o=i}if(t){return}if(o){throw o}if(!le.TypeIsObject(n)){throw new TypeError("Iterator's return method returned a non-object.")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!le.TypeIsObject(t)){throw new TypeError("bad iterator")}return t},IteratorStep:function(e){var t=le.IteratorNext(e);var r=le.IteratorComplete(t);return r?false:t},Construct:function(e,t,r,n){var o=typeof r==="undefined"?e:r;if(!n&&ue.construct){return ue.construct(e,t,o)}var i=o.prototype;if(!le.TypeIsObject(i)){i=Object.prototype}var a=O(i);var u=le.Call(e,a,t);return le.TypeIsObject(u)?u:a},SpeciesConstructor:function(e,t){var r=e.constructor;if(r===void 0){return t}if(!le.TypeIsObject(r)){throw new TypeError("Bad constructor")}var n=r[X];if(ce(n)){return t}if(!le.IsConstructor(n)){throw new TypeError("Bad @@species")}return n},CreateHTML:function(e,t,r,n){var o=le.ToString(e);var i="<"+t;if(r!==""){var a=le.ToString(n);var u=a.replace(/"/g,"&quot;");i+=" "+r+'="'+u+'"'}var f=i+">";var s=f+o;return s+"</"+t+">"},IsRegExp:function IsRegExp(e){if(!le.TypeIsObject(e)){return false}var t=e[J.match];if(typeof t!=="undefined"){return!!t}return ne.regex(e)},ToString:function ToString(e){if(ie&&g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return fe(e)}};if(s&&ie){var pe=function defineWellKnownSymbol(e){if(ne.symbol(J[e])){return J[e]}var t=J["for"]("Symbol."+e);Object.defineProperty(J,e,{configurable:false,enumerable:false,writable:false,value:t});return t};if(!ne.symbol(J.search)){var ve=pe("search");var ye=String.prototype.search;h(RegExp.prototype,ve,function search(e){return le.Call(ye,e,[this])});var he=function search(e){var t=le.RequireObjectCoercible(this);if(!ce(e)){var r=le.GetMethod(e,ve);if(typeof r!=="undefined"){return le.Call(r,e,[t])}}return le.Call(ye,t,[le.ToString(e)])};oe(String.prototype,"search",he)}if(!ne.symbol(J.replace)){var be=pe("replace");var ge=String.prototype.replace;h(RegExp.prototype,be,function replace(e,t){return le.Call(ge,e,[this,t])});var de=function replace(e,t){var r=le.RequireObjectCoercible(this);if(!ce(e)){var n=le.GetMethod(e,be);if(typeof n!=="undefined"){return le.Call(n,e,[r,t])}}return le.Call(ge,r,[le.ToString(e),t])};oe(String.prototype,"replace",de)}if(!ne.symbol(J.split)){var me=pe("split");var Oe=String.prototype.split;h(RegExp.prototype,me,function split(e,t){return le.Call(Oe,e,[this,t])});var we=function split(e,t){var r=le.RequireObjectCoercible(this);if(!ce(e)){var n=le.GetMethod(e,me);if(typeof n!=="undefined"){return le.Call(n,e,[r,t])}}return le.Call(Oe,r,[le.ToString(e),t])};oe(String.prototype,"split",we)}var je=ne.symbol(J.match);var Se=je&&function(){var e={};e[J.match]=function(){return 42};return"a".match(e)!==42}();if(!je||Se){var Te=pe("match");var Ie=String.prototype.match;h(RegExp.prototype,Te,function match(e){return le.Call(Ie,e,[this])});var Ee=function match(e){var t=le.RequireObjectCoercible(this);if(!ce(e)){var r=le.GetMethod(e,Te);if(typeof r!=="undefined"){return le.Call(r,e,[t])}}return le.Call(Ie,t,[le.ToString(e)])};oe(String.prototype,"match",Ee)}}var Pe=function wrapConstructor(e,t,r){m.preserveToString(t,e);if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}if(s){l(Object.getOwnPropertyNames(e),function(n){if(n in G||r[n]){return}m.proxy(e,n,t)})}else{l(Object.keys(e),function(n){if(n in G||r[n]){return}t[n]=e[n]})}t.prototype=e.prototype;m.redefine(e.prototype,"constructor",t)};var Ce=function(){return this};var Me=function(e){if(s&&!q(e,X)){m.getter(e,X,Ce)}};var xe=function(e,t){var r=t||function iterator(){return this};h(e,ae,r);if(!e[ae]&&ne.symbol(ae)){e[ae]=r}};var Ne=function createDataProperty(e,t,r){if(s){Object.defineProperty(e,t,{configurable:true,enumerable:true,writable:true,value:r})}else{e[t]=r}};var Ae=function createDataPropertyOrThrow(e,t,r){Ne(e,t,r);if(!le.SameValue(e[t],r)){throw new TypeError("property is nonconfigurable")}};var _e=function(e,t,r,n){if(!le.TypeIsObject(e)){throw new TypeError("Constructor requires `new`: "+t.name)}var o=t.prototype;if(!le.TypeIsObject(o)){o=r}var i=O(o);for(var a in n){if(q(n,a)){var u=n[a];h(i,a,u,true)}}return i};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var Re=String.fromCodePoint;oe(String,"fromCodePoint",function fromCodePoint(e){return le.Call(Re,this,arguments)})}var ke={fromCodePoint:function fromCodePoint(e){var t=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!le.SameValue(r,le.ToInteger(r))||r<0||r>1114111){throw new RangeError("Invalid code point "+r)}if(r<65536){M(t,String.fromCharCode(r))}else{r-=65536;M(t,String.fromCharCode((r>>10)+55296));M(t,String.fromCharCode(r%1024+56320))}}return N(t,"")},raw:function raw(e){var t=arguments.length-1;var r=le.ToObject(e,"bad template");var raw=le.ToObject(r.raw,"bad raw value");var n=raw.length;var o=le.ToLength(n);if(o<=0){return""}var i=[];var a=0;var u,f,s,c;while(a<o){u=le.ToString(a);s=le.ToString(raw[u]);M(i,s);if(a+1>=o){break}f=a+1<arguments.length?arguments[a+1]:"";c=le.ToString(f);M(i,c);a+=1}return N(i,"")}};if(String.raw&&String.raw({raw:{0:"x",1:"y",length:2}})!=="xy"){oe(String,"raw",ke.raw)}b(String,ke);var Le=function repeat(e,t){if(t<1){return""}if(t%2){return repeat(e,t-1)+e}var r=repeat(e,t/2);return r+r};var Fe=Infinity;var De={repeat:function repeat(e){var t=le.ToString(le.RequireObjectCoercible(this));var r=le.ToInteger(e);if(r<0||r>=Fe){throw new RangeError("repeat count must be less than infinity and not overflow maximum string size")}return Le(t,r)},startsWith:function startsWith(e){var t=le.ToString(le.RequireObjectCoercible(this));if(le.IsRegExp(e)){throw new TypeError('Cannot call method "startsWith" with a regex')}var r=le.ToString(e);var n;if(arguments.length>1){n=arguments[1]}var o=_(le.ToInteger(n),0);return C(t,o,o+r.length)===r},endsWith:function endsWith(e){var t=le.ToString(le.RequireObjectCoercible(this));if(le.IsRegExp(e)){throw new TypeError('Cannot call method "endsWith" with a regex')}var r=le.ToString(e);var n=t.length;var o;if(arguments.length>1){o=arguments[1]}var i=typeof o==="undefined"?n:le.ToInteger(o);var a=R(_(i,0),n);return C(t,a-r.length,a)===r},includes:function includes(e){if(le.IsRegExp(e)){throw new TypeError('"includes" does not accept a RegExp')}var t=le.ToString(e);var r;if(arguments.length>1){r=arguments[1]}return I(this,t,r)!==-1},codePointAt:function codePointAt(e){var t=le.ToString(le.RequireObjectCoercible(this));var r=le.ToInteger(e);var n=t.length;if(r>=0&&r<n){var o=t.charCodeAt(r);var i=r+1===n;if(o<55296||o>56319||i){return o}var a=t.charCodeAt(r+1);if(a<56320||a>57343){return o}return(o-55296)*1024+(a-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",Infinity)!==false){oe(String.prototype,"includes",De.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var ze=i(function(){return"/a/".startsWith(/a/)});var qe=a(function(){return"abc".startsWith("a",Infinity)===false});if(!ze||!qe){oe(String.prototype,"startsWith",De.startsWith);oe(String.prototype,"endsWith",De.endsWith)}}if(ie){var We=a(function(){var e=/a/;e[J.match]=false;return"/a/".startsWith(e)});if(!We){oe(String.prototype,"startsWith",De.startsWith)}var Ge=a(function(){var e=/a/;e[J.match]=false;return"/a/".endsWith(e)});if(!Ge){oe(String.prototype,"endsWith",De.endsWith)}var He=a(function(){var e=/a/;e[J.match]=false;return"/a/".includes(e)});if(!He){oe(String.prototype,"includes",De.includes)}}b(String.prototype,De);var Ve=["\t\n\x0B\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join("");var Be=new RegExp("(^["+Ve+"]+)|(["+Ve+"]+$)","g");var Ue=function trim(){return le.ToString(le.RequireObjectCoercible(this)).replace(Be,"")};var $e=["\x85","\u200b","\ufffe"].join("");var Je=new RegExp("["+$e+"]","g");var Xe=/^[-+]0x[0-9a-f]+$/i;var Ke=$e.trim().length!==$e.length;h(String.prototype,"trim",Ue,Ke);var Ze=function(e){return{value:e,done:arguments.length===0}};var Ye=function(e){le.RequireObjectCoercible(e);h(this,"_s",le.ToString(e));h(this,"_i",0)};Ye.prototype.next=function(){var e=this._s;var t=this._i;if(typeof e==="undefined"||t>=e.length){this._s=void 0;return Ze()}var r=e.charCodeAt(t);var n,o;if(r<55296||r>56319||t+1===e.length){o=1}else{n=e.charCodeAt(t+1);o=n<56320||n>57343?1:2}this._i=t+o;return Ze(e.substr(t,o))};xe(Ye.prototype);xe(String.prototype,function(){return new Ye(this)});var Qe={from:function from(e){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,i;if(typeof n==="undefined"){o=false}else{if(!le.IsCallable(n)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){i=arguments[2]}o=true}var a=typeof(re(e)||le.GetMethod(e,ae))!=="undefined";var u,f,s;if(a){f=le.IsConstructor(r)?Object(new r):[];var c=le.GetIterator(e);var l,p;s=0;while(true){l=le.IteratorStep(c);if(l===false){break}p=l.value;try{if(o){p=typeof i==="undefined"?n(p,s):t(n,i,p,s)}f[s]=p}catch(v){le.IteratorClose(c,true);throw v}s+=1}u=s}else{var y=le.ToObject(e);u=le.ToLength(y.length);f=le.IsConstructor(r)?Object(new r(u)):new Array(u);var h;for(s=0;s<u;++s){h=y[s];if(o){h=typeof i==="undefined"?n(h,s):t(n,i,h,s)}Ae(f,s,h)}}f.length=u;return f},of:function of(){var e=arguments.length;var t=this;var n=r(t)||!le.IsCallable(t)?new Array(e):le.Construct(t,[e]);for(var o=0;o<e;++o){Ae(n,o,arguments[o])}n.length=e;return n}};b(Array,Qe);Me(Array);W=function(e,t){h(this,"i",0);h(this,"array",e);h(this,"kind",t)};b(W.prototype,{next:function(){var e=this.i;var t=this.array;if(!(this instanceof W)){throw new TypeError("Not an ArrayIterator")}if(typeof t!=="undefined"){var r=le.ToLength(t.length);if(e<r){var n=this.kind;var o;if(n==="key"){o=e}else if(n==="value"){o=t[e]}else if(n==="entry"){o=[e,t[e]]}this.i=e+1;return Ze(o)}}this.array=void 0;return Ze()}});xe(W.prototype);var et=Array.of===Qe.of||function(){var e=function Foo(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!et){oe(Array,"of",Qe.of)}var tt={copyWithin:function copyWithin(e,t){var r=le.ToObject(this);var n=le.ToLength(r.length);var o=le.ToInteger(e);var i=le.ToInteger(t);var a=o<0?_(n+o,0):R(o,n);var u=i<0?_(n+i,0):R(i,n);var f;if(arguments.length>2){f=arguments[2]}var s=typeof f==="undefined"?n:le.ToInteger(f);var c=s<0?_(n+s,0):R(s,n);var l=R(c-u,n-a);var p=1;if(u<a&&a<u+l){p=-1;u+=l-1;a+=l-1}while(l>0){if(u in r){r[a]=r[u]}else{delete r[a]}u+=p;a+=p;l-=1}return r},fill:function fill(e){var t;if(arguments.length>1){t=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=le.ToObject(this);var o=le.ToLength(n.length);t=le.ToInteger(typeof t==="undefined"?0:t);r=le.ToInteger(typeof r==="undefined"?o:r);var i=t<0?_(o+t,0):R(t,o);var a=r<0?o+r:r;for(var u=i;u<o&&u<a;++u){n[u]=e}return n},find:function find(e){var r=le.ToObject(this);var n=le.ToLength(r.length);if(!le.IsCallable(e)){throw new TypeError("Array#find: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0,a;i<n;i++){a=r[i];if(o){if(t(e,o,a,i,r)){return a}}else if(e(a,i,r)){return a}}},findIndex:function findIndex(e){var r=le.ToObject(this);var n=le.ToLength(r.length);if(!le.IsCallable(e)){throw new TypeError("Array#findIndex: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0;i<n;i++){if(o){if(t(e,o,r[i],i,r)){return i}}else if(e(r[i],i,r)){return i}}return-1},keys:function keys(){return new W(this,"key")},values:function values(){return new W(this,"value")},entries:function entries(){return new W(this,"entry")}};if(Array.prototype.keys&&!le.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!le.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ae]){b(Array.prototype,{values:Array.prototype[ae]});if(ne.symbol(J.unscopables)){Array.prototype[J.unscopables].values=true}}if(c&&Array.prototype.values&&Array.prototype.values.name!=="values"){var rt=Array.prototype.values;oe(Array.prototype,"values",function values(){return le.Call(rt,this,arguments)});h(Array.prototype,ae,Array.prototype.values,true)}b(Array.prototype,tt);if(1/[true].indexOf(true,-0)<0){h(Array.prototype,"indexOf",function indexOf(e){var t=E(this,arguments);if(t===0&&1/t<0){return 0}return t},true)}xe(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){var nt=Object.getPrototypeOf([].values());if(nt){xe(nt)}}var ot=function(){return a(function(){return Array.from({length:-1}).length===0})}();var it=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!ot||!it){oe(Array,"from",Qe.from)}var at=function(){return a(function(){return Array.from([0],void 0)})}();if(!at){var ut=Array.from;oe(Array,"from",function from(e){if(arguments.length>1&&typeof arguments[1]!=="undefined"){return le.Call(ut,this,arguments)}return t(ut,this,e)})}var ft=-(Math.pow(2,32)-1);var st=function(e,r){var n={length:ft};n[r?(n.length>>>0)-1:0]=true;return a(function(){t(e,n,function(){throw new RangeError("should not reach here")},[]);return true})};if(!st(Array.prototype.forEach)){var ct=Array.prototype.forEach;oe(Array.prototype,"forEach",function forEach(e){return le.Call(ct,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.map)){var lt=Array.prototype.map;oe(Array.prototype,"map",function map(e){return le.Call(lt,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.filter)){var pt=Array.prototype.filter;oe(Array.prototype,"filter",function filter(e){return le.Call(pt,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.some)){var vt=Array.prototype.some;oe(Array.prototype,"some",function some(e){return le.Call(vt,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.every)){var yt=Array.prototype.every;oe(Array.prototype,"every",function every(e){return le.Call(yt,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.reduce)){var ht=Array.prototype.reduce;oe(Array.prototype,"reduce",function reduce(e){return le.Call(ht,this.length>=0?this:[],arguments)})}if(!st(Array.prototype.reduceRight,true)){var bt=Array.prototype.reduceRight;oe(Array.prototype,"reduceRight",function reduceRight(e){return le.Call(bt,this.length>=0?this:[],arguments)})}var gt=Number("0o10")!==8;var dt=Number("0b10")!==2;var mt=y($e,function(e){return Number(e+0+e)===0});if(gt||dt||mt){var Ot=Number;var wt=/^0b[01]+$/i;var jt=/^0o[0-7]+$/i;var St=wt.test.bind(wt);var Tt=jt.test.bind(jt);var It=function(e,t){var r;if(typeof e.valueOf==="function"){r=e.valueOf();if(ne.primitive(r)){return r}}if(typeof e.toString==="function"){r=e.toString();if(ne.primitive(r)){return r}}throw new TypeError("No default value")};var Et=Je.test.bind(Je);var Pt=Xe.test.bind(Xe);var Ct=function(){var e=function Number(t){var r;if(arguments.length>0){r=ne.primitive(t)?t:It(t,"number")}else{r=0}if(typeof r==="string"){r=le.Call(Ue,r);if(St(r)){r=parseInt(C(r,2),2)}else if(Tt(r)){r=parseInt(C(r,2),8)}else if(Et(r)||Pt(r)){r=NaN}}var n=this;var o=a(function(){Ot.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new Ot(r)}return Ot(r)};return e}();Pe(Ot,Ct,{});b(Ct,{NaN:Ot.NaN,MAX_VALUE:Ot.MAX_VALUE,MIN_VALUE:Ot.MIN_VALUE,NEGATIVE_INFINITY:Ot.NEGATIVE_INFINITY,POSITIVE_INFINITY:Ot.POSITIVE_INFINITY});Number=Ct;m.redefine(S,"Number",Ct)}var Mt=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:Mt,MIN_SAFE_INTEGER:-Mt,EPSILON:2.220446049250313e-16,parseInt:S.parseInt,parseFloat:S.parseFloat,isFinite:Z,isInteger:function isInteger(e){return Z(e)&&le.ToInteger(e)===e},isSafeInteger:function isSafeInteger(e){return Number.isInteger(e)&&L(e)<=Number.MAX_SAFE_INTEGER},isNaN:K});h(Number,"parseInt",S.parseInt,Number.parseInt!==S.parseInt);if([,1].find(function(){return true})===1){oe(Array.prototype,"find",tt.find)}if([,1].findIndex(function(){return true})!==0){oe(Array.prototype,"findIndex",tt.findIndex)}var xt=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var Nt=function ensureEnumerable(e,t){if(s&&xt(e,t)){Object.defineProperty(e,t,{enumerable:false})}};var At=function sliceArgs(){var e=Number(this);var t=arguments.length;var r=t-e;var n=new Array(r<0?0:r);for(var o=e;o<t;++o){n[o-e]=arguments[o]}return n};var _t=function assignTo(e){return function assignToSource(t,r){t[r]=e[r];return t}};var Rt=function(e,t){var r=n(Object(t));var o;if(le.IsCallable(Object.getOwnPropertySymbols)){o=v(Object.getOwnPropertySymbols(Object(t)),xt(t))}return p(P(r,o||[]),_t(t),e)};var kt={assign:function(e,t){var r=le.ToObject(e,"Cannot convert undefined or null to object");return p(le.Call(At,1,arguments),Rt,r)},is:function is(e,t){return le.SameValue(e,t)}};var Lt=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return e[1]==="y"}}();if(Lt){oe(Object,"assign",kt.assign)}b(Object,kt);if(s){var Ft={setPrototypeOf:function(e){var r;var n=function(e,t){if(!le.TypeIsObject(e)){throw new TypeError("cannot set prototype on a non-object")}if(!(t===null||le.TypeIsObject(t))){throw new TypeError("can only set prototype to an object or null"+t)}};var o=function(e,o){n(e,o);t(r,e,o);return e};try{r=e.getOwnPropertyDescriptor(e.prototype,"__proto__").set;t(r,{},null)}catch(i){if(e.prototype!=={}.__proto__){return}r=function(e){this.__proto__=e};o.polyfill=o(o({},null),e.prototype)instanceof e}return o}(Object)};b(Object,Ft)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf;var r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){var n=t(r);return n===e?null:n};Object.setPrototypeOf=function(t,n){var o=n===null?e:n;return r(t,o)};Object.setPrototypeOf.polyfill=false})()}var Dt=!i(function(){return Object.keys("foo")});if(!Dt){var zt=Object.keys;oe(Object,"keys",function keys(e){return zt(le.ToObject(e))});n=Object.keys}var qt=i(function(){return Object.keys(/a/g)});if(qt){var Wt=Object.keys;oe(Object,"keys",function keys(e){if(ne.regex(e)){var t=[];for(var r in e){if(q(e,r)){M(t,r)}}return t}return Wt(e)});n=Object.keys}if(Object.getOwnPropertyNames){var Gt=!i(function(){return Object.getOwnPropertyNames("foo")});if(!Gt){var Ht=typeof window==="object"?Object.getOwnPropertyNames(window):[];var Vt=Object.getOwnPropertyNames;oe(Object,"getOwnPropertyNames",function getOwnPropertyNames(e){var t=le.ToObject(e);if(g(t)==="[object Window]"){try{return Vt(t)}catch(r){return P([],Ht)}}return Vt(t)})}}if(Object.getOwnPropertyDescriptor){var Bt=!i(function(){return Object.getOwnPropertyDescriptor("foo","bar")});if(!Bt){var Ut=Object.getOwnPropertyDescriptor;oe(Object,"getOwnPropertyDescriptor",function getOwnPropertyDescriptor(e,t){return Ut(le.ToObject(e),t)})}}if(Object.seal){var $t=!i(function(){return Object.seal("foo")});if(!$t){var Jt=Object.seal;oe(Object,"seal",function seal(e){if(!le.TypeIsObject(e)){return e}return Jt(e)})}}if(Object.isSealed){var Xt=!i(function(){return Object.isSealed("foo")});if(!Xt){var Kt=Object.isSealed;oe(Object,"isSealed",function isSealed(e){if(!le.TypeIsObject(e)){return true}return Kt(e)})}}if(Object.freeze){var Zt=!i(function(){return Object.freeze("foo")});if(!Zt){var Yt=Object.freeze;oe(Object,"freeze",function freeze(e){if(!le.TypeIsObject(e)){return e}return Yt(e)})}}if(Object.isFrozen){var Qt=!i(function(){return Object.isFrozen("foo")});if(!Qt){var er=Object.isFrozen;oe(Object,"isFrozen",function isFrozen(e){if(!le.TypeIsObject(e)){return true}return er(e)})}}if(Object.preventExtensions){var tr=!i(function(){return Object.preventExtensions("foo")});if(!tr){var rr=Object.preventExtensions;oe(Object,"preventExtensions",function preventExtensions(e){if(!le.TypeIsObject(e)){return e}return rr(e)})}}if(Object.isExtensible){var nr=!i(function(){return Object.isExtensible("foo")});if(!nr){var or=Object.isExtensible;oe(Object,"isExtensible",function isExtensible(e){if(!le.TypeIsObject(e)){return false}return or(e)})}}if(Object.getPrototypeOf){var ir=!i(function(){return Object.getPrototypeOf("foo")});if(!ir){var ar=Object.getPrototypeOf;oe(Object,"getPrototypeOf",function getPrototypeOf(e){return ar(le.ToObject(e))})}}var ur=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&le.IsCallable(e.get)}();if(s&&!ur){var fr=function flags(){if(!le.TypeIsObject(this)){throw new TypeError("Method called on incompatible type: must be an object.")}var e="";if(this.global){e+="g"}if(this.ignoreCase){e+="i"}if(this.multiline){e+="m"}if(this.unicode){e+="u"}if(this.sticky){e+="y"}return e};m.getter(RegExp.prototype,"flags",fr)}var sr=s&&a(function(){return String(new RegExp(/a/g,"i"))==="/a/i"});var cr=ie&&s&&function(){var e=/./;e[J.match]=false;return RegExp(e)===e}();var lr=a(function(){return RegExp.prototype.toString.call({source:"abc"})==="/abc/"});var pr=lr&&a(function(){return RegExp.prototype.toString.call({source:"a",flags:"b"})==="/a/b"});if(!lr||!pr){var vr=RegExp.prototype.toString;h(RegExp.prototype,"toString",function toString(){var e=le.RequireObjectCoercible(this);if(ne.regex(e)){return t(vr,e)}var r=fe(e.source);var n=fe(e.flags);return"/"+r+"/"+n},true);m.preserveToString(RegExp.prototype.toString,vr);RegExp.prototype.toString.prototype=void 0}if(s&&(!sr||cr)){var yr=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get;var hr=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{};var br=function(){return this.source};var gr=le.IsCallable(hr.get)?hr.get:br;var dr=RegExp;var mr=function(){return function RegExp(e,t){var r=le.IsRegExp(e);var n=this instanceof RegExp;if(!n&&r&&typeof t==="undefined"&&e.constructor===RegExp){return e}var o=e;var i=t;if(ne.regex(e)){o=le.Call(gr,e);i=typeof t==="undefined"?le.Call(yr,e):t;return new RegExp(o,i)}else if(r){o=e.source;i=typeof t==="undefined"?e.flags:t}return new dr(e,t)}}();Pe(dr,mr,{$input:true});RegExp=mr;m.redefine(S,"RegExp",mr)}if(s){var Or={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};l(n(Or),function(e){if(e in RegExp&&!(Or[e]in RegExp)){m.getter(RegExp,Or[e],function get(){return RegExp[e]})}})}Me(RegExp);var wr=1/Number.EPSILON;var jr=function roundTiesToEven(e){return e+wr-wr};var Sr=Math.pow(2,-23);var Tr=Math.pow(2,127)*(2-Sr);var Ir=Math.pow(2,-126);var Er=Math.E;var Pr=Math.LOG2E;var Cr=Math.LOG10E;var Mr=Number.prototype.clz;delete Number.prototype.clz;var xr={acosh:function acosh(e){var t=Number(e);if(K(t)||e<1){return NaN}if(t===1){return 0}if(t===Infinity){return t}var r=1/(t*t);if(t<2){return Q(t-1+z(1-r)*t)}var n=t/2;return Q(n+z(1-r)*n-1)+1/Pr},asinh:function asinh(e){var t=Number(e);if(t===0||!T(t)){return t}var r=L(t);var n=r*r;var o=Y(t);if(r<1){return o*Q(r+n/(z(n+1)+1))}return o*(Q(r/2+z(1+1/n)*r/2-1)+1/Pr)},atanh:function atanh(e){var t=Number(e);if(t===0){return t}if(t===-1){return-Infinity}if(t===1){return Infinity}if(K(t)||t<-1||t>1){return NaN}var r=L(t);return Y(t)*Q(2*r/(1-r))/2},cbrt:function cbrt(e){var t=Number(e);if(t===0){return t}var r=t<0;var n;if(r){t=-t}if(t===Infinity){n=Infinity}else{n=F(D(t)/3);n=(t/(n*n)+2*n)/3}return r?-n:n},clz32:function clz32(e){var t=Number(e);var r=le.ToUint32(t);if(r===0){return 32}return Mr?le.Call(Mr,r):31-k(D(r+.5)*Pr)},cosh:function cosh(e){var t=Number(e);if(t===0){return 1}if(K(t)){return NaN}if(!T(t)){return Infinity}var r=F(L(t)-1);return(r+1/(r*Er*Er))*(Er/2)},expm1:function expm1(e){var t=Number(e);if(t===-Infinity){return-1}if(!T(t)||t===0){return t}if(L(t)>.5){return F(t)-1}var r=t;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=t/o}return n},hypot:function hypot(e,t){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var i=L(Number(arguments[o]));if(n<i){r*=n/i*(n/i);r+=1;n=i}else{r+=i>0?i/n*(i/n):i}}return n===Infinity?Infinity:n*z(r)},log2:function log2(e){return D(e)*Pr},log10:function log10(e){return D(e)*Cr},log1p:Q,sign:Y,sinh:function sinh(e){var t=Number(e);if(!T(t)||t===0){return t}var r=L(t);if(r<1){var n=Math.expm1(r);return Y(t)*n*(1+1/(n+1))/2}var o=F(r-1);return Y(t)*(o-1/(o*Er*Er))*(Er/2)},tanh:function tanh(e){var t=Number(e);if(K(t)||t===0){return t}if(t>=20){return 1}if(t<=-20){return-1}return(Math.expm1(t)-Math.expm1(-t))/(F(t)+F(-t))},trunc:function trunc(e){var t=Number(e);return t<0?-k(-t):k(t)},imul:function imul(e,t){var r=le.ToUint32(e);var n=le.ToUint32(t);var o=r>>>16&65535;var i=r&65535;var a=n>>>16&65535;var u=n&65535;return i*u+(o*u+i*a<<16>>>0)|0},fround:function fround(e){var t=Number(e);if(t===0||t===Infinity||t===-Infinity||K(t)){return t}var r=Y(t);var n=L(t);if(n<Ir){return r*jr(n/Ir/Sr)*Ir*Sr}var o=(1+Sr/Number.EPSILON)*n;var i=o-(o-n);if(i>Tr||K(i)){return r*Infinity}return r*i}};var Nr=function withinULPDistance(e,t,r){return L(1-e/t)/Number.EPSILON<(r||8)};b(Math,xr);h(Math,"sinh",xr.sinh,Math.sinh(710)===Infinity);h(Math,"cosh",xr.cosh,Math.cosh(710)===Infinity);h(Math,"log1p",xr.log1p,Math.log1p(-1e-17)!==-1e-17);h(Math,"asinh",xr.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));
h(Math,"asinh",xr.asinh,Math.asinh(1e300)===Infinity);h(Math,"atanh",xr.atanh,Math.atanh(1e-300)===0);h(Math,"tanh",xr.tanh,Math.tanh(-2e-17)!==-2e-17);h(Math,"acosh",xr.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);h(Math,"acosh",xr.acosh,!Nr(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON)));h(Math,"cbrt",xr.cbrt,!Nr(Math.cbrt(1e-300),1e-100));h(Math,"sinh",xr.sinh,Math.sinh(-2e-17)!==-2e-17);var Ar=Math.expm1(10);h(Math,"expm1",xr.expm1,Ar>22025.465794806718||Ar<22025.465794806718);h(Math,"hypot",xr.hypot,Math.hypot(Infinity,NaN)!==Infinity);var _r=Math.round;var Rr=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var kr=wr+1;var Lr=2*wr-1;var Fr=[kr,Lr].every(function(e){return Math.round(e)===e});h(Math,"round",function round(e){var t=k(e);var r=t===-1?-0:t+1;return e-t<.5?t:r},!Rr||!Fr);m.preserveToString(Math.round,_r);var Dr=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=xr.imul;m.preserveToString(Math.imul,Dr)}if(Math.imul.length!==2){oe(Math,"imul",function imul(e,t){return le.Call(Dr,Math,arguments)})}var zr=function(){var e=S.setTimeout;if(typeof e!=="function"&&typeof e!=="object"){return}le.IsPromise=function(e){if(!le.TypeIsObject(e)){return false}if(typeof e._promise==="undefined"){return false}return true};var r=function(e){if(!le.IsConstructor(e)){throw new TypeError("Bad promise constructor")}var t=this;var r=function(e,r){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError("Bad Promise implementation!")}t.resolve=e;t.reject=r};t.resolve=void 0;t.reject=void 0;t.promise=new e(r);if(!(le.IsCallable(t.resolve)&&le.IsCallable(t.reject))){throw new TypeError("Bad promise constructor")}};var n;if(typeof window!=="undefined"&&le.IsCallable(window.postMessage)){n=function(){var e=[];var t="zero-timeout-message";var r=function(r){M(e,r);window.postMessage(t,"*")};var n=function(r){if(r.source===window&&r.data===t){r.stopPropagation();if(e.length===0){return}var n=A(e);n()}};window.addEventListener("message",n,true);return r}}var o=function(){var e=S.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var i=le.IsCallable(S.setImmediate)?S.setImmediate:typeof process==="object"&&process.nextTick?process.nextTick:o()||(le.IsCallable(n)?n():function(t){e(t,0)});var a=function(e){return e};var u=function(e){throw e};var f=0;var s=1;var c=2;var l=0;var p=1;var v=2;var y={};var h=function(e,t,r){i(function(){g(e,t,r)})};var g=function(e,t,r){var n,o;if(t===y){return e(r)}try{n=e(r);o=t.resolve}catch(i){n=i;o=t.reject}o(n)};var d=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.fulfillReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+l],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=s;r.reactionLength=0};var m=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.rejectReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+p],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=c;r.reactionLength=0};var O=function(e){var t=false;var r=function(r){var n;if(t){return}t=true;if(r===e){return m(e,new TypeError("Self resolution"))}if(!le.TypeIsObject(r)){return d(e,r)}try{n=r.then}catch(o){return m(e,o)}if(!le.IsCallable(n)){return d(e,r)}i(function(){j(e,r,n)})};var n=function(r){if(t){return}t=true;return m(e,r)};return{resolve:r,reject:n}};var w=function(e,r,n,o){if(e===I){t(e,r,n,o,y)}else{t(e,r,n,o)}};var j=function(e,t,r){var n=O(e);var o=n.resolve;var i=n.reject;try{w(r,t,o,i)}catch(a){i(a)}};var T,I;var E=function(){var e=function Promise(t){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires "new"')}if(this&&this._promise){throw new TypeError("Bad construction")}if(!le.IsCallable(t)){throw new TypeError("not a valid resolver")}var r=_e(this,e,T,{_promise:{result:void 0,state:f,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=O(r);var o=n.reject;try{t(n.resolve,o)}catch(i){o(i)}return r};return e}();T=E.prototype;var P=function(e,t,r,n){var o=false;return function(i){if(o){return}o=true;t[e]=i;if(--n.count===0){var a=r.resolve;a(t)}}};var C=function(e,t,r){var n=e.iterator;var o=[];var i={count:1};var a,u;var f=0;while(true){try{a=le.IteratorStep(n);if(a===false){e.done=true;break}u=a.value}catch(s){e.done=true;throw s}o[f]=void 0;var c=t.resolve(u);var l=P(f,o,r,i);i.count+=1;w(c.then,c,l,r.reject);f+=1}if(--i.count===0){var p=r.resolve;p(o)}return r.promise};var x=function(e,t,r){var n=e.iterator;var o,i,a;while(true){try{o=le.IteratorStep(n);if(o===false){e.done=true;break}i=o.value}catch(u){e.done=true;throw u}a=t.resolve(i);w(a.then,a,r.resolve,r.reject)}return r.promise};b(E,{all:function all(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=le.GetIterator(e);i={iterator:o,done:false};return C(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{le.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},race:function race(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=le.GetIterator(e);i={iterator:o,done:false};return x(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{le.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},reject:function reject(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}var n=new r(t);var o=n.reject;o(e);return n.promise},resolve:function resolve(e){var t=this;if(!le.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}if(le.IsPromise(e)){var n=e.constructor;if(n===t){return e}}var o=new r(t);var i=o.resolve;i(e);return o.promise}});b(T,{"catch":function(e){return this.then(null,e)},then:function then(e,t){var n=this;if(!le.IsPromise(n)){throw new TypeError("not a promise")}var o=le.SpeciesConstructor(n,E);var i;var b=arguments.length>2&&arguments[2]===y;if(b&&o===E){i=y}else{i=new r(o)}var g=le.IsCallable(e)?e:a;var d=le.IsCallable(t)?t:u;var m=n._promise;var O;if(m.state===f){if(m.reactionLength===0){m.fulfillReactionHandler0=g;m.rejectReactionHandler0=d;m.reactionCapability0=i}else{var w=3*(m.reactionLength-1);m[w+l]=g;m[w+p]=d;m[w+v]=i}m.reactionLength+=1}else if(m.state===s){O=m.result;h(g,i,O)}else if(m.state===c){O=m.result;h(d,i,O)}else{throw new TypeError("unexpected Promise state")}return i.promise}});y=new r(E);I=T.then;return E}();if(S.Promise){delete S.Promise.accept;delete S.Promise.defer;delete S.Promise.prototype.chain}if(typeof zr==="function"){b(S,{Promise:zr});var qr=w(S.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var Wr=!i(function(){return S.Promise.reject(42).then(null,5).then(null,G)});var Gr=i(function(){return S.Promise.call(3,G)});var Hr=function(e){var t=e.resolve(5);t.constructor={};var r=e.resolve(t);try{r.then(null,G).then(null,G)}catch(n){return true}return t===r}(S.Promise);var Vr=s&&function(){var e=0;var t=Object.defineProperty({},"then",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var Br=function BadResolverPromise(e){var t=new Promise(e);e(3,function(){});this.then=t.then;this.constructor=BadResolverPromise};Br.prototype=Promise.prototype;Br.all=Promise.all;var Ur=a(function(){return!!Br.all([1,2])});if(!qr||!Wr||!Gr||Hr||!Vr||Ur){Promise=zr;oe(S,"Promise",zr)}if(Promise.all.length!==1){var $r=Promise.all;oe(Promise,"all",function all(e){return le.Call($r,this,arguments)})}if(Promise.race.length!==1){var Jr=Promise.race;oe(Promise,"race",function race(e){return le.Call(Jr,this,arguments)})}if(Promise.resolve.length!==1){var Xr=Promise.resolve;oe(Promise,"resolve",function resolve(e){return le.Call(Xr,this,arguments)})}if(Promise.reject.length!==1){var Kr=Promise.reject;oe(Promise,"reject",function reject(e){return le.Call(Kr,this,arguments)})}Nt(Promise,"all");Nt(Promise,"race");Nt(Promise,"resolve");Nt(Promise,"reject");Me(Promise)}var Zr=function(e){var t=n(p(e,function(e,t){e[t]=true;return e},{}));return e.join(":")===t.join(":")};var Yr=Zr(["z","a","bb"]);var Qr=Zr(["z",1,"a","3",2]);if(s){var en=function fastkey(e,t){if(!t&&!Yr){return null}if(ce(e)){return"^"+le.ToString(e)}else if(typeof e==="string"){return"$"+e}else if(typeof e==="number"){if(!Qr){return"n"+e}return e}else if(typeof e==="boolean"){return"b"+e}return null};var tn=function emptyObject(){return Object.create?Object.create(null):{}};var rn=function addIterableToMap(e,n,o){if(r(o)||ne.string(o)){l(o,function(e){if(!le.TypeIsObject(e)){throw new TypeError("Iterator value "+e+" is not an entry object")}n.set(e[0],e[1])})}else if(o instanceof e){t(e.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var i,a;if(!ce(o)){a=n.set;if(!le.IsCallable(a)){throw new TypeError("bad map")}i=le.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=le.IteratorStep(i);if(u===false){break}var f=u.value;try{if(!le.TypeIsObject(f)){throw new TypeError("Iterator value "+f+" is not an entry object")}t(a,n,f[0],f[1])}catch(s){le.IteratorClose(i,true);throw s}}}}};var nn=function addIterableToSet(e,n,o){if(r(o)||ne.string(o)){l(o,function(e){n.add(e)})}else if(o instanceof e){t(e.prototype.forEach,o,function(e){n.add(e)})}else{var i,a;if(!ce(o)){a=n.add;if(!le.IsCallable(a)){throw new TypeError("bad set")}i=le.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=le.IteratorStep(i);if(u===false){break}var f=u.value;try{t(a,n,f)}catch(s){le.IteratorClose(i,true);throw s}}}}};var on={Map:function(){var e={};var r=function MapEntry(e,t){this.key=e;this.value=t;this.next=null;this.prev=null};r.prototype.isRemoved=function isRemoved(){return this.key===e};var n=function isMap(e){return!!e._es6map};var o=function requireMapSlot(e,t){if(!le.TypeIsObject(e)||!n(e)){throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+le.ToString(e))}};var i=function MapIterator(e,t){o(e,"[[MapIterator]]");h(this,"head",e._head);h(this,"i",this.head);h(this,"kind",t)};i.prototype={isMapIterator:true,next:function next(){if(!this.isMapIterator){throw new TypeError("Not a MapIterator")}var e=this.i;var t=this.kind;var r=this.head;if(typeof this.i==="undefined"){return Ze()}while(e.isRemoved()&&e!==r){e=e.prev}var n;while(e.next!==r){e=e.next;if(!e.isRemoved()){if(t==="key"){n=e.key}else if(t==="value"){n=e.value}else{n=[e.key,e.value]}this.i=e;return Ze(n)}}this.i=void 0;return Ze()}};xe(i.prototype);var a;var u=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}if(this&&this._es6map){throw new TypeError("Bad construction")}var e=_e(this,Map,a,{_es6map:true,_head:null,_map:H?new H:null,_size:0,_storage:tn()});var t=new r(null,null);t.next=t.prev=t;e._head=t;if(arguments.length>0){rn(Map,e,arguments[0])}return e};a=u.prototype;m.getter(a,"size",function(){if(typeof this._size==="undefined"){throw new TypeError("size method called on incompatible Map")}return this._size});b(a,{get:function get(e){o(this,"get");var t;var r=en(e,true);if(r!==null){t=this._storage[r];if(t){return t.value}return}if(this._map){t=B.call(this._map,e);if(t){return t.value}return}var n=this._head;var i=n;while((i=i.next)!==n){if(le.SameValueZero(i.key,e)){return i.value}}},has:function has(e){o(this,"has");var t=en(e,true);if(t!==null){return typeof this._storage[t]!=="undefined"}if(this._map){return U.call(this._map,e)}var r=this._head;var n=r;while((n=n.next)!==r){if(le.SameValueZero(n.key,e)){return true}}return false},set:function set(e,t){o(this,"set");var n=this._head;var i=n;var a;var u=en(e,true);if(u!==null){if(typeof this._storage[u]!=="undefined"){this._storage[u].value=t;return this}a=this._storage[u]=new r(e,t);i=n.prev}else if(this._map){if(U.call(this._map,e)){B.call(this._map,e).value=t}else{a=new r(e,t);$.call(this._map,e,a);i=n.prev}}while((i=i.next)!==n){if(le.SameValueZero(i.key,e)){i.value=t;return this}}a=a||new r(e,t);if(le.SameValue(-0,e)){a.key=+0}a.next=this._head;a.prev=this._head.prev;a.prev.next=a;a.next.prev=a;this._size+=1;return this},"delete":function(t){o(this,"delete");var r=this._head;var n=r;var i=en(t,true);if(i!==null){if(typeof this._storage[i]==="undefined"){return false}n=this._storage[i].prev;delete this._storage[i]}else if(this._map){if(!U.call(this._map,t)){return false}n=B.call(this._map,t).prev;V.call(this._map,t)}while((n=n.next)!==r){if(le.SameValueZero(n.key,t)){n.key=e;n.value=e;n.prev.next=n.next;n.next.prev=n.prev;this._size-=1;return true}}return false},clear:function clear(){o(this,"clear");this._map=H?new H:null;this._size=0;this._storage=tn();var t=this._head;var r=t;var n=r.next;while((r=n)!==t){r.key=e;r.value=e;n=r.next;r.next=r.prev=t}t.next=t.prev=t},keys:function keys(){o(this,"keys");return new i(this,"key")},values:function values(){o(this,"values");return new i(this,"value")},entries:function entries(){o(this,"entries");return new i(this,"key+value")},forEach:function forEach(e){o(this,"forEach");var r=arguments.length>1?arguments[1]:null;var n=this.entries();for(var i=n.next();!i.done;i=n.next()){if(r){t(e,r,i.value[1],i.value[0],this)}else{e(i.value[1],i.value[0],this)}}}});xe(a,a.entries);return u}(),Set:function(){var e=function isSet(e){return e._es6set&&typeof e._storage!=="undefined"};var r=function requireSetSlot(t,r){if(!le.TypeIsObject(t)||!e(t)){throw new TypeError("Set.prototype."+r+" called on incompatible receiver "+le.ToString(t))}};var o;var i=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}if(this&&this._es6set){throw new TypeError("Bad construction")}var e=_e(this,Set,o,{_es6set:true,"[[SetData]]":null,_storage:tn()});if(!e._es6set){throw new TypeError("bad set")}if(arguments.length>0){nn(Set,e,arguments[0])}return e};o=i.prototype;var a=function(e){var t=e;if(t==="^null"){return null}else if(t==="^undefined"){return void 0}var r=t.charAt(0);if(r==="$"){return C(t,1)}else if(r==="n"){return+C(t,1)}else if(r==="b"){return t==="btrue"}return+t};var u=function ensureMap(e){if(!e["[[SetData]]"]){var t=new on.Map;e["[[SetData]]"]=t;l(n(e._storage),function(e){var r=a(e);t.set(r,r)});e["[[SetData]]"]=t}e._storage=null};m.getter(i.prototype,"size",function(){r(this,"size");if(this._storage){return n(this._storage).length}u(this);return this["[[SetData]]"].size});b(i.prototype,{has:function has(e){r(this,"has");var t;if(this._storage&&(t=en(e))!==null){return!!this._storage[t]}u(this);return this["[[SetData]]"].has(e)},add:function add(e){r(this,"add");var t;if(this._storage&&(t=en(e))!==null){this._storage[t]=true;return this}u(this);this["[[SetData]]"].set(e,e);return this},"delete":function(e){r(this,"delete");var t;if(this._storage&&(t=en(e))!==null){var n=q(this._storage,t);return delete this._storage[t]&&n}u(this);return this["[[SetData]]"]["delete"](e)},clear:function clear(){r(this,"clear");if(this._storage){this._storage=tn()}if(this["[[SetData]]"]){this["[[SetData]]"].clear()}},values:function values(){r(this,"values");u(this);return new f(this["[[SetData]]"].values())},entries:function entries(){r(this,"entries");u(this);return new f(this["[[SetData]]"].entries())},forEach:function forEach(e){r(this,"forEach");var n=arguments.length>1?arguments[1]:null;var o=this;u(o);this["[[SetData]]"].forEach(function(r,i){if(n){t(e,n,i,i,o)}else{e(i,i,o)}})}});h(i.prototype,"keys",i.prototype.values,true);xe(i.prototype,i.prototype.values);var f=function SetIterator(e){h(this,"it",e)};f.prototype={isSetIterator:true,next:function next(){if(!this.isSetIterator){throw new TypeError("Not a SetIterator")}return this.it.next()}};xe(f.prototype);return i}()};var an=S.Set&&!Set.prototype["delete"]&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys);if(an){S.Set=on.Set}if(S.Map||S.Set){var un=a(function(){return new Map([[1,2]]).get(1)===2});if(!un){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new H;if(arguments.length>0){rn(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,S.Map.prototype);return e};S.Map.prototype=O(H.prototype);h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,H)}var fn=new Map;var sn=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var cn=fn.set(1,2)===fn;if(!sn||!cn){oe(Map.prototype,"set",function set(e,r){t($,this,e===0?0:e,r);return this})}if(!sn){b(Map.prototype,{get:function get(e){return t(B,this,e===0?0:e)},has:function has(e){return t(U,this,e===0?0:e)}},true);m.preserveToString(Map.prototype.get,B);m.preserveToString(Map.prototype.has,U)}var ln=new Set;var pn=Set.prototype["delete"]&&Set.prototype.add&&Set.prototype.has&&function(e){e["delete"](0);e.add(-0);return!e.has(0)}(ln);var vn=ln.add(1)===ln;if(!pn||!vn){var yn=Set.prototype.add;Set.prototype.add=function add(e){t(yn,this,e===0?0:e);return this};m.preserveToString(Set.prototype.add,yn)}if(!pn){var hn=Set.prototype.has;Set.prototype.has=function has(e){return t(hn,this,e===0?0:e)};m.preserveToString(Set.prototype.has,hn);var bn=Set.prototype["delete"];Set.prototype["delete"]=function SetDelete(e){return t(bn,this,e===0?0:e)};m.preserveToString(Set.prototype["delete"],bn)}var gn=w(S.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var dn=Object.setPrototypeOf&&!gn;var mn=function(){try{return!(S.Map()instanceof S.Map)}catch(e){return e instanceof TypeError}}();if(S.Map.length!==0||dn||!mn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new H;if(arguments.length>0){rn(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Map.prototype);return e};S.Map.prototype=H.prototype;h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,H)}var On=w(S.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var wn=Object.setPrototypeOf&&!On;var jn=function(){try{return!(S.Set()instanceof S.Set)}catch(e){return e instanceof TypeError}}();if(S.Set.length!==0||wn||!jn){var Sn=S.Set;S.Set=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}var e=new Sn;if(arguments.length>0){nn(Set,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Set.prototype);return e};S.Set.prototype=Sn.prototype;h(S.Set.prototype,"constructor",S.Set,true);m.preserveToString(S.Set,Sn)}var Tn=new S.Map;var In=!a(function(){return Tn.keys().next().done});if(typeof S.Map.prototype.clear!=="function"||(new S.Set).size!==0||Tn.size!==0||typeof S.Map.prototype.keys!=="function"||typeof S.Set.prototype.keys!=="function"||typeof S.Map.prototype.forEach!=="function"||typeof S.Set.prototype.forEach!=="function"||u(S.Map)||u(S.Set)||typeof Tn.keys().next!=="function"||In||!gn){b(S,{Map:on.Map,Set:on.Set},true)}if(S.Set.prototype.keys!==S.Set.prototype.values){h(S.Set.prototype,"keys",S.Set.prototype.values,true)}xe(Object.getPrototypeOf((new S.Map).keys()));xe(Object.getPrototypeOf((new S.Set).keys()));if(c&&S.Set.prototype.has.name!=="has"){var En=S.Set.prototype.has;oe(S.Set.prototype,"has",function has(e){return t(En,this,e)})}}b(S,on);Me(S.Map);Me(S.Set)}var Pn=function throwUnlessTargetIsObject(e){if(!le.TypeIsObject(e)){throw new TypeError("target must be an object")}};var Cn={apply:function apply(){return le.Call(le.Call,null,arguments)},construct:function construct(e,t){if(!le.IsConstructor(e)){throw new TypeError("First argument must be a constructor.")}var r=arguments.length>2?arguments[2]:e;if(!le.IsConstructor(r)){throw new TypeError("new.target must be a constructor.")}return le.Construct(e,t,r,"internal")},deleteProperty:function deleteProperty(e,t){Pn(e);if(s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable){return false}}return delete e[t]},has:function has(e,t){Pn(e);return t in e}};if(Object.getOwnPropertyNames){Object.assign(Cn,{ownKeys:function ownKeys(e){Pn(e);var t=Object.getOwnPropertyNames(e);if(le.IsCallable(Object.getOwnPropertySymbols)){x(t,Object.getOwnPropertySymbols(e))}return t}})}var Mn=function ConvertExceptionToBoolean(e){return!i(e)};if(Object.preventExtensions){Object.assign(Cn,{isExtensible:function isExtensible(e){Pn(e);return Object.isExtensible(e)},preventExtensions:function preventExtensions(e){Pn(e);return Mn(function(){return Object.preventExtensions(e)})}})}if(s){var xn=function get(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);if(!n){var o=Object.getPrototypeOf(e);if(o===null){return void 0}return xn(o,t,r)}if("value"in n){return n.value}if(n.get){return le.Call(n.get,r)}return void 0};var Nn=function set(e,r,n,o){var i=Object.getOwnPropertyDescriptor(e,r);if(!i){var a=Object.getPrototypeOf(e);if(a!==null){return Nn(a,r,n,o)}i={value:void 0,writable:true,enumerable:true,configurable:true}}if("value"in i){if(!i.writable){return false}if(!le.TypeIsObject(o)){return false}var u=Object.getOwnPropertyDescriptor(o,r);if(u){return ue.defineProperty(o,r,{value:n})}return ue.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}if(i.set){t(i.set,o,n);return true}return false};Object.assign(Cn,{defineProperty:function defineProperty(e,t,r){Pn(e);return Mn(function(){return Object.defineProperty(e,t,r)})},getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){Pn(e);return Object.getOwnPropertyDescriptor(e,t)},get:function get(e,t){Pn(e);var r=arguments.length>2?arguments[2]:e;return xn(e,t,r)},set:function set(e,t,r){Pn(e);var n=arguments.length>3?arguments[3]:e;return Nn(e,t,r,n)}})}if(Object.getPrototypeOf){var An=Object.getPrototypeOf;Cn.getPrototypeOf=function getPrototypeOf(e){Pn(e);return An(e)}}if(Object.setPrototypeOf&&Cn.getPrototypeOf){var _n=function(e,t){var r=t;while(r){if(e===r){return true}r=Cn.getPrototypeOf(r)}return false};Object.assign(Cn,{setPrototypeOf:function setPrototypeOf(e,t){Pn(e);if(t!==null&&!le.TypeIsObject(t)){throw new TypeError("proto must be an object or null")}if(t===ue.getPrototypeOf(e)){return true}if(ue.isExtensible&&!ue.isExtensible(e)){return false}if(_n(e,t)){return false}Object.setPrototypeOf(e,t);return true}})}var Rn=function(e,t){if(!le.IsCallable(S.Reflect[e])){h(S.Reflect,e,t)}else{var r=a(function(){S.Reflect[e](1);S.Reflect[e](NaN);S.Reflect[e](true);return true});if(r){oe(S.Reflect,e,t)}}};Object.keys(Cn).forEach(function(e){Rn(e,Cn[e])});var kn=S.Reflect.getPrototypeOf;if(c&&kn&&kn.name!=="getPrototypeOf"){oe(S.Reflect,"getPrototypeOf",function getPrototypeOf(e){return t(kn,S.Reflect,e)})}if(S.Reflect.setPrototypeOf){if(a(function(){S.Reflect.setPrototypeOf(1,{});return true})){oe(S.Reflect,"setPrototypeOf",Cn.setPrototypeOf)}}if(S.Reflect.defineProperty){if(!a(function(){var e=!S.Reflect.defineProperty(1,"test",{value:1});var t=typeof Object.preventExtensions!=="function"||!S.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})){oe(S.Reflect,"defineProperty",Cn.defineProperty)}}if(S.Reflect.construct){if(!a(function(){var e=function F(){};return S.Reflect.construct(function(){},[],e)instanceof e})){oe(S.Reflect,"construct",Cn.construct)}}if(String(new Date(NaN))!=="Invalid Date"){var Ln=Date.prototype.toString;var Fn=function toString(){var e=+this;if(e!==e){return"Invalid Date"}return le.Call(Ln,this)};oe(Date.prototype,"toString",Fn)}var Dn={anchor:function anchor(e){return le.CreateHTML(this,"a","name",e)},big:function big(){return le.CreateHTML(this,"big","","")},blink:function blink(){return le.CreateHTML(this,"blink","","")},bold:function bold(){return le.CreateHTML(this,"b","","")},fixed:function fixed(){return le.CreateHTML(this,"tt","","")},fontcolor:function fontcolor(e){return le.CreateHTML(this,"font","color",e)},fontsize:function fontsize(e){return le.CreateHTML(this,"font","size",e)},italics:function italics(){return le.CreateHTML(this,"i","","")},link:function link(e){return le.CreateHTML(this,"a","href",e)},small:function small(){return le.CreateHTML(this,"small","","")},strike:function strike(){return le.CreateHTML(this,"strike","","")},sub:function sub(){return le.CreateHTML(this,"sub","","")},sup:function sub(){return le.CreateHTML(this,"sup","","")}};l(Object.keys(Dn),function(e){var r=String.prototype[e];var n=false;if(le.IsCallable(r)){var o=t(r,"",' " ');var i=P([],o.match(/"/g)).length;n=o!==o.toLowerCase()||i>2}else{n=true}if(n){oe(String.prototype,e,Dn[e])}});var zn=function(){if(!ie){return false}var e=typeof JSON==="object"&&typeof JSON.stringify==="function"?JSON.stringify:null;if(!e){return false}if(typeof e(J())!=="undefined"){return true}if(e([J()])!=="[null]"){return true}var t={a:J()};t[J()]=true;if(e(t)!=="{}"){return true}return false}();var qn=a(function(){if(!ie){return true}return JSON.stringify(Object(J()))==="{}"&&JSON.stringify([Object(J())])==="[{}]"});if(zn||!qn){var Wn=JSON.stringify;oe(JSON,"stringify",function stringify(e){if(typeof e==="symbol"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[e];if(!r(n)){var i=le.IsCallable(n)?n:null;var a=function(e,r){var n=i?t(i,this,e,r):r;if(typeof n!=="symbol"){if(ne.symbol(n)){return _t({})(n)}return n}};o.push(a)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return Wn.apply(this,o)})}return S});
//# sourceMappingURL=es6-shim.map
/*! jQuery v3.7.1 | (c) OpenJS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(ie,e){"use strict";var oe=[],r=Object.getPrototypeOf,ae=oe.slice,g=oe.flat?function(e){return oe.flat.call(e)}:function(e){return oe.concat.apply([],e)},s=oe.push,se=oe.indexOf,n={},i=n.toString,ue=n.hasOwnProperty,o=ue.toString,a=o.call(Object),le={},v=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},y=function(e){return null!=e&&e===e.window},C=ie.document,u={type:!0,src:!0,nonce:!0,noModule:!0};function m(e,t,n){var r,i,o=(n=n||C).createElement("script");if(o.text=e,t)for(r in u)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function x(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[i.call(e)]||"object":typeof e}var t="3.7.1",l=/HTML$/i,ce=function(e,t){return new ce.fn.init(e,t)};function c(e){var t=!!e&&"length"in e&&e.length,n=x(e);return!v(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}function fe(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}ce.fn=ce.prototype={jquery:t,constructor:ce,length:0,toArray:function(){return ae.call(this)},get:function(e){return null==e?ae.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=ce.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return ce.each(this,e)},map:function(n){return this.pushStack(ce.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(ae.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(ce.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(ce.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:oe.sort,splice:oe.splice},ce.extend=ce.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||v(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(ce.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||ce.isPlainObject(n)?n:{},i=!1,a[t]=ce.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},ce.extend({expando:"jQuery"+(t+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==i.call(e))&&(!(t=r(e))||"function"==typeof(n=ue.call(t,"constructor")&&t.constructor)&&o.call(n)===a)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){m(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(c(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},text:function(e){var t,n="",r=0,i=e.nodeType;if(!i)while(t=e[r++])n+=ce.text(t);return 1===i||11===i?e.textContent:9===i?e.documentElement.textContent:3===i||4===i?e.nodeValue:n},makeArray:function(e,t){var n=t||[];return null!=e&&(c(Object(e))?ce.merge(n,"string"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:se.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!l.test(t||n&&n.nodeName||"HTML")},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(c(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:le}),"function"==typeof Symbol&&(ce.fn[Symbol.iterator]=oe[Symbol.iterator]),ce.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var pe=oe.pop,de=oe.sort,he=oe.splice,ge="[\\x20\\t\\r\\n\\f]",ve=new RegExp("^"+ge+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ge+"+$","g");ce.contains=function(e,t){var n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(e.contains?e.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))};var f=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function p(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}ce.escapeSelector=function(e){return(e+"").replace(f,p)};var ye=C,me=s;!function(){var e,b,w,o,a,T,r,C,d,i,k=me,S=ce.expando,E=0,n=0,s=W(),c=W(),u=W(),h=W(),l=function(e,t){return e===t&&(a=!0),0},f="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",t="(?:\\\\[\\da-fA-F]{1,6}"+ge+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",p="\\["+ge+"*("+t+")(?:"+ge+"*([*^$|!~]?=)"+ge+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+t+"))|)"+ge+"*\\]",g=":("+t+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+p+")*)|.*)\\)|)",v=new RegExp(ge+"+","g"),y=new RegExp("^"+ge+"*,"+ge+"*"),m=new RegExp("^"+ge+"*([>+~]|"+ge+")"+ge+"*"),x=new RegExp(ge+"|>"),j=new RegExp(g),A=new RegExp("^"+t+"$"),D={ID:new RegExp("^#("+t+")"),CLASS:new RegExp("^\\.("+t+")"),TAG:new RegExp("^("+t+"|[*])"),ATTR:new RegExp("^"+p),PSEUDO:new RegExp("^"+g),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ge+"*(even|odd|(([+-]|)(\\d*)n|)"+ge+"*(?:([+-]|)"+ge+"*(\\d+)|))"+ge+"*\\)|)","i"),bool:new RegExp("^(?:"+f+")$","i"),needsContext:new RegExp("^"+ge+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ge+"*((?:-\\d)?\\d*)"+ge+"*\\)|)(?=[^-]|$)","i")},N=/^(?:input|select|textarea|button)$/i,q=/^h\d$/i,L=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,H=/[+~]/,O=new RegExp("\\\\[\\da-fA-F]{1,6}"+ge+"?|\\\\([^\\r\\n\\f])","g"),P=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},M=function(){V()},R=J(function(e){return!0===e.disabled&&fe(e,"fieldset")},{dir:"parentNode",next:"legend"});try{k.apply(oe=ae.call(ye.childNodes),ye.childNodes),oe[ye.childNodes.length].nodeType}catch(e){k={apply:function(e,t){me.apply(e,ae.call(t))},call:function(e){me.apply(e,ae.call(arguments,1))}}}function I(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(V(e),e=e||T,C)){if(11!==p&&(u=L.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return k.call(n,a),n}else if(f&&(a=f.getElementById(i))&&I.contains(e,a)&&a.id===i)return k.call(n,a),n}else{if(u[2])return k.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&e.getElementsByClassName)return k.apply(n,e.getElementsByClassName(i)),n}if(!(h[t+" "]||d&&d.test(t))){if(c=t,f=e,1===p&&(x.test(t)||m.test(t))){(f=H.test(t)&&U(e.parentNode)||e)==e&&le.scope||((s=e.getAttribute("id"))?s=ce.escapeSelector(s):e.setAttribute("id",s=S)),o=(l=Y(t)).length;while(o--)l[o]=(s?"#"+s:":scope")+" "+Q(l[o]);c=l.join(",")}try{return k.apply(n,f.querySelectorAll(c)),n}catch(e){h(t,!0)}finally{s===S&&e.removeAttribute("id")}}}return re(t.replace(ve,"$1"),e,n,r)}function W(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function F(e){return e[S]=!0,e}function $(e){var t=T.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function B(t){return function(e){return fe(e,"input")&&e.type===t}}function _(t){return function(e){return(fe(e,"input")||fe(e,"button"))&&e.type===t}}function z(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&R(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function X(a){return F(function(o){return o=+o,F(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function U(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function V(e){var t,n=e?e.ownerDocument||e:ye;return n!=T&&9===n.nodeType&&n.documentElement&&(r=(T=n).documentElement,C=!ce.isXMLDoc(T),i=r.matches||r.webkitMatchesSelector||r.msMatchesSelector,r.msMatchesSelector&&ye!=T&&(t=T.defaultView)&&t.top!==t&&t.addEventListener("unload",M),le.getById=$(function(e){return r.appendChild(e).id=ce.expando,!T.getElementsByName||!T.getElementsByName(ce.expando).length}),le.disconnectedMatch=$(function(e){return i.call(e,"*")}),le.scope=$(function(){return T.querySelectorAll(":scope")}),le.cssHas=$(function(){try{return T.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}}),le.getById?(b.filter.ID=function(e){var t=e.replace(O,P);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&C){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(O,P);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&C){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},b.find.CLASS=function(e,t){if("undefined"!=typeof t.getElementsByClassName&&C)return t.getElementsByClassName(e)},d=[],$(function(e){var t;r.appendChild(e).innerHTML="<a id='"+S+"' href='' disabled='disabled'></a><select id='"+S+"-\r\\' disabled='disabled'><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+ge+"*(?:value|"+f+")"),e.querySelectorAll("[id~="+S+"-]").length||d.push("~="),e.querySelectorAll("a#"+S+"+*").length||d.push(".#.+[+~]"),e.querySelectorAll(":checked").length||d.push(":checked"),(t=T.createElement("input")).setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),r.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&d.push(":enabled",":disabled"),(t=T.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||d.push("\\["+ge+"*name"+ge+"*="+ge+"*(?:''|\"\")")}),le.cssHas||d.push(":has"),d=d.length&&new RegExp(d.join("|")),l=function(e,t){if(e===t)return a=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!le.sortDetached&&t.compareDocumentPosition(e)===n?e===T||e.ownerDocument==ye&&I.contains(ye,e)?-1:t===T||t.ownerDocument==ye&&I.contains(ye,t)?1:o?se.call(o,e)-se.call(o,t):0:4&n?-1:1)}),T}for(e in I.matches=function(e,t){return I(e,null,null,t)},I.matchesSelector=function(e,t){if(V(e),C&&!h[t+" "]&&(!d||!d.test(t)))try{var n=i.call(e,t);if(n||le.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){h(t,!0)}return 0<I(t,T,null,[e]).length},I.contains=function(e,t){return(e.ownerDocument||e)!=T&&V(e),ce.contains(e,t)},I.attr=function(e,t){(e.ownerDocument||e)!=T&&V(e);var n=b.attrHandle[t.toLowerCase()],r=n&&ue.call(b.attrHandle,t.toLowerCase())?n(e,t,!C):void 0;return void 0!==r?r:e.getAttribute(t)},I.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ce.uniqueSort=function(e){var t,n=[],r=0,i=0;if(a=!le.sortStable,o=!le.sortStable&&ae.call(e,0),de.call(e,l),a){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)he.call(e,n[r],1)}return o=null,e},ce.fn.uniqueSort=function(){return this.pushStack(ce.uniqueSort(ae.apply(this)))},(b=ce.expr={cacheLength:50,createPseudo:F,match:D,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(O,P),e[3]=(e[3]||e[4]||e[5]||"").replace(O,P),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||I.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&I.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return D.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&j.test(n)&&(t=Y(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(O,P).toLowerCase();return"*"===e?function(){return!0}:function(e){return fe(e,t)}},CLASS:function(e){var t=s[e+" "];return t||(t=new RegExp("(^|"+ge+")"+e+"("+ge+"|$)"))&&s(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=I.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(v," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(d,e,t,h,g){var v="nth"!==d.slice(0,3),y="last"!==d.slice(-4),m="of-type"===e;return 1===h&&0===g?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u=v!==y?"nextSibling":"previousSibling",l=e.parentNode,c=m&&e.nodeName.toLowerCase(),f=!n&&!m,p=!1;if(l){if(v){while(u){o=e;while(o=o[u])if(m?fe(o,c):1===o.nodeType)return!1;s=u="only"===d&&!s&&"nextSibling"}return!0}if(s=[y?l.firstChild:l.lastChild],y&&f){p=(a=(r=(i=l[S]||(l[S]={}))[d]||[])[0]===E&&r[1])&&r[2],o=a&&l.childNodes[a];while(o=++a&&o&&o[u]||(p=a=0)||s.pop())if(1===o.nodeType&&++p&&o===e){i[d]=[E,a,p];break}}else if(f&&(p=a=(r=(i=e[S]||(e[S]={}))[d]||[])[0]===E&&r[1]),!1===p)while(o=++a&&o&&o[u]||(p=a=0)||s.pop())if((m?fe(o,c):1===o.nodeType)&&++p&&(f&&((i=o[S]||(o[S]={}))[d]=[E,p]),o===e))break;return(p-=g)===h||p%h==0&&0<=p/h}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||I.error("unsupported pseudo: "+e);return a[S]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?F(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=se.call(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:F(function(e){var r=[],i=[],s=ne(e.replace(ve,"$1"));return s[S]?F(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:F(function(t){return function(e){return 0<I(t,e).length}}),contains:F(function(t){return t=t.replace(O,P),function(e){return-1<(e.textContent||ce.text(e)).indexOf(t)}}),lang:F(function(n){return A.test(n||"")||I.error("unsupported lang: "+n),n=n.replace(O,P).toLowerCase(),function(e){var t;do{if(t=C?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=ie.location&&ie.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===r},focus:function(e){return e===function(){try{return T.activeElement}catch(e){}}()&&T.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:z(!1),disabled:z(!0),checked:function(e){return fe(e,"input")&&!!e.checked||fe(e,"option")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return q.test(e.nodeName)},input:function(e){return N.test(e.nodeName)},button:function(e){return fe(e,"input")&&"button"===e.type||fe(e,"button")},text:function(e){var t;return fe(e,"input")&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:X(function(){return[0]}),last:X(function(e,t){return[t-1]}),eq:X(function(e,t,n){return[n<0?n+t:n]}),even:X(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:X(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:X(function(e,t,n){var r;for(r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:X(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=B(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=_(e);function G(){}function Y(e,t){var n,r,i,o,a,s,u,l=c[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=y.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=m.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(ve," ")}),a=a.slice(n.length)),b.filter)!(r=D[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?I.error(e):c(e,s).slice(0)}function Q(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function J(a,e,t){var s=e.dir,u=e.next,l=u||s,c=t&&"parentNode"===l,f=n++;return e.first?function(e,t,n){while(e=e[s])if(1===e.nodeType||c)return a(e,t,n);return!1}:function(e,t,n){var r,i,o=[E,f];if(n){while(e=e[s])if((1===e.nodeType||c)&&a(e,t,n))return!0}else while(e=e[s])if(1===e.nodeType||c)if(i=e[S]||(e[S]={}),u&&fe(e,u))e=e[s]||e;else{if((r=i[l])&&r[0]===E&&r[1]===f)return o[2]=r[2];if((i[l]=o)[2]=a(e,t,n))return!0}return!1}}function K(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Z(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function ee(d,h,g,v,y,e){return v&&!v[S]&&(v=ee(v)),y&&!y[S]&&(y=ee(y,e)),F(function(e,t,n,r){var i,o,a,s,u=[],l=[],c=t.length,f=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)I(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),p=!d||!e&&h?f:Z(f,u,d,n,r);if(g?g(p,s=y||(e?d:c||v)?[]:t,n,r):s=p,v){i=Z(s,l),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(s[l[o]]=!(p[l[o]]=a))}if(e){if(y||d){if(y){i=[],o=s.length;while(o--)(a=s[o])&&i.push(p[o]=a);y(null,s=[],i,r)}o=s.length;while(o--)(a=s[o])&&-1<(i=y?se.call(e,a):u[o])&&(e[i]=!(t[i]=a))}}else s=Z(s===t?s.splice(c,s.length):s),y?y(null,t,s,r):k.apply(t,s)})}function te(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=J(function(e){return e===i},a,!0),l=J(function(e){return-1<se.call(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!=w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[J(K(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return ee(1<s&&K(c),1<s&&Q(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(ve,"$1"),t,s<n&&te(e.slice(s,n)),n<r&&te(e=e.slice(n)),n<r&&Q(e))}c.push(t)}return K(c)}function ne(e,t){var n,v,y,m,x,r,i=[],o=[],a=u[e+" "];if(!a){t||(t=Y(e)),n=t.length;while(n--)(a=te(t[n]))[S]?i.push(a):o.push(a);(a=u(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=E+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==T||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==T||(V(o),n=!C);while(s=v[a++])if(s(o,t||T,n)){k.call(r,o);break}i&&(E=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=pe.call(r));f=Z(f)}k.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&ce.uniqueSort(r)}return i&&(E=h,w=p),c},m?F(r):r))).selector=e}return a}function re(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&Y(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&C&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(O,P),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=D.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(O,P),H.test(o[0].type)&&U(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&Q(o)))return k.apply(n,r),n;break}}}return(l||ne(e,c))(r,t,!C,n,!t||H.test(e)&&U(t.parentNode)||t),n}G.prototype=b.filters=b.pseudos,b.setFilters=new G,le.sortStable=S.split("").sort(l).join("")===S,V(),le.sortDetached=$(function(e){return 1&e.compareDocumentPosition(T.createElement("fieldset"))}),ce.find=I,ce.expr[":"]=ce.expr.pseudos,ce.unique=ce.uniqueSort,I.compile=ne,I.select=re,I.setDocument=V,I.tokenize=Y,I.escape=ce.escapeSelector,I.getText=ce.text,I.isXML=ce.isXMLDoc,I.selectors=ce.expr,I.support=ce.support,I.uniqueSort=ce.uniqueSort}();var d=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&ce(e).is(n))break;r.push(e)}return r},h=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},b=ce.expr.match.needsContext,w=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function T(e,n,r){return v(n)?ce.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?ce.grep(e,function(e){return e===n!==r}):"string"!=typeof n?ce.grep(e,function(e){return-1<se.call(n,e)!==r}):ce.filter(n,e,r)}ce.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?ce.find.matchesSelector(r,e)?[r]:[]:ce.find.matches(e,ce.grep(t,function(e){return 1===e.nodeType}))},ce.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(ce(e).filter(function(){for(t=0;t<r;t++)if(ce.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)ce.find(e,i[t],n);return 1<r?ce.uniqueSort(n):n},filter:function(e){return this.pushStack(T(this,e||[],!1))},not:function(e){return this.pushStack(T(this,e||[],!0))},is:function(e){return!!T(this,"string"==typeof e&&b.test(e)?ce(e):e||[],!1).length}});var k,S=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(ce.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||k,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:S.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof ce?t[0]:t,ce.merge(this,ce.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:C,!0)),w.test(r[1])&&ce.isPlainObject(t))for(r in t)v(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=C.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==n.ready?n.ready(e):e(ce):ce.makeArray(e,this)}).prototype=ce.fn,k=ce(C);var E=/^(?:parents|prev(?:Until|All))/,j={children:!0,contents:!0,next:!0,prev:!0};function A(e,t){while((e=e[t])&&1!==e.nodeType);return e}ce.fn.extend({has:function(e){var t=ce(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(ce.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&ce(e);if(!b.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&ce.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?ce.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?se.call(ce(e),this[0]):se.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(ce.uniqueSort(ce.merge(this.get(),ce(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ce.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return d(e,"parentNode")},parentsUntil:function(e,t,n){return d(e,"parentNode",n)},next:function(e){return A(e,"nextSibling")},prev:function(e){return A(e,"previousSibling")},nextAll:function(e){return d(e,"nextSibling")},prevAll:function(e){return d(e,"previousSibling")},nextUntil:function(e,t,n){return d(e,"nextSibling",n)},prevUntil:function(e,t,n){return d(e,"previousSibling",n)},siblings:function(e){return h((e.parentNode||{}).firstChild,e)},children:function(e){return h(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(fe(e,"template")&&(e=e.content||e),ce.merge([],e.childNodes))}},function(r,i){ce.fn[r]=function(e,t){var n=ce.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=ce.filter(t,n)),1<this.length&&(j[r]||ce.uniqueSort(n),E.test(r)&&n.reverse()),this.pushStack(n)}});var D=/[^\x20\t\r\n\f]+/g;function N(e){return e}function q(e){throw e}function L(e,t,n,r){var i;try{e&&v(i=e.promise)?i.call(e).done(t).fail(n):e&&v(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}ce.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},ce.each(e.match(D)||[],function(e,t){n[t]=!0}),n):ce.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){ce.each(e,function(e,t){v(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==x(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return ce.each(arguments,function(e,t){var n;while(-1<(n=ce.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<ce.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},ce.extend({Deferred:function(e){var o=[["notify","progress",ce.Callbacks("memory"),ce.Callbacks("memory"),2],["resolve","done",ce.Callbacks("once memory"),ce.Callbacks("once memory"),0,"resolved"],["reject","fail",ce.Callbacks("once memory"),ce.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return ce.Deferred(function(r){ce.each(o,function(e,t){var n=v(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&v(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,v(t)?s?t.call(e,l(u,o,N,s),l(u,o,q,s)):(u++,t.call(e,l(u,o,N,s),l(u,o,q,s),l(u,o,N,o.notifyWith))):(a!==N&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){ce.Deferred.exceptionHook&&ce.Deferred.exceptionHook(e,t.error),u<=i+1&&(a!==q&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(ce.Deferred.getErrorHook?t.error=ce.Deferred.getErrorHook():ce.Deferred.getStackHook&&(t.error=ce.Deferred.getStackHook()),ie.setTimeout(t))}}return ce.Deferred(function(e){o[0][3].add(l(0,e,v(r)?r:N,e.notifyWith)),o[1][3].add(l(0,e,v(t)?t:N)),o[2][3].add(l(0,e,v(n)?n:q))}).promise()},promise:function(e){return null!=e?ce.extend(e,a):a}},s={};return ce.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=ae.call(arguments),o=ce.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?ae.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(L(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||v(i[t]&&i[t].then)))return o.then();while(t--)L(i[t],a(t),o.reject);return o.promise()}});var H=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;ce.Deferred.exceptionHook=function(e,t){ie.console&&ie.console.warn&&e&&H.test(e.name)&&ie.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},ce.readyException=function(e){ie.setTimeout(function(){throw e})};var O=ce.Deferred();function P(){C.removeEventListener("DOMContentLoaded",P),ie.removeEventListener("load",P),ce.ready()}ce.fn.ready=function(e){return O.then(e)["catch"](function(e){ce.readyException(e)}),this},ce.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--ce.readyWait:ce.isReady)||(ce.isReady=!0)!==e&&0<--ce.readyWait||O.resolveWith(C,[ce])}}),ce.ready.then=O.then,"complete"===C.readyState||"loading"!==C.readyState&&!C.documentElement.doScroll?ie.setTimeout(ce.ready):(C.addEventListener("DOMContentLoaded",P),ie.addEventListener("load",P));var M=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===x(n))for(s in i=!0,n)M(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,v(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(ce(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},R=/^-ms-/,I=/-([a-z])/g;function W(e,t){return t.toUpperCase()}function F(e){return e.replace(R,"ms-").replace(I,W)}var $=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function B(){this.expando=ce.expando+B.uid++}B.uid=1,B.prototype={cache:function(e){var t=e[this.expando];return t||(t={},$(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[F(t)]=n;else for(r in t)i[F(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][F(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(F):(t=F(t))in r?[t]:t.match(D)||[]).length;while(n--)delete r[t[n]]}(void 0===t||ce.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!ce.isEmptyObject(t)}};var _=new B,z=new B,X=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,U=/[A-Z]/g;function V(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(U,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:X.test(i)?JSON.parse(i):i)}catch(e){}z.set(e,t,n)}else n=void 0;return n}ce.extend({hasData:function(e){return z.hasData(e)||_.hasData(e)},data:function(e,t,n){return z.access(e,t,n)},removeData:function(e,t){z.remove(e,t)},_data:function(e,t,n){return _.access(e,t,n)},_removeData:function(e,t){_.remove(e,t)}}),ce.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=z.get(o),1===o.nodeType&&!_.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=F(r.slice(5)),V(o,r,i[r]));_.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){z.set(this,n)}):M(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=z.get(o,n))?t:void 0!==(t=V(o,n))?t:void 0;this.each(function(){z.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){z.remove(this,e)})}}),ce.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=_.get(e,t),n&&(!r||Array.isArray(n)?r=_.access(e,t,ce.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=ce.queue(e,t),r=n.length,i=n.shift(),o=ce._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){ce.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return _.get(e,n)||_.access(e,n,{empty:ce.Callbacks("once memory").add(function(){_.remove(e,[t+"queue",n])})})}}),ce.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?ce.queue(this[0],t):void 0===n?this:this.each(function(){var e=ce.queue(this,t,n);ce._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&ce.dequeue(this,t)})},dequeue:function(e){return this.each(function(){ce.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=ce.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=_.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var G=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Y=new RegExp("^(?:([+-])=|)("+G+")([a-z%]*)$","i"),Q=["Top","Right","Bottom","Left"],J=C.documentElement,K=function(e){return ce.contains(e.ownerDocument,e)},Z={composed:!0};J.getRootNode&&(K=function(e){return ce.contains(e.ownerDocument,e)||e.getRootNode(Z)===e.ownerDocument});var ee=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&K(e)&&"none"===ce.css(e,"display")};function te(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return ce.css(e,t,"")},u=s(),l=n&&n[3]||(ce.cssNumber[t]?"":"px"),c=e.nodeType&&(ce.cssNumber[t]||"px"!==l&&+u)&&Y.exec(ce.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)ce.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,ce.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ne={};function re(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=_.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&ee(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ne[s])||(o=a.body.appendChild(a.createElement(s)),u=ce.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ne[s]=u)))):"none"!==n&&(l[c]="none",_.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}ce.fn.extend({show:function(){return re(this,!0)},hide:function(){return re(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ee(this)?ce(this).show():ce(this).hide()})}});var xe,be,we=/^(?:checkbox|radio)$/i,Te=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Ce=/^$|^module$|\/(?:java|ecma)script/i;xe=C.createDocumentFragment().appendChild(C.createElement("div")),(be=C.createElement("input")).setAttribute("type","radio"),be.setAttribute("checked","checked"),be.setAttribute("name","t"),xe.appendChild(be),le.checkClone=xe.cloneNode(!0).cloneNode(!0).lastChild.checked,xe.innerHTML="<textarea>x</textarea>",le.noCloneChecked=!!xe.cloneNode(!0).lastChild.defaultValue,xe.innerHTML="<option></option>",le.option=!!xe.lastChild;var ke={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Se(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&fe(e,t)?ce.merge([e],n):n}function Ee(e,t){for(var n=0,r=e.length;n<r;n++)_.set(e[n],"globalEval",!t||_.get(t[n],"globalEval"))}ke.tbody=ke.tfoot=ke.colgroup=ke.caption=ke.thead,ke.th=ke.td,le.option||(ke.optgroup=ke.option=[1,"<select multiple='multiple'>","</select>"]);var je=/<|&#?\w+;/;function Ae(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===x(o))ce.merge(p,o.nodeType?[o]:o);else if(je.test(o)){a=a||f.appendChild(t.createElement("div")),s=(Te.exec(o)||["",""])[1].toLowerCase(),u=ke[s]||ke._default,a.innerHTML=u[1]+ce.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;ce.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<ce.inArray(o,r))i&&i.push(o);else if(l=K(o),a=Se(f.appendChild(o),"script"),l&&Ee(a),n){c=0;while(o=a[c++])Ce.test(o.type||"")&&n.push(o)}return f}var De=/^([^.]*)(?:\.(.+)|)/;function Ne(){return!0}function qe(){return!1}function Le(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Le(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=qe;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return ce().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=ce.guid++)),e.each(function(){ce.event.add(this,t,i,r,n)})}function He(e,r,t){t?(_.set(e,r,!1),ce.event.add(e,r,{namespace:!1,handler:function(e){var t,n=_.get(this,r);if(1&e.isTrigger&&this[r]){if(n)(ce.event.special[r]||{}).delegateType&&e.stopPropagation();else if(n=ae.call(arguments),_.set(this,r,n),this[r](),t=_.get(this,r),_.set(this,r,!1),n!==t)return e.stopImmediatePropagation(),e.preventDefault(),t}else n&&(_.set(this,r,ce.event.trigger(n[0],n.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Ne)}})):void 0===_.get(e,r)&&ce.event.add(e,r,Ne)}ce.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=_.get(t);if($(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&ce.find.matchesSelector(J,i),n.guid||(n.guid=ce.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof ce&&ce.event.triggered!==e.type?ce.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(D)||[""]).length;while(l--)d=g=(s=De.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=ce.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=ce.event.special[d]||{},c=ce.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&ce.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),ce.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=_.hasData(e)&&_.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(D)||[""]).length;while(l--)if(d=g=(s=De.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=ce.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||ce.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)ce.event.remove(e,d+t[l],n,r,!0);ce.isEmptyObject(u)&&_.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=ce.event.fix(e),l=(_.get(this,"events")||Object.create(null))[u.type]||[],c=ce.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=ce.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((ce.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<ce(i,this).index(l):ce.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(ce.Event.prototype,t,{enumerable:!0,configurable:!0,get:v(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[ce.expando]?e:new ce.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return we.test(t.type)&&t.click&&fe(t,"input")&&He(t,"click",!0),!1},trigger:function(e){var t=this||e;return we.test(t.type)&&t.click&&fe(t,"input")&&He(t,"click"),!0},_default:function(e){var t=e.target;return we.test(t.type)&&t.click&&fe(t,"input")&&_.get(t,"click")||fe(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},ce.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},ce.Event=function(e,t){if(!(this instanceof ce.Event))return new ce.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ne:qe,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&ce.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[ce.expando]=!0},ce.Event.prototype={constructor:ce.Event,isDefaultPrevented:qe,isPropagationStopped:qe,isImmediatePropagationStopped:qe,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ne,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ne,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ne,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},ce.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},ce.event.addProp),ce.each({focus:"focusin",blur:"focusout"},function(r,i){function o(e){if(C.documentMode){var t=_.get(this,"handle"),n=ce.event.fix(e);n.type="focusin"===e.type?"focus":"blur",n.isSimulated=!0,t(e),n.target===n.currentTarget&&t(n)}else ce.event.simulate(i,e.target,ce.event.fix(e))}ce.event.special[r]={setup:function(){var e;if(He(this,r,!0),!C.documentMode)return!1;(e=_.get(this,i))||this.addEventListener(i,o),_.set(this,i,(e||0)+1)},trigger:function(){return He(this,r),!0},teardown:function(){var e;if(!C.documentMode)return!1;(e=_.get(this,i)-1)?_.set(this,i,e):(this.removeEventListener(i,o),_.remove(this,i))},_default:function(e){return _.get(e.target,r)},delegateType:i},ce.event.special[i]={setup:function(){var e=this.ownerDocument||this.document||this,t=C.documentMode?this:e,n=_.get(t,i);n||(C.documentMode?this.addEventListener(i,o):e.addEventListener(r,o,!0)),_.set(t,i,(n||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=C.documentMode?this:e,n=_.get(t,i)-1;n?_.set(t,i,n):(C.documentMode?this.removeEventListener(i,o):e.removeEventListener(r,o,!0),_.remove(t,i))}}}),ce.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){ce.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||ce.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),ce.fn.extend({on:function(e,t,n,r){return Le(this,e,t,n,r)},one:function(e,t,n,r){return Le(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,ce(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=qe),this.each(function(){ce.event.remove(this,e,n,t)})}});var Oe=/<script|<style|<link/i,Pe=/checked\s*(?:[^=]|=\s*.checked.)/i,Me=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Re(e,t){return fe(e,"table")&&fe(11!==t.nodeType?t:t.firstChild,"tr")&&ce(e).children("tbody")[0]||e}function Ie(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function We(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Fe(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(_.hasData(e)&&(s=_.get(e).events))for(i in _.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)ce.event.add(t,i,s[i][n]);z.hasData(e)&&(o=z.access(e),a=ce.extend({},o),z.set(t,a))}}function $e(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=v(d);if(h||1<f&&"string"==typeof d&&!le.checkClone&&Pe.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),$e(t,r,i,o)});if(f&&(t=(e=Ae(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=ce.map(Se(e,"script"),Ie)).length;c<f;c++)u=e,c!==p&&(u=ce.clone(u,!0,!0),s&&ce.merge(a,Se(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,ce.map(a,We),c=0;c<s;c++)u=a[c],Ce.test(u.type||"")&&!_.access(u,"globalEval")&&ce.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?ce._evalUrl&&!u.noModule&&ce._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")},l):m(u.textContent.replace(Me,""),u,l))}return n}function Be(e,t,n){for(var r,i=t?ce.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||ce.cleanData(Se(r)),r.parentNode&&(n&&K(r)&&Ee(Se(r,"script")),r.parentNode.removeChild(r));return e}ce.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=K(e);if(!(le.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ce.isXMLDoc(e)))for(a=Se(c),r=0,i=(o=Se(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&we.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||Se(e),a=a||Se(c),r=0,i=o.length;r<i;r++)Fe(o[r],a[r]);else Fe(e,c);return 0<(a=Se(c,"script")).length&&Ee(a,!f&&Se(e,"script")),c},cleanData:function(e){for(var t,n,r,i=ce.event.special,o=0;void 0!==(n=e[o]);o++)if($(n)){if(t=n[_.expando]){if(t.events)for(r in t.events)i[r]?ce.event.remove(n,r):ce.removeEvent(n,r,t.handle);n[_.expando]=void 0}n[z.expando]&&(n[z.expando]=void 0)}}}),ce.fn.extend({detach:function(e){return Be(this,e,!0)},remove:function(e){return Be(this,e)},text:function(e){return M(this,function(e){return void 0===e?ce.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return $e(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Re(this,e).appendChild(e)})},prepend:function(){return $e(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Re(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return $e(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return $e(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(ce.cleanData(Se(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return ce.clone(this,e,t)})},html:function(e){return M(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Oe.test(e)&&!ke[(Te.exec(e)||["",""])[1].toLowerCase()]){e=ce.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(ce.cleanData(Se(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return $e(this,arguments,function(e){var t=this.parentNode;ce.inArray(this,n)<0&&(ce.cleanData(Se(this)),t&&t.replaceChild(e,this))},n)}}),ce.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){ce.fn[e]=function(e){for(var t,n=[],r=ce(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),ce(r[o])[a](t),s.apply(n,t.get());return this.pushStack(n)}});var _e=new RegExp("^("+G+")(?!px)[a-z%]+$","i"),ze=/^--/,Xe=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=ie),t.getComputedStyle(e)},Ue=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ve=new RegExp(Q.join("|"),"i");function Ge(e,t,n){var r,i,o,a,s=ze.test(t),u=e.style;return(n=n||Xe(e))&&(a=n.getPropertyValue(t)||n[t],s&&a&&(a=a.replace(ve,"$1")||void 0),""!==a||K(e)||(a=ce.style(e,t)),!le.pixelBoxStyles()&&_e.test(a)&&Ve.test(t)&&(r=u.width,i=u.minWidth,o=u.maxWidth,u.minWidth=u.maxWidth=u.width=a,a=n.width,u.width=r,u.minWidth=i,u.maxWidth=o)),void 0!==a?a+"":a}function Ye(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",J.appendChild(u).appendChild(l);var e=ie.getComputedStyle(l);n="1%"!==e.top,s=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),r=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),J.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=C.createElement("div"),l=C.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",le.clearCloneStyle="content-box"===l.style.backgroundClip,ce.extend(le,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=C.createElement("table"),t=C.createElement("tr"),n=C.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="box-sizing:content-box;border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",J.appendChild(e).appendChild(t).appendChild(n),r=ie.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,J.removeChild(e)),a}}))}();var Qe=["Webkit","Moz","ms"],Je=C.createElement("div").style,Ke={};function Ze(e){var t=ce.cssProps[e]||Ke[e];return t||(e in Je?e:Ke[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Qe.length;while(n--)if((e=Qe[n]+t)in Je)return e}(e)||e)}var et=/^(none|table(?!-c[ea]).+)/,tt={position:"absolute",visibility:"hidden",display:"block"},nt={letterSpacing:"0",fontWeight:"400"};function rt(e,t,n){var r=Y.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function it(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0,l=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(l+=ce.css(e,n+Q[a],!0,i)),r?("content"===n&&(u-=ce.css(e,"padding"+Q[a],!0,i)),"margin"!==n&&(u-=ce.css(e,"border"+Q[a]+"Width",!0,i))):(u+=ce.css(e,"padding"+Q[a],!0,i),"padding"!==n?u+=ce.css(e,"border"+Q[a]+"Width",!0,i):s+=ce.css(e,"border"+Q[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u+l}function ot(e,t,n){var r=Xe(e),i=(!le.boxSizingReliable()||n)&&"border-box"===ce.css(e,"boxSizing",!1,r),o=i,a=Ge(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(_e.test(a)){if(!n)return a;a="auto"}return(!le.boxSizingReliable()&&i||!le.reliableTrDimensions()&&fe(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===ce.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===ce.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+it(e,t,n||(i?"border":"content"),o,r,a)+"px"}function at(e,t,n,r,i){return new at.prototype.init(e,t,n,r,i)}ce.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ge(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=F(t),u=ze.test(t),l=e.style;if(u||(t=Ze(s)),a=ce.cssHooks[t]||ce.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=Y.exec(n))&&i[1]&&(n=te(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(ce.cssNumber[s]?"":"px")),le.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=F(t);return ze.test(t)||(t=Ze(s)),(a=ce.cssHooks[t]||ce.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Ge(e,t,r)),"normal"===i&&t in nt&&(i=nt[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),ce.each(["height","width"],function(e,u){ce.cssHooks[u]={get:function(e,t,n){if(t)return!et.test(ce.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?ot(e,u,n):Ue(e,tt,function(){return ot(e,u,n)})},set:function(e,t,n){var r,i=Xe(e),o=!le.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===ce.css(e,"boxSizing",!1,i),s=n?it(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-it(e,u,"border",!1,i)-.5)),s&&(r=Y.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=ce.css(e,u)),rt(0,t,s)}}}),ce.cssHooks.marginLeft=Ye(le.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Ge(e,"marginLeft"))||e.getBoundingClientRect().left-Ue(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),ce.each({margin:"",padding:"",border:"Width"},function(i,o){ce.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+Q[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(ce.cssHooks[i+o].set=rt)}),ce.fn.extend({css:function(e,t){return M(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Xe(e),i=t.length;a<i;a++)o[t[a]]=ce.css(e,t[a],!1,r);return o}return void 0!==n?ce.style(e,t,n):ce.css(e,t)},e,t,1<arguments.length)}}),((ce.Tween=at).prototype={constructor:at,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||ce.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(ce.cssNumber[n]?"":"px")},cur:function(){var e=at.propHooks[this.prop];return e&&e.get?e.get(this):at.propHooks._default.get(this)},run:function(e){var t,n=at.propHooks[this.prop];return this.options.duration?this.pos=t=ce.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):at.propHooks._default.set(this),this}}).init.prototype=at.prototype,(at.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=ce.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){ce.fx.step[e.prop]?ce.fx.step[e.prop](e):1!==e.elem.nodeType||!ce.cssHooks[e.prop]&&null==e.elem.style[Ze(e.prop)]?e.elem[e.prop]=e.now:ce.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=at.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ce.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},ce.fx=at.prototype.init,ce.fx.step={};var st,ut,lt,ct,ft=/^(?:toggle|show|hide)$/,pt=/queueHooks$/;function dt(){ut&&(!1===C.hidden&&ie.requestAnimationFrame?ie.requestAnimationFrame(dt):ie.setTimeout(dt,ce.fx.interval),ce.fx.tick())}function ht(){return ie.setTimeout(function(){st=void 0}),st=Date.now()}function gt(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=Q[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function vt(e,t,n){for(var r,i=(yt.tweeners[t]||[]).concat(yt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function yt(o,e,t){var n,a,r=0,i=yt.prefilters.length,s=ce.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=st||ht(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:ce.extend({},e),opts:ce.extend(!0,{specialEasing:{},easing:ce.easing._default},t),originalProperties:e,originalOptions:t,startTime:st||ht(),duration:t.duration,tweens:[],createTween:function(e,t){var n=ce.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=F(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=ce.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=yt.prefilters[r].call(l,o,c,l.opts))return v(n.stop)&&(ce._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return ce.map(c,vt,l),v(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),ce.fx.timer(ce.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}ce.Animation=ce.extend(yt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return te(n.elem,e,Y.exec(t),n),n}]},tweener:function(e,t){v(e)?(t=e,e=["*"]):e=e.match(D);for(var n,r=0,i=e.length;r<i;r++)n=e[r],yt.tweeners[n]=yt.tweeners[n]||[],yt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ee(e),v=_.get(e,"fxshow");for(r in n.queue||(null==(a=ce._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,ce.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],ft.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||ce.style(e,r)}if((u=!ce.isEmptyObject(t))||!ce.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=_.get(e,"display")),"none"===(c=ce.css(e,"display"))&&(l?c=l:(re([e],!0),l=e.style.display||l,c=ce.css(e,"display"),re([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===ce.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=_.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&re([e],!0),p.done(function(){for(r in g||re([e]),_.remove(e,"fxshow"),d)ce.style(e,r,d[r])})),u=vt(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?yt.prefilters.unshift(e):yt.prefilters.push(e)}}),ce.speed=function(e,t,n){var r=e&&"object"==typeof e?ce.extend({},e):{complete:n||!n&&t||v(e)&&e,duration:e,easing:n&&t||t&&!v(t)&&t};return ce.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in ce.fx.speeds?r.duration=ce.fx.speeds[r.duration]:r.duration=ce.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){v(r.old)&&r.old.call(this),r.queue&&ce.dequeue(this,r.queue)},r},ce.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ee).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=ce.isEmptyObject(t),o=ce.speed(e,n,r),a=function(){var e=yt(this,ce.extend({},t),o);(i||_.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=ce.timers,r=_.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&pt.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||ce.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=_.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=ce.timers,o=n?n.length:0;for(t.finish=!0,ce.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),ce.each(["toggle","show","hide"],function(e,r){var i=ce.fn[r];ce.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(gt(r,!0),e,t,n)}}),ce.each({slideDown:gt("show"),slideUp:gt("hide"),slideToggle:gt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){ce.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),ce.timers=[],ce.fx.tick=function(){var e,t=0,n=ce.timers;for(st=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||ce.fx.stop(),st=void 0},ce.fx.timer=function(e){ce.timers.push(e),ce.fx.start()},ce.fx.interval=13,ce.fx.start=function(){ut||(ut=!0,dt())},ce.fx.stop=function(){ut=null},ce.fx.speeds={slow:600,fast:200,_default:400},ce.fn.delay=function(r,e){return r=ce.fx&&ce.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=ie.setTimeout(e,r);t.stop=function(){ie.clearTimeout(n)}})},lt=C.createElement("input"),ct=C.createElement("select").appendChild(C.createElement("option")),lt.type="checkbox",le.checkOn=""!==lt.value,le.optSelected=ct.selected,(lt=C.createElement("input")).value="t",lt.type="radio",le.radioValue="t"===lt.value;var mt,xt=ce.expr.attrHandle;ce.fn.extend({attr:function(e,t){return M(this,ce.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){ce.removeAttr(this,e)})}}),ce.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?ce.prop(e,t,n):(1===o&&ce.isXMLDoc(e)||(i=ce.attrHooks[t.toLowerCase()]||(ce.expr.match.bool.test(t)?mt:void 0)),void 0!==n?null===n?void ce.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=ce.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!le.radioValue&&"radio"===t&&fe(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(D);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),mt={set:function(e,t,n){return!1===t?ce.removeAttr(e,n):e.setAttribute(n,n),n}},ce.each(ce.expr.match.bool.source.match(/\w+/g),function(e,t){var a=xt[t]||ce.find.attr;xt[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=xt[o],xt[o]=r,r=null!=a(e,t,n)?o:null,xt[o]=i),r}});var bt=/^(?:input|select|textarea|button)$/i,wt=/^(?:a|area)$/i;function Tt(e){return(e.match(D)||[]).join(" ")}function Ct(e){return e.getAttribute&&e.getAttribute("class")||""}function kt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(D)||[]}ce.fn.extend({prop:function(e,t){return M(this,ce.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[ce.propFix[e]||e]})}}),ce.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&ce.isXMLDoc(e)||(t=ce.propFix[t]||t,i=ce.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=ce.find.attr(e,"tabindex");return t?parseInt(t,10):bt.test(e.nodeName)||wt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),le.optSelected||(ce.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),ce.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ce.propFix[this.toLowerCase()]=this}),ce.fn.extend({addClass:function(t){var e,n,r,i,o,a;return v(t)?this.each(function(e){ce(this).addClass(t.call(this,e,Ct(this)))}):(e=kt(t)).length?this.each(function(){if(r=Ct(this),n=1===this.nodeType&&" "+Tt(r)+" "){for(o=0;o<e.length;o++)i=e[o],n.indexOf(" "+i+" ")<0&&(n+=i+" ");a=Tt(n),r!==a&&this.setAttribute("class",a)}}):this},removeClass:function(t){var e,n,r,i,o,a;return v(t)?this.each(function(e){ce(this).removeClass(t.call(this,e,Ct(this)))}):arguments.length?(e=kt(t)).length?this.each(function(){if(r=Ct(this),n=1===this.nodeType&&" "+Tt(r)+" "){for(o=0;o<e.length;o++){i=e[o];while(-1<n.indexOf(" "+i+" "))n=n.replace(" "+i+" "," ")}a=Tt(n),r!==a&&this.setAttribute("class",a)}}):this:this.attr("class","")},toggleClass:function(t,n){var e,r,i,o,a=typeof t,s="string"===a||Array.isArray(t);return v(t)?this.each(function(e){ce(this).toggleClass(t.call(this,e,Ct(this),n),n)}):"boolean"==typeof n&&s?n?this.addClass(t):this.removeClass(t):(e=kt(t),this.each(function(){if(s)for(o=ce(this),i=0;i<e.length;i++)r=e[i],o.hasClass(r)?o.removeClass(r):o.addClass(r);else void 0!==t&&"boolean"!==a||((r=Ct(this))&&_.set(this,"__className__",r),this.setAttribute&&this.setAttribute("class",r||!1===t?"":_.get(this,"__className__")||""))}))},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+Tt(Ct(n))+" ").indexOf(t))return!0;return!1}});var St=/\r/g;ce.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=v(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,ce(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=ce.map(t,function(e){return null==e?"":e+""})),(r=ce.valHooks[this.type]||ce.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=ce.valHooks[t.type]||ce.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(St,""):null==e?"":e:void 0}}),ce.extend({valHooks:{option:{get:function(e){var t=ce.find.attr(e,"value");return null!=t?t:Tt(ce.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!fe(n.parentNode,"optgroup"))){if(t=ce(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=ce.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<ce.inArray(ce.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),ce.each(["radio","checkbox"],function(){ce.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<ce.inArray(ce(e).val(),t)}},le.checkOn||(ce.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Et=ie.location,jt={guid:Date.now()},At=/\?/;ce.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new ie.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||ce.error("Invalid XML: "+(n?ce.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var Dt=/^(?:focusinfocus|focusoutblur)$/,Nt=function(e){e.stopPropagation()};ce.extend(ce.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||C],d=ue.call(e,"type")?e.type:e,h=ue.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||C,3!==n.nodeType&&8!==n.nodeType&&!Dt.test(d+ce.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[ce.expando]?e:new ce.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:ce.makeArray(t,[e]),c=ce.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!y(n)){for(s=c.delegateType||d,Dt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||C)&&p.push(a.defaultView||a.parentWindow||ie)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(_.get(o,"events")||Object.create(null))[e.type]&&_.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&$(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!$(n)||u&&v(n[d])&&!y(n)&&((a=n[u])&&(n[u]=null),ce.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,Nt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,Nt),ce.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=ce.extend(new ce.Event,n,{type:e,isSimulated:!0});ce.event.trigger(r,null,t)}}),ce.fn.extend({trigger:function(e,t){return this.each(function(){ce.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return ce.event.trigger(e,t,n,!0)}});var qt=/\[\]$/,Lt=/\r?\n/g,Ht=/^(?:submit|button|image|reset|file)$/i,Ot=/^(?:input|select|textarea|keygen)/i;function Pt(n,e,r,i){var t;if(Array.isArray(e))ce.each(e,function(e,t){r||qt.test(n)?i(n,t):Pt(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==x(e))i(n,e);else for(t in e)Pt(n+"["+t+"]",e[t],r,i)}ce.param=function(e,t){var n,r=[],i=function(e,t){var n=v(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!ce.isPlainObject(e))ce.each(e,function(){i(this.name,this.value)});else for(n in e)Pt(n,e[n],t,i);return r.join("&")},ce.fn.extend({serialize:function(){return ce.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ce.prop(this,"elements");return e?ce.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ce(this).is(":disabled")&&Ot.test(this.nodeName)&&!Ht.test(e)&&(this.checked||!we.test(e))}).map(function(e,t){var n=ce(this).val();return null==n?null:Array.isArray(n)?ce.map(n,function(e){return{name:t.name,value:e.replace(Lt,"\r\n")}}):{name:t.name,value:n.replace(Lt,"\r\n")}}).get()}});var Mt=/%20/g,Rt=/#.*$/,It=/([?&])_=[^&]*/,Wt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ft=/^(?:GET|HEAD)$/,$t=/^\/\//,Bt={},_t={},zt="*/".concat("*"),Xt=C.createElement("a");function Ut(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(D)||[];if(v(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Vt(t,i,o,a){var s={},u=t===_t;function l(e){var r;return s[e]=!0,ce.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function Gt(e,t){var n,r,i=ce.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&ce.extend(!0,e,r),e}Xt.href=Et.href,ce.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Et.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":zt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":ce.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Gt(Gt(e,ce.ajaxSettings),t):Gt(ce.ajaxSettings,e)},ajaxPrefilter:Ut(Bt),ajaxTransport:Ut(_t),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=ce.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?ce(y):ce.event,x=ce.Deferred(),b=ce.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=Wt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||Et.href)+"").replace($t,Et.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(D)||[""],null==v.crossDomain){r=C.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Xt.protocol+"//"+Xt.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=ce.param(v.data,v.traditional)),Vt(Bt,v,t,T),h)return T;for(i in(g=ce.event&&v.global)&&0==ce.active++&&ce.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Ft.test(v.type),f=v.url.replace(Rt,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Mt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(At.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(It,"$1"),o=(At.test(f)?"&":"?")+"_="+jt.guid+++o),v.url=f+o),v.ifModified&&(ce.lastModified[f]&&T.setRequestHeader("If-Modified-Since",ce.lastModified[f]),ce.etag[f]&&T.setRequestHeader("If-None-Match",ce.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+zt+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Vt(_t,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=ie.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&ie.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<ce.inArray("script",v.dataTypes)&&ce.inArray("json",v.dataTypes)<0&&(v.converters["text script"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(ce.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(ce.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--ce.active||ce.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return ce.get(e,t,n,"json")},getScript:function(e,t){return ce.get(e,void 0,t,"script")}}),ce.each(["get","post"],function(e,i){ce[i]=function(e,t,n,r){return v(t)&&(r=r||n,n=t,t=void 0),ce.ajax(ce.extend({url:e,type:i,dataType:r,data:t,success:n},ce.isPlainObject(e)&&e))}}),ce.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),ce._evalUrl=function(e,t,n){return ce.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){ce.globalEval(e,t,n)}})},ce.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=ce(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return v(n)?this.each(function(e){ce(this).wrapInner(n.call(this,e))}):this.each(function(){var e=ce(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=v(t);return this.each(function(e){ce(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){ce(this).replaceWith(this.childNodes)}),this}}),ce.expr.pseudos.hidden=function(e){return!ce.expr.pseudos.visible(e)},ce.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},ce.ajaxSettings.xhr=function(){try{return new ie.XMLHttpRequest}catch(e){}};var Yt={0:200,1223:204},Qt=ce.ajaxSettings.xhr();le.cors=!!Qt&&"withCredentials"in Qt,le.ajax=Qt=!!Qt,ce.ajaxTransport(function(i){var o,a;if(le.cors||Qt&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Yt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&ie.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),ce.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),ce.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return ce.globalEval(e),e}}}),ce.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),ce.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=ce("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),C.head.appendChild(r[0])},abort:function(){i&&i()}}});var Jt,Kt=[],Zt=/(=)\?(?=&|$)|\?\?/;ce.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Kt.pop()||ce.expando+"_"+jt.guid++;return this[e]=!0,e}}),ce.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Zt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Zt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=v(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Zt,"$1"+r):!1!==e.jsonp&&(e.url+=(At.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||ce.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=ie[r],ie[r]=function(){o=arguments},n.always(function(){void 0===i?ce(ie).removeProp(r):ie[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,Kt.push(r)),o&&v(i)&&i(o[0]),o=i=void 0}),"script"}),le.createHTMLDocument=((Jt=C.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Jt.childNodes.length),ce.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(le.createHTMLDocument?((r=(t=C.implementation.createHTMLDocument("")).createElement("base")).href=C.location.href,t.head.appendChild(r)):t=C),o=!n&&[],(i=w.exec(e))?[t.createElement(i[1])]:(i=Ae([e],t,o),o&&o.length&&ce(o).remove(),ce.merge([],i.childNodes)));var r,i,o},ce.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=Tt(e.slice(s)),e=e.slice(0,s)),v(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&ce.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?ce("<div>").append(ce.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},ce.expr.pseudos.animated=function(t){return ce.grep(ce.timers,function(e){return t===e.elem}).length},ce.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=ce.css(e,"position"),c=ce(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=ce.css(e,"top"),u=ce.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),v(t)&&(t=t.call(e,n,ce.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},ce.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){ce.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===ce.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===ce.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=ce(e).offset()).top+=ce.css(e,"borderTopWidth",!0),i.left+=ce.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-ce.css(r,"marginTop",!0),left:t.left-i.left-ce.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===ce.css(e,"position"))e=e.offsetParent;return e||J})}}),ce.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;ce.fn[t]=function(e){return M(this,function(e,t,n){var r;if(y(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),ce.each(["top","left"],function(e,n){ce.cssHooks[n]=Ye(le.pixelPosition,function(e,t){if(t)return t=Ge(e,n),_e.test(t)?ce(e).position()[n]+"px":t})}),ce.each({Height:"height",Width:"width"},function(a,s){ce.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){ce.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return M(this,function(e,t,n){var r;return y(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?ce.css(e,t,i):ce.style(e,t,n,i)},s,n?e:void 0,n)}})}),ce.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ce.fn[t]=function(e){return this.on(t,e)}}),ce.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.on("mouseenter",e).on("mouseleave",t||e)}}),ce.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){ce.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var en=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;ce.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),v(e))return r=ae.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(ae.call(arguments)))}).guid=e.guid=e.guid||ce.guid++,i},ce.holdReady=function(e){e?ce.readyWait++:ce.ready(!0)},ce.isArray=Array.isArray,ce.parseJSON=JSON.parse,ce.nodeName=fe,ce.isFunction=v,ce.isWindow=y,ce.camelCase=F,ce.type=x,ce.now=Date.now,ce.isNumeric=function(e){var t=ce.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},ce.trim=function(e){return null==e?"":(e+"").replace(en,"$1")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return ce});var tn=ie.jQuery,nn=ie.$;return ce.noConflict=function(e){return ie.$===ce&&(ie.$=nn),e&&ie.jQuery===ce&&(ie.jQuery=tn),ce},"undefined"==typeof e&&(ie.jQuery=ie.$=ce),ce});
"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,i,s=[],c=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,a=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw a}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function ownKeys(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:String(e)}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var n,r,a,o,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return r=!(n=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return n=e.done,e},e:function(e){r=!0,a=e},f:function(){try{n||null==i.return||i.return()}finally{if(r)throw a}}};if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return i&&(e=i),o=0,{s:t=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}define("engine",["jquery","utils","state","section","passages"],function(N,j,P,R,I){var t,V=j.impossible,M=j.passageSelector,D=j.transitionOut,F=j.options;function L(e,t,n){var r,a,o;if(n?(n=n.get("name"),(a=I.getTree(n)).children.length&&(r={type:"include",tag:t,name:n,children:a.children,text:a.text})):r=I.getTree(t),r){for(;(o=e[e.length-1])&&("root"===o.type||"include"===o.type)&&o.children.some(function(e){return e.type.startsWith("unclosed")});)e[e.length-1]=Object.create(o),e=e[e.length-1].children=o.children.slice();e.push(r)}}function n(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=n.loadedGame,a=I.get(e),o=j.storyElement,i=o.parent(),s=n.stretch,n=n.transition,n=void 0===n?{}:n,c=n.depart,c=void 0===c?"instant":c,l=n.arrive,l=void 0===l?"dissolve":l,u=n.departOrigin,p=n.arriveOrigin,n=n.time,d=(i.findAndFilter("tw-enchantment").each(function(e,t){var n=(t=N(t)).data("enchantedProperties");n&&o.css(n.reduce(function(e,t){return e[t]="",e},{})),t[0]===i[0]&&(i=o.unwrap().parent())}),I.hasValid(e)||V("Engine.showPassage","There's no passage with the name \""+e+'"!'),o.children(M).not(".transition-out, .transition-out *")),a=(a.get("tags")||[]).join(" "),f=(t=N("<tw-passage><tw-sidebar>"),f=t.children("tw-sidebar"),h=N('<tw-icon tabindex=0 alt="Undo" title="Undo">&#8630;</tw-icon>'),g=N('<tw-icon tabindex=0 alt="Redo" title="Redo">&#8631;</tw-icon>'),P.pastLength<=0&&h.css("visibility","hidden"),P.futureLength<=0&&g.css("visibility","hidden"),f.append(h,g),t),h=("function"==typeof u&&(u=u.call(d)),"function"==typeof p&&(p=p.call(f)),!s&&c),m=h&&d.css("width"),g=(j.detachStoryElement(),f.appendTo(o).attr({tags:a}),h&&(D(d,c,n,0,0,0,u),d.css({position:"absolute",width:function(){return"0px"!==m?m:"100%"}})),o.attr({tags:a}),R.create(f)),y=(r&&(g.loadedGame=!0),[]);if(P.pastLength<=0&&1===P.turns){var b,v=_createForOfIteratorHelper(I.getTagged("startup"));try{for(v.s();!(b=v.n()).done;)L(y,"startup",b.value)}catch(e){v.e(e)}finally{v.f()}if(F.debug){var w,k=_createForOfIteratorHelper(I.getTagged("debug-startup"));try{for(k.s();!(w=k.n()).done;)L(y,"debug-startup",w.value)}catch(e){k.e(e)}finally{k.f()}}}var S,T=_createForOfIteratorHelper(I.getTagged("header"));try{for(T.s();!(S=T.n()).done;)L(y,"header",S.value)}catch(e){T.e(e)}finally{T.f()}if(F.debug){var _,x=_createForOfIteratorHelper(I.getTagged("debug-header"));try{for(x.s();!(_=x.n()).done;)L(y,"debug-header",_.value)}catch(e){x.e(e)}finally{x.f()}}L(y,e);var O,A=_createForOfIteratorHelper(I.getTagged("footer"));try{for(A.s();!(O=A.n()).done;)L(y,"footer",O.value)}catch(e){A.e(e)}finally{A.f()}if(F.debug){var C,E=_createForOfIteratorHelper(I.getTagged("debug-footer"));try{for(E.s();!(C=E.n()).done;)L(y,"debug-footer",C.value)}catch(e){E.e(e)}finally{E.f()}}g.renderInto(y,f,{transition:l,transitionTime:n,transitionOrigin:p}),g.loadedGame=!1,j.reattachStoryElement(),scroll(0,s?f.offset().top-.05*N(window).height():o[0].getBoundingClientRect().top+document.body.scrollTop)}return Object.freeze({goBack:function(e){P.rewind()&&n(P.passage,e)},goForward:function(e){P.fastForward()&&n(P.passage,e)},goToPassage:function(e,t){P.play(e),n(e,t)},redirect:function(e,t){P.redirect(e),n(e,t)},toggleFullscreen:function(){var e=document.documentElement;document.fullscreenElement?document.exitFullscreen():document.msFullscreenElement?document.msExitFullscreen():(e.msRequestFullscreen||e.requestFullscreen).call(e)},showPassage:n,enableDebugMode:function(){t&&t()},registerDebugMode:function(e){t=t||e}})}),define("harlowe",["jquery","debugmode/mode","renderer","state","section","engine","passages","utils","utils/renderutils","internaltypes/varscope","internaltypes/twineerror","macros","macrolib/values","macrolib/commands","macrolib/datastructures","macrolib/stylechangers","macrolib/enchantments","macrolib/metadata","macrolib/patterns","macrolib/links","macrolib/custommacros","utils/jqueryplugins","repl"],function($,DebugMode,Renderer,State,Section,Engine,Passages,Utils,_ref,VarScope){var dialog=_ref.dialog;function __HarloweEval(text){eval(text+"")}function printJSError(e){var t,n="".concat(e.name,": ").concat(e.message);return e.stack&&(t=(e=e.stack.split("\n")).findIndex(function(e){return e.includes("__HarloweEval")}),n+="\n".concat(e.slice(0,t).join("\n").replace(/\([^)]+\)/g,""))),"<div style='font-family:monospace;overflow-y:scroll;max-height:30vh'>```"+n+"```</div>"}!function(o){window.onerror=function(e,t,n,r,a){window.onerror=o,Utils.storyElement.parent().append(dialog({message:"Sorry to interrupt, but this page's code has got itself in a mess.\n\n".concat(printJSError(a),"\n(This is probably due to a bug in the Harlowe game engine.)")}).addClass("harlowe-crash")),"function"==typeof o&&o.apply(void 0,arguments)}}(window.onerror),Utils.onStartup(function(){var n,e,t,r,a=$("tw-storydata");0!==a.length&&(Utils.options.ifid=a.attr("ifid"),(a.attr("tags")||"").split(/\s/).forEach(function(e){"uncompressed-pure-values"!==e&&"uncompressed-saves"!==e||(Utils.options.uncompressedPureValues=!0),"uncompressed-structures"!==e&&"uncompressed-saves"!==e||(Utils.options.uncompressedStructures=!0)}),(a.attr("options")||"").split(/\s/).forEach(function(e){e&&(Utils.options[e]=!0),"debug"===e&&DebugMode()}),a=(a=a.attr("startnode"))||[].reduce.call($("tw-passagedata"),function(e,t){t=t.getAttribute("pid");return t<e?t:e},1/0),a=$("tw-passagedata[pid='"+a+"']").attr("name"),$(document.documentElement).on("keydown",function(e){13===e.which&&"0"===e.target.getAttribute("tabindex")&&$(e.target).trigger("click")}),n=!1,$("[role=script]").each(function(t){try{__HarloweEval($(this).html())}catch(e){n||(n=!0,dialog({parent:Utils.storyElement.parent(),message:"There is a problem with this story's "+Utils.nth(t+1)+" script:\n\n"+printJSError(e)}))}}),$("[role=stylesheet]").each(function(e,t){$(document.head).append("<style data-title=\"Story stylesheet '".concat(e+1,"'\">").concat($(t).html()))}),(e=Section.create()).stack=[{tempVariables:Object.create(VarScope)}],(r=Passages.loadMetadata(e)).length&&(t=dialog({parent:Utils.storyElement.parent(),message:"These errors occurred when running the `(metadata:)` macro calls in this story's passages:<p></p>"}),r.forEach(function(e){return t.find("p").append(e.render())})),(r=!Utils.options.debug&&State.hasSessionStorage&&sessionStorage.getItem("Saved Session"))&&!0===State.deserialise(e,r)?Engine.showPassage(State.passage):Engine.goToPassage(a))})}),define("macros",["utils/naturalsort","utils","utils/operationutils","datatypes/changercommand","datatypes/custommacro","datatypes/lambda","datatypes/codehook","internaltypes/changedescriptor","internaltypes/twineerror"],function(g,e,t,o,r,y,b,p,v){var w=e.insensitiveName,k=e.nth,S=e.andList,T=t.objectName,_=t.typeName,d=t.toSource,x=Array.isArray,i={};function O(e){return e===s.TypeSignature.Any||(x(e.innerType)?e.innerType.some(O):!!e.innerType&&O(e.innerType))}function a(e,t,n,r){var a,o,i,s,c,l,u,p,d=t.fn,f=t.typeSignature,h=t.returnType,m=(r=function(e){for(var t,n,r,a=[],o=0;o<e.length;o+=1)o in e&&(!0===(null==(t=e[o])?void 0:t.spreader)?(n=t.value,(r=v.containsError(n))?a.push(r):x(n)||"string"==typeof n?a.push.apply(a,_toConsumableArray(n)):n instanceof Set?a.push.apply(a,_toConsumableArray(Array.from(n).sort(g("en")))):a.push(v.create("operation","I can't spread out "+T(n)+", because it is not a string, dataset, or array."))):a.push(t));return a}(r),"string"!=typeof e&&(a=e,e=""),a?"":"("+(x(e)&&1<e.length?e[0]:e)+":)");for(e=a?a.TwineScript_KnownName?"the custom macro, ".concat(a.TwineScript_KnownName):"an unnamed custom macro":"the ".concat(m," macro"),o=0<f.length?1===f.length&&O(f[0])?1===r.length?"That value can't be given to macros as-is.":"Give only a single value to this macro.":e+" must only be given "+S(f.map(_))+(1<f.length?", in that order":"."):e+" must not be given any data."+(a?"":" Just write "+m),s=0,c=Math.max(r.length,f.length);s<c;s+=1){if(p=f[s],l=r[s],v.containsError(l))return l;if(s>=f.length&&!i)return v.create("datatype",r.length-f.length+" too many values were given to "+e+".",o);if(!(p=p||i).innerType||"rest"!==p.pattern&&"zero or more"!==p.pattern||(i=p.innerType,"rest"===p.pattern&&(p=p.innerType)),!function e(t,n){if(null===n)return void 0===t;var r=_typeof(t);if("function"!=typeof n&&n.pattern){if("optional"===n.pattern||"zero or more"===n.pattern)return void 0===t||e(t,n.innerType);if("either"===n.pattern){for(var a=0;a<n.innerType.length;a+=1)if(e(t,n.innerType[a]))return!0;return!1}if("lambda"===n.pattern&&e(t,n.innerType))return n.clauses.includes("where")===("where"in t||"each"in t)&&n.clauses.includes("making")==="making"in t&&n.clauses.includes("via")==="via"in t&&n.clauses.includes("with")==="with"in t;if("insensitive set"===n.pattern)return n.innerType.includes(w(t));if("range"===n.pattern)return n.range(t);if("wrapped"===n.pattern)return e(t,n.innerType)}return(void 0===n||void 0!==t)&&("anything"===n.TwineScript_TypeName&&void 0!==t&&!t.TwineScript_Unstorable||"everything"===n.TwineScript_TypeName&&void 0!==t||(n===String?"string"===r:n===Boolean?"boolean"===r:n===parseInt?"number"===r&&!Number.isNaN(t)&&!(t+"").includes("."):n===Number?"number"===r&&!Number.isNaN(t):n===Array?x(t):n===Map||n===Set?t instanceof n:Object.isPrototypeOf.call(n,t)))}(l,p))return void 0===l?(u=f.filter(function(e){return!("optional"===e.pattern||"zero or more"===e.pattern)}).length,v.create("datatype","".concat(e," was given ").concat(r.length?S(r.map(T)):"nothing",", but needs ").concat(u-s," more value").concat(1<u-s?"s":"","."),o)):null!=(u=l)&&u.TwineScript_Unstorable&&O(p)?v.create("datatype",e+"'s "+k(s+1)+" value, "+T(l)+", is not valid data for this macro.",o):b.isPrototypeOf(l)&&"Changer"===h?v.create("syntax","Please put this hook outside the parentheses of "+e+", not inside it.","Hooks should appear after a macro"+(a?".":": "+m+"[Some text]")):l&&y.isPrototypeOf(l)&&"lambda"===p.pattern?v.create("datatype",e+"'s "+k(s+1)+" value (a lambda) should have "+S(["where","when","making","via","with"].filter(function(e){return p.clauses.includes(e)}).map(function(e){return"a '"+e+"' clause"}))+", not "+S(["where","when","making","via","with"].filter(function(e){return e in l}).map(function(e){return"a '"+e+"' clause"}))+"."):"insensitive set"===p.pattern?v.create("datatype",T(l)+" is not a valid name string for "+e+".","Only the following names are recognised (capitalisation and hyphens ignored): "+S(p.innerType)+"."):v.create("datatype","".concat(e,"'s ").concat(k(s+1)," value is ").concat(T(l),", but should be ").concat(_(p),"."),p.message||o)}return d.apply(null,[n].concat(r))}function f(e,t,n,r){var a={fn:n,typeSignature:r=[].concat(r||[]),returnType:t};Object.freeze(a),[].concat(e).forEach(function(e){return Object.defineProperty(i,w(e),{value:a})})}var s={has:function(e){return e=w(e),hasOwnProperty.call(i,e)},get:function(e){return e=w(e),hasOwnProperty.call(i,e)&&i[e]},add:function e(t,n,r,a){return f(t,n,r,a),e},addChanger:function e(t,n,r,a){return f(t,"Changer",n,a),o.register(x(t)?t[0]:t,r),e},addCommand:function e(t,n,r,a){var s,c,l,u,o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],i=[].concat(t)[0];return f(t,"Command",(s=i,c=n,l=r,u=o,function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a,o,i=c.apply(void 0,n);return i||(a=p.create(),o=_objectSpread({TwineScript_TypeID:"command",TwineScript_ObjectName:"a (".concat(s,":) command"),TwineScript_TypeName:"a (".concat(s,":) command"),TwineScript_Print:function(){return"`[A (".concat(s,":) command]`")},TwineScript_ToSource:function(){return"(".concat(s,":").concat(n.map(d),")")},TwineScript_is:function(e){return d(this)===d(e)}},u?{TwineScript_Attach:function(e,t){return a.section=e,t.run(a),o},TwineScript_Run:function(e){e=l.apply(void 0,[a,e].concat(n));return a=p.create(),e}}:{TwineScript_Run:function(e){return l.apply(void 0,[e].concat(n))}}))}),a),e},TypeSignature:{optional:function(e){return{pattern:"optional",innerType:e}},zeroOrMore:function(e){return{pattern:"zero or more",innerType:e}},either:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"either",innerType:t}},rest:function(e){return{pattern:"rest",innerType:e}},insensitiveSet:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"insensitive set",innerType:t}},numberRange:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0;return{pattern:"range",min:t,max:n,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&t<=e&&e<=n}}},nonNegativeInteger:{pattern:"range",integer:!0,min:0,max:1/0,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&0<=e&&!(e+"").includes(".")}},positiveInteger:{pattern:"range",integer:!0,min:1,max:1/0,range:function(e){return"number"==typeof e&&!Number.isNaN(e)&&1<=e&&!(e+"").includes(".")}},wrapped:function(e,t){return{pattern:"wrapped",innerType:e,message:t}},Any:{TwineScript_TypeName:"anything"},Everything:{TwineScript_TypeName:"everything"}},run:function(e,t,n){return s.has(e)?a(e,s.get(e),t,n):v.create("macrocall","I can't run the macro '"+e+"' because it doesn't exist.","Did you mean to run a macro? If you have a word written like (this:), it is regarded as a macro name.")},runCustom:function(e,t,n){return r.isPrototypeOf(e)?a(e,e,t,n):v.containsError(e)?e:v.create("macrocall","I can't call ".concat(T(e)," because it isn't a custom macro."))}};return Object.assign(s.TypeSignature,{positiveNumber:s.TypeSignature.numberRange(Math.pow(2,-52),1/0),nonNegativeNumber:s.TypeSignature.numberRange(0,1/0),percent:s.TypeSignature.numberRange(0,1)}),Object.freeze(s)}),define("passages",["jquery","utils/naturalsort","utils","markup","internaltypes/twineerror"],function(t,s,e,c,l){var u=e.insensitiveName,p=e.unescape,n=e.onStartup,o=e.impossible,d=Object.assign,f=RegExp(c.Patterns.macroFront+c.Patterns.macroName,"ig");function r(e){var t,r,a,o,n=e.attr("name"),i=p(e.html()),s=(t=n,o=["metadata","storylet","exclusivity","urgency"],((s=i).match(f)||[]).some(function(t){return o.some(function(e){return u(t.slice(1,-1))===e})})?(r=!1,a={},c.lex(s,t).children.forEach(function e(t){if("macro"===t.type){var n=u(t.name);if(o.some(function(e){return n===e})){if(l.isPrototypeOf(a[n]))return;if(r)return void(a[n]=l.create("syntax","The (".concat(t.name,":) macro can't appear after non-metadata macros.")));if(a[n])return void(a[n]=l.create("syntax","There is more than one (".concat(t.name,":) macro.")));a[n]=t}else r=!0;t.children.forEach(function e(t){var n=u(t.name);"macro"===t.type&&o.some(function(e){return n===e})?a[n]=l.create("syntax","The (".concat(t.name,":) macro can't be inside another macro.")):t.children.forEach(e)})}else t.children.forEach(e)}),a):{});return d(new Map([["source",i],["tags",(e.attr("tags")||"").split(/\s/)||[]],["name",n]]),{TwineScript_TypeName:"a passage datamap",TwineScript_ObjectName:"a passage datamap",metadata:s,tree:null})}var a=Object.create(null),i=[],h=null,m=d(new Map,{TwineScript_ObjectName:"the Passages datamap",getTagged:function(n){var e,r;return a[n]||(e=s("en",function(e){return e.get("name")}),r=[],this.forEach(function(e){var t=e instanceof Map&&e.get("tags");Array.isArray(t)&&t.includes(n)&&r.push(e)}),r.sort(e),a[n]=r)},clearTagCache:function(){a=Object.create(null)},clear:function(){Map.prototype.clear.call(this),this.clearTagCache(),this.clearTreeCache(),this.clearStoryletCache()},delete:function(){var e;(e=Map.prototype.delete).call.apply(e,[this].concat(Array.prototype.slice.call(arguments))),this.clearTagCache(),this.clearTreeCache(),this.clearStoryletCache()},getTree:function(e){if(!this.has(e))return o("Passages.getTree","No passage name?"),[];var t=this.get(e),n=t.get("tags");if(n.includes("header")||n.includes("footer")||n.includes("debug-header")||n.includes("debug-footer"))return t.tree||(t.tree=c.lex(t.get("source"),e)),t.tree;for(var r,a=0;a<i.length;a+=1)if(i[a]&&i[a].place===e)return r=i.splice(a,1)[0],i.unshift(r),r;n=c.lex(t.get("source"),e);return i.unshift(n),16<i.length&&i.pop(),n},clearTreeCache:function(){i=[]},getStorylets:function(r,e){var a,o,i,e=e?e.filter(r,_toConsumableArray(m.values())):_toConsumableArray(m.values());return l.containsError(e)?e:(a=[],o=-1/0,e.reduce(function(e,t){if(e)return e;e=t.get("storylet");if(e){var n=r.speculate(e,t.get("name"),"a (storylet:) macro");if(l.containsError(n))return n.message="There's an error in the storylet passage \""+t.get("name")+'":\n'+n.message,n.source=e.TwineScript_ToSource(),n;n&&(e=t.get("exclusivity"),o=Math.max(o,"number"==typeof e?e:0),a.push(t))}},void 0)||(i=s("en"),a.filter(function(e){e=e.get("exclusivity");return("number"==typeof e?e:0)===o}).sort(function(e,t){var n=e.get("urgency"),r=t.get("urgency");return(n="number"==typeof n?n:0)!==(r="number"==typeof r?r:0)?r-n:i(e.get("name"),t.get("name"))})))},allStorylets:function(){return h=h||_toConsumableArray(m.values()).filter(function(e){return e.get("storylet")})},clearStoryletCache:function(){h=null},loadMetadata:function(i){var s=[];return m.forEach(function(o){o.metadata&&Object.keys(o.metadata).forEach(function(e){var t,n,r;function a(e,t){o.has(e)?s.push(l.create("syntax","This passage's datamap already has a '"+JSON.stringify(e)+"' data name.")):o.set(e,t)}l.containsError(o.metadata[e])?s.push(o.metadata[e]):(t=o.metadata[e],n=i.speculate(t,o.get("name"),"a ("+e+":) macro"),r='In "'+o.get("name")+'":\n',l.containsError(n)?(n.message=r+n.message,n.source=t.text,s.push(n)):n instanceof Map?n.forEach(function(e,t){return a(t,e)}):a(e,n))}),o.metadata=void 0}),s},hasValid:function(e){e=this.get(e);return e&&e instanceof Map&&e.has("source")},create:r});return n(function(){t("tw-storydata > tw-passagedata").get().forEach(function(e){e=t(e),m.set(e.attr("name"),new r(e))})}),m}),define("renderer",["jquery","utils","markup","internaltypes/twineerror"],function(a,e,S,T){var _=e.escape,x=e.insensitiveName,O=e.options;function A(e,t,n){n=2<arguments.length&&void 0!==n?n:"";return"<"+t+(n?" "+n:"")+">"+e+"</"+t+">"}var C="text-align: center; max-width:50%; ";function E(m,g){function y(e,t,n){e=E(e.children,g);return e&&A(e,t,n)}var b="",v=[];if(m)for(var e,w=(m=Array.isArray(m)?m:[m]).length,k=0;k<w;k+=1)if(e=function(e){var n=m[e];switch(n.type){case"include":b+=y(n,"tw-"+n.type,'type="'.concat(n.tag,'" name="').concat(n.name,'"'));break;case"error":b+=T.create("syntax",n.message,n.explanation).render(_(n.text))[0].outerHTML;break;case"numbered":case"bulleted":for(var t="numbered"===n.type?"ol":"ul",r=(b+="<"+t+">",1);e<w&&m[e];){if("br"===m[e].type){if(b+="</li>",!m[e+1]||m[e+1].type!==n.type)break}else m[e].type===n.type?(b=(b+=("<"+t+">").repeat(Math.max(0,m[e].depth-r)))+("</"+t+">").repeat(Math.max(0,r-m[e].depth))+"<li>",r=m[e].depth):b+=E([m[e]],g);e+=1}b+=("</"+t+">").repeat(r+1);break;case"align":for(;n&&"align"===n.type;){var a=n.align,o=e+=1;if("left"===a){--e;break}for(;e<w&&m[e]&&"align"!==m[e].type;)e+=1;var o=E(m.slice(o,e),g),i="";switch(a){case"center":i+=C+"margin-left: auto; margin-right: auto;";break;case"justify":case"right":i+="text-align: "+a+";";break;default:+a&&(i+=C+"margin-left: "+a+"%;")}b+="<tw-align "+(i?'style="'+i+'"':"")+">"+o+"</tw-align>\n",n=m[e]}break;case"column":for(var s,c=[];n&&"column"===n.type;){var l=n.column,u=e+=1;if("none"===l){--e;break}for(;e<w&&m[e]&&"column"!==m[e].type;)e+=1;c.push({text:n.text,type:l,body:E(m.slice(u,e),g),width:n.width,marginLeft:n.marginLeft,marginRight:n.marginRight}),n=m[e]}c.length&&(s=c.reduce(function(e,t){return e+t.width},0),b+="<tw-columns>"+c.map(function(e){return"<tw-column type=".concat(e.type," ",' style="width:').concat(e.width/s*100,"%; margin-left: ").concat(e.marginLeft,"em; margin-right: ").concat(e.marginRight,'em;">').concat(e.body,"</tw-column>\n")}).join("")+"</tw-columns>");break;case"heading":for(b+="<h"+n.depth+">";++e<w&&m[e];){if("br"===m[e].type){b+="</h"+n.depth+">";break}b+=E([m[e]],g)}break;case"br":if(!v.length||/td|th/.test(v[0])){b+="<br>";for(var p=m[e+1];p&&("br"===p.type||"tag"===p.type&&/^<br\b/i.test(p.text));)b+="<tw-consecutive-br"+("tag"===p.type?" data-raw":"")+"></tw-consecutive-br>",p=m[(e+=1)+1]}break;case"hr":b+="<hr>";break;case"escapedLine":case"comment":break;case"inlineUrl":b+='<a class="link" href="'+_(n.text)+'">'+n.text+"</a>";break;case"scriptStyleTag":case"tag":var d=n.text.toLowerCase();/^<\/?(?:table|thead|tbody|tr|tfoot|td|th|svg)\b/.test(d)&&!n.text.endsWith("/>")&&v[n.text.startsWith("</")?"shift":"unshift"](d),b+=n.text.startsWith("</")?n.text:n.text.replace(/(\/)?>$/,function(e,t){return" data-raw".concat(t?"></".concat(n.text.match(/[\w-]+/)):"",">")});break;case"sub":case"sup":case"strong":case"em":b+=y(n,n.type);break;case"strike":b+=y(n,"s");break;case"bold":b+=y(n,"b");break;case"italic":b+=y(n,"i");break;case"twineLink":d=_slicedToArray(S.lex("(link-goto:"+JSON.stringify(n.innerText)+","+JSON.stringify(n.passage)+")").children,1)[0];b+='<tw-expression type="macro" name="link-goto"'+(O.debug?' title="'+_(n.text)+'"':"")+' code="'+g.code.length+'"></tw-expression>',g.code.push(d);break;case"hook":b+="<tw-hook "+(n.hidden?"hidden ":"")+(n.name?'name="'+x(n.name)+'"':"")+(O.debug&&n.name?' title="Hook: ?'+n.name+'"':"")+' source="'+g.source.length+'"></tw-hook>',g.source.push(n.children);break;case"unclosedHook":return b+="<tw-hook "+(n.hidden?"hidden ":"")+(n.name?'name="'+x(n.name)+'"':"")+'source="'+g.source.length+'"></tw-hook>',g.source.push(m.slice(e+1,w)),{v:b};case"verbatim":b+=A(_(n.innerText).replace(/\n/g,"<br>"),"tw-verbatim");break;case"collapsed":b+=y(n,"tw-collapsed");break;case"unclosedCollapsed":return{v:b+="<tw-collapsed>"+E(m.slice(e+1,w),g)+"</tw-collapsed>"};case"variable":case"tempVariable":case"macro":var f=[],h=[];if("macro"===n.type&&!function e(t){"string"!==t.type&&"hook"!==t.type&&t.children.every(e);var n=x(t.name);if("macro"!==t.type||"prompt"!==n&&"confirm"!==n){if("hook"===t.type&&!t.everyLeaf(function(e){return"error"!==e.type||(h.push(e),!1)}))return!1}else f.push(t);return!0}(n),h.length)return{v:T.create("syntax","This code hook's markup contained "+h.length+" error"+(h.length?"s":"")+":<br>\u2014"+h.map(function(e){return e.message}).join("<br>\u2014")).render(_(n.text))[0].outerHTML};d=f.map(function(e){return e.blockerTree=g.blockers.length,g.blockers.push(e),e.blockerTree});b+='<tw-expression type="'+n.type+'" name="'+_(n.name||n.text)+'"'+(O.debug?' title="'+_(n.text)+'"':"")+(d.length?' blockers="'+d+'"':"")+' code="'+g.code.length+'"></tw-expression>',g.code.push(n);break;default:b+=n.children&&n.children.length?E(n.children,g):n.text}k=e}(k))return e.v;return b}return Object.freeze({exec:function(e){var r={code:[],blockers:[],source:[]},e=E(e="string"==typeof e?S.lex(e).children:e,r),e=a(a.parseHTML(e,document,!0));return e.findAndFilter("script:not([src])").each(function(e,t){var n=t.getAttribute("type");n&&"text/javascript"!==n.toLowerCase()||t.setAttribute("type","application/x-harlowe")}),r.blockers=r.blockers.map(function(e){e.blockedValue=!0;e=Object.create(e);return e.blockedValue=!1,e}),e.findAndFilter("tw-expression[code]:not([data-raw]), tw-expression[blockers]:not([data-raw]), tw-hook[source]:not([data-raw])").each(function(e,t){var n;(t=a(t)).attr("blockers")&&(n=t.popAttr("blockers").split(",").map(function(e){return r.blockers[e]}),t.data("blockers",n)),t.attr("source")&&t.data("source",r.source[t.popAttr("source")]),t.attr("code")&&t.data("code",r.code[t.popAttr("code")])}),e}})}),define("repl",["utils","markup","section"],function(e,t,n){e.onStartup(function(){return setTimeout(function(){e.options.debug&&(window.REPL=function(e){e=n.create().eval(t.lex("(print:"+e+")"));return e.TwineScript_Run?e.TwineScript_Run().source:e},window.LEX=function(e){e=t.lex(e);return 1===e.length?e[0]:e})})})}),define("section",["jquery","utils","twinescript/runner","twinescript/operations","state","utils/operationutils","utils/renderutils","utils/scripttag","datatypes/changercommand","datatypes/colour","datatypes/lambda","datatypes/codehook","internaltypes/changedescriptor","internaltypes/varscope","internaltypes/twineerror","internaltypes/twinenotifier"],function(p,f,a,u,r,e,t,i,d,h,o,m,g,y,b,v){var w=e.printBuiltinValue,k=e.objectName,S=e.typeID,T=e.isObject,s=t.collapse,_=Object.assign,x=Object.create,O=Object.keys;function A(e,t,n){if(t&&"object"===_typeof(t)&&d.isPrototypeOf(t)){var r=n.popData("source")||(null==(r=n[0].cachedData)?void 0:r.source),a=(null!=(a=n[0])&&a.cachedData&&(n[0].cachedData.source=void 0),n.data("originalSource",r),g.create({target:n,source:r,section:this,append:"append"})),o=t.run(a);if(b.containsError(o)&&e.replaceWith(o.render(e.attr("title"))),!this.renderInto(r,null,a))return o=f.insensitiveName(e.attr("name")),["if","elseif","unless","else","testfalse"].includes(o)&&(e.addClass("false"),"elseif"!==o)&&(this.stackTop.lastHookShown=!1),n.data("live")&&function(t,n,r){function a(e){p&&(d-=(e-p)*(f.options.debug&&void 0!==f.options.speedMultiplier?f.options.speedMultiplier:1)),p=e,0<d?requestAnimationFrame(a):(d=s,o())}var o,i=this,e=r.data("live"),s=e.delay,c=e.event,l=((n=_objectSpread(_objectSpread({},n),{},{append:"replace",transitionDeferred:!1,enabled:!0})).data=_objectSpread(_objectSpread({},n.data),{},{live:void 0}),r.data("originalSource")||""),u=this.stackTop.tempVariables,p=null,d=s;o=this.whenUnblocked.bind(this,function(){var e;i.inDOM()&&(e=null==c?void 0:c.filter(i,[!0],u),b.containsError(e)?e.render(i,t.attr("title")).replaceAll(t):c&&!e[0]?requestAnimationFrame(a):(i.renderInto(l,r,n,u),e||r.find("tw-expression[name='stop']").length||i.inDOM()&&requestAnimationFrame(a)))}),requestAnimationFrame(a)}.call(this,e,a,n),!0}else{if(!1===t)return o=n.popData("source")||(null==(r=n[0].cachedData)?void 0:r.source),null!=(a=n[0])&&a.cachedData&&(n[0].cachedData.source=void 0),o&&(n.cachedData&&(n.cachedData.source=void 0),n.data("originalSource",o),n.data("hidden",!0)),e.addClass("false"),!(this.stackTop.lastHookShown=!1);if(!0!==t)return!1}return this.stackTop.lastHookShown=!0}function C(e){var t,n,e=(e instanceof p?e[0]:e).nextSibling;return e&&(e instanceof Text&&!e.textContent.trim()||["br","tw-consecutive-br"].includes((e.tagName||"").toLowerCase()))?(t=(n=C(e)).whitespace,n=n.nextElem,{whitespace:p(e).add(t),nextElem:n}):{whitespace:p(),nextElem:p(e)}}function E(e){if(null!=e&&e.length)return p("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",e)}function c(e,t){var n=this.eval(t);e.append(E(this.evalReplay)),e.append(function(e,t){if(/a \((go-to|undo|redirect|restart):\) command/.exec(null==t?void 0:t.TwineScript_TypeName))return p("<tw-open-button goto label='GO'>").data("goto",{section:e,command:t})}(this,n)),this.stackTop.evaluateOnly&&n&&(d.isPrototypeOf(n)||"function"==typeof n.TwineScript_Run)&&(n=b.create("syntax","I can't work out what ".concat(this.stackTop.evaluateOnly," should evaluate to, because it contains a ").concat(d.isPrototypeOf(n)?"changer.":"command."),"Please rewrite this without putting changers or commands here."));var r=p();for(i=e;d.isPrototypeOf(n);){var a=C(i),o=a.whitespace;if((i=a.nextElem)[0]&&i[0].nodeType===Node.TEXT_NODE&&"+"===i[0].textContent.trim()){var i,a=i,s=C(a),c=s.whitespace;if((i=s.nextElem).is("tw-expression")){var s=i.popData("code")||(null==(s=i[0])||null==(s=s.cachedData)?void 0:s.code),l=(null!=(l=i[0])&&l.cachedData&&(i[0].cachedData.code=void 0),this.eval(s));if(b.containsError(l)){n=l;break}s=u["+"](n,l);p(o).add(a).add(c).remove(),n=b.containsError(s)?b.create("operation","I can't combine "+k(n)+" with "+k(l)+".","function"==typeof l.TwineScript_Run?"If you want to attach this changer to ".concat(k(l),", remove the + between them."):"Changers can only be added to other changers."):s;continue}}if(i.is("tw-expression")){c=i.popData("code")||(null==(a=i[0])||null==(a=a.cachedData)?void 0:a.code),s=(null!=(l=i[0])&&l.cachedData&&(i[0].cachedData.code=void 0),this.eval(c));if(i.append(E(this.evalReplay)),b.containsError(s)){n=s;break}if(s&&"object"===_typeof(s)&&"function"==typeof s.TwineScript_Attach){n=s.TwineScript_Attach(this,n);break}return d.isPrototypeOf(s)?void e.replaceWith(b.create("operation","Changers like (".concat(n.macroName,":) need to be combined using + between them."),"Place the + between the changer macros, or the variables holding them. The + is absent only between a changer and its attached hook or command.").render(e.attr("title"))):void e.replaceWith(b.create("operation","".concat(k(s)," can't have changers like (").concat(n.macroName,":) attached."),"Changers placed just before hooks, links and commands will attempt to attach, but in this case it didn't work.").render(e.attr("title")))}if(i.is("tw-hook")){o.remove(),r=i;break}n.macroName||f.impossible("Section.runExpression","changer has no macroName");a=e.attr("title")||"("+n.macroName+": ...)";return void e.replaceWith(b.create("syntax","The (".concat(n.macroName,":) changer should be stored in a variable or attached to a hook."),"Macros like this should appear before a hook: ".concat(a,"[Some text]")).render(e.attr("title")))}e.attr("return",S(n)),r=r.length?r:C(e).nextElem.filter("tw-hook"),(t=b.containsError(n))?e.replaceWith(t.render(e.attr("title")).append(E(this.evalReplay))):v.isPrototypeOf(n)?e.append(n.render()):n&&"function"==typeof n.TwineScript_Run?(n=n.TwineScript_Run(this),b.containsError(n)?e.replaceWith(n.render(e.attr("title"))):g.isPrototypeOf(n)?null!=(t=n.data)&&t.live?e.replaceWith(b.create("unimplemented","I currently can't attach (live:) or (event:) macros to commands - only hooks.").render(e.attr("title"))):(n.section=this,n.target=i,this.renderInto("",i,n)):T(n)&&n.blocked?(this.stackTop.blocked=n.blocked,e.data("code",{type:"macro",blockedValue:!0,text:e.attr("title")||"",start:0,end:(e.attr("title")||"").length})):n&&f.impossible("Section.runExpression","TwineScript_Run() returned a non-ChangeDescriptor ".concat(_typeof(n),': "').concat(n,'"'))):r.length&&A.call(this,e,n,r)||("string"==typeof n||"number"==typeof n||n instanceof Map||n instanceof Set||Array.isArray(n)||h.isPrototypeOf(n)||m.isPrototypeOf(n)||n&&"function"==typeof n.TwineScript_Print&&!d.isPrototypeOf(n)?(n=w(n),b.containsError(n)?e.replaceWith(n.render(e.attr("title"))):"string"==typeof n||Array.isArray(n)?this.renderInto(n,e):f.impossible("printBuiltinValue() produced a non-string non-array ".concat(_typeof(n)))):d.isPrototypeOf(n)||"boolean"==typeof n||f.impossible("Section.runExpression","The expression evaluated to an unknown value: ".concat(n)))}var l={add:[],remove:[]};return Object.preventExtensions({create:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f.storyElement,n=_(x(this),{timestamp:Date.now(),dom:e,stack:[],enchantments:[],unblockCallbacks:[],freeVariables:null,evalReplay:null,loadedGame:!1,Identifiers:{TwineScript_Identifiers:!0,it:0,get time(){var e;return null!=(e=n.stackTop)&&e.evaluateOnly?b.create("operation","'time' can't be used in ".concat(n.stackTop.evaluateOnly,".")):(Date.now()-n.timestamp)*(f.options.debug&&void 0!==f.options.speedMultiplier?f.options.speedMultiplier:1)},get turns(){return r.turns},get turn(){return r.turns},get visits(){var t=n.stackTop.speculativePassage;return r.history().filter(function(e){return e===(t||r.passage)}).length+(!t||t===r.passage)},get visit(){return n.Identifiers.visits},get exits(){var e;return null!=(e=n.stackTop)&&e.evaluateOnly?b.create("operation","'exit' and 'exits' can't be used in ".concat(n.stackTop.evaluateOnly,".")):n.dom.find("tw-enchantment, tw-link").filter(function(e,t){return(t=p(t)).data("enchantmentEvent")||t.parent().data("linkPassageName")||t.parent().data("clickEvent")}).length},get exit(){return n.Identifiers.exits},get pos(){return n.stackTop&&!n.stackTop.evaluateOnly&&n.stackTop.lambdaPos?+n.stackTop.lambdaPos||1:b.create("operation","'pos' can only be used in lambdas that aren't 'when' lambdas.")}}});return n},eval:function(t){var e,n;f.options.debug&&f.options.evalReplay&&(n=Array.isArray(t)?t.reduce(function(e,t){return e+t.text},""):t.text||"",this.evalReplay=[{code:n,fromCode:n,basis:(Array.isArray(t)?t[0]:t).start,start:0,end:n.length,diff:0}]);try{e=a(this,t)}catch(e){return null!=(n=window.console)&&n.error(e),this.evalReplay=null,b.create("","An internal error occurred while trying to run ".concat([].concat(t).map(function(e){return e.text}).join(""),"."),'The error was "'.concat(e.message,'".\nIf this is the latest version of Harlowe, please consider reporting a bug (see the documentation).'))}return this.evalReplay&&2===this.evalReplay.length&&this.evalReplay.shift(),e},get stackTop(){return this.stack[0]},inDOM:function(){return 0<f.storyElement.find(this.dom).length},evaluateTwineMarkup:function(e,t){var n=p("<p>");return this.stack.unshift({desc:g.create({target:n,source:e,section:this,append:"append"}),tempVariables:this.stackTop.tempVariables,evaluateOnly:t,finalIter:!0}),this.execute(),0<(e=n.find("tw-error")).length?e:n},speculate:function(e,t,n){this.stack.unshift({evaluateOnly:n,finalIter:!0,tempVariables:_(x(y),{TwineScript_VariableStore:{type:"temp",name:n}}),speculativePassage:t});var r,n=this.evalReplay;return this.evalReplay=null,o.isPrototypeOf(e)?r=e.apply(this,{fail:!1,pass:!0}):e&&(r=a(this,e)),this.stack.shift(),this.evalReplay=n,r},renderInto:function(e,a,t){var o=this,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=g.create({target:a,source:e,section:this,append:"append"});if(t)if(d.isPrototypeOf(t)){var e=t.run(i);if(b.containsError(e))return e.render(a.attr("title")).replaceAll(a),!1}else _(i,t);if((a=i.target,50<=this.stack.length)&&50<=this.stack.reduce(function(e,t){return e+!!t.finalIter},0))return b.create("infinite","Printing this expression may have trapped me in an infinite loop.").render(a.attr("title")).replaceAll(a),!1;var s=function(e,t,n){var r=a instanceof p&&a.is("tw-hook")&&0<a.parents("tw-collapsed,[collapsing=true]").length;o.stack.unshift({desc:e,finalIter:n,tempVariables:t,collapses:r,evaluateOnly:o.stackTop&&o.stackTop.evaluateOnly})},r=r||x(this.stack.length?this.stackTop.tempVariables:y),t=(hasOwnProperty.call(r,"TwineScript_VariableStore")||(t=null==(e=a)?void 0:e.tag(),r.TwineScript_VariableStore={type:"temp",name:"tw-hook"===t?a.attr("name")?"?"+a.attr("name"):"an unnamed hook":"tw-expression"===t?"a "+a.attr("type")+" expression":"tw-passage"===t?"this passage":"an unknown scope"}),null==(e=this.stackTop)?void 0:e.blocked);if(O(i.loopVars).length){var c=_objectSpread({},i.loopVars),l=Math.min.apply(Math,_toConsumableArray(O(c).map(function(e){return c[e].length})));if(v.create(l+" loop"+(1!==l?"s":"")).render().prependTo(a),l){for(var n=l-1;0<=n;--n)!function(n){s(i,O(c).reduce(function(e,t){return e[t]=c[t][n],e},x(r),n===l-1))}(n);for(var u=l-1;0<=u&&!this.stackTop.blocked;--u)this.execute()}}else s(i,r,!0),this.execute();return(0===this.stack.length||!t&&null!=(e=this.stackTop)&&e.blocked)&&this.updateEnchantments(),i.enabled},execute:function(){var a=this,e=this.stackTop,t=e.desc,n=e.dom,r=e.collapses,o=e.evaluateOnly;t&&!n&&(n=t.render(),this.stackTop.dom=n,this.stackTop.desc=void 0),n.findAndFilter('tw-hook,tw-expression,script[type="application/x-harlowe"]').each(function(e,t){var n=p(t).data();t.cachedData={blockers:n.blockers,code:n.code,source:n.source}}).each(function(e,t){if(a.stackTop.blocked)return!1;var n=t.cachedData;switch(n&&(t.cachedData=void 0),(t=p(t)).tag()){case"tw-hook":var r=t.popData("source")||(null==n?void 0:n.source);(r&&t.data("originalSource",r),t.data("tempVariables",a.stackTop.tempVariables),t.popAttr("hidden"))?t.data("hidden",!0):r&&a.renderInto(r,t);break;case"tw-expression":var r=t.data("blockers")||(null==n?void 0:n.blockers);if(r){if(o)return void t.removeData("blockers").removeData("code").replaceWith(b.create("syntax","I can't use a macro like (prompt:) or (confirm:) in ".concat(o,"."),"Please rewrite this without putting such macros here.").render(t.attr("title"),t));if(r.length)return a.stackTop.blocked=!0,r=a.eval(r.shift()),b.containsError(r)&&(a.stackTop.blocked=!1,t.removeData("blockers").replaceWith(r.render(t.attr("title"),t))),!1;t.removeData("blockers")}r=t.popData("code")||(null==n?void 0:n.code);r&&c.call(a,t,r);break;case"script":if(f.reattachStoryElement(),t.text())try{i(t.text(),a.stackTop.tempVariables)}catch(e){b.isPrototypeOf(e)?t.replaceWith(e.render(t.text(),t)):(null!=(r=window.console)&&r.error(e),t.replaceWith(b.create("","A Javascript error occurred while running this <script> element.",'The error was "'.concat(e,'". Check the browser console for more details.')).render(t.text(),t)))}}}),this.stackTop.blocked||(n.length&&r&&s(n),n.findAndFilter("tw-collapsed,[collapsing=true]").each(function(){s(p(this))}),setTimeout(function(){return n.find("input, textarea").first().focus()},100),this.stack.shift())},updateEnchantments:function(){this.enchantments.forEach(function(e){e.disenchant(),e.enchantScope()})},on:function(e,t){return l[e].push(t),this},addEnchantment:function(t){var n=this;this.enchantments.push(t),l.add.forEach(function(e){return e(n,t)})},removeEnchantment:function(t){var n=this,e=this.enchantments.indexOf(t);this.enchantments.splice(e,1),t.disenchant(),l.remove.forEach(function(e){return e(n,t)})},unblock:function(e){for(this.stack.length||f.impossible("Section.unblock","stack is empty"),this.stackTop.blocked=!1,void 0!==e&&(this.stackTop.blockedValues=(this.stackTop.blockedValues||[]).concat(e));this.stack.length&&!this.stackTop.blocked;)this.execute();if(!this.stack.length)for(;0<this.unblockCallbacks.length;){var t;if(this.unblockCallbacks.shift()(),null!=(t=this.stackTop)&&t.blocked)return}},whenUnblocked:function(e,t){this.stack.length&&this.stackTop.blocked?this.unblockCallbacks=this.unblockCallbacks.concat(e):(t||e)()},blockedValue:function(){var e=this.stackTop;return e?e.blockedValues&&e.blockedValues.length?e.blockedValues.shift():(f.impossible("Section.blockedValue","blockedValues is missing or empty"),0):(f.impossible("Section.blockedValue","stack is empty"),0)}})}),define("state",["jquery","utils","passages","datatypes/customcommand","utils/operationutils","markup"],function(n,y,b,v,e,t){var i,w,C=e.toSource,E=e.is,k=t.lex,o=Object.assign,h=Object.create,e=Object.defineProperty,N=Array.isArray,s=Math.imul,t=(e(Map.prototype,"toJSON",{value:void 0}),e(Set.prototype,"toJSON",{value:void 0}),["localStorage","sessionStorage"].map(function(e){try{return!!window[e]&&(window[e].setItem("test","1"),window[e].removeItem("test"),!0)}catch(e){return!1}}));function S(e,t){var n=0<arguments.length&&void 0!==e?e:String.fromCodePoint(Date.now()%1114112),e=1<arguments.length&&void 0!==t?t:0;i.seedIter=e,i.seed=n;for(var r,a=0,o=2166136261;a<n.length;a+=1)r=s(n.charCodeAt(a),3432918353),o^=s(r<<15|r>>>17,461845907),o=s(o=o<<13|o>>>19,5)+3864292196|0;return o^=n.length,o=s(o^=o>>>16,2246822507),o=s(o^=o>>>13,3266489909),o=((o^=o>>>16)>>>0)+1831565813*e,function(){i.seedIter+=1;var e=o+=1831565813,e=s(e^e>>>15,1|e);return(((e^=e+s(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}}function r(e,t){for(var n,r=t.variables,a=h(null),o=e.length-1;0<=o;--o){for(var i,s,c=e[o],l=0,u=["mockVisits","mockTurns","seed","seedIter"];l<u.length;l++){var p=u[l];hasOwnProperty.call(c,p)&&!hasOwnProperty.call(t,p)&&(t[p]=c[p])}for(i in c.forgetVisits&&(t.forgetVisits=Math.max(t.forgetVisits||0,c.forgetVisits)),void 0!==c.turns&&(t.turns=(t.turns||0)+c.turns),t.pastVisits||(t.pastVisits=[]),o!==e.length-1&&(void 0!==e[o+1].visits&&Array.isArray(t.pastVisits[0])?t.pastVisits[0]:t.pastVisits).unshift(c.passage),void 0!==c.pastVisits&&t.pastVisits.unshift(c.pastVisits),void 0!==c.visits&&t.pastVisits.unshift(c.visits),c.variables)if("TwineScript_TypeDefs"===i)for(var d in r[i]||(r[i]=h(null)),c.variables[i])r[i][d]||(r[i][d]=c.variables[i][d]);else i.startsWith("TwineScript_")||i in r||(null===c.variables[i]&&(a[i]=!0),a[i])||(r[i]=c.variables[i],!(s=c.valueRefs[i]))||"via"in s||t.valueRefs[i]||(t.valueRefs[i]=s)}for(n in t.valueRefs){var f=t.valueRefs[n];f&&"via"in f&&delete t.valueRefs[n]}}var a,c={passage:"",variables:h(null),visits:void 0,turns:void 0,seed:void 0,seedIter:void 0,mockVisits:void 0,mockTurns:void 0,forgetVisits:void 0,create:function(e){var t=h(c);return t.passage=e||"",t.variables=h(null),t.valueRefs=h(null),t}},l={forward:[],back:[],load:[],beforeForward:[],beforeBack:[],beforeLoad:[],forgetUndos:[]},u=[],p=-1,d=c.create(),f="";function m(){i.history=i.pastVisits.slice(i.forgetVisits).reduce(function(e,t){return e.concat(t)},[]),i.mockVisits&&(i.history=i.mockVisits.concat(i.history))}function g(){var e=c.create();e.pastVisits=[],o(e.variables,{TwineScript_ObjectName:"this story's variables",TwineScript_TypeDefs:h(null),TwineScript_VariableStore:{type:"global",name:"this story's variables"},TwineScript_Delete:function(e){delete this[e],d.variables[e]=null,delete d.valueRefs[e]},TwineScript_Set:function(e,t,n){if(this[e]=t,d.variables[e]=t,n)d.valueRefs[e]=n;else if((N(t)||t instanceof Map||t instanceof Set||"string"==typeof t)&&!y.options.uncompressedStructures)for(var r=p;0<=r;--r){var a=u[r].variables[e];if(void 0!==a){a=function e(t,n,r){var a="it"===r?"its":r+"'s",o="";if(N(n)&&N(t)&&n.length){for(var i=n.length===t.length,o="(a:",s=0;s<n.length;s+=1){var c,l,u,p=n[s];E(p,t[s])?(c=C(p),l="".concat(a," ").concat(s+1,"th"),o+=(c.length<l.length?c:l)+","):(i=!1,-1<(c=t.indexOf(p))?(l=C(p),u="".concat(a," ").concat(c+1,"th"),o+=(l.length<u.length?l:u)+","):o+=e(t[s],p,"".concat(a," ").concat(s+1,"th"))+",")}o=i?r:o.slice(0,-1)+")"}else if(n instanceof Map&&t instanceof Map&&n.size){var d,f=n.size===t.size,h=(o="(dm:",_createForOfIteratorHelper(n.entries()));try{for(h.s();!(d=h.n()).done;){var m,g,y=_slicedToArray(d.value,2),b=y[0],v=y[1];o+="".concat(C(b),","),E(v,t.get(b))?(m=C(v),g="".concat(a," (").concat(C(b),")"),o+=(m.length<g.length?m:g)+","):(f=!1,o+=e(t.get(b),v,"".concat(a," (").concat(C(b),")"))+",")}}catch(e){h.e(e)}finally{h.f()}o=f?r:o.slice(0,-1)+")"}else if(n instanceof Set&&t instanceof Set&&n.size){var w,k=new Set,S=new Set,T=_createForOfIteratorHelper(t);try{for(T.s();!(w=T.n()).done;){var _=w.value;n.has(_)||k.add(_)}}catch(e){T.e(e)}finally{T.f()}var x,O=_createForOfIteratorHelper(n);try{for(O.s();!(x=O.n()).done;){var A=x.value;t.has(A)||S.add(A)}}catch(e){O.e(e)}finally{O.f()}k.size||S.size||(o=r),o=k.size+S.size>n.size?C(n):r+(S.size?"+"+C(S):"")+(k.size?"-"+C(k):"")}else"string"==typeof n&&"string"==typeof t&&n&&(n.startsWith(t)?o=r+"+"+C(n.slice(t.length)):n.endsWith(t)&&(o=C(n.slice(0,n.length-t.length))+"+"+r));return o?"it"===r?{via:o}:o:"it"===r?void 0:C(n)}(a,t,"it");a&&("it"===a.via?delete d.variables[e]:d.valueRefs[e]=a);break}}},TwineScript_GetProperty:function(e){return this[e]},TwineScript_DefineType:function(e,t){this.TwineScript_TypeDefs[e]=t,hasOwnProperty.call(d.variables,"TwineScript_TypeDefs")||(d.variables.TwineScript_TypeDefs=h(null)),d.variables.TwineScript_TypeDefs[e]=t}}),r(u.slice(0,p+1),e),i=e,m(),w=S(e.seed,e.seedIter)}function T(e){d=c.create(e);e=a.serialise(!0),f=e.past,e=e.pastAndPresent;if(a.hasSessionStorage&&"string"==typeof e)try{sessionStorage.setItem("Saved Session",e)}catch(e){}}function _(e,t,n,r){for(var a in r)if(hasOwnProperty.call(r,a)&&!a.startsWith("TwineScript_"))if("object"===_typeof(r[a]))if(hasOwnProperty.call(r[a],"at")){n.valueRefs[a]=r[a];var o=r[a],i=o.at,s=o.from,c=o.to,l=o.hash,u=o.seed,p=o.seedIter,o=o.blockedValues;if(!b.has(i))throw Error('The data refers to a passage named `"'.concat(n.passage,"\"`, but it isn't in this story."));var d=b.get(i).get("source"),f=d.slice(s,c);if(void 0!==l)for(var h=0,m=c-s;y.hash(f).toString(16)!==l;){if(h+m>=d.length)throw Error("The value (or type) of the variable `$".concat(a,"` couldn't be found in the passage `\"").concat(i,'"`.'));(h+=1)===s&&(h+=1),f=d.slice(h,h+m)}c=k(f,"","macro");void 0!==u&&void 0!==p&&(w=S(u,p)),void 0!==o&&(e.stackTop.blockedValues=o,c.forEach(function e(t){var n;"string"!==t.type&&"hook"!==t.type&&t.children.every(e),"macro"!==t.type||"prompt"!==(n=y.insensitiveName(t.name))&&"confirm"!==n||(t.blockedValue=!0)})),r[a]=e.eval(c)}else if(hasOwnProperty.call(r[a],"via")){for(var g=t.length-1;0<=g;--g)if(hasOwnProperty.call(t[g].variables,a)){e.Identifiers.it=t[g].variables[a];break}r[a]=e.eval(k(r[a].via,"","macro")),e.Identifiers.it=0}else hasOwnProperty.call(r[a],"changer")&&(r[a].changer=e.eval(k(r[a].changer,"","macro")),r[a].hook=e.eval(k(r[a].hook,"","macro")),_(e,t,n,r[a].variables),r[a]=v.create(r[a]));else r[a]=e.eval(k(r[a],"","macro"));else"TwineScript_MockVisits"===a&&(n.mockVisits=r[a])}return g(),d.seed=i.seed,d.seedIter=0,(a={get passage(){return d.passage},get variables(){return i.variables},get pastLength(){return p},get turns(){return p+1+(i.turns||0)+(i.mockTurns||0)},get futureLength(){return u.length-1-p},get mockVisits(){return i.mockVisits||[]},set mockVisits(e){i.mockVisits=e,d.mockVisits=e,m()},get mockTurns(){return i.mockTurns||0},set mockTurns(e){i.mockTurns=e,d.mockTurns=e},history:function(){return i.history},forgetUndos:function(e){e<0&&(e=u.length+e);var t,e=u.splice(0,Math.min(u.length-1,e));e.length&&(p=u.length-1,t=u[0],r(e,t),t.pastVisits.push(e[e.length-1].passage),t.turns=(t.turns||0)+e.length,i.turns=(i.turns||0)+e.length,t.forgetVisits&&(t.pastVisits=t.pastVisits.slice(t.forgetVisits-t.turns),t.forgetVisits-=t.turns),f="",0===p&&n("tw-link[undo], tw-icon[alt='Undo']",y.storyElement).each(function(e,t){(n(t).closest("tw-expression, tw-hook").data("forgetUndosEvent")||Object)(t)}),l.forgetUndos.forEach(function(e){return e()}))},forgetVisits:function(e){(e=e<0?u.length+e:e)>p+i.turns&&(e=p+i.turns),d.forgetVisits=i.forgetVisits=Math.max(i.forgetVisits||0,e),m()},passageNameVisited:function(e){var t=0;if(!b.get(e))return 0;for(var n=0;n<i.history.length;n++)t+=+(e===i.history[n]);return t},get timeline(){return u},play:function(t){var e;d||y.impossible("State.play","present is undefined!"),l.beforeForward.forEach(function(e){return e()}),d.passage&&((null!=(e=d.visits)&&e.length&&Array.isArray(i.pastVisits[i.pastVisits.length-1])?i.pastVisits[i.pastVisits.length-1]:i.pastVisits).push(d.passage),i.history.push(d.passage)),d.passage=t,u=u.slice(0,p+1).concat(d),p+=1,T(t),l.forward.forEach(function(e){return e(t)})},redirect:function(e){var t;d||y.impossible("State.redirect","present is undefined!"),d.passage&&(null!=(t=d.visits)&&t.length&&Array.isArray(i.pastVisits[i.pastVisits.length-1])?i.pastVisits[i.pastVisits.length-1].push(d.passage):i.pastVisits.push([d.passage]),i.history.push(d.passage)),d.visits=(d.visits||[]).concat(e),d.passage=e},rewind:function(e){for(var t=void 0!==e?e:1,n=!1;0<t&&0<p;t--)n=!0,--p;return n&&(l.beforeBack.forEach(function(e){return e()}),f="",T(u[p].passage),g(),l.back.forEach(function(e){return e()})),n},fastForward:function(e){var t=1,n=!1;for("number"==typeof e&&(t=e);0<t&&0<u.length;t--)n=!0,p+=1;return n&&(l.beforeForward.forEach(function(e){return e()}),T(u[p].passage),g(),l.forward.forEach(function(e){return e(u[p].passage,"fastForward")})),n},on:function(e,t){if(e in l)return"function"!=typeof t||l[e].includes(t)||l[e].push(t),a;y.impossible("State.on","invalid event name")},reset:function(){l.beforeLoad.forEach(function(e){return e()}),u=[],p=-1,g(),(d=c.create()).seed=i.seed,d.seedIter=0,f="",w=S(),l.load.forEach(function(e){return e(u)})},hasStorage:t[0],hasSessionStorage:t[1],setSeed:function(e){w=S(e),d.seed=i.seed,d.seedIter=0},get seed(){return i.seed},get seedIter(){return i.seedIter},random:function(){var e=w();return d.seedIter=i.seedIter,e},shuffled:function(){for(var a=this,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce(function(e,t,n){var r=a.random()*(n+1)|0;return r===n?e.push(t):(e.push(e[r]),e[r]=t),e},[]);return d.seedIter=i.seedIter,r}}).serialise=function(e){function o(e,t){if("TwineScript_TypeDefs"===t){var n,r={};for(n in e[t])r[n]=C(e[t][n]);return r}var a;return null===e[t]?null:e[t]&&hasOwnProperty.call(e[t],"TwineScript_CustomCommand")?(a=e[t].TwineScript_CustomCommand(),{changer:C(a.changer),toSource:a.toSource,hook:C(a.hook),variables:Object.keys(a.variables).reduce(function(e,t){return e[t]=o(a.variables,t),e},{})}):C(e[t])}function t(e,t){if(c.isPrototypeOf(t)&&void 0===t.visits&&void 0===t.turns&&void 0===t.mockVisits&&void 0===t.forgetVisits&&void 0===t.pastVisits&&void 0===t.mockTurns&&void 0===t.seed&&void 0===t.seedIter&&Object.keys(t.variables).every(function(e){return e.startsWith("TwineScript_")}))return t.passage;if(!c.isPrototypeOf(this)||"valueRefs"!==e){if(c.isPrototypeOf(this)&&"variables"===e){var n,r={};for(n in this.variables)this.valueRefs[n]?r[n]=this.valueRefs[n]:r[n]=o(this.variables,n);return r}return t}}var e=u.slice(f?e?p-1:p:0,p+1),n=e.slice(0,-1),r=f;try{return{past:r=n.length?(r?r.slice(0,-1)+",":"[")+JSON.stringify(n,t).slice(1):r,pastAndPresent:r.slice(0,-1)+(r?",":"[")+JSON.stringify(e.slice(-1),t).slice(1)}}catch(e){return{past:!1,pastAndPresent:!1}}},a.deserialise=function(e,t){var n;try{n=JSON.parse(t)}catch(e){return Error("The save data is unintelligible.")}if(!N(n))return Error("The save data isn't a sequence of past turns.");for(var r=0;r<n.length;r+=1){var a=n[r];if("string"==typeof a)a={passage:a,variables:{}};else if("object"!==_typeof(a)||!hasOwnProperty.call(a,"variables")){n.splice(r--,1);continue}if(a.valueRefs=h(null),a.variables=o(h(null),a.variables),!b.hasValid(a.passage))return Error('The data refers to a passage named `"'.concat(a.passage,"\"`, but it isn't in this story."));if(hasOwnProperty.call(a.variables,"TwineScript_TypeDefs"))try{_(e,n.slice(0,r),a,a.variables.TwineScript_TypeDefs)}catch(e){return Error("The variable types on turn ".concat(r+1," couldn't be reconstructed.").concat(e.message?" (".concat(e.message,")"):""))}try{_(e,n.slice(0,r),a,a.variables)}catch(e){return Error("The variables on turn ".concat(r+1," couldn't be reconstructed.").concat(e.message?" (".concat(e.message,")"):""))}n[r]=o(h(c),a)}return p=(u=n).length-1,l.load.forEach(function(e){return e(u)}),f="",g(),T(u[p].passage),!0},Object.seal(c),Object.freeze(a)}),define("utils",["jquery","markup","utils/polyfills"],function(d){var r=String.fromCharCode,n="audio,blockquote,canvas,div,h1,h2,h3,h4,h5,hr,ol,p,pre,table,ul,video,tw-align,tw-story,tw-passage,tw-sidebar,tw-columns,tw-column,tw-meter".split(","),a="a,b,i,em,strong,sup,sub,abbr,acronym,s,strike,del,big,small,script,img,button,input,tw-link,tw-broken-link,tw-verbatim,tw-collapsed,tw-error,tw-colour,tw-icon".split(","),f=["audio"],e=_slicedToArray([function(e){return r(e)!==r(e).toLowerCase()},function(e){return r(e)!==r(e).toUpperCase()},function(e){return r(e).toLowerCase()!==r(e).toUpperCase()}].map(function(e){return"["+Array.from(Array(57343)).map(function(e,t){return t}).filter(e).map(function(e,t,n){return e===n[t-1]+1&&e===n[t+1]-1?"-":r(e)}).join("").replace(/-+/g,"-")+"]"}),3),t=e[0],o=e[1],e=e[2];function s(e){return"instant"===e?0:800}var i,c,l=[],u={},p=0,h={},m=0,g={};function y(n,r,e,a,o){var i=null,s=0,c=r+e;function l(e){var t;1&n[0].compareDocumentPosition(document)&&(c=0),i&&(c-=t=e-i),i=e,0<a&&0<p+m&&n.data("expediteAnim")(a),c<=r&&(s+=t||0,"paused"===n.css("animation-play-state"))&&n.css({visibility:"","animation-play-state":"running"}),c<=0?(n.removeData("expediteAnim"),o()):requestAnimationFrame(l)}n.data("expediteAnim",function(e){var t;c-=e=void 0===e?s:e,"running"===n.css("animation-play-state")&&n.css("animation-delay",(("ms"===(t=(t=n.css("animation-delay")).toLowerCase()).slice(-2)?+t.slice(0,-2)||0:"s"===t.slice(-1)&&1e3*+t.slice(0,-1)||0)||0)-e+"ms")}),c?requestAnimationFrame(l):l()}d(document.documentElement).on("keydown keyup mousedown mouseup",function(e){var t=e.key,n=e.button,e=e.type.includes("down"),r=t?u:h,n=t&&v.insensitiveName(t)||n;r[n]&&!e?t?p=Math.max(p-1,0):m=Math.max(m-1,0):!r[n]&&e&&(t?p+=1:m+=1),r[n]=e}).on("mousemove",function(e){var t=e.pageX,e=e.pageY;g.x=t,g.y=e});var b=/-|_/g,v={hash:function(e){for(var t=9,n=e.length;0<n;)--n,t=Math.imul(t^e.charCodeAt(n),Math.pow(9,9));return(t^t>>>9)>>>0},permutations:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r,a,o=t.length,i=[[].concat(t)],s=Array(o).fill(0),c=1;c<o;)s[c]<c?(r=c%2&&s[c],a=t[c],t[c]=t[r],t[r]=a,++s[c],c=1,i.push([].concat(t))):(s[c]=0,++c);return i},nth:function(e){var t=+e+"";return e+("1"!==t[t.length-1]||1!==t.length&&"1"===t[t.length-2]?"2"!==t[t.length-1]||1!==t.length&&"1"===t[t.length-2]?"3"!==t[t.length-1]||1!==t.length&&"1"===t[t.length-2]?"th":"rd":"nd":"st")},plural:function(e,t,n){return e+" "+(1!==Math.abs(e)?n||t+"s":t)},andList:function(e){return e.length<=1?e[0]:e.slice(0,-1).join(", ")+" and "+e[e.length-1]},realWhitespace:"[ \\n\\r\\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]",anyRealLetter:"[\\dA-Za-z\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",anyUppercase:t,anyLowercase:o,anyCasedLetter:e,anyNewline:"(?:\\n|\\r|\\r\\n)",unescape:function(e){return e.replace(/&(?:amp|lt|gt|quot|nbsp|zwnj|#39|#96);/g,function(e){return{"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"',"&#39;":"'","&nbsp;":String.fromCharCode(160),"&zwnj;":String.fromCharCode(8204)}[e]})},escape:function(e){return e.replace(/[&><"']/g,function(e){return{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"}[e]})},insensitiveName:function(e){return(e+"").toLowerCase().replace(b,"")},allKeysDown:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(function(e){return u[e]})},someKeysDown:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function(e){return u[e]})},buttonsDown:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every(function(e){return h[e]})},anyInputDown:function(){return 0<p+m},mouseCoords:g,parentColours:function(e){for(var t,n={colour:null,backgroundColour:null},r=/^\w+a\(.+?,\s*0\s*\)$|^transparent$/;e.length&&e[0]!==document;e=e.parent())if(n.backgroundColour||(t=e.css("background-color")).match(r)||(n.backgroundColour=t),n.colour||(t=e.css("color")).match(r)||(n.colour=t),n.colour&&n.backgroundColour)return n;return{colour:"#fff",backgroundColour:"#000"}},childrenProbablyInline:function(e){var t=[];return[].every.call(e.findAndFilter("*"),function(e){if(!(e.hidden||/none|inline/.test(e.style.display)||/display: (none|inline)/.test(e.getAttribute("style")))){if(n.includes(e.tagName.toLowerCase())||/display: (?!none|inline|inherit|unset)/.test(e.getAttribute("style")))return!1;a.includes(e.tagName.toLowerCase())||t.push(e)}return!0})&&t.every(function(e){return/inline|none/.test(window.getComputedStyle(e).display)})},transitionOut:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,i=6<arguments.length&&void 0!==arguments[6]?arguments[6]:void 0;0!==e.length&&(n=n||s(t),!(1<e.length)&&v.childrenProbablyInline(e)&&["tw-hook","tw-passage","tw-sidebar","tw-expression"].includes(e.tag())||(e=e.wrapAll("<tw-transition-container>").parent()),i&&e.css("transform-origin",i),e.attr("data-t8n",t).addClass("transition-out").css({"animation-duration":"".concat(n,"ms"),"animation-delay":"".concat(-o,"ms"),"animation-play-state":"paused"}),requestAnimationFrame(function(){v.childrenProbablyInline(e)?e.css("display","inline"):e.parent().is("tw-backdrop,tw-story")||e[0].setAttribute("style",e[0].getAttribute("style")+"display:block !important;width:100%")}),y(e,n,r-o,a,function(){e.remove()}))},transitionIn:function(u,e,t){var p,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:void 0;0!==u.length&&(t=t||s(e),(p=1<u.length||!v.childrenProbablyInline(u)||!["tw-hook","tw-passage","tw-sidebar","tw-expression"].includes(u.tag()))&&(u=u.wrapAll("<tw-transition-container>").parent()),o&&u.css("transform-origin",o),u.attr("data-t8n",e).addClass("transition-in").css(_objectSpread({"animation-duration":"".concat(t,"ms"),"animation-delay":"".concat(-a,"ms")},n-a?{visibility:"hidden","animation-play-state":"paused"}:{})),requestAnimationFrame(function(){v.childrenProbablyInline(u)?u.css("display","inline"):u.parent().is("tw-backdrop,tw-story")||u[0].setAttribute("style",u[0].getAttribute("style")+"display:block !important;width:100%")}),y(u,t,n-a,r,function(){var e=0===u.filter(f.join(",")).length;if(p&&e){u.find("tw-transition-container, .transition-in, .transition-out").each(function(e,t){((t=d(t)).data("expediteAnim")||Object)()});for(var t=[],n=u.find("*"),r=0;r<n.length;r+=1){var a=n[r];0===a.scrollTop&&0===a.scrollLeft||t.push([a,a.scrollLeft,a.scrollTop])}e=u.find(document.activeElement);u.contents().unwrap();for(var o=0,i=t;o<i.length;o++){var s=_slicedToArray(i[o],3),c=s[0],l=s[1],s=s[2];c.scrollLeft=l,c.scrollTop=s}e.length&&e[0].focus()}else u.removeClass("transition-in").removeAttr("data-t8n")}))},debounce:function(e){function t(){300<Date.now()-l||s<=u?(u=n=0,p=!i,o?(e(c),c=[]):e.apply(void 0,_toConsumableArray(c)),p=!1):n=requestAnimationFrame(t)}var n,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=r.batch,o=void 0!==a&&a,a=r.recur,i=void 0!==a&&a,a=r.maxWait,s=void 0===a?1/0:a,c=[],l=0,u=0,p=!1;return function(){var e;p||(e=Date.now(),u+=e-l,l=e,o?c.push(arguments):c=arguments,n&&cancelAnimationFrame(n),n=requestAnimationFrame(t))}},impossible:function(e,t){window.console&&console.error(e+"(): "+t)},onStartup:function(e){l?l.push(e):e()},get storyElement(){return i},detachStoryElement:function(){document.documentElement.contains(i[0])&&(c=i.parent(),i.detach())},reattachStoryElement:function(){document.documentElement.contains(i[0])||(c||d(document.body)).append(i.parents().length?i.parents().last():i)},options:{speedMultiplier:1}};return d(function(){i=d("tw-story"),l.forEach(function(e){return e()}),l=null}),Object.freeze(v)}),define("datatypes/assignmentrequest",["utils/operationutils","datatypes/typedvar","datatypes/datatype","internaltypes/varref","internaltypes/twineerror"],function(e,y,b,v,w){var k=e.objectName,S=e.matches,t=e.toSource;return Object.freeze({assignmentRequest:!0,TwineScript_TypeName:"a VariableToValue (a 'to' or 'into' expression)",TwineScript_ObjectName:"a VariableToValue (a 'to' or 'into' expression)",TwineScript_ToSource:function(){return"into"===this.operator?"".concat(t(this.src)," ").concat(this.operator," ").concat(t(this.dest)):"".concat(t(this.dest)," ").concat(this.operator," ").concat(t(this.src))},TwineScript_Unstorable:!0,set:function(){var e,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=[],r=function e(t,n,r){var a=!(2<arguments.length&&void 0!==r)||r,o=[],i=n&&v.isPrototypeOf(n)?n.get():n;if(w.containsError(i))return i;if(Array.isArray(i)&&Array.isArray(t)){for(var s=0,c=0;s<t.length&&c<i.length;){var l=t[s],u=i[c];if(y.isPrototypeOf(l)&&l.datatype.rest||b.isPrototypeOf(l)&&l.rest){for(var p=c;c<i.length&&S(l,u);)u=i[c+=1];y.isPrototypeOf(l)?l.datatype=[l.datatype]:b.isPrototypeOf(l)&&(l=b.create("array")),o=o.concat(e(l,v.isPrototypeOf(n)?v.create(n,{first:p+1,last:c+1}):i.slice(p,c)))}else o=o.concat(e(l,v.isPrototypeOf(n)?v.create(n,c+1):u)),c+=1;s+=1}return s<t.length?a&&w.create("operation","I can't unpack this array because it needs ".concat(t.length-s," more value").concat(0<t.length-s?"s":"",".")):o}if(t instanceof Map&&i instanceof Map){var d,f=_createForOfIteratorHelper(t.entries());try{for(f.s();!(d=f.n()).done;){var h=_slicedToArray(d.value,2),m=h[0],g=h[1];if(!i.has(m))return a&&w.create("operation","I can't unpack this datamap because it needs a '"+m+"' data name.");o=o.concat(e(g,v.isPrototypeOf(n)?v.create(n,m):i.get(m)))}}catch(e){f.e(e)}finally{f.f()}return o}if(y.isPrototypeOf(t)){if("function"==typeof t.datatype.destructure)return[{dest:t,value:i,src:n}].concat(t.datatype.destructure(i));if(!S(i,t.datatype))return a&&w.create("operation","I can't put ".concat(k(i)," into ").concat(t.varRef.TwineScript_ToSource()," because it doesn't match ").concat(t.varRef.TwineScript_ToSource(),"'s datatype, ").concat(k(t.datatype),"."));o=o.concat(e(t.datatype,i))}return v.isPrototypeOf(t)||y.isPrototypeOf(t)?o.concat({dest:t,value:i,src:n}):"function"==typeof t.destructure?o.concat(t.destructure(i)):S(i,t)?o:a&&w.create("operation","I tried to unpack, but "+k(t)+" in the pattern didn't match "+k(i)+".")}(this.dest,this.src);if(e=w.containsError(r))return e;if(!r.length)return w.create("operation","I can't store a new value inside "+k(this.dest)+" that isn't in a variable.","You need a variable, or a data structure containing variables at certain positions, to store the value.");var a,o=_createForOfIteratorHelper(r.reverse());try{for(o.s();!(a=o.n()).done;){var i=a.value,s=i.dest,c=i.value,l=i.src;if(y.isPrototypeOf(s)){if(e=w.containsError(s.defineType()))return e;s=s.varRef}if(e=s.set(c,this.srcRef),w.isPrototypeOf(e))return e;t&&l&&l.delete(),n.shift(k(s)+" is now "+k(c))}}catch(e){o.e(e)}finally{o.f()}return n.join("; ")},create:function(e,t,n,r){return w.containsError(e)?e:w.containsError(t)?t:Object.assign(Object.create(this),{dest:e,src:t,operator:n,srcRef:r})}})}),define("datatypes/changercommand",["utils","utils/operationutils","internaltypes/changedescriptor","internaltypes/twineerror"],function(e,t,n,r){var i=e.plural,a=e.impossible,o=t.is,s=t.toSource,c={},l={TwineScript_TypeID:"changer",TwineScript_TypeName:"a changer",TwineScript_Print:function(){return"`[A ("+this.macroName+":) changer]`"},TwineScript_ToSource:function(){return"("+this.macroName+":"+("else"===this.name?"":this.params.map(s))+")"+(this.next?"+"+this.next.TwineScript_ToSource():"")},get TwineScript_ObjectName(){1===this.params.length&&36<(e=s(this.params[0])).length&&(e=void 0);for(var e,t="a (".concat(this.macroName,":").concat(e||"",") changer"),n=this.next,r=(n&&(t+=" combined with "),0);n&&t.length<48;){var a="(".concat(n.macroName,":)");t+=(0<r&&!n.next?" and ":"")+a+(n.next?", ":""),n=n.next,r+=1}for(var o=0;n&&o<99;)n=n.next,o+=1;return 0<o&&(t+="".concat(0<r?" and ":"").concat(i(o,"other changer"))),t},summary:function(){var e=n.create();return this.run(e),e.summary()},create:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];return Array.isArray(t)||a("ChangerCommand.create","params was not an array but "+t),Object.assign(Object.create(this),{macroName:e,params:t,next:n,canEnchant:r})},"TwineScript_+":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t.canEnchant=this.canEnchant&&e.canEnchant,t},TwineScript_is:function(e){if(l.isPrototypeOf(e))return this.macroName===e.macroName&&o(this.params,e.params)&&o(this.next,e.next)},TwineScript_Clone:function(){for(var e=l.create(this.macroName,this.params,this.next),t=e;t.next;)t=t.next=t.next.TwineScript_Clone();return e.canEnchant=this.canEnchant,e},run:function(e,t){var n="output"===this.macroName?[t||this]:this.params,n=c[this.macroName].apply(c,[e].concat(_toConsumableArray(n)));if(r.containsError(n))return n;this.next&&this.next.run(e,t||this)},register:function(e,t){c[e]=t}};return Object.freeze(l)}),define("datatypes/codehook",[],function(){var t=Object.freeze({TwineScript_TypeName:"a code hook",TwineScript_ObjectName:"a code hook",TwineScript_ToSource:function(){return this.source},TwineScript_Print:function(){return this.code},TwineScript_toString:function(){return this.source},TwineScript_is:function(e){return t.isPrototypeOf(e)&&this.source===e.source},TwineScript_Clone:function(){return t.create(this.code,this.source)},create:function(e,t){return Object.assign(Object.create(this),{code:e,source:t})}});return t}),define("datatypes/colour",["jquery"],function(c){var l=Math.max,u=Math.min,a=Math.sin,o=Math.cos,i=Math.pow,p=Math.round,d=Math.floor,s=Math.atan2,f=Math.cbrt,h=Math.sqrt,m=Math.PI,g=Object.assign,y=Object.create,b=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,t=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,v=y(null);function w(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(0<r.length)return w.apply(void 0,[w(e,t)].concat(r));if(!t)return e;for(var o=[],i=0;i<e.length;i++){o[i]=[];for(var s=0;s<t[0].length;s++){for(var c=0,l=0;l<e[0].length;l++)c+=e[i][l]*t[l][s];o[i][s]=c}}return o}function n(e){var t,n=e.r,r=e.g,a=e.b,e=e.a,o=l(n/=255,r/=255,a/=255),i=u(n,r,a),s=(o+i)/2,c=o-i;if(o===i)return{h:0,s:0,l:s};switch(o){case n:t=(r-a)/c+(r<a?6:0);break;case r:t=(a-n)/c+2;break;case a:t=(n-r)/c+4}return{h:t=p(60*t),s:.5<s?c/(2-o-i):c/(o+i),l:s,a:e}}var k=[.9642956764295677,1,.8251046025104602],S=24389/27,T=216/24389,_=function(e){return e.map(function(e){return[e]})},x=function(e){return e.map(function(e){return e[0]})};function O(e){var t=e.l,n=e.c,r=e.h,e=e.a,n=[t*=100,n*o(r*m/180),n*a(r*m/180)],r=[];r[1]=(n[0]+16)/116,r[0]=n[1]/500+r[1],r[2]=r[1]-n[2]/200;n=[i(r[0],3)>T?i(r[0],3):(116*r[0]-16)/S,S*T<t?i((16+t)/116,3):t/S,i(r[2],3)>T?i(r[2],3):(116*r[2]-16)/S].map(function(e,t){return e*k[t]}),t=_slicedToArray(x(w([[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]],w([[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]],_(n)))).map(function(e){return u(255,l(0,255*(.0031308<(e=e)?1.055*i(e,1/2.4)-.055:12.92*e)))}),3);return{r:t[0],g:t[1],b:t[2],a:e}}function e(e){function t(e){return 1e-5<=n[e]&&n[e]<=255-1e-5}var n=O(e);if(Object.keys(n).every(t))return n;var r=(e=_objectSpread({},e)).c,a=0;for(e.c/=2;1e-5<r-a;)n=O(e),Object.keys(n).every(t)?a=e.c:r=e.c,e.c=(r+a)/2;return O(e)}var A=Object.freeze({TwineScript_TypeID:"colour",TwineScript_TypeName:"a colour",TwineScript_ObjectName:"a colour",TwineScript_DebugName:function(){return"a colour "+this.TwineScript_Print()},"TwineScript_+":function(e){var t=this.toRGBA(),e=e.toRGBA();return A.create({r:u(p(.6*(t.r+e.r)),255),g:u(p(.6*(t.g+e.g)),255),b:u(p(.6*(t.b+e.b)),255),a:(t.a+e.a)/2})},TwineScript_Print:function(){var e=this.toRGBA();return"<tw-colour style='background-color:rgba("+[e.r,e.g,e.b,e.a]+");'></tw-colour>"},TwineScript_is:function(e){var t;return!!A.isPrototypeOf(e)&&(e.lcha&&this.lcha?e.lcha.l===this.lcha.l&&e.lcha.c===this.lcha.c&&e.lcha.h===this.lcha.h&&e.a===this.a:(t=this.toRGBA(),(e=e.toRGBA()).r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a))},TwineScript_Clone:function(){return A.create(this)},toRGBAString:function(){var e=this.toRGBA(),t=e.r,n=e.g,r=e.b,e=e.a;return"rgba(".concat(t,", ").concat(n,", ").concat(r,", ").concat(e,")")},toHSLA:function(){return n(this.toRGBA())},toRGBA:function(){return this.lch?e(_objectSpread({a:this.a},this.lch)):this},toLCHA:function(){return this.lch?_objectSpread({a:this.a},this.lch):(t=(e=this).r,n=e.g,r=e.b,e=e.a,n=[116*(t=x(w([[1.0479298208405488,.022946793341019088,-.05019222954313557],[.029627815688159344,.990434484573249,-.01707382502938514],[-.009243058152591178,.015055144896577895,.7518742899580008]],w([[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],_([t/255,n/255,r/255].map(function(e){return e<.04045?e/12.92:i((e+.055)/1.055,2.4)}))))).map(function(e,t){return e/k[t]}).map(function(e){return T<e?f(e):(S*e+16)/116}))[1]-16,500*(t[0]-t[1]),200*(t[1]-t[2])],r=180*s(n[2],n[1])/m,{l:n[0]/100,c:h(i(n[1],2)+i(n[2],2)),h:0<=r?r:360+r,a:e});var e,t,n,r},LCHRotate:function(e){e<0&&(e=360+e);var t=this.toLCHA();return t.h=(t.h+e)%360,A.create(t)},TwineScript_GetProperty:function(e){var t;return"lch"===e?(t=this.toLCHA(),new Map([["l",t.l],["c",t.c],["h",t.h]])):(t=this.toRGBA(),"h"===e||"s"===e||"l"===e?n(t)[e]:"r"===e||"g"===e||"b"===e||"a"===e?t[e]:void 0)},TwineScript_Properties:["h","s","l","r","g","b","a","lch"],TwineScript_ToSource:function(){if(0===this.a)return"transparent";var e=!this.lch&&n(this);if(1===e.l&&!e.h&&!e.s)return"white";if(0===e.l&&!e.h&&!e.s)return"black";if(.5<=e.l&&e.l<.5334&&0===e.s)return"gray";if(.5===e.l&&.8<=e.s&&e.s<.804){var t={0:"red",30:"orange",60:"yellow",90:"lime",120:"green",180:"cyan",210:"blue",240:"navy",270:"purple",300:"magenta"}[e.h];if(t)return t}return"(".concat(this.lch?"lch":"hsl",":").concat(this.lch?[this.lch.l,this.lch.c,this.lch.h]:[e.h,e.s,e.l]).concat(1!==this.a?","+this.a:"",")")},create:function(e){var t,n,r,a,o,i;return"string"==typeof e?this.create((A.isHexString(e)?function(e){return"string"!=typeof e?e:(e=(e=e.replace("#","")).replace(b,"$1$1$2$2$3$3"),{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16)})}:function(e){var t;return e in v?v[e]:(t="transparent"===(t=c("<p>").css("background-color",e).css("background-color"))?{r:0,g:0,b:0,a:0}:t.startsWith("rgb")?t.match(/\d+/g).reduce(function(e,t,n){return e["rgb"[n]]=+t,e},{}):{r:192,g:192,b:192},v[e]=t)})(e)):!("h"in e&&"s"in e&&"l"in e)||"r"in e||"g"in e||"b"in e?("a"in e&&"number"==typeof e.a||(e.a=1),"h"in e&&"c"in e&&!("s"in e)&&"l"in e?g(y(this),{a:e.a,lch:{l:e.l,c:e.c,h:e.h}}):g(y(this),e)):this.create((a=(t=e).h,o=e.s,i=e.l,t=e.a,0===o?{r:e=d(255*i),g:e,b:e}:(r=2*i-(n=i<.5?i*(1+o):i+o-i*o),{r:d(255*s((a/=360)+1/3)),g:d(255*s(a)),b:d(255*s(a-1/3)),a:t})));function s(e){return e<0&&(e+=1),1<e&&--e,e<1/6?r+6*(n-r)*e:e<.5?n:e<2/3?r+(n-r)*(2/3-e)*6:r}},isHexString:function(e){return"string"==typeof e&&"#"===e[0]&&(e.slice(1).match(b)||e.slice(1).match(t))},isCSS3Function:function(e){return"string"==typeof e&&/^(?:rgb|hsl)a?\(\s*\d+(?:\.\d+)?\s*,\s*\d+(?:\.\d+)?%?\s*,\s*\d+(?:\.\d+)?%?(?:,\s*\d+(?:\.\d+)?\s*)?\)$/.test(e)}});return A}),define("datatypes/customcommand",["internaltypes/changedescriptor","internaltypes/twineerror"],function(l,u){var p=Object.assign,d=Object.create;return Object.seal({TwineScript_TypeID:"command",TwineScript_ObjectName:"a custom command",TwineScript_TypeName:"a custom command",TwineScript_Print:function(){return"`[a custom command]`"},create:function(e){var t,n=e.toSource,r=e.changer,a=e.hook,o=e.variables,i={};for(t in o)i[t]=[o[t]];var s,c=l.create({source:a,loopVars:i},r);return u.containsError(c)?c:s=p(d(this),{TwineScript_Attach:function(e,t){c.section=e;e=t.run(c);return u.containsError(e)?e:s},TwineScript_Run:function(e){c.section=e;e=c;return c=l.create({source:a,loopVars:i},r),e},TwineScript_ToSource:function(){return n},TwineScript_CustomCommand:function(){return e}})}})}),define("datatypes/custommacro",["jquery","utils","renderer","utils/operationutils","datatypes/customcommand","internaltypes/varref","internaltypes/varscope","internaltypes/twineerror","internaltypes/twinenotifier"],function(w,e,k,t,S,T,_,x,O){function n(v){return function(e){v.called+=1;for(var t=v.varNames,n=v.params,r=v.body,a=E(N(_),{TwineScript_VariableStore:{type:"temp",name:v.TwineScript_ObjectName+" call #"+v.called},TwineScript_TypeDefs:N(null)}),o=[],i=0,s=!1,c=arguments.length,l=new Array(1<c?c-1:0),u=1;u<c;u++)l[u-1]=arguments[u];for(var p=0;p<l.length;p+=1){var d=l[p],f=t[i],h=(a.TwineScript_TypeDefs[f]=n[i].datatype.rest?n[i].datatype.create("array"):n[i].datatype,T.create(a,f));if(x.containsError(h))return h;if(n[i].datatype.rest){var s=!0,m=(a[f]||[]).concat([d]);if(p<l.length-1){a[f]=m;continue}h.set(m)}else h.set(d),i+=1;o.push(O.create(A(h)+" is now "+A(a[f])))}if(!s&&null!=(g=n[i])&&g.datatype.rest){var g=T.create(a,t[i]);if(x.containsError(g))return g;g.set([]),a.TwineScript_TypeDefs[name]=n[i].datatype.create("array")}var y,g=w("<p>").append(k.exec(r.code)),b=e.stack.length,r=(e.stack.unshift({tempVariables:a,dom:g,output:function(e){y=e}}),e.evalReplay);for(e.evalReplay=null,e.execute();e.stack.length>b;)e.stack.shift();e.evalReplay=r;r=g.find("tw-error");return r.length?(g.prepend(o.map(function(e){return e.render()}),"<br>"),x.create("propagated","".concat(r.length," error").concat(1<r.length?"s":""," occurred when running ").concat(v.TwineScript_ObjectName,"."),void 0,g)):void 0===y?x.create("custommacro","".concat(v.TwineScript_ObjectName," didn't output any data or hooks using (output:) or (output-data:).")):"object"===_typeof(y)&&"changer"in y?S.create(E(y,{toSource:"(".concat(v.TwineScript_KnownName||"unnamed",":").concat(l.map(C),")")})):y}}var r=e.andList,A=t.objectName,a=t.typeName,o=t.matches,C=t.toSource,E=Object.assign,N=Object.create,i=Object.seal({TwineScript_TypeID:"macro",TwineScript_TypeName:"a custom macro",TwineScript_GetProperty:function(e){if("params"===e)return _toConsumableArray(this.params)},TwineScript_Properties:["params"],TwineScript_Print:function(){return"`["+this.TwineScript_ObjectName+"]`"},TwineScript_Clone:function(){var e=E(N(i),this);return e.fn=n(e),e},TwineScript_ToSource:function(){return"(macro:"+this.params.map(function(e){return e.TwineScript_ToSource()}).concat("")+this.body.TwineScript_ToSource()+")"},createFromFn:function(e,t,n,r){return E(N(i),{params:[],fn:e,typeSignature:r,TwineScript_ObjectName:t,TwineScript_ToSource:n,TwineScript_KnownName:""})},create:function(e,t){t=E(N(i),{params:e,called:0,varNames:e.map(function(e){return e.varRef.propertyChain[0]}),typeSignature:e.map(function(t){var e=t.datatype.toTypeSignatureObject?t.datatype.toTypeSignatureObject({rest:t.rest}):{pattern:"range",range:function(e){return o(t.datatype,e)},name:a(t.datatype)};return t.rest?{pattern:"zero or more",innerType:e}:e}),body:t,TwineScript_KnownName:"",TwineScript_ObjectName:"a custom macro (with ".concat(e.length?r(e.map(C)):"no params",")")});return t.fn=n(t),t}});return i}),define("datatypes/datatype",["utils","utils/operationutils","datatypes/changercommand","datatypes/colour","datatypes/gradient","datatypes/lambda","datatypes/custommacro","datatypes/codehook","internaltypes/twineerror"],function(e,t,n,r,a,o,i,s,c){var l=e.realWhitespace,u=e.anyRealLetter,p=e.anyCasedLetter,d=e.anyNewline,f=t.objectName,e=Object.seal,h=Object.keys,m=Math.floor,g=Math.abs,y={TwineScript_TypeID:"datatype",TwineScript_TypeName:"a datatype",TwineScript_Print:function(){return"`["+this.TwineScript_ObjectName+"]`"},get TwineScript_ObjectName(){return"the "+(this.rest?"...":"")+this.name+" datatype"},TwineScript_is:function(e){return y.isPrototypeOf(e)&&e.name===this.name},TwineScript_Clone:function(){return this.rest?this:Object.create(this)},TwineScript_ToSource:function(){return(this.rest?"...":"")+this.name},TwineScript_IsTypeOf:function(e){var t=this.name,n=this.rest;return!!v[t]&&v[t](e,n)},toTypeSignatureObject:function(){var e=this.name,e={pattern:"range",range:v[e],name:"a "+("dm"===e?"datamap":"ds"===e?"dataset":"num"===e?e+"ber":"str"===e?e+"ing":"color"===e?"colour":"bool"===e?e+"ean":"alnum"===e?"alphanumeric character":"int"===e?e+"eger":"even"===e||"odd"===e?e+" number":e.endsWith("case")||"whitespace"===e?e+" character":"empty"===e?e+" value":e)};return this.rest?{pattern:"zero or more",innerType:e}:e},create:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=(e="datamap"===e?"dm":"dataset"===e?"ds":"number"===e?"num":"string"===e?"str":"color"===e?"colour":"boolean"===e?"bool":"alphanumeric"===e?"alnum":"integer"===e?"int":"newline"===e?"linebreak":e,Object.create(this));return n.name=e,n.rest=t,n},from:function(t){var e=h(b).find(function(e){return b[e](t)});return e?y.create(e):c.create("datatype",f(t)+" doesn't correspond to a datatype value.")}},b={array:Array.isArray,dm:function(e){return e instanceof Map},ds:function(e){return e instanceof Set},datatype:function(e){return y.isPrototypeOf(e)},changer:function(e){return n.isPrototypeOf(e)},colour:function(e){return r.isPrototypeOf(e)},gradient:function(e){return a.isPrototypeOf(e)},lambda:function(e){return o.isPrototypeOf(e)},macro:function(e){return i.isPrototypeOf(e)},codehook:function(e){return s.isPrototypeOf(e)},command:function(e){return e&&"command"===e.TwineScript_TypeID},str:function(e){return"string"==typeof e},num:function(e){return"number"==typeof e},bool:function(e){return"boolean"==typeof e}},v=_objectSpread(_objectSpread({},b),{},{even:function(e){return!isNaN(e)&&m(g(e))%2==0},odd:function(e){return!isNaN(e)&&m(g(e))%2==1},empty:function(e){return e instanceof Map||e instanceof Set?!e.size:!(!Array.isArray(e)&&"string"!=typeof e||e.length)},int:function(e){return"number"==typeof e&&e===(0|e)},uppercase:function(e){return"string"==typeof e&&1===_toConsumableArray(e).length&&_toConsumableArray(e).every(function(e){return e!==e.toLowerCase()})},lowercase:function(e){return"string"==typeof e&&1===_toConsumableArray(e).length&&_toConsumableArray(e).every(function(e){return e!==e.toUpperCase()})},whitespace:function(e){return"string"==typeof e&&!!e.match("^"+l+"$")},digit:function(e){return"string"==typeof e&&!!e.match("^\\d$")},alnum:function(e){return"string"==typeof e&&!!e.match("^"+u+"$")},anycase:function(e){return"string"==typeof e&&!!e.match("^"+p+"$")},linebreak:function(e){return"string"==typeof e&&!!e.match("^"+d+"$")},any:function(){return!0},const:function(){return!0}});return e(y)}),define("datatypes/gradient",["utils/operationutils"],function(e){var t=e.toSource,n=Object.freeze({TwineScript_TypeID:"gradient",TwineScript_TypeName:"a gradient",TwineScript_ObjectName:"a gradient",TwineScript_DebugName:function(){return"a gradient "+this.TwineScript_Print()},TwineScript_GetProperty:function(e){var t=this;return"angle"===e?this.angle:"stops"===e?this.stops.map(function(e){return new Map([[t.repeating?"pixels":"percent",e.stop],["colour",e.colour.TwineScript_Clone()]])}):void 0},TwineScript_Properties:["angle","stops"],TwineScript_ToSource:function(){return"(gradient:"+this.angle+","+this.stops.map(function(e){return t(e.stop)+","+t(e.colour)})+")"},TwineScript_is:function(e){var r=this;return e.angle===this.angle&&e.stops.length===this.stops.length&&e.stops.every(function(e,t){var n=e.colour,e=e.stop;return r.stops[t].stop===e&&r.stops[t].colour.TwineScript_is(n)})},TwineScript_Clone:function(){return n.create(this.angle,_toConsumableArray(this.stops))},TwineScript_Print:function(){return"<tw-colour style='background:"+this.toLinearGradientString()+"'></tw-colour>"},create:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return Object.assign(Object.create(this),{angle:e,stops:t.sort(function(e,t){return e.stop-t.stop}),repeating:n})},multiply:function(t){return n.create(this.angle,this.stops.map(function(e){return{colour:e.colour,stop:e.stop*t}}))},toLinearGradientString:function(){var r=this;return(this.repeating?"repeating-":"")+"linear-gradient(".concat(this.angle,"deg, ").concat(this.stops.reduce(function(e,t){var n=t.colour,t=t.stop;return e+n.toRGBAString()+" "+t*(r.repeating?1:100)+(r.repeating?"px,":"%,")},"").slice(0,-1),")")}});return n}),define("datatypes/hookset",["jquery","utils","utils/renderutils","utils/operationutils"],function(g,s,e,t){var y=e.textNodeToChars,b=e.realWhitespace,c=e.findTextInNodes,r=t.toSource;function l(e){function t(n,e){if(Array.isArray(e))return e.reduce(function(e,t){return e.add(n.get(t))},g());if(e&&"object"===_typeof(e)&&"first"in e&&"last"in e){for(var t=e.first,r=e.last,a=n.length,o=(t<0&&(t+=a),r<0&&(r+=a),[n.get(t)]);t!==r;)t+=Math.sign(r-t),o.push(n.get(t));return g(o)}if("string"==typeof e){if("chars"===e){var i,s=[],c=_createForOfIteratorHelper(n.textNodes(m));try{for(c.s();!(i=c.n()).done;){var l,u=i.value,p=_createForOfIteratorHelper(y(u));try{for(p.s();!(l=p.n()).done;){var d=l.value;d.textContent.match(b)||s.push(d)}}catch(e){p.e(e)}finally{p.f()}}}catch(e){c.e(e)}finally{c.f()}return g(s)}if("links"===e)return n.findAndFilter("tw-link, .enchantment-link");if("visited"===e)return n.findAndFilter("tw-link.visited");var f,h;if("lines"===e)return f=n.findAndFilter("br:not(tw-sidebar *),tw-consecutive-br:not(tw-sidebar *)").get(),h=[[]],n.contents().each(function e(t,n){var r=(n.tagName||"").toLowerCase();if("tw-sidebar"!==r)if("tw-passage"===r||"tw-transition-container"===r)g(n).contents().each(e);else{if(f.length){if(n===f[0])return f.shift(),void h.push([]);if(16&n.compareDocumentPosition(f[0]))return h.push([]),g(n).contents().each(e),void h.push([])}h[h.length-1].push(n)}}),g(h.map(function(e){return!!e.length&&g(e).wrapAll("<tw-pseudo-hook>").parent()[0]}).filter(Boolean))}return g(n.get(e))}var n,r,a=e.dom,m=":not(tw-error, tw-error *)",o=g();this.next&&(o=o.add(l.call(this.next,e)));if(this.selector){if("string"===this.selector.type)i=this.selector.data,n=c((n=a).textNodes(),i),r=g(),n.forEach(function(e){r=r.add(g(e).wrapAll("<tw-pseudo-hook>").parent())}),i=r;else{if("base"===this.selector.type)return o.add(t(l.call(this.selector.data,e),this.property));n=this.selector.data,e='tw-hook[name="'+(n=s.insensitiveName(n).replace(/"/g,"&quot;"))+'"],tw-enchantment[name="'+n+'"]';var e=e+={page:", tw-story",passage:", tw-passage",sidebar:", tw-sidebar",link:", tw-link, .enchantment-link"}[n]||"",i=a.findAndFilter(e).add(a.parentsUntil(s.storyElement.parent())).filter(e)}o=this.property?o.add(t(i,this.property)):o.add(i)}return o=o.get().reduce(function(e,t){return t=g(t),e.add(t.is("tw-enchantment")&&t.contents().length<=1?t.contents():t)},g())}function a(e){var t,n;return e?(t=e.selector,n=e.property,e=e.next,[JSON.stringify(["base"===t.type?a(t.data):s.insensitiveName(t.data),n])].concat(_toConsumableArray(a(e))).sort()):[]}var o=Object.freeze({forEach:function(e,n){var t=l.call(this,e).each(function(e,t){return n(g(t),e)});return e.dom.findAndFilter("tw-pseudo-hook").contents().unwrap(),t},hooks:function(e){return l.call(this,e)},get TwineScript_ObjectName(){return"the hook name ".concat(this.TwineScript_ToSource())},TwineScript_TypeID:"hookName",TwineScript_TypeName:"a hook name (like ?this)",TwineScript_Unstorable:!0,TwineScript_ToSource:function(){var e="",t=this.selector,n=t.type,t=t.data;return"name"===n?t.match(RegExp("^"+s.anyRealLetter+"+$"))?e+="?"+t:e+="(hooks-named:"+JSON.stringify(t)+")":"string"===n?e+=JSON.stringify(t):"base"===n&&(e+=t.TwineScript_ToSource()+"'s "+r(this.property,"property")),this.next&&(e+=" + "+this.next.TwineScript_ToSource()),e},"TwineScript_+":function(e){for(var t=this.TwineScript_Clone(),n=t;n.next;)n=n.next;return n.next=e,t},TwineScript_is:function(e){return a(this)+""==a(e)+""},TwineScript_GetProperty:function(e){return o.create({type:"base",data:this},e,void 0)},TwineScript_Properties:["chars","links","lines","visited"],TwineScript_Clone:function(){return o.create(this.selector,this.property,this.next)},create:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;return Object.assign(Object.create(this||o),{selector:Object.freeze(e),property:t,next:n})},from:function(e){return o.isPrototypeOf(e)||"string"==typeof e||s.impossible("HookSet.from() was given a non-HookSet non-string."),o.isPrototypeOf(e)?e:o.create({type:"string",data:e})}});return o}),define("datatypes/lambda",["utils/operationutils","internaltypes/varscope","internaltypes/varref","internaltypes/twineerror"],function(e,h,s,m){var g=e.objectName;var c=Object.freeze({TwineScript_TypeID:"lambda",TwineScript_TypeName:"a lambda",get TwineScript_ObjectName(){return'a "'+("making"in this?"making ... ":"")+("each"in this?"each ... ":"")+("where"in this?"where ... ":"")+("when"in this?"when ... ":"")+("via"in this?"via ... ":"")+'" lambda'},TwineScript_Print:function(){return"`[A lambda]`"},TwineScript_is:function(e){return e===this},TwineScript_ToSource:function(){return this.source},TypeSignature:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{pattern:"lambda",innerType:c,clauses:t,typeName:'a "'+t.concat("").join(" ...")+'" lambda'}},TwineScript_Clone:function(){return Object.assign(Object.create(c),this)},create:function(e,t,n,r){var a,o="temp variable, or typed temp variable";function i(e){e=e&&e.varRef?e.varRef:e;return void 0===e||e&&s.isPrototypeOf(e)&&h.isPrototypeOf(e.object)&&1===e.propertyChain.length}if(m.containsError(n))return n;if("making"===t&&!i(n))return m.create("syntax","I need a "+o+", to the right of '"+t+"', not "+g(n)+".");if(m.containsError(e))return e;if(c.isPrototypeOf(e)){if("when"===t||"when"in e)return m.create("syntax","A 'when' lambda cannot have any other clauses, such as '"+t+"'.");if(t in e)return m.create("syntax","This lambda has two '"+t+"' clauses.");a=e}else{if("when"===t&&void 0!==e)return m.create("syntax","A 'when' lambda shouldn't begin with a temp variable (just use 'when' followed by the condition).");if(!i(e))return m.create("syntax","This lambda needs to start with a single "+o+", not "+g(e)+".");(a=Object.create(this)).loop=e||""}return a.source=r.trim(),a[t]=n,a.making&&a.making.getName()===(a.loop&&a.loop.getName())?m.create("syntax","This lambda has two variables named '"+a.loop.getName()+"'.","Lambdas should have all-unique parameter names."):a},apply:function(e,t){var n=t.loop,r=t.pos,a=t.making,o=t.ignoreVia;function i(e,t){if(e){var n,r;if("datatype"in e&&"varRef"in e)return n=e.varRef.create(s,e.varRef.propertyChain),m.containsError(n)?n:(r=n.defineType(e.datatype),m.containsError(r)||(r=n.set(t),m.containsError(r))?r:void 0);s[e.getName()]=t}}var s=(s=t.tempVariables)||Object.create(e.stack.length?e.stackTop.tempVariables:h),t=i(this.loop,n)||i(this.making,a);if(m.containsError(t))return t;e.stack.unshift(Object.assign(Object.create(e.stackTop||null),{tempVariables:s,lambdaPos:this.when?void 0:r})),!n||this.making||this.when?e.Identifiers.it=m.create("operation","I can't use 'it', or an implied 'it', in "+this.TwineScript_ObjectName):e.Identifiers.it=n;var c,l,u,p,d,t=!o&&this.via,o="where"in this||"when"in this,f=e.evalReplay;return e.evalReplay=f?[]:null,o?(c=e.eval(this.where||this.when),l=e.evalReplay,e.evalReplay=l&&t?[]:null,!n||this.making||this.when||(e.Identifiers.it=n),u=c,p=!t||e.eval(t),d=null,u=m.containsError(u)||("boolean"!=typeof u?m.create("operation","This lambda's 'where' clause must evaluate to true or false, not "+g(u)+"."):u?p:d)):c=u=!t||e.eval(t),p=t?e.evalReplay:null,e.stack.shift(),(e.evalReplay=f)&&(o||t)&&(((d=f[f.length-1])||{}).lambda&&d.lambda.obj===this||((d={lambda:{obj:this,loops:[]},code:(f[f.length-1]||{}).code||""}).fromCode=d.code,f.push(d)),d.lambda.loops.push(_objectSpread(_objectSpread(_objectSpread({it:n,pos:r},void 0!==a&&{making:a}),t&&{viaReplay:p,viaResult:u}),o&&{whereReplay:l,whereResult:null!==c&&c}))),u},filter:function(r,e){var a,o=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return e.reduce(function(e,t,n){return a||(n=o.apply(r,{loop:t,pos:n+1,ignoreVia:!0,tempVariables:i}),a=m.containsError(n))||e.concat(n?[t]:[])},[])}});return c}),define("datatypes/typedvar",["utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(e,a,o){var i=e.typeName,t=e.matches,n=e.toSource,s=e.unstorableValue,e=Object.freeze,c=Object.assign,l=Object.create,u=e({TwineScript_TypeName:"a TypedVar (typed variable name)",get TwineScript_ObjectName(){var e=n(this.datatype);return"the ".concat(e.length<24?e+"-":"","typed variable name, ").concat(this.varRef.TwineScript_ToSource())},TwineScript_Print:function(){return"`[A typed variable name]`"},TwineScript_Unstorable:!0,TwineScript_Clone:function(){return c(l(u),{datatype:this.datatype.TwineScript_Clone(),varRef:this.varRef})},TwineScript_ToSource:function(){return n(this.datatype)+"-type "+this.varRef.TwineScript_ToSource()},TwineScript_GetProperty:function(e){return"name"===e?this.getName():this[e]},TwineScript_Properties:["datatype","name"],TwineScript_IsTypeOf:function(e){return t(this.datatype,e)},get:function(){var e;return(e=this.varRef).get.apply(e,arguments)},getName:function(){return this.varRef.getName()},defineType:function(){if("any"!==this.datatype.name)return this.varRef.defineType(this.datatype)},create:function(e,t){var n,r;return(n=o.containsError(t)||o.containsError(e)||t.error)||(a.isPrototypeOf(t)?(n=t.object,r=t.compiledPropertyChain,n&&n.TwineScript_VariableStore&&1===r.length&&n.TwineScript_TypeDefs?(r=s(e))&&!u.isPrototypeOf(r)?o.create("syntax","The -type syntax can't have "+i(r)+" to its left."):c(l(this),{datatype:e,varRef:t}):o.create("unimplemented","I can only restrict the datatypes of variables, not data names or anything else.")):o.create("syntax","The -type syntax must have a variable to its right."))}});return u}),define("datatypes/varbind",["jquery","utils","utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(o,e,t,n,r){var a=t.objectName;return n.on("set",function(r,a){r.TwineScript_VariableStore&&e.storyElement.find("[data-2bind]").each(function(e,t){var n=(t=o(t)).data("twoWayBindEvent");"function"==typeof n&&n(t,r,a)})}),Object.freeze({TwineScript_TypeName:"a VarBind (bound variable name)",get TwineScript_ObjectName(){return"a ".concat(this.bind," bind to ").concat(this.varRef.TwineScript_ToSource())},TwineScript_Print:function(){return"`[A bound variable name]`"},TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return("two way"===this.bind?"2":"")+"bind "+this.varRef.TwineScript_ToSource()},set:function(e){var e=this.varRef.set(e);if(e=r.containsError(e))return e},create:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"one way";return r.containsError(e)?e:n.isPrototypeOf(e)?e.error||Object.assign(Object.create(this),{varRef:e,bind:t}):r.create("operation","I can only 'bind' a variable, not "+a(e)+".")}})}),define("debugmode/highlight",["jquery","utils","utils/typecolours","macros","lexer"],function(u,e,t,p,n){var d=e.insensitiveName,f=t.versionClass,h=n.lex;return function(e,t,n,r){if(9999<e.length)return[u("<span>").text(e)];for(var a=h(e,"",t||"macro"),o=[],i="",s=a,c=a.start;c<a.end;c+=1){var l=a.pathAt(c);l[0]!==s[0]&&(o.length&&(o[o.length-1].textContent=i),i="",s=l,o.push(u("<".concat(r&&n<=c&&c<r?"mark":"span",' class="').concat(function(e){for(var t={},n="",r=0;r<e.length;r+=1){var a=e[r],o=a.type,i=a.text,s=("verbatim"!==o&&"comment"!==o||(n=""),f+o);switch(t[s]=(t[s]||0)+1,1<t[s]&&(s+="-"+t[s]),o){case"text":i.trim()&&e.slice(r+1).reduce(function(e,t){return void 0===e?"macro"===t.type||"hook"!==t.type&&e:e},void 0)&&(s+=" ".concat(f,"error"));break;case"macroName":var c,l=e[r].text[0];"_"!==l&&"$"!==l?(c=d(e[r].text.slice(0,-1)),p.has(c)?s+="-"+p.get(c).returnType.toLowerCase():s+=" ".concat(f,"error")):s+=" ".concat(f,"customMacro ").concat(f+("_"===l?"tempV":"v"),"ariable")}n+=s+" "}return n}(s),'">'))[0])),i+=a.text[c-a.start]}return o.length&&(o[o.length-1].textContent=i),o}}),define("debugmode/mode",["jquery","utils","utils/naturalsort","state","engine","internaltypes/varref","internaltypes/twineerror","utils/operationutils","utils/renderutils","passages","section","debugmode/panel","debugmode/highlight","utils/typecolours"],function(I,V,M,D,F,L,H,e,t,z,q,W,B,n){var U=e.objectName,$=e.isObject,G=e.toSource,Y=e.typeID,J=t.dialog,X=n.CSS,K=function(e,t){var f=V.escape,i=V.nth,n=V.debounce,r=I(document.documentElement),a=M(),o={darkMode:!0,fadePanel:!0,evalReplay:!0,width:null,maxHeight:400};if(D.hasStorage)try{var s=localStorage.getItem("(Debug Options "+V.options.ifid+")");s&&(o=JSON.parse(s))}catch(e){}function c(){if(D.hasStorage)try{localStorage.setItem("(Debug Options "+V.options.ifid+")",JSON.stringify(o))}catch(e){}}W.defaultMaxHeight=o.maxHeight;function l(e){return n(function(){if(V.options.debug)return e.apply(this,arguments)},{maxWait:2e3})}var h=I('<tw-debugger class="'.concat([o.darkMode?"theme-dark":"",o.fadePanel?"fade-panel":""].join(" "),'" style="').concat(o.width?"width:"+o.width+"px":"","\">\n<div class='panel panel-errors' hidden><table></table></div>\n<div class='tabs'></div>\n<label style='user-select:none'>Turns: </label><select class='turns' disabled></select>\n<button class='show-invisibles'>\ud83d\udd0d Debug View</button>\n<button class='show-dom'><span style=\"vertical-align:text-top\">&lt;</span><span style=\"vertical-align:text-bottom\">&gt;</span> DOM View</button>\n<button class='close'>\u2716</button>\n<div class='resizer-h'>\n</tw-debugger>")),s=h.find(".tabs"),u=h.find(".show-dom"),p=h.find(".show-invisibles"),d=h.find(".close"),m=h.find(".turns");I(document.documentElement).on("click","tw-expression, tw-error, tw-eval-explanation",n(function(e){var r,a,o,i,l,u,p,d,t=I(e.target).data("evalReplay");function n(){var e,s,c=r[a],t=o.find("tw-eval-explanation").empty(),n=o.find("tw-eval-code");c.toCode||c.toDesc||c.error||c.lambda?(o.find("tw-eval-code").empty().append(B(c.code,"macro",0<a&&c.start,0<a&&c.end+c.diff)),t.append(c.lambda?"":"<code class='".concat(56<c.fromCode.length?"from-block":"from-inline","'></code>"),c.error?"<span> caused an error: </span>":c.lambda?"<span>The lambda <code class='to-lambda'></code> was run, producing these results.</span>":"<span> became".concat(c.ToDesc?"\u2026":""," </span>").concat(c.toDesc?"<span class='to-desc'>".concat(f(c.toDesc),".</span>"):"<code class='to-code'></code>")),c.error?t.append(c.error):c.lambda?(s=function(e,t){return I("<".concat(e,"><code></").concat(e,">")).find("code").append(B(t,"macro")).end()},t.find(".to-lambda").append(B(c.lambda.obj.source,"macro")).end().append((e=I("<table>")).append.apply(e,[I("<tr>").append(s("th","pos"),c.lambda.obj.loop?s("th","_"+c.lambda.obj.loop.getName()).append(" / ",I("<code>").append(B("it","macro"))):s("th","it"),c.lambda.obj.making&&s("th","_"+c.lambda.obj.making.getName()),c.lambda.obj.where&&s("th","where").append(" result"),c.lambda.obj.via&&s("th","via").append(" result"))].concat(_toConsumableArray(c.lambda.loops.map(function(e){var t=e.it,n=e.pos,r=e.making,a=e.whereResult,o=e.whereReplay,i=e.viaResult,e=e.viaReplay;return I("<tr>").append(s("td",G(n)),s("td",G(t)),void 0!==r&&s("td",G(r)),null!=a&&(H.containsError(a)?I("<td>").append(a.render(c.lambda.obj.source,!0)):s("td",G(a))).append(o&&I("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",o)),null!=i&&(H.containsError(i)?I("<td>").append(i.render(c.lambda.obj.source,!0)):s("td",G(i))).append(e&&I("<tw-open-button replay label='\ud83d\udd0d'>").data("evalReplay",e)))})))))):c.toDesc||t.find(".to-code").append(B(c.toCode,"macro")),t.next().html(c.itIdentifier?'(The <code class="cm-harlowe-3-identifier">it</code> identifier now refers to '.concat(f(c.itIdentifier),".)"):"").next().text(c.reason||"")):(n.html(B(c.code,"macro")),t.html("<center>First, there was <code></code>.</center>").next().empty().next().empty()),c.lambda||t.find("code").first().append(B(c.fromCode,"macro")),o.find("mark").each(function(e,t){t.scrollIntoView()}),i.css("visibility",a<=9?"hidden":"visible"),l.css("visibility",a<=0?"hidden":"visible"),p.css("visibility",a>=r.length-1?"hidden":"visible"),d.css("visibility",a>=r.length-10?"hidden":"visible"),u.html("( ".concat(a+1,"/").concat(r.length," )"))}t&&(r=t,t=J({buttons:[{name:"Understood",confirm:!(a=0),callback:function(){return!h.find("tw-backdrop").length&&h.removeClass("show-dialog")}}]}).addClass("eval-replay"),o=I("<tw-eval-replay>".concat(1===r.length?"":"<tw-eval-code></tw-eval-code>","<tw-eval-explanation></tw-eval-explanation><tw-eval-it></tw-eval-it><tw-eval-reason></tw-eval-reason>").concat(1===r.length?"":"<tw-dialog-links><tw-link style='visibility:hidden'>\u2190 10</tw-link><tw-link style='visibility:hidden'>\u2190 \u2190</tw-link><b></b><tw-link>\u2192 \u2192</tw-link><tw-link>10 \u2192</tw-link></tw-dialog-links>","</tw-eval-replay>")),t.find("tw-dialog").css({width:"75vw","max-width":"75vw"}).prepend(o),i=o.find("tw-link:first-of-type"),l=i.next(),u=l.next(),p=u.next(),d=p.next(),n(),i.on("click",function(){a=Math.max(0,a-10),n()}),l.on("click",function(){a=Math.max(0,a-1),n()}),p.on("click",function(){a=Math.min(r.length-1,a+1),n()}),d.on("click",function(){a=Math.min(r.length-1,a+10),n()}),h.find("tw-backdrop").length?h.find("tw-backdrop").before(t):h.addClass("show-dialog").append(t));var s,t=I(e.target).data("goto");t&&(s=V.options.ignoreGotos,V.options.ignoreGotos=!1,t.command.TwineScript_Run(t.section),V.options.ignoreGotos=s),e.stopPropagation()})),h.find(".resizer-h").mousedown(function(e){if(1!==e.which)return!0;e.stopPropagation();var t=e.pageX,n=h.width();r.on("mousemove.debugger-resizer-h",function(e){e=e.pageX;h.width("".concat(n+t-e|0,"px"))}).on("mouseup.debugger-resizer-h",function(){r.off(".debugger-resizer-h"),o.width=h.width(),c()})}),h.on("mousedown",".resizer-v",function(e){if(1!==e.which)return!0;e.stopPropagation();var t=e.pageY,n=I(e.target.parentNode).height();r.on("mousemove.debugger-resizer-v",function(e){e=e.pageY;h.find(".panel").css("maxHeight","".concat(n+t-(0|e),"px"))}).on("mouseup.debugger-resizer-v",function(){r.off(".debugger-resizer-v"),o.maxHeight=h.find(".panel").css("maxHeight"),c()})}),p.click(function(){r.toggleClass("debug-mode").removeClass("dom-debug-mode"),p.toggleClass("enabled"),u.removeClass("enabled")}),u.click(function(){r.toggleClass("dom-debug-mode").removeClass("debug-mode"),u.toggleClass("enabled"),p.removeClass("enabled")}),d.click(function(){r.removeClass("debug-mode dom-debug-mode"),h.detach(),Object.assign(V.options,{debug:!1,speedMultiplier:1,ignoreClickEvents:!1,ignoreGotos:!1})});function g(e){(e=e.parents(".variable-row, .enchantment-row, .source-row")).next(".panel-row-source").find("td").empty().append(B(e.data("value")||G(e.data("enchantment").changer),e.is("source-row")?"markup":"macro"))}function y(){return k=new Set}function b(){I(document.body).append(h),V.options.debug=!0,V.options.evalReplay=o.evalReplay,V.options.speedMultiplier=1,V.options.ignoreClickEvents=!1,V.options.ignoreGotos=!1,R()}var v,w=l(function(){var r=m.children().get(),e=D.timeline,a=0;e.forEach(function(e,t){var n=e.turns,e=e.passage,n=(a+=1+(void 0===n?0:n))+": "+e;r[t]?r[t].textContent=n:m.append("<option value='".concat(t,"'>").concat(n,"</option>"))}),e.length<r.length&&I(r.slice(e.length)).remove(),m[1<=e.length?"removeAttr":"attr"]("disabled"),m.val(D.pastLength)}),k=(m.change(function(e){e=e.target.value-D.pastLength;0!=e&&(D[e<0?"rewind":"fastForward"](Math.abs(e)),F.showPassage(D.passage))}),w(),D.on("forward",w).on("load",w).on("forgetUndos",function(){return w}).on("back",function(){D.pastLength<=1&&m.attr("disabled"),m.find("[selected]").removeAttr("selected"),m.val(D.pastLength)}),new Set),S=W.create({className:"variables",tabName:"Variable",rowWrite:function(e,t){var n,r=e.name,a=e.dataset,o=e.path,i=e.value,s=e.tempScope,e=e.type,c=i&&48<i.length&&!i.TwineScript_DebugName,l=$(i)&&i.TwineScript_DebugName?i.TwineScript_DebugName():f(U(i)),u="",a=(o.length&&(u=o.reduce(function(e,t){return e+t+"'s "},"")),a&&(r="???"),e?G(e):""),e="object"===_typeof(i)||c;return t?(t[0].firstChild.innerHTML=a||"",u&&I(t[0].firstChild).children(".variable-path").html((s?"_":"$")+f(u)),t[0].childNodes[1].lastChild.textContent=(u?"":s?"_":"$")+f(r+""),t[0].childNodes[2].textContent=s||"",t[0].childNodes[3].innerHTML=l,n=(c=I(t[0].lastChild.firstChild)).is(".open"),c[e?"show":"hide"](),c=t.next(".panel-row-source"),n&&c.find("td").empty().append(B(G(i))),t.data("value",G(i)),t.add(c)):I('<div class="variable-row">').attr("data-name",r).attr("data-path",o+"").attr("data-scope",s||"").css("padding-left",Math.min(5,o.length)+"em").append("<td class='variable-type'>".concat(a||"","</td>"),"<td class='variable-name cm-harlowe-3-"+(s?"tempV":"v")+"ariable'><span class='variable-path'>"+(u?(s?"_":"$")+f(u):"")+"</span> "+(u?"":s?"_":"$")+f(r+"")+"</td>","<td class='temporary-variable-scope'>".concat(s||"","</td>"),"<td class='variable-value cm-harlowe-3-macroName-"+Y(i)+"'>"+l+"</td><td class='panel-row-buttons'><tw-folddown tabindex=0 style='display:"+(e?"visible":"none")+"'>(source:) </tw-folddown></td>").data("value",G(i)).find("tw-folddown").data("folddown",g).end().add("<tr class='variable-row panel-row-source' style='display:none'><td colspan='5'></td></tr>")},rowCheck:function(e,t){var n=e.name,r=e.path,e=e.tempScope;return t[0]&&t[0].getAttribute("data-name")===n&&t[0].getAttribute("data-path")===r+""&&t[0].getAttribute("data-scope")===e},columnHead:function(){return'<tr class="panel-head"><th data-col="variable-type">Type</th><th data-col="variable-name">Name</th><th data-col="temporary-variable-scope">Scope</th><th data-col="variable-value">Value</th></tr>'},rowSort:function(e,t,n){if("variable-value"===e)return a(t.attr("class"),n.attr("class"))||a(t.parent().data("value"),n.parent().data("value"))}}),T=l(function(){var e,t,o=[],n=D.variables,r=o.length;for(e in n)e.startsWith("TwineScript")||(r+=1,function n(e){var r,t,a;500<o.length||(o.push(e),r=e.path.concat(e.name),t=e.value,a=e.tempScope,r.length<=4&&(Array.isArray(t)?t.forEach(function(e,t){return n({name:i(t+1),path:r,value:e,tempScope:a})}):t instanceof Map?_toConsumableArray(t).forEach(function(e){var t=(e=_slicedToArray(e,2))[0],e=e[1];return n({name:t,path:r,value:e,tempScope:a})}):t instanceof Set&&_toConsumableArray(t).forEach(function(e,t){return n({name:t,dataset:!0,path:r,value:e,tempScope:a})})))}({name:e,path:[],value:n[e],tempScope:"",type:null==(t=n.TwineScript_TypeDefs)?void 0:t[e]}));o.push.apply(o,_toConsumableArray(k)),r+=k.size,S.update(o,r),0===r!==S.panel[0].classList.contains("panel-variables-empty")&&S.panel.toggleClass("panel-variables-empty")}),_=(L.on("set",function(e,t,n){var r,a;e===D.variables||"temp"!==(null==(a=e.TwineScript_VariableStore)?void 0:a.type)||null!=(a=e.TwineScript_VariableStore)&&a.name.match(/#\d+$/)||(r=null==(a=e.TwineScript_VariableStore)?void 0:a.name,e=null==(a=e.TwineScript_TypeDefs)?void 0:a[t],(a=_toConsumableArray(k).find(function(e){return e.name===t&&e.tempScope===r}))?a.value=n:k.add({name:t,path:[],value:n,tempScope:r,type:e})),T(),v()}).on("delete",function(){T(),v()}),S.panel.append("<div class='panel-variables-bottom'>\n\t\t\t<button class='panel-variables-copy'>Copy $ variables as (set:) call</button>\n\t\t\t<input class='clipboard' type=\"text\" style='opacity:0;pointer-events:none;position:absolute;'></input>\n\t\t</div>").removeAttr("hidden"),S.tab.addClass("enabled"),S.panel.find(".clipboard")),x=(r.on("click",".panel-variables-copy",function(){var e,t=[];for(e in D.variables)e.startsWith("TwineScript")||t.push("$"+e+" to "+G(D.variables[e]));_.val("(set:"+t+")")[0].select(),document.execCommand("copy")}),W.create({className:"enchantments",tabName:"Enchantment",rowWrite:function(e,t){var n=e.scope,r=e.changer,a=e.lambda,o=e.name,i=e.localHook,a=r?f(U(r)):a?f(G(a)):"<em>enchanted with ("+o+":)</em>";return t||I('<div class="enchantment-row">').data("enchantment",e).append("<td><span class='enchantment-name'>"+G(n)+(i?"</span><span class='enchantment-local cm-harlowe-3-hookName'>"+("function"==typeof i.TwineScript_ToSource?i.TwineScript_ToSource():i.attr("name")?"?"+i.attr("name"):"an unnamed hook"):"")+"</span></td><td class='enchantment-value cm-harlowe-3-macroName-"+(r?"changer":"command")+" '>"+a+"</td>"+(r?"<td class='panel-row-buttons'><tw-folddown tabindex=0>(source:)</tw-folddown></td>":"")).find("tw-folddown").data("folddown",g).end().add(r?I("<tr class='panel-row-source' style='display:none'><td colspan='3'></td></tr>"):"")},rowCheck:function(e,t){return t.data("enchantment")===e},columnHead:function(){return'<tr class="panel-head"><th data-col="enchantment-name">Scope</th><th data-col="enchantment-value">Value</th></div>'}})),d=l(function(e){x.update(e.enchantments,e.enchantments.length)}),O=(q.on("add",d).on("remove",d),q.create()),A=W.create({className:"storylets",tabName:"Storylet",rowWrite:function(e,t){var n=e.name,r=e.active,a=e.storyletSource,o=e.exclusive,e=e.urgent;return t?(t.toggleClass("storylet-closed",!r),t[0].firstChild.textContent=r?"\u2713":""):(t=I('<tr class="storylet-row '.concat(r?"":"storylet-closed",'">')).attr("data-name",n).append("<td class='storylet-open'>"+(r?"\u2713":"")+"</td><td class='storylet-name'>"+n+"</td><td class='storylet-lambda'></td><td class='storylet-exclusive'>"+o+"</td><td class='storylet-urgent'>"+e+"</td>")).find(".storylet-lambda").append(B(a.replace(/^when\s+/i,""))),t},rowCheck:function(e,t){e=e.name;return t[0].getAttribute("data-name")===f(e+"")},columnHead:function(){return'<tr class="panel-head"><th data-col="storylet-open" data-order="desc">Open</th><th data-col="storylet-name">Name</th><th data-col="storylet-lambda">Condition</th><th data-col="storylet-exclusive" class=\'storylet-exclusive\'>Exclusivity</th><th data-col="storylet-urgent" class=\'storylet-urgent\'>Urgency</th></tr>'}}),C=(A.tab.hide(),v=l(function(){var r,a,o=z.getStorylets(O),i=H.containsError(o),e=z.allStorylets();A.update(e.map(function(t){var e="number"==typeof t.get("exclusivity")?t.get("exclusivity"):0,n="number"==typeof t.get("urgency")?t.get("urgency"):0;return r=r||e,a=a||e,{name:t.get("name"),storyletSource:t.get("storylet").TwineScript_ToSource(),active:!i&&o.some(function(e){return e.get("name")===t.get("name")}),exclusive:e,urgent:n}}),i?0:o.length),A.panel.toggleClass("storylet-error",i),A.panel.toggleClass("panel-exclusive",r),A.panel.toggleClass("panel-urgent",a),e.length&&A.tab.show()}),W.create({className:"source",tabName:"Source",tabNameCounter:!1,rowWrite:function(e,t){var n=e.name,e=e.tag;return t?t.add(t.next(".panel-row-source")):(t=z.get(n).get("source"),I('<div class="source-row" data-tag="'.concat(e,'">')).data("value",t).append('<td class="source-name">'.concat(n,'</td><td class="source-tags">').concat(e,"</td><td class='panel-row-buttons'><tw-folddown class='").concat(e?"":"open","' tabindex=0></tw-folddown></td>")).find("tw-folddown").data("folddown",g).end().add(I("<tr class='panel-row-source' style='".concat(e?"display:none":"","'><td colspan='3'></td></tr>")).find("td").append(!e&&B(t,"markup")).end()))},rowCheck:function(e,t){e=e.name;return t[0].firstChild.textContent===f(e+"")},tabUpdate:I.noop,columnHead:I.noop})),E=["debug-startup","startup","header","debug-header","footer","debug-footer"].reduce(function(e,t){return e.concat(z.getTagged(t).map(function(e){return{name:e.get("name"),tag:t}}))},[]),N=W.create({className:"errors",tabName:"Error",rowWrite:I.noop,rowCheck:I.noop,columnHead:I.noop,tabUpdate:function(e){return N.tab.css({background:e?"rgba(230,101,204,0.3)":""}).text("".concat(e," Error").concat(1!==e?"s":""))}}),d=n(function(e){var t;V.options.debug&&(N.panelRows.append(e.reduce(function(e,t){var t=_slicedToArray(t,2),n=t[0],t=t[1];return"propagated"===n.type?e:e+'<tr class="error-row"><td class="error-passage">'+D.passage+'</td><td class="error-message" title="'+f(t)+'">'+n.message+"</td></tr>"},"")),500<(t=(e=N.panelRows.children()).length)&&I(Array.prototype.slice.call(N.panelRows[0].childNodes,0,t-500)).remove(),N.tabUpdate(Math.min(500,e.length)))},{batch:!0}),j=(H.on(d),N.panel.append("<div class='panel-errors-bottom'>\n\t\t\t<button class='panel-errors-clean'>\ud83e\uddf9 Clear this panel</button>\n\t\t</div>"),r.on("click",".panel-errors-clean",function(){N.panelRows.empty(),N.tabUpdate(0)}),W.create({className:"tools",tabName:"Tools",tabNameCounter:!1,rowWrite:function(e,t){var n=e.id,r=e.type,a=e.label,o=e.dropdownItems,i=e.dropdownValue;return"checkbox"===r?t?t.find("input").prop("checked",!1):I('<span><input id="debug-'.concat(n,'" type="checkbox"></input><label for="debug-').concat(n,'">').concat(a,"</label></span>")):"dropdown"===r?t?t.find("input").prop("checked",!1):I("<span>".concat(a,'<select style="width:3em" data-default="').concat(i,'" id="debug-').concat(n,'"></span>')).find("select").append(o.map(function(e){return"<option value='".concat(e,"' ").concat(e===i?"selected":"",">").concat(e,"x</option>")})).end():void 0},rowCheck:I.noop,columnHead:I.noop,tabUpdate:function(e){return j.tab.css({background:e?"hsla(210, 72%, 65%, .3)":""})}})),P=(r.on("click, change",'.panel-tools [type="checkbox"], .panel-tools select',function(e){var e=e.target,t=(e=I(e)).attr("id"),n=e.is(":checked")||e.is("select")&&e.val()!==+e.attr("data-default");"debug-peekBehindDialogs"===t&&r.toggleClass("debug-dialogs",n),"debug-ignoreClickEvents"===t&&(V.options.ignoreClickEvents=n),"debug-ignoreGotos"===t&&(V.options.ignoreGotos=n),"debug-speedMultiplier"===t&&(V.options.speedMultiplier=+e.val()),j.tabUpdate(n)}),j.update([{id:"peekBehindDialogs",type:"checkbox",label:"See through and click through <code>(dialog:)</code> boxes"},{id:"ignoreClickEvents",type:"checkbox",label:"Stop links, <code>(click:)</code> and <code>(hover-style:)</code> from activating"},{id:"ignoreGotos",type:"checkbox",label:"Stop <code>(go-to:)</code>, <code>(undo:)</code>, <code>(redirect:)</code> and <code>(restart:)</code> from activating<br><small>(Click 'GO' buttons in Debug View to activate later)</small>"},{id:"speedMultiplier",label:"Speed of timed events (<code>time</code>, <code>(live:)</code>, <code>(after:)</code>): ",type:"dropdown",dropdownValue:1,dropdownItems:[.25,.5,.75,1,1.25,1.5,1.75,2,3,5,10]}]),W.create({className:"options",tabName:"\u2699\ufe0f",tabNameCounter:!1,rowWrite:function(e,t){var n=e.name,e=e.label,r={darkMode:o.darkMode,fadePanel:o.fadePanel,evalReplay:o.evalReplay}[n];return t?t.find("input").prop("checked",r):I('<span><input id="debug-'.concat(n,'" type="checkbox" ').concat(r?"checked":"",'></input><label for="debug-').concat(n,'">').concat(e,"</label></span>"))},rowCheck:I.noop,tabUpdate:I.noop,columnHead:I.noop})),R=(r.on("click",'.panel-options [type="checkbox"]',function(e){var e=e.target,t=(e=I(e)).attr("id"),e=e.is(":checked");"debug-darkMode"===t&&(o.darkMode=e,h.toggleClass("theme-dark",e)),"debug-fadePanel"===t&&(o.fadePanel=e,h.toggleClass("fade-panel",e)),"debug-evalReplay"===t&&(V.options.evalReplay=o.evalReplay=e),c()}),P.update([{name:"darkMode",label:"Debug panel is dark"},{name:"fadePanel",label:"Debug panel is transparent unless the cursor is over it"},{name:"evalReplay",label:"Record expression replays (viewable via \ud83d\udd0d buttons in Debug View; slower)"}]),h.prepend(S.panel,x.panel,N.panel,A.panel,C.panel,j.panel,P.panel),s.prepend(S.tab,x.tab,N.tab,A.tab,C.tab,j.tab,P.tab),D.on("beforeForward",y).on("beforeBack",y).on("beforeLoad",y),l(function(){T(),v(),x.panelRows.empty(),x.tabUpdate(0),D.passage&&z.get(D.passage)&&(C.update(E.concat({name:D.passage,tag:""})),C.panel.find('[data-tag=""], [data-tag=""] + .panel-row-source').insertBefore(C.panel.find('[data-tag="footer"]').first()))}));D.on("forward",R).on("back",R).on("load",R);K=b,I(document.head).append(I("<style>").html(X)),b(),e&&d(e,t)};return F.registerDebugMode(function(e,t){return!V.options.debug&&K(e,t)}),K}),define("debugmode/panel",["jquery","utils/naturalsort"],function(d,e){var i=e();return Object.seal({create:function(e){var n,t=e.className,r=e.rowWrite,a=e.rowCheck,o=e.rowSort,i=e.columnHead,s=e.tabName,c=e.tabNameCounter,l=void 0===c||c,c=e.tabUpdate,u=d("<div class='panel panel-".concat(t,"' style='").concat(this.defaultMaxHeight?"max-height:"+this.defaultMaxHeight+"px":"","' hidden><div class=\"resizer-v\"></div><table class='panel-rows'></table></div>")),p=d("<button class='tab tab-".concat(t,"'>").concat(l?"0 ".concat(s,"s"):s,"</button>"));return p.click(function(){p.toggleClass("enabled"),p.parent().siblings(".panel").attr("hidden",""),p.is(".enabled")&&(p.siblings(".tab:not(.tab-"+t+")").removeClass("enabled"),u.removeAttr("hidden"))}),u.on("click","th",function(e){var e=e.target,t="desc"===(e=d(e)).attr("data-order")?"asc":"desc";n.sort(e.attr("data-col"),t),u.find("th[data-order]").removeAttr("data-order"),e.attr("data-order",t)}),c=c||function(e){return p.text(l?"".concat(e," ").concat(s).concat(1!==e?"s":""):s)},n=Object.assign(Object.create(this),{tabName:s,tab:p,panel:u,panelRows:u.find(".panel-rows"),rowWrite:r,rowSort:o,rowCheck:a,columnHead:i,tabUpdate:c})},sort:function(r,a){var o=this;this.panelRows.children(":not(.panel-head, .panel-row-source)").get().sort(function(e,t){var n;return"desc"===a&&(e=(n=[t,e])[0],t=n[1]),e=e.querySelector("."+r),t=t.querySelector("."+r),o.rowSort&&o.rowSort(r,d(e),d(t))||i(e.textContent,t.textContent)}).forEach(function(e){var t=d(e).next(".panel-row-source").get();o.panelRows.append(e,t)})},update:function(e,t){var r=this.rowCheck,a=this.rowWrite,o=this.panelRows,n=this.columnHead,i=this.panel,s=[],c=o.children(),e=(e.forEach(function(t){var e=c.get().filter(function(e){return r(t,d(e))}),n=a(t,e.length&&d(e));e.length||o.append(n),s.push.apply(s,_toConsumableArray(n.get()))}),c.filter(function(e,t){return!s.includes(t)&&!t.className.includes("panel-head")}).remove(),this.tabUpdate(t),0<t&&!o.find(".panel-head").length?o.prepend(n()):0===t&&o.find(".panel-head").remove(),i.find("th[data-order]"));e.length&&this.sort(e.attr("data-col"),e.attr("data-order"))},defaultMaxHeight:300})}),define("internaltypes/changedescriptor",["jquery","utils","renderer","datatypes/hookset","internaltypes/twineerror"],function(b,e,t,v,n){function w(e){return("string"==typeof e?e:e.map(function(e){return e.text}).join("")).split(/\n/g).reduce(function(e,t,n,r){r=r.length;return e.concat(document.createTextNode(t),n!==r-1&&document.createElement(t.length?"br":"tw-consecutive-br"))},[])}var k=e.impossible,S=e.transitionIn,T=t.exec,r=Object.assign,p=Object.keys,a=Object.create,e=Object.seal,_=Array.isArray,x={source:"",appendSource:null,enabled:!0,enablers:null,verbatim:!1,target:null,append:"",newTargets:null,transition:"",transitionTime:null,transitionDeferred:!1,transitionDelay:0,transitionSkip:0,transitionOrigin:null,loopVars:null,styles:null,attr:null,data:null,innerEnchantments:null,section:null,timestamp:0,output:!1,summary:function(){var t=this;return["source","appendSource","enabled","verbatim","target","append","newTargets","transition","transitionTime","transitionDeferred","transitionDelay","transitionSkip","transitionOrigin","innerEnchantments","enablers","output"].filter(function(e){return hasOwnProperty.call(t,e)}).concat([this.attr.length&&"attr",this.styles.length&&"styles",p(this.loopVars).length&&"loopVars",p(this.data).length&&"data"].filter(Boolean))},create:function(e,t){e=r(a(this),{attr:this.attr?this.attr.slice():[],styles:this.styles?this.styles.slice():[],loopVars:this.loopVars||{},data:this.data||{}},e);if(t){t=t.run(e);if(n.containsError(t))return t}return e},update:function(){function e(t){var e,n,r;_(a.styles)&&0<a.styles.length&&(n=(e=_slicedToArray(a.styles.reduce(function(n,r){return p(r).forEach(function(e){var t=r[e];n[+("function"==typeof t)].push(_defineProperty({},e,t))}),n},[[],[]]),2))[0],r=e[1],n.forEach(function(e){return t.css(e)}),setTimeout(function(){r.forEach(function(e){return t.css(e)})})),a.attr&&a.attr.forEach(function(e){return t.attr(e)}),a.data&&t.data(a.data)}var a=this,t=this.section,n=this.newTargets,r=this.transition,o=this.transitionDeferred,i=this.append,s=this.target;"function"==typeof s&&(s=s());if(_(n)&&n.length&&(s=n.map(function(e){return e.target})),_(s))for(var c=0;c<s.length;c+=1)v.isPrototypeOf(s[c])?s[c].forEach(t,e):e(s[c]);else v.isPrototypeOf(s)?s.forEach(t,e):e(s);if(r&&!o&&!i){for(var l,u=s;(l=u.data("timestamp"))||(u=u.parent()),!l&&u.length;);S(s,r,this.transitionTime,this.transitionDelay,this.transitionSkip,l?Date.now()-l:0,this.transitionOrigin)}},render:function(){var e,r=this,t=this.source,n=this.transition,a=this.transitionTime,o=this.transitionDeferred,i=this.enabled,s=this.enablers,c=this.data,l=this.section,u=this.newTargets,p=this.innerEnchantments,d=this.appendSource,f=this.output,h=this.target,m=this.target,g=this.append;if("function"==typeof h&&(h=h()),!g)return k("ChangeDescriptor.render","This doesn't have an 'append' method chosen."),b();if(f)return b();if(null!=s&&s.length)return s=(f=s[0]).descriptor,f=f.changer,s=s.render(),f&&(e=x.create({section:l,target:s}),f.run(e),e.update()),s;if(!i||void 0!==h.attr("hidden"))return x.create({target:h,attr:this.attr.filter(function(e){return!("style"in e)}),data:_objectSpread(_objectSpread({},c),{},{originalSource:t,hidden:!0})}).update(),b();if(!(h=_(u)&&u.length?u:h))return k("ChangeDescriptor.render","ChangeDescriptor has source but not a target!"),b();var y=b();if([].concat(h).filter(function(e){return!e.jquery}).map(function(e){var t,n,r=g;return e.target&&e.append&&(r=(t=e).append,n=t.before,e=e.target),{elements:e.hooks(l,m).filter(function(){return!(n&&1&this.compareDocumentPosition(document)&&2&this.compareDocumentPosition(m[0]))}),append:r}},[]).forEach(function(e){var t=e.elements,n=e.append;t.each(function(e,t){t=b(t),y=y.add(r.create({target:t,append:n,newTargets:null}).render()),t.filter("tw-pseudo-hook").contents().unwrap()})}),!(y.length||_(h)||v.isPrototypeOf(h))){f=g;if(!(f in h)){if("replace"!==f)return k("ChangeDescriptor.render","The target doesn't have a '"+f+"' method."),b();f=h[0]instanceof Text?"replaceWith":(h.empty(),"append")}h[0]instanceof Text&&"prepend"===(f="append"===f?"after":f)&&(f="before"),y=b(t&&(this.verbatim?w:T)(t)),_(d)&&d.forEach(function(e){var t=e.source,e=e.append,t=b((r.verbatim?w:T)(t));y="append"===e?y.add(t):"prepend"===e?t.add(y):t}),h[f](y.length?y:void 0),h.data("timestamp",Date.now()),this.update(),n&&!o&&S("replace"===g?h:y,n,a,this.transitionDelay,this.transitionSkip,this.expedite,this.transitionOrigin),p&&p.map(function(e){return e(h)}).forEach(function(e){return l.addEnchantment(e)})}return y}};return e(x)}),define("internaltypes/enchantment",["jquery","utils","internaltypes/changedescriptor","datatypes/changercommand","utils/operationutils","internaltypes/twineerror","utils/renderutils"],function(g,y,b,v,e,w,t){var k=e.objectName,S=e.toSource,T=t.collapse;return Object.freeze({create:function(e){return Object.assign(Object.create(this),{enchantments:g()},e)},enchantScope:function(){var i=this,s=this.attr,c=this.data,l=this.functions,u=this.section,p=this.scope,d=this.localHook,f=this.lambda,h=[],m=0;p.forEach(u,function(e,t){if(d){d=d.jquery?d:d.hooks(u);var n=e.find(d);if(n.length)e=n;else if(!d.has(e[0]).length)return}var r,a,o;(!e.is(":empty")||e.data("source")&&e.data("source").length)&&(m+=1,f?(o=f.apply(u,{loop:p.TwineScript_GetProperty(t),pos:m}),w.containsError(o)?(e.replaceWith(o.render()),f=o=null):v.isPrototypeOf(o)?o.canEnchant||(e.replaceWith(w.create("macrocall",'The lambda "'.concat(S(f),"\" can't be or include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).")).render()),f=o=null):(e.replaceWith(w.create("macrocall",'The lambda "'.concat(S(f),'" must return a changer, not ').concat(k(o),".")).render()),f=o=null)):o=i.changer,n=!s&&!c&&(!o||o.summary().every(function(e){return e.startsWith("transition")})),r=n?e:e.wrap("<tw-enchantment>").parent(),s&&r.attr(s),c&&r.data(c),l&&l.forEach(function(e){return e(r)}),o&&(t=b.create({section:u,target:r}),o.run(t),t.update(),e.is(y.storyElement)?(a=Object.keys(Object.assign.apply(Object,[{}].concat(_toConsumableArray(t.styles)))),e.css(a.reduce(function(e,t){return"background-color"===t||"background-image"===t?(e["background-color"]="transparent",e["background-image"]="none",a.push("background-".concat("background-color"===t?"image":"color"))):e[t]="inherit",e},{})),r.data({enchantedProperties:a})):e.is("tw-passage")&&t.styles.some(function(e){return"margin-left"in e||"margin"in e||"margin-right"in e})&&(o="padding-right",y.storyElement.css(t="padding-left","0px").css(o,"0px"),r.data({enchantedProperties:[t,o]}))),e.is(y.storyElement)&&r.css({"min-width":"100%","min-height":"100%"}),"true"===r.attr("collapsing")&&(r.find("[collapsing=false]").each(function(){g(this).removeAttr("collapsing")}),T(r)),n||h.push(r))}),this.enchantments=g(h)},disenchant:function(){this.enchantments.each(function(e,t){(t=g(t)).contents().unwrap();t=t.data("enchantedProperties");t&&y.storyElement.css(t.reduce(function(e,t){return e[t]="",e},{}))})}})}),define("internaltypes/twineerror",["jquery","utils"],function(i,s){var a=s.impossible,c=s.escape,l=(i(document.documentElement).on("click","tw-folddown",function(e){var t=e.target,e=((t=i(t)).toggleClass("open"),t.popData("folddown"));for("function"==typeof e&&e(t);t&&!t.next().length;)t=t.parent();null!=(e=t)&&e.next().toggle()}),{syntax:"The markup seems to contain a mistake.",saving:"I tried to save or load the game, but I couldn't do it.",operation:"I tried to perform an operation on some data, but the data's type was incorrect.",macrocall:"I tried to use a macro, but its call wasn't written correctly.",datatype:"I tried to use a macro, but was given the wrong type of data to it.",custommacro:"I tried to use a custom macro, but its code hook had a mistake in it.",infinite:"I almost ended up doing the same thing over and over, forever.",property:"I tried to access a value in a string/array/datamap, but I couldn't find it.",unimplemented:"I currently don't have this particular feature. I'm sorry.",propagated:"Click the 'Open' button to see the code hook as it was executed.",user:"This is a custom error created by (error:). It usually means you used a custom macro incorrectly.",assertion:"This command exists to provide a helpful error if a certain important condition wasn't true.",debugonly:"This macro is not meant to be used outside of debugging your story."}),u=[],n={TwineError:!0,create:function(e,t,n,r){return t&&"string"==typeof t||a("TwineError.create","has a bad message string"),n||e in l||a("TwineError.create","no error explanation given"),"user"!==e&&(t=t[0].toUpperCase()+t.slice(1)),Object.assign(Object.create(this),{type:e,message:t,explanation:n,source:void 0,innerDOM:r,appendTitleText:!1})},containsError:function(){for(var e=0;e<arguments.length;e+=1){var t=arguments[e];if(n.isPrototypeOf(t))return t;if(Array.isArray(t)){t=n.containsError.apply(n,t);if(t)return t}}return!1},createWarning:function(e,t){return Object.assign(this.create(e,t),{warning:!0})},render:function(t){var n=this,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=(t="string"==typeof t?t:this.source||"",i("<tw-error class='"+(this.warning?"warning":"error")+"' title='"+c(t)+"'>"+c(this.message+(this.appendTitleText?" "+t:""))+"</tw-error>")),a=i("<tw-error-explanation>").text(this.explanation||l[this.type]).hide(),o=i("<tw-folddown tabindex=0>");return this.innerDOM&&i("<tw-open-button label='Open'>").on("click",function(){var e=i("<tw-backdrop><tw-dialog></tw-backdrop>");e.find("tw-dialog").prepend(n.innerDOM,i("<tw-link tabindex=0>OK</tw-link>").on("click",function(){n.innerDOM.detach(),e.remove()}).wrap("<tw-dialog-links>").parent()),s.storyElement.prepend(e)}).appendTo(r),r.append(o).append(a),r.data("TwineError",this),e||u.forEach(function(e){return e(n,t)}),r},on:function(e){return"function"!=typeof e||u.includes(e)||u.push(e),n}};return Object.preventExtensions(n)}),define("internaltypes/twinenotifier",["jquery","utils"],function(e,t){var n=t.impossible,r={create:function(e){return e||n("TwineNotifier.create","called with only 1 string."),Object.assign(Object.create(r),{message:e})},render:function(){return e("<tw-notifier>").attr("message",this.message)}};return Object.preventExtensions(r)}),define("internaltypes/varref",["state","internaltypes/twineerror","utils","utils/operationutils","datatypes/hookset"],function(u,p,e,t,i){var c,n=e.impossible,s=e.andList,r=e.nth,o=t.is,d=t.isObject,f=t.toSource,h=t.isSequential,m=t.objectName,l=t.typeName,g=t.clone,y=t.isValidDatamapName,b=t.subset,v=t.collectionType,w=t.unstorableValue,a=t.matches,k=Array.isArray,S={set:[],delete:[]},T="You can only access position strings/numbers ('4th', 'last', '2ndlast', (2), etc.), slices ('1stTo2ndlast', '3rdTo5th'), ",_="You can't access the '0th' or '0thlast' position of ";function x(e,t){if(p.containsError(t))return n;if(e instanceof Map&&(n=p.containsError(y(e,t))))return n;if(h(e))if("number"==typeof t){if(0===t)return p.create("property","You can't access elements at position 0 of ".concat(m(e),"."),"Only positive and negative position values exist.");0<t&&--t}else if("string"==typeof t&&(r=/^(\d+)(?:st|[nr]d|th)last$/i.exec(t))){if("0"===r[1])return p.create("property",_+m(e)+".");t=-r[1]}else if("string"==typeof t&&(r=/^(\d+)(?:st|[nr]d|th)$/i.exec(t))){if("0"===r[1])return p.create("property",_+m(e)+".");t=r[1]-1}else if("string"==typeof t&&(r=/^(?:(\d+)(?:st|[nr]d|th)(last)?|last)to(?:(\d+)(?:st|[nr]d|th)(last)?|last)$/i.exec(t))){var n=_slicedToArray(r,5),r=n[1],r=void 0===r?0:r,a=n[2],o=n[3],o=void 0===o?0:o;t={last:n[4]?-o:o-1,first:a?-r:r-1}}else if("last"===t)t=-1;else if("random"===t){if(!e.length)return p.create("property","I can't get a random value from ".concat(m(e),", because it's empty."));t=u.random()*Array.from(e).length|0}else{if(i.isPrototypeOf(e)&&!i.TwineScript_Properties.includes(t))return p.create("property","".concat(T+s(i.TwineScript_Properties.map(function(e){return"'"+e+"'"}))," of ").concat(m(e),", not ").concat(("string"==typeof t?f:m)(t),"."));if(!["length","some","any","all","start","end","random"].includes(t)&&!i.isPrototypeOf(e))return p.create("property","".concat(T,"'length', 'some', 'any', 'all', 'start', 'end', and 'random' of ").concat(m(e),", not ").concat(("string"==typeof t?f:m)(t),"."))}else if(e instanceof Set){if(!["length","some","any","all"].includes(t))return p.create("property","".concat(T,"'length', 'some', 'any', and 'all' of ").concat(m(e),"."),"You can't access specific individual data values from datasets.");"length"===t&&(t="size")}else{if(k(e.TwineScript_Properties)&&!e.TwineScript_Properties.includes(t))return p.create("property","You can only get the ".concat(s(e.TwineScript_Properties.map(function(e){return"'"+e+"'"}))," of ").concat(m(e),", not ").concat(("string"==typeof t?f:m)(t),"."));if("number"==typeof e||"boolean"==typeof e)return p.create("property","You can't get any data values, let alone ".concat(m(t),", from ").concat(m(e)))}return t}function O(e,t){return+t<0&&Math.abs(t)<=e.length?e.length+ +t:t}var A=/[^\uD801-\uDFFF]/,C=new Map;function E(e,t){var n,r,a;return void 0===e?e:e instanceof Map?e.get(t):"some"!==t&&"any"!==t&&"all"!==t&&"start"!==t&&"end"!==t||e.TwineScript_VariableStore?("string"==typeof e&&(C.has(e)?e=C.get(e):A.test(e)?(a=_toConsumableArray(e),C.set(e,a),e=a):C.set(e,e)),h(e)&&Number.isFinite(t)&&(t=O(e,t)),e.TwineScript_GetProperty?e.TwineScript_GetProperty(t):"function"!=typeof(a=e[t])?a:void 0):(n=e,r=t,a='"'.concat(r," value").concat("any"===r?"":"s",'" of '),{determiner:r,determined:n,array:_toConsumableArray(n),string:"string"==typeof n&&n,TwineScript_ObjectName:a+m(n),TwineScript_ToSource:function(){return"".concat(r," of ").concat(f(n))},TwineScript_TypeName:a+"a data structure",TwineScript_Unstorable:!0,TwineScript_Print:function(){return"`["+this.TwineScript_TypeName+"]`"}})}function N(e){var t;return e.computed?(t=e.value,"string"==typeof(t=c.isPrototypeOf(t)?t.get():t)?"('"+t+"')":"("+t+")"):"number"==typeof e?r(e):"'"+e+"'"}function j(t,e,n){if(t.TwineScript_VariableStore){if(t.TwineScript_TypeDefs&&e in t.TwineScript_TypeDefs){var r=t.TwineScript_TypeDefs[e];if("const"===r.name){if(void 0!==t[e])return p.create("operation","I can't alter ".concat(t===u.variables?"$":"_").concat(e," because it's been restricted to a constant value."),"This variable can't be changed for the rest of the story.")}else if(!a(r,n))return p.create("operation","I can't set ".concat(t===u.variables?"$":"_").concat(e," to ").concat(l(n)," because it's been restricted to ").concat(f(r),"-type data."),"You can restrict a variable or data name by giving a typed variable to (set:) or (put:).")}return!0}return k(e)?e.map(function(e){return j(t,e)}):t instanceof Map?"string"==typeof e||p.create("operation","".concat(m(t)," can only have string data names, not ").concat(m(e),".")):h(t)?["length","random","some","any","all","start","end"].includes(e)?p.create("operation","I can't forcibly alter the '"+e+"' of "+m(t)+".","start"===e||"end"===e?"Alter the values at actual positions, like 1st or 2ndlast, rather than just the '"+e+"'.":void 0):+e==(0|e)||p.create("property",m(t)+" can only have position keys ('3rd', '1st', (5), etc.), not "+N(e)+"."):t.TwineScript_Identifiers&&e in t?p.create("keyword","I can't alter the value of the '"+e+"' identifier.","You can only alter data in variables, not fixed identifiers."):p.create("operation","I can't modify "+m(t),t instanceof Set?"You should use an (array:) if you need to modify the data inside this dataset.":i.isPrototypeOf(t)?"You should alter hooks indirectly using macros like (replace:) or (enchant:).":void 0)}function P(t,e,n,r){var a=e;t instanceof Map?t.set(e,n):(h(t)&&(e=O(t,e)),t.TwineScript_Set?t.TwineScript_Set(e,n,r):t[e]=n),S.set.forEach(function(e){return e(t,a,n)})}function R(t,e){var n=e;h(t)&&(e=O(t,e)),k(t)&&/^(?:[1-9]\d*|0)$/.exec(e)?t.splice(e,1):t instanceof Map||t instanceof Set?t.delete(e):t.TwineScript_Delete?t.TwineScript_Delete(e):delete t[e],S.delete.forEach(function(e){return e(t,n)})}function I(t,e){var n,r,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e,o=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return e&&"object"===_typeof(e)&&"last"in e&&"first"in e?i.isPrototypeOf(t)?t.TwineScript_GetProperty(e):(n=e.first,r=e.last,b(t,n+(0<=n),r+(0<=r))):k(e)?i.isPrototypeOf(t)?t.TwineScript_GetProperty(e):e.map(function(e){return I(t,e,e)})["string"==typeof t?"join":"valueOf"](""):void 0!==(n=E(t,e))||o?n:t===u.variables?0:"temp"===(null==(r=t.TwineScript_VariableStore)?void 0:r.type)?p.create("property","There isn't a temp variable named _".concat(a," in this place."),"Temp variables only exist inside the same passage, hook, or lambda in which they're created."):k(t)&&"number"==typeof e?p.create("property","This array of ".concat(t.length," elements doesn't have a ").concat(N(a+("number"==typeof a?1:""))," element."),t.length?"It contains: ".concat(s(t.map(m)),"."):"The array is empty."):(o=Array.from("function"==typeof t.keys&&t.keys()),p.create("property","I can't find a ".concat(N(a)," data name in ").concat(m(t)),t instanceof Map&&o.length?"Its names include: ".concat(s(o),"."):void 0))}function V(e,t){var r=this,e=this.compiledPropertyChain.reduce(function(e,t){var n=0===e.length?r.object:I.apply(void 0,_toConsumableArray(e[e.length-1]));return e.push([n,t])&&e},[]).reduceRight(e,t);return p.containsError(e)?e:void 0}return c=Object.freeze({get:function(){for(var e=this.object,t=0;t<this.compiledPropertyChain.length-1;t+=1)if(e=I(e,this.compiledPropertyChain[t]),p.containsError(e))return e;return I(e,this.compiledPropertyChain.slice(-1)[0],this.propertyChain.slice(-1)[0])},has:function(){for(var e=this.object,t=0;t<this.compiledPropertyChain.length-1;t+=1)if(void 0===(e=I(e,this.compiledPropertyChain[t],void 0,!0))||p.containsError(e))return!1;return void 0!==I(e,this.compiledPropertyChain.slice(-1)[0],void 0,!0)},set:function(e,c){var l=this;return!this.object||this.object.TwineScript_VariableStore||this.object.TwineScript_Identifiers?V.call(this,function(n,e,t){var e=_slicedToArray(e,2),r=e[0],a=e[1];if(e=p.containsError(n,r,a)||p.containsError(j(r,a,n)))return e;if(e=w(n))return p.create("operation","".concat(m(n)," can't be stored").concat(!n.TwineScript_Unstorable&&v(n)?" because it holds ".concat(m(e)):"","."));if(0<t)r=g(r);else if("temp"===(null==(e=r.TwineScript_VariableStore)?void 0:e.type)&&r!==u.variables){for(var o=r;"temp"===(null==(i=o.TwineScript_VariableStore)?void 0:i.type)&&!hasOwnProperty.call(o,a);)var i,o=Object.getPrototypeOf(o);"temp"===(null==(t=o.TwineScript_VariableStore)?void 0:t.type)&&(r=o)}if("string"==typeof r){if("string"!=typeof n)return p.create("datatype","I can't put this non-string value, ".concat(m(n),", in a string."));if(n.length!==(k(a)?a.length:1))return p.create("datatype","".concat(m(n),"is not the right length to fit into this string location."));var r=_toConsumableArray(r),s=_toConsumableArray(n);[].concat(a).forEach(function(e){0+e<0&&(e=r.length+(0+e)),r=[].concat(_toConsumableArray(r.slice(0,e)),[s.shift()],_toConsumableArray(r.slice(e+1)))}),r=r.join("")}else d(r)&&(void 0!==n.TwineScript_KnownName&&((n=""!==n.TwineScript_KnownName?g(n):n).TwineScript_KnownName=f(l)),k(a)&&h(n)?("string"==typeof n&&(n=_toConsumableArray(n)),a.map(function(e,t){return[e,n[t]]}).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];return P(r,t,e,c)})):P(r,a,n,c));return r},e):p.create("macrocall","I can't (set:) ".concat(m(this),", if the ").concat((m(this.object).match(/ (.+$)/)||["","value"])[1]," isn't stored in a variable."),"Modifying data structures that aren't in variables won't change the game state at all.")},delete:function(){return V.call(this,function(e,t,n){var r,t=_slicedToArray(t,2),a=t[0],t=t[1];return(r=p.containsError(e,a,t)||p.containsError(j(a,t)))||(0<n&&(a=g(a)),null===e?((r="string"==typeof a)&&(a=_toConsumableArray(a)),k(t)?(h(a)&&(t=_toConsumableArray(new Set(t))).sort(function(e,t){return O(a,t)-O(a,e)}),t.forEach(function(e){return R(a,e)})):R(a,t),r&&(a=a.join(""))):P(a,t,e,!1),a)},null)},defineType:function(e){var t=this.object,n=this.compiledPropertyChain[0],r=(hasOwnProperty.call(t,"TwineScript_TypeDefs")||(t.TwineScript_TypeDefs=Object.create(t.TwineScript_TypeDefs||null)),t.TwineScript_TypeDefs),a=r[n];if(a&&!o(a,e))return p.create("operation","I can't redefine the type of "+m(this)+" to "+(e.TwineScript_ObjectName||l(e))+", as it is already "+(a.TwineScript_ObjectName||l(a))+".");t.TwineScript_DefineType?t.TwineScript_DefineType(n,e):r[n]=e,"const"===e.name&&(t[n]=void 0)},matches:function(e,t){return this.object===e&&this.compiledPropertyChain[0]===t},getName:function(){return this.compiledPropertyChain[0]},create:function(e,t){var n;if(n=p.containsError(e))return n;Array.isArray(t)||(t=[].concat(t)),c.isPrototypeOf(e)&&(t=e.propertyChain.concat(t),e=e.object);var r=function(e,t){for(var n,r=[],a=0;a<t.length;a+=1){var o=t[a];if(o.computed&&(o=o.value),c.isPrototypeOf(o)&&(o=o.get()),k(o)){for(var i=[],s=0;s<o.length;s+=1)i[s]=x(e,o[s]);o=i}else o=x(e,o);if(n=p.containsError(o))return n;a<t.length-1&&(e=I(e,o)),r.push(o)}return r}(e,t);return(n=p.containsError(r))||Object.assign(Object.create(c),{object:e,propertyChain:t,compiledPropertyChain:r})},TwineScript_ToSource:function(){function r(e,t){return!t&&n.object.TwineScript_VariableStore?e:N(e)}var e,n=this;return(this.object===u.variables?"$":"temp"===(null==(e=this.object.TwineScript_VariableStore)?void 0:e.type)?"_":f(this.object)+"'s ")+(1===this.propertyChain.length?r(this.propertyChain[0]):this.propertyChain.reduce(function(e,t,n){return e+"'s "+r(t,n)}))},get TwineScript_ObjectName(){var e;return this.object.TwineScript_VariableStore?"the ".concat("temp"===(null==(e=this.object.TwineScript_VariableStore)?void 0:e.type)?"temp ":"","variable ").concat(this.TwineScript_ToSource()):m(this.object)+"'s "+(1===this.propertyChain.length?N(this.propertyChain[0]):this.propertyChain.reduce(function(e,t,n){return e+"'s "+N(t)}))},on:function(e,t){if(e in S)return"function"!=typeof t||S[e].includes(t)||S[e].push(t),c;n("VarRef.on","invalid event name")}})}),define("internaltypes/varscope",[],function(){return Object.seal({TwineScript_ObjectName:"the temporary variables",TwineScript_VariableStore:{type:"temp",name:"an unknown scope"},TwineScript_TypeDefs:Object.create(null)})}),define("macrolib/commands",["jquery","macros","utils","state","passages","engine","internaltypes/twineerror","internaltypes/twinenotifier","datatypes/assignmentrequest","datatypes/hookset","datatypes/codehook","datatypes/colour","datatypes/gradient","internaltypes/varref","datatypes/typedvar","datatypes/varbind","utils/operationutils","utils/renderutils"],function(u,n,b,c,l,a,y,M,e,o,t,p,d,i,s,v,r,f){var h=r.printBuiltinValue,m=r.objectName,g=r.clone,w=r.toSource,k=f.dialog,S=f.geomParse,D=f.geomStringRegExp,r=n.TypeSignature,f=r.Any,F=r.Everything,T=r.rest,_=r.either,x=r.optional,O=r.zeroOrMore,L=r.percent,H=r.nonNegativeInteger,A=r.positiveInteger,r=r.positiveNumber,C=Object.assign,E=Math.floor,N=Math.ceil,j=Math.abs,z=Math.max,q=Math.min,P=u.noop;function R(e){return"(".concat(e," ").concat(b.options.ifid,") ")}["set","put","unpack"].forEach(function(r){return n.add(r,"Instant",function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t+=1){var n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if("into"===n.operator&&"set"===r)return y.create("macrocall","Please say 'to' when using the (set:) macro.");if("to"===n.operator&&"set"!==r)return y.create("macrocall","Please say 'into' when using the (put:) or (unpack:) macro.");if((i.isPrototypeOf(n.dest)||s.isPrototypeOf(n.dest))===("unpack"===r))return y.create("macrocall","unpack"===r?"Please use the (unpack:) macro with arrays, datamaps or (p:) patterns containing variables to the right of 'into'.":"Please use the (".concat(r,":) macro with just single variables and typed variables to the ").concat("set"===r?"left of 'to'.":"right of 'into'."),"You may wish to change this to the (".concat("unpack"!==r?"unpack":"to"===n.operator?"set":"put",":) macro."));n=n.set();if(y.containsError(n))return n}return{TwineScript_TypeID:"instant",TwineScript_TypeName:"a (".concat(r,":) operation"),TwineScript_ObjectName:"a (".concat(r,":) operation"),TwineScript_Unstorable:!0,TwineScript_Print:function(){return b.options.debug,""}}},[T(e)])}),n.add("move","Instant",function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t+=1){var n=t+1<1||arguments.length<=t+1?void 0:arguments[t+1];if("into"!==n.operator)return y.create("macrocall","Please say 'into' when using the (move:) macro.");n=n.set(!0);if(y.containsError(n))return n}return{TwineScript_TypeID:"instant",TwineScript_TypeName:"a (move:) operation",TwineScript_ObjectName:"a (move:) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return b.options.debug,""}}},[T(e)]),n.addCommand("display",function(e){if(!l.hasValid(e))return y.create("macrocall","I can't (display:) the passage '".concat(e,"' because it doesn't exist."))},function(e,t,n){return e.source=l.getTree(n),e},[String])("print",P,function(e,t,n){return C(e,{source:h(n)})},[f])(["verbatim-print","v6m-print"],P,function(e,t,n){return C(e,{verbatim:!0,source:h(n)})},[f])(["verbatim-source","v6m-source"],function(e){if("command"===(null==e?void 0:e.TwineScript_TypeID)&&!e.TwineScript_ToSource)return y.create("datatype","I can't construct the source code of a command created by a custom macro.")},function(e,t,n){return C(e,{verbatim:!0,source:h(w(n))})},[f])("go-to",function(e){if(!l.hasValid(e))return y.create("macrocall","I can't (go-to:) to the passage '".concat(e,"' because it doesn't exist."),"Check that you didn't mistype the passage name, or rename the passage to something else.")},function(e,t,n){if(!b.options.ignoreGotos)return requestAnimationFrame(function(){return a.goToPassage(n,{transition:e.data.passageT8n})}),{blocked:!0}},[String])("redirect",function(e){if(!l.hasValid(e))return y.create("macrocall","I can't (redirect:) to the passage '".concat(e,"' because it doesn't exist."),"Check that you didn't mistype the passage name, or rename the passage to something else.")},function(e,t,n){if(!b.options.ignoreGotos)return requestAnimationFrame(function(){return a.redirect(n,{transition:e.data.passageT8n})}),{blocked:!0}},[String])("undo",P,function(e,t,n){return c.pastLength<1?C(e,{source:n}):b.options.ignoreGotos?void 0:(requestAnimationFrame(function(){return a.goBack({transition:e.data.passageT8n})}),{blocked:!0})},[x(String)])("debug",P,a.enableDebugMode,[],!1),b.onStartup(function(){return b.storyElement.on("click.icon","tw-icon",function(e){var t=u(this),n=t.data("clickEvent"),r=t.attr("alt");n&&n(t),"Undo"===r&&(e.stopPropagation(),a.goBack()),"Redo"===r&&(e.stopPropagation(),a.goForward()),"Fullscreen"===r&&(e.stopPropagation(),a.toggleFullscreen()),"Restart"===r&&(c.hasSessionStorage&&sessionStorage.removeItem("Saved Session"),window.location.reload())})}),[["Undo","&#8630;",function(){return 0<c.pastLength}],["Redo","&#8631;",function(){return 0<c.futureLength}],["Fullscreen","&#9974;",function(){return document.fullscreenEnabled||document.msFullscreenEnabled}],["Restart","&#10226;",Object]].forEach(function(e){var e=_slicedToArray(e,3),o=e[0],i=e[1],s=e[2];n.addCommand("icon-".concat(o.toLowerCase()),function(e,t){if("string"==typeof e&&"string"==typeof t)return e=_toConsumableArray(e).length,t=_toConsumableArray(t).length,1<e&&1<t?y.create("datatype","One of the two strings given to (icon-".concat(o.toLowerCase(),":) should be 1 character long, for its icon.")):1===e&&1===t?y.create("datatype","One of the two strings given to (icon-".concat(o.toLowerCase(),":) should be 2 or more characters long, for its label.")):void 0},function(t,e,n,r){var a;return("string"==typeof r&&1===_toConsumableArray(r).length||"string"==typeof n&&1<_toConsumableArray(n).length)&&(n=(a=[r,n])[0],r=a[1]),"Undo"===o&&(t.data.forgetUndosEvent=function(e){t.section.whenUnblocked(function(){return u(e).css("visibility","hidden")})}),C(t,{source:'<tw-icon tabindex=0 alt="'.concat(o,'" ').concat(r?'data-label="'.concat(r.replace('"',"&quot;"),'"'):"",' title="').concat(o,'" ').concat(s()?"":'style="visibility:hidden"',">").concat(n||i,"</tw-icon>")})},[x(String),x(String)])}),n.addCommand("icon-counter",function(e,t,n){var r=" label string given to (icon-counter:) can't be empty or only whitespace.";return t&&t.trim()?"string"!=typeof n||n.trim()?void 0:y.create("datatype","The 2nd "+r):y.create("datatype","The 1st "+r)},function(r,e,a,o,i){r.attr.push({"data-2bind":!0}),r.data.twoWayBindEvent=function(e,t,n){a.varRef.matches(t,n)&&"number"==typeof(t=a.varRef.get())&&r.target.children("tw-icon").text((0<t?E:N)(t)).attr("data-label",1!==j(t)&&void 0!==i?i:o)};var t=a.varRef.get();return"number"!=typeof t?y.create("datatype","(icon-counter:) can only be bound to a variable holding a number, not ".concat(m(t),".")):C(r,{source:'<tw-icon data-label="'.concat(b.escape(1!==j(t)&&void 0!==i?i:o),'">').concat((0<t?E:N)(t),"</tw-icon>")})},[v,String,x(String)]),n.addCommand("meter",function(e,t,n,r){return"two way"===e.bind?y.create("datatype","(meter:) shouldn't be given two-way bound variables.",'Change the "2bind" keyword to just "bind".'):"string"!=typeof r||r.trim()?-1===n.search(D)||!n.includes("=")&&1<n.length?y.create("datatype",'The (meter:) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not '+JSON.stringify(n)+"."):void 0:y.create("datatype","The label string given to (meter:) can't be empty or only whitespace.")},function(r,e,a,n,t,o,i){o&&"string"!=typeof o&&(i=o,o=void 0),i=i||p.create({h:0,s:0,l:.5,a:.5}),p.isPrototypeOf(i)&&(i=d.create(90,[{colour:i,stop:0},{colour:i,stop:1}]));function s(e){var t=z(0,q(1,e/n)),e=i.repeating?i:i.multiply(n/e);return"height:100%;background-repeat:no-repeat;background-image:".concat((l?C(e,e.repeating?{}:{angle:270}).toLinearGradientString()+", ":"")+C(e,e.repeating?{}:{angle:l||0===c?90:270}).toLinearGradientString(),";background-size:").concat(l?Array(2).fill(50*t+"%"):100*t+"%",";background-position-x:").concat(l?-100/(2-t)+100+"%,"+100/(2-t)+"%":0===c?"left":"right",";text-align:").concat(l?"center":0===c?"left":"right")}var t=S(t),c=t.marginLeft,t=t.size,l=0<c&&Math.ceil(c+t)<100,u=(r.styles.push({"margin-left":c+"%",width:t+"%",height:"1.5em",display:"block"}),r.attr.push({"data-2bind":!0}),o&&e.stackTop.tempVariables),t=(r.data.twoWayBindEvent=function(e,t,n){a.varRef.matches(t,n)&&"number"==typeof(t=a.varRef.get())&&((n=r.target.children("tw-meter")).attr("style",s(t)),o)&&r.section.renderInto("",null,{source:o,target:n,append:"replace",transitionDeferred:!1},u)},a.varRef.get());return"number"!=typeof t?y.create("datatype","(meter:) can only be bound to a variable holding a number, not ".concat(m(t),".")):C(r,{source:'<tw-meter style="'.concat(s(t),'">').concat(o||"","</tw-meter>")})},[v,r,String,x(_(String,p,d)),x(_(p,d))]),[["cycling-link"],["seq-link","sequence-link"]].forEach(function(t,u){return n.addCommand(t,function(){var e;return""===(arguments.length<=0?void 0:arguments[0])?y.create("datatype","The first string in a ("+t[0]+":) can't be empty."):arguments.length<=(v.isPrototypeOf(arguments.length<=0?void 0:arguments[0])?2:1)?y.create("datatype","I need two or more strings to "+(u?"sequence":"cycle")+" through, not just '"+((e=arguments.length-1)<0||arguments.length<=e?void 0:arguments[e])+"'."):void 0},function(a,e){for(var o,t=arguments.length,i=new Array(2<t?t-2:0),n=2;n<t;n++)i[n-2]=arguments[n];v.isPrototypeOf(i[0])&&(o=i.shift());var s=0,c=("two way"===(null==(l=o)?void 0:l.bind)&&(a.attr.push({"data-2bind":!0}),-1<(l=i.indexOf(o.varRef.get())))&&(s=l),e.stackTop.tempVariables);function r(e,t){var n=s>=i.length-1&&u,r=""===i[s]?"":n?i[s]:"<tw-link>".concat(i[s],"</tw-link>");if(n&&(a.data.clickEvent=void 0),o&&!t){n=o.set(i[s]);if(y.containsError(n))return void e.replaceWith(n.render(i[s]))}t=_objectSpread(_objectSpread({},a),{},{source:r,transitionDeferred:!1});a.section.renderInto("",null,t,c)}i[s]&&(a.data.clickEvent=function(e){s=(s+1)%i.length,r(e,!1)},a.data.twoWayBindEvent=function(e,t,n){o.varRef.matches(t,n)&&(t=o.varRef.get(),-1<(n=i.indexOf(t)))&&n!==s&&(s=n,r(e,!0))});var l="<tw-link>".concat(i[s],"</tw-link>");if(o){e=o.set(i[s]);if(y.containsError(e))return e}return C(a,{source:l,append:"replace",transitionDeferred:!0})},[_(v,String),T(String)])}),b.onStartup(function(){return b.storyElement.on("change.dropdown-macro","select",function(){var e=u(this),t=e.closest("tw-expression, tw-hook").data("dropdownEvent");t&&t(e)})}),n.addCommand("dropdown",function(e){var t;return""===(arguments.length<=1?void 0:arguments[1])||""===((t=(arguments.length<=1?0:arguments.length-1)-1+1)<1||arguments.length<=t?void 0:arguments[t])?y.create("datatype","The first or last strings in a (dropdown:) can't be empty.","Because empty strings create separators within (dropdown:)s, having them at the start or end doesn't make sense."):(arguments.length<=1?0:arguments.length-1)<=1?y.create("datatype","I need two or more strings to create a (dropdown:) menu, not just "+(arguments.length<=1?0:arguments.length-1)+"."):void 0},function(e,t,r){for(var n=arguments.length,a=new Array(3<n?n-3:0),o=3;o<n;o++)a[o-3]=arguments[o];var i=0,s=("two way"===r.bind&&(e.attr.push({"data-2bind":!0}),-1<(c=a.indexOf(r.varRef.get())))&&(i=c),Math.max.apply(Math,_toConsumableArray(a.map(function(e){return _toConsumableArray(e).length})))),c="<select>"+a.map(function(e,t){return"<option".concat(t===i?" selected":"").concat(""===e?" disabled":"",">").concat(b.escape(e||"\u2500".repeat(s)),"</option>")}).join("\n")+"</select>",l=(e.data.dropdownEvent=function(e){var t=e.val(),n=r.set(t);y.containsError(n)&&e.replaceWith(n.render(t))},e.data.twoWayBindEvent=function(e,t,n){r.varRef.matches(t,n)&&(t=r.varRef.get(),-1<(n=a.indexOf(t)))&&n!==i&&(e.find("select").val(t),i=n)},e.styles.push({"background-color":function(){return b.parentColours(u(this)).backgroundColour}}),r.set(a[i]));return y.containsError(l)?l:C(e,{source:c,append:"replace"})},[v,String,T(String)]),b.onStartup(function(){return b.storyElement.on("input.checkbox-macro","input[type=checkbox]",function(){var e=u(this),t=e.closest("tw-expression").data("checkboxEvent");t&&t(e)})});function I(e){return["I can't use a dialog macro in "+e+".","Please rewrite this without putting such macros here."]}var V=1;n.addCommand("checkbox",function(){},function(e,t,r,n){var a=!1,o="checkbox-"+ ++V,i=("two way"===r.bind&&(e.attr.push({"data-2bind":!0}),"boolean"==typeof(i=r.varRef.get())&&(a=i),e.data.twoWayBindEvent=function(e,t,n){r.varRef.matches(t,n)&&"boolean"==typeof(t=r.varRef.get())&&e.children("input[type=checkbox]").prop("checked",t)}),e.data.checkboxEvent=function(e){var t=e.is(":checked"),t=r.set(t);y.containsError(t)&&e.replaceWith(t.render(""))},r.set(a));return y.containsError(i)?i:C(e,{source:'<input id="'.concat(o,'" type="checkbox" ').concat(a?"checked":"",'><label for="').concat(o,'">').concat(n,"</label>"),append:"replace"})},[v,String]),b.onStartup(function(){return u(document).on("fullscreenchange",function(){u("input[type=checkbox][id^=fullscreen]",b.storyElement).each(function(e,t){(u(t).closest("tw-expression").data("fullscreenEvent")||Object)(t)})})}),n.addCommand("checkbox-fullscreen",function(){},function(e,t,n){var r="fullscreenCheckbox-"+ ++V;return e.data.fullscreenEvent=function(e){return u(e).prop("checked",!(!document.fullscreenElement&&!document.msFullscreenElement))},e.data.checkboxEvent=function(){return a.toggleFullscreen()},C(e,{source:'<input id="'.concat(r,'" type="checkbox" ').concat(document.fullscreenEnabled||document.msFullscreenEnabled?" ":"disabled ").concat(document.fullscreenElement||document.msFullscreenElement?"checked":"",'><label for="').concat(r,'">').concat(n,"</label>"),append:"replace"})},[String]),b.onStartup(function(){return b.storyElement.on("input.input-box-macro","textarea, input[type=text]",function(){var e=u(this),t=e.closest("tw-expression").data("inputBoxEvent");t&&t(e)})}),["input","force-input","input-box","force-input-box"].forEach(function(g){return n.addCommand(g,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=g.endsWith("box"),a=v.isPrototypeOf(t[0]),o="string"==typeof t[+a],r=r&&"number"==typeof t[o+a],i=o?t[+a]:t[a+r],s=0<S(i).size,o=s?t[a+r+o]:i;return g.startsWith("force")&&"string"!=typeof o?y.create("datatype","The (".concat(g,":) macro requires a string of text to forcibly input.")):t.length>a+r+s+("string"==typeof o)?y.create("datatype","An incorrect combination of values was given to this (".concat(g,":) macro.")):void 0},function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var o=g.startsWith("force"),i=g.endsWith("box"),s=v.isPrototypeOf(r[0]),c="string"==typeof r[+s],l=i&&"number"==typeof r[c+s],u=s&&r[0],p=l?r[1+s]:3,d=c?S(r[+s]):{},f=d.marginLeft,d=d.size,h=(d?r[s+l+c]:c&&r[+s])||"",l=o?"":h,c=!1;if("two way"===u.bind){e.attr.push({"data-2bind":!0});s=u.varRef.get();if("string"==typeof s){l=o?h.slice(0,s.length):s,s=u.set(l),c=!0;if(y.containsError(s))return s}e.data.twoWayBindEvent=function(e,t,n){u.varRef.matches(t,n)&&"string"==typeof(t=u.varRef.get())&&e.find(i?"textarea":"input").val(o?h.slice(0,t.length):t)}}if(u&&!c){s=u.set(o?"":h);if(y.containsError(s))return s}!o&&u&&(e.data.inputBoxEvent=function(e){var t=e.val(),t=u.set(t);y.containsError(t)&&e.replaceWith(t.render(""))});var m,c="<".concat(i?"textarea":"input type=text",' style="width:100%" ').concat(i?"rows=".concat(p,">"):'value="').concat(b.escape(l)).concat(i?"</textarea>":'">');return o&&(m=Array.from(h),e.data.inputBoxEvent=function(e){var t=e.val().length,t=m.slice(0,t).join("");return e.val(t),u&&(t=u.set(t),y.containsError(t))&&e.replaceWith(t.render("")),!0}),e.styles.push({display:"block","margin-left":d?f+"%":void 0,width:d?d+"%":"100%","border-style":function(){return this.style.borderStyle||"solid"}}),C(e,{source:c,append:"replace"})},g.endsWith("box")?[_(v,String),x(_(A,String)),x(_(A,String)),x(String)]:[x(_(v,String)),x(String),x(String)])}),["show","rerun"].forEach(function(s){return n.addCommand(s,function(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function e(t){var n=t.selector,t=t.next;return"name"===n.type&&"page"===n.data?(r=y.create("macrocall","You can't (hide:) the ?page. Sorry."),!0):!!("base"===n.type&&e(n.data)||t&&e(t))||void 0}),r},function(o,i){for(var e=arguments.length,t=new Array(2<e?e-2:0),n=2;n<e;n++)t[n-2]=arguments[n];return t.forEach(function(e){return e.forEach(i,function(e){var t,n,r,a=e.data("hidden");void 0!==a!=("rerun"===s)&&(e.removeData("hidden"),a instanceof u?e.empty().append(a):(a=e.data("tempVariables"),n=(t="tw-passage"===e.tag())?l.getTree(c.passage):e.data("originalSource")||"",t&&(r=e.find("tw-sidebar").detach()),i.renderInto("",null,_objectSpread(_objectSpread({},o),{},{append:"replace",source:n,target:e}),a&&Object.create(a)),r&&e.prepend(r)))})}),o},[T(o)])});n.addCommand("hide",function(){for(var r,e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some(function e(t){var n=t.selector,t=t.next;return"name"===n.type&&"page"===n.data?(r=y.create("macrocall","You can't (hide:) the ?page. Sorry."),!0):!!("base"===n.type&&e(n.data)||t&&e(t))||void 0}),r},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0,o=n;a<o.length;a++)o[a].forEach(e,function(e){e.data("hidden")||e.data("hidden",e.contents().detach())})},[T(o)],!1)("scroll",P,function(m,e,g){var y="number"==typeof g&&g;requestAnimationFrame(function(){e.forEach(m,function(e){if(!1!==y){var t,n,r=e[0];null!=(t=(n=r=r===b.storyElement[0]&&r.scrollHeight===r.clientHeight?getComputedStyle(document.body).overflow.includes(" scroll")?document.body:document.documentElement:r).scrollTo)&&t.call(n,0,(r.scrollHeight-r.clientHeight)*y)}else{var a,o=_createForOfIteratorHelper(g.hooks(m).get());try{for(o.s();!(a=o.n()).done;){var i=a.value;if(e.find(i)){for(var s=[],c=e[0];(c=c.parentNode)&&c!==document.body;)s.push([c,c.scrollLeft,c.scrollTop]);i.scrollIntoView();for(var l=0,u=s;l<u.length;l++){var p=_slicedToArray(u[l],3),d=p[0],f=p[1],h=p[2];d.scrollLeft=f,d.scrollTop=h}break}}}catch(e){o.e(e)}finally{o.f()}}})})},[o,_(L,o)],!1)("stop",P,P,[],!1)("load-game",P,function(e,t){var n,r;return e.loadedGame?y.create("infinite","I can't use (load-game:) immediately after loading a game."):(n=localStorage.getItem(R("Saved Game")+t))?(n=c.deserialise(e,n))instanceof Error?{blocked:r=k({message:"Sorry to interrupt... The story tried to load saved data, but there was a problem.\n"+n.message+"\n\nThat data might have been saved from a different version of this story. Should I delete it?\n(Type 'delete' and choose Yes to delete it.)\n\nEither way, the story will now continue without loading the data.",defaultValue:"",buttons:[{name:"Yes",confirm:!0,callback:function(){"delete"===r.find("input").last().val()&&localStorage.removeItem(R("Saved Game")+t),e.unblock("")}},{name:"No",cancel:!0,callback:function(){return e.unblock()}}]})}:void requestAnimationFrame(a.showPassage.bind(a,c.passage,{loadedGame:!0})):y.create("saving","I can't find a save slot named '"+t+"'!")},[String],!1)("forget-undos",P,function(e,t){c.futureLength||c.forgetUndos(t)},[parseInt],!1)("forget-visits",P,function(e,t){c.forgetVisits(t)},[parseInt],!1)("mock-visits",function(){if(!b.options.debug)return y.create("debugonly","(mock-visits:) cannot be used outside of debug mode.");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.find(function(e){return!l.hasValid(e)});return r?y.create("datatype","I can't mock-visit '"+r+"' because no passage with that name exists."):void 0},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];c.mockVisits=g(n)},[T(String)],!1)("mock-turns",function(){if(!b.options.debug)return y.create("debugonly","(mock-turns:) cannot be used outside of debug mode.")},function(e,t){c.mockTurns=t},[H],!1)("seed",P,function(e,t){c.setSeed(t)},[String],!1)(["dialog","alert"],function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(v.isPrototypeOf(e)){if("two way"===e.bind)return y.create("datatype","(dialog:) shouldn't be given two-way bound variables.",'Change the "2bind" keyword to just "bind".');if(void 0===t)return y.create("datatype","(dialog:) needs a message string or codehook to display.")}else void 0!==t&&r.unshift(t);e=r.findIndex(function(e){return""===e});if(-1<e)return y.create("datatype","(dialog:)'s ".concat(b.nth(e+1)," link text shouldn't be an empty string."))},function(e,n,r,t){for(var a=arguments.length,o=new Array(4<a?a-4:0),i=4;i<a;i++)o[i-4]=arguments[i];return v.isPrototypeOf(r)||(void 0!==t&&o.unshift(t),t=r,r=void 0),o.length||(o=["OK"]),{blocked:k({section:n,message:t,cd:e,buttons:o.map(function(t){return{name:t,callback:function(){var e;n.unblock((null==(e=r)?void 0:e.set(t))||"")}}})})}},[_(v,String,t),x(_(t,String)),O(String)])("open-url",P,function(e,t){window.open(t,"")},[String],!1)(["restart","reload"],P,function(){if(!b.options.ignoreGotos){if(c.turns<=1)return y.create("infinite","I mustn't (restart:) the story in the starting passage.");c.hasSessionStorage&&sessionStorage.removeItem("Saved Session"),window.location.reload()}},[],!1)("goto-url",P,function(e,t){window.location.assign(t)},[String],!1)("ignore",P,P,[O(F)])("assert-exists",function(e){if(""===e)return y.create("datatype","(assert-exists:) mustn't be given an empty string.")},function(e,t,n){var r=0;return("string"==typeof n?o.create({type:"string",data:n}):n).forEach(t,function(){++r}),r?e:y.create("assertion","I didn't see any ".concat("string"==typeof n?"text occurrences of":"hooks matching"," ").concat(w(n)," in this passage."))},[_(o,String)]),n.add("assert","Instant",function(e,t){return t?{TwineScript_TypeID:"instant",TwineScript_TypeName:"an (assert:) operation",TwineScript_ObjectName:"an (assert:) operation",TwineScript_Unstorable:!0,TwineScript_Print:function(){return""}}:C(y.create("assertion","An assertion failed: "),{appendTitleText:!0})},[Boolean])("save-game","Boolean",function(e,t,n){if(n=n||"",!c.hasStorage)return!1;var r=c.serialise(!1).pastAndPresent;if(y.containsError(r))return r;if(!1===r)return!1;try{return localStorage.setItem(R("Saved Game")+t,r),localStorage.setItem(R("Saved Game Filename")+t,n),!0}catch(e){return!1}},[String,x(String)])("prompt","String",function(e,t,n,r,a){var o,i;return null!=(o=e.stackTop)&&o.evaluateOnly?y.create.apply(y,["macrocall"].concat(_toConsumableArray(I(e.stackTop.evaluateOnly)))):""===a?y.create("datatype","The text for (prompt:)'s confirm link can't be blank."):(i=k({section:e,message:t,defaultValue:n,buttons:[{name:a||"OK",confirm:!0,callback:function(){return e.unblock(i.find("input").last().val())}}].concat(""===r?[]:{name:r||"Cancel",cancel:!0,callback:function(){return e.unblock(n)}})}),e.stackTop.blocked=i,0)},[_(String,t),String,x(String),x(String)])("confirm","Boolean",function(e,t,n,r){var a;return null!=(a=e.stackTop)&&a.evaluateOnly?y.create.apply(y,["macrocall"].concat(_toConsumableArray(I(e.stackTop.evaluateOnly)))):""===r?y.create("datatype","The text for (confirm:)'s confirm link can't be blank."):(a=k({section:e,message:t,defaultValue:!1,buttons:[{name:r||"OK",confirm:!0,callback:function(){return e.unblock(!0)}}].concat(""===n?[]:{name:n||"Cancel",cancel:!0,callback:function(){return e.unblock(!1)}})}),e.stackTop.blocked=a,0)},[_(String,t),x(String),x(String)])("page-url","String",function(){return window.location.href},[])}),define("macrolib/custommacros",["utils","macros","state","utils/operationutils","datatypes/changercommand","datatypes/custommacro","datatypes/codehook","datatypes/typedvar","internaltypes/twineerror"],function(c,l,u,e,t,p,n,d,f){function s(e,t,n){if(!t.some(function(e){if("function"==typeof e.output)return e.output(n),!0}))return f.create("macrocall","("+e+":) should only be used inside a code hook passed to (macro:).")}var h=e.objectName,m=e.toSource,e=l.add,r=l.addChanger,a=l.addCommand,o=l.TypeSignature,i=o.rest,g=o.either,y=o.Any,b=o.Everything,o=o.zeroOrMore;e("macro","CustomMacro",function(e){for(var t,n=[],r=arguments.length,a=new Array(1<r?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];for(t=0;t<a.length;t+=1){var i=t===a.length-1;if(d.isPrototypeOf(a[t])===i)return f.create("datatype","The "+(i?"":c.nth(a.length-t+1)+"-")+"last value given to (macro:) should be a "+(i?"code hook":"datatyped variable")+", not "+h(a[t]));if(!i){i="A custom macro";if(a[t].varRef.object===u.variables)return f.create("datatype",i+"'s typed variables must be temp variables (with a '_'), not global variables (with a '$').","Write them with a _ symbol at the start instead of a $ symbol.");if(1<a[t].varRef.propertyChain.length)return f.create("datatype",i+"'s typed variables can't be properties inside a data structure.");if(a[t].datatype.rest&&t!==a.length-2)return f.create("datatype",i+" can only have one spread variable, and it must be its last variable.");var s=a[t].varRef.propertyChain[0];if(n.includes(s))return f.create("datatype",i+"'s typed variables can't both be named '"+s+"'.");n.push(s)}}return p.create(a.slice(0,-1),a[a.length-1])},[i(g(d,n))]);a(["output-data","out-data"],function(){},function(e,t){e=e.stack;return s("output-data",e,t)||{blocked:!0}},[y],!1),r(["output","out"],function(){return Object.assign(t.create("output",[]))},function(e,t){if(e.section){var n,r=e.section,a=r.stack,o=r.stackTop,i={};for(n in o.tempVariables)n.startsWith("TwineScript_")||(i[n]=o.tempVariables[n]);s("output",a,{changer:t,variables:i,hook:Array.isArray(e.source)?"["+e.source.map(function(e){return e.text}).join("")+"]":e.source}),e.output=!0,o.blocked=!0}},[]),a("error",function(e){if(!e)return f.create("datatype","This (error:) macro was given an empty string.")},function(e,t){e=e.stack;return s("error",e,f.create("user",t))||{blocked:!0}},[String],!1),e("partial","CustomMacro",function(e,a){for(var t=arguments.length,o=new Array(2<t?t-2:0),n=2;n<t;n++)o[n-2]=arguments[n];var r="string"!=typeof a&&a,i=!r&&a;if(!r){if(!l.has(i))return f.create("macrocall",'The macro name given to (partial:), "'.concat(a,"\", isn't the name of a built-in macro."));if("Metadata"===l.get(i).returnType)return f.create("macrocall","(partial:) can't be used with metadata macros such as (".concat(a,":)"))}var s="(partial:".concat(m(a),",").concat(o.map(function(e){return m(e)}),")"),c=p.createFromFn(function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e=l["string"==typeof a?"run":"runCustom"](a,e,o.concat(n));return f.containsError(e)&&(e.message="An error occurred while running the (partial:)-created macro, ".concat(c.TwineScript_ObjectName,":\n")+e.message),e},"a (partial:) custom macro of ".concat(i||r.TwineScript_KnownName?"(".concat(i||r.TwineScript_KnownName,":").concat(o.map(function(e){return m(e)}),")"):"another unnamed custom macro"),function(){return s},(i?l.get(i):r).typeSignature.filter(function(e,t){return t>=o.length||"rest"===e.pattern||"zero or more"===e.pattern}));return c},[g(String,p),o(b)])}),define("macrolib/datastructures",["utils","utils/naturalsort","macros","utils/operationutils","state","engine","passages","datatypes/lambda","datatypes/typedvar","internaltypes/twineerror"],function(e,i,t,n,s,r,a,c,o,l){var u=e.permutations,p=e.options,d=n.objectName,f=n.subset,h=n.collectionType,m=n.isValidDatamapName,g=n.is,y=n.unique,b=n.clone,v=n.range,e=t.TypeSignature,n=e.optional,w=e.rest,k=e.either,S=e.zeroOrMore,T=e.Any,e=e.nonNegativeInteger,_=i("en");t.add(["a","array"],"Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n},S(k(o,T)))("range","Array",function(e,t,n){return v(t,n)},[parseInt,parseInt])("subarray","Array",function(e,t,n,r){return f(t,n,r)},[Array,parseInt,parseInt])("reversed","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reverse().map(b)},S(T))("shuffled","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return s.shuffled.apply(s,n).map(b)},[S(T)])("sorted","Array",function(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];if(!c.isPrototypeOf(r[0]))return(t=r.filter(function(e){return"string"!=typeof e&&"number"!=typeof e}))&&t.length?1===t.length&&Array.isArray(t[0])?l.create("macrocall","Please give multiple numbers or strings to (sorted:), not a single array.","You can use the spread ... syntax to spread out the array's values into (sorted:)."):l.create("datatype","If (sorted:) isn't given a 'via' lambda, it must be given only numbers and strings, not ".concat(d(t[0]),".")):r.sort(_);var o=r.shift();if("making"in o||"where"in o||"when"in o||!("via"in o))return l.create("datatype","The optional lambda given to (sorted:) must be a 'via' lambda, not ".concat(d(o),"."));for(var i=0;i<r.length;i+=1){var s=o.apply(e,{loop:r[i],pos:i+1});if(l.containsError(s))return s;if("string"!=typeof s&&"number"!=typeof s)return l.create("datatype",'The "via" lambda given to (sorted:) couldn\'t convert '.concat(d(r[i])," into a string or number."));r[i]=[r[i],s]}return r.sort(function(e,t){return _(e[1],t[1])}).map(function(e){return e[0]})},[S(T)])("rotated","Array",function(e,t){if(0===t)return l.create("macrocall","I can't rotate these values by 0 positions.");for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=-1*(t=Math.abs(t)%r.length*Math.sign(t));return r.slice(t).concat(r.slice(0,t)).map(b)},[parseInt,S(T)])("rotated-to","Array",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)?t:t.length?(e=r.indexOf(t[0]),r.slice(e).concat(r.slice(0,e)).map(b)):l.create("macrocall","None of these "+r.length+" values matched the lambda, so I can't rotate them.")},[c.TypeSignature("where"),w(T)])("repeated","Array",function(e,t){for(var n=[],r=arguments.length,a=new Array(2<r?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];if(!a.length)return n;for(;0<t--;)n.push.apply(n,a);return n.map(b)},[e,w(T)])("interlaced","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=Math.min.apply(Math,_toConsumableArray(n.map(function(e){return e.length}))),o=[],i=0;i<a;i+=1)for(var s=0;s<n.length;s+=1)o.push(b(n[s][i]));return o},[Array,w(Array)])("permutations","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.length?u.apply(void 0,n):[]},[S(T)])("unique","Array",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.filter(y)},[S(T)])("altered","Array",function(n,r){for(var e=arguments.length,t=new Array(2<e?e-2:0),a=2;a<e;a++)t[a-2]=arguments[a];return t.map(function(e,t){t=r.apply(n,{loop:e,pos:t+1});return null===t?e:t})},[k(c.TypeSignature("via"),c.TypeSignature("where","via")),S(T)])("find","Array",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return t.filter(e,r)},[c.TypeSignature("where"),S(T)])(["all-pass","pass"],"Boolean",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)||t.length===r.length},[c.TypeSignature("where"),S(T)])("some-pass","Boolean",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)||0<t.length},[c.TypeSignature("where"),S(T)])("none-pass","Boolean",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];t=t.filter(e,r);return l.containsError(t)||0===t.length},[c.TypeSignature("where"),S(T)])("folded","Any",function(r,a){for(var e=arguments.length,t=new Array(2<e?e-2:0),n=2;n<e;n++)t[n-2]=arguments[n];return"where"in a&&(t=[t[0]].concat(_toConsumableArray(a.filter(r,t.slice(1))))),l.containsError(t)||t.reduce(function(e,t,n){return a.apply(r,{making:e,loop:t,pos:n+1})})},[k(c.TypeSignature("where","via","making"),c.TypeSignature("via","making")),w(T)])(["dm-names","datamap-names","datanames"],"Array",function(e,t){return Array.from(t.keys()).sort(i("en"))},[Map])(["dm-values","datamap-values","datavalues"],"Array",function(e,t){return Array.from(t.entries()).sort(i("en",function(e){return String(e[0])})).map(function(e){return b(e[1])})},[Map])(["dm-entries","datamap-entries","dataentries"],"Array",function(e,t){return Array.from(t.entries()).sort(function(e,t){return[e[0],t[0]].sort(i("en"))[0]===e[0]?-1:1}).map(function(e){return new Map([["name",e[0]],["value",b(e[1])]])})},[Map])(["dm-altered","datamap-altered"],"Datamap",function(a,o,e){return Array.from(e.entries()).sort(function(e,t){return[e[0],t[0]].sort(i("en"))[0]===e[0]?-1:1}).reduce(function(e,t,n){if(!l.containsError(e)){var r=new Map([["name",t[0]],["value",b(t[1])]]),r=o.apply(a,{loop:r,pos:n+1});if(l.containsError(r))return r;e.set(t[0],null===r?t[1]:r)}return e},new Map)},[k(c.TypeSignature("via"),c.TypeSignature("where","via")),Map])("history","Array",function(e,t){var n=s.history();return t?(t=t.filter(e,n.map(function(e){return a.get(e)})),l.containsError(t)?t:t.map(function(e){return e.get("name")})):n},[n(c.TypeSignature("where"))])("visited","Boolean",function(e,t){var n;return"string"==typeof t?a.has(t)?0<s.passageNameVisited(t)||s.passage===t:l.create("macrocall","There's no passage named '"+t+"' in this story."):(n=s.history(),n=t.filter(e,n.concat(s.passage).map(function(e){return a.get(e)})),l.containsError(n)?n:0<n.length)},[k(String,c.TypeSignature("where"))])("passage","Datamap",function(e,t){return b(a.get(t||s.passage))||l.create("macrocall","There's no passage named '"+t+"' in this story.")},[n(String)])("passages","Array",function(e,t){var n=i("en"),r=_toConsumableArray(a.values()).map(function(e){return b(e)}),t=t?t.filter(e,r):r,e=l.containsError(t);return e||t.sort(function(e,t){return n(e.get("name"),t.get("name"))})},[n(c.TypeSignature("where"))])("open-storylets","Array",function(e,t){return e.stackTop.evaluateOnly?l.create("macrocall","(open-storylets:) can't be used in "+e.stackTop.evaluateOnly+"."):(e=a.getStorylets(e,t),l.containsError(e)||e.map(b))},[n(c.TypeSignature("where"))])("savedgames","Datamap",function(){function e(e){return"("+e+" "+p.ifid+") "}var t,n,r=0,a=new Map;do{if(!s.hasStorage)break;t=localStorage.key(r),r+=1;var o=e("Saved Game")}while(null!=(n=t)&&n.startsWith(o)&&(t=t.slice(o.length),a.set(t,localStorage.getItem(e("Saved Game Filename")+t))),t);return a},[])(["datamap","dm"],"Datamap",function(e){for(var r,a=new Map,t=arguments.length,n=new Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var i=n.reduce(function(e,t){var n;if(!l.containsError(e))if(void 0===r)r=t;else{if(n=l.containsError(m(a,r)))return n;if(a.has(r))return l.create("macrocall","You used the same data name ("+d(r)+") twice in the same (datamap:) call.");a.set(r,b(t)),r=void 0}return e},!0);return l.containsError(i)?i:void 0!==r?l.create("macrocall","This datamap has a data name without a value."):a},S(k(o,T)))(["dataset","ds"],"Dataset",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new Set(n.filter(y).map(b))},S(T))("count","Number",function t(n,r){for(var e,a=arguments.length,o=new Array(2<a?a-2:0),i=2;i<a;i++)o[i-2]=arguments[i];if(1<o.length)return e=o.map(function(e){return t(n,r,e)}),l.containsError(e)||e.reduce(function(e,t){return e+t},0);var s=o[0];switch(h(r)){case"dataset":case"datamap":return l.create("macrocall","(count:) shouldn't be given a datamap or dataset.","You should use the 'contains' operator instead. For instance, write: $variable contains 'value'.");case"string":return"string"!=typeof s?l.create("macrocall",d(r)+" can't contain  "+d(s)+" because it isn't also a string."):s?r.split(s).length-1:0;case"array":return r.reduce(function(e,t){return e+g(t,s)},0);default:return l.create("macrocall",d(r)+" can't contain values, let alone "+d(s)+".")}},[T,w(T)])}),define("macrolib/enchantments",["jquery","utils","utils/operationutils","engine","state","passages","macros","datatypes/hookset","datatypes/codehook","datatypes/changercommand","datatypes/lambda","internaltypes/changedescriptor","internaltypes/enchantment","internaltypes/twineerror"],function(c,r,e,l,s,n,u,p,a,d,t,i,f,h){var m=e.is,e=u.TypeSignature,g=e.either,y=e.rest,o=e.optional,b=Object.assign;function v(e,t){if(d.isPrototypeOf(t)&&!t.canEnchant)return h.create("datatype","The changer given to (".concat(e,":) can't include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:)."))}["enchant","change"].forEach(function(o){u.addCommand(o,function(e,t){t=v(o,t);if(t)return t},function(t,n,e){n=p.from(n);var r,a=[];return d.isPrototypeOf(e)&&(r=i.create({section:t}),e.run(r),0<(r.innerEnchantments||[]).length)&&(r=r.innerEnchantments.map(function(e){return e(n)}),a.push.apply(a,_toConsumableArray(r))),a.push(f.create(_defineProperty(_defineProperty({scope:n},d.isPrototypeOf(e)?"changer":"lambda",e),"section",t))),a.forEach(function(e){"enchant"===o?(t.addEnchantment(e),t.updateEnchantments()):e.enchantScope()}),""},[g(p,String),g(d,t.TypeSignature("via"))],!1)}),u.addChanger("enchant-in",function(e,t,n){var r=v("enchant-in",n);return r||d.create("enchant-in",[t,n])},function(t,n,r){return t.innerEnchantments=(t.innerEnchantments||[]).concat(function(e){return f.create(_defineProperty(_defineProperty({scope:p.from(n),localHook:e},d.isPrototypeOf(r)?"changer":"lambda",r),"section",t.section))}),t},[g(p,String),g(d,t.TypeSignature("via"))]),[["link-style",p.create({type:"name",data:"link"})],["line-style",p.create({type:"base",data:p.create({type:"name",data:"page"})},"lines",void 0)],["char-style",p.create({type:"base",data:p.create({type:"name",data:"page"})},"chars",void 0)]].forEach(function(e){var e=_slicedToArray(e,2),r=e[0],a=e[1];u.addChanger(r,function(e,t){var n=v(r,t);return n||d.create(r,[t])},function(t,n){return t.innerEnchantments=(t.innerEnchantments||[]).concat(function(e){return f.create(_defineProperty(_defineProperty({scope:a,localHook:e},d.isPrototypeOf(n)?"changer":"lambda",n),"section",t.section))}),t},[g(d,t.TypeSignature("via"))])});e=["replace","append","prepend"];function w(i,s){return r.onStartup(function(){var e=i.classList.replace(/ /g,"."),t=i.blockClassList?i.blockClassList.replace(/ /g,"."):"",n="."+e+(t?",."+t:"");r.storyElement.on(i.event.map(function(e){return e+".enchantment"}).join(" "),n,function(){var e,t=c(this);r.options.debug&&r.options.ignoreClickEvents&&!t.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *")||t.is("tw-open-button")||(e=(t=c(Array.from(t.parents(n).add(this)).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0])).data("enchantmentEvent"))&&e(t)})}),[function(e,t,n){if(!t)return h.create("datatype","A string given to this ("+s+":) macro was empty.");if(n){var r=v(s,n);if(r)return r}return d.create(s,[p.from(t)].concat(n?[n]:[]))},function(t,e,n){t.enabled=!1,t.transitionDeferred=!0,i.rerender&&(t.newTargets=(t.newTargets||[]).concat({target:e,append:i.rerender}));var r,a=null!=(r=t.section)&&r.stackTop?t.section.stackTop.tempVariables:Object.create(null),o=f.create(_defineProperty({functions:[function(e){e.attr("class",e.children().is("tw-story, tw-sidebar, tw-passage")||["block","flex"].includes(e.children().css("display"))?i.blockClassList:i.classList),e.attr({tabIndex:"0"})}],data:{enchantmentEvent:function(){var e;null!=(e=t.section.stackTop)&&e.blocked||(i.once&&t.section.removeEnchantment(o),i.goto?l.goToPassage(i.goto,{transition:i.transition}):i.undo?l.goBack({transition:i.transition}):t.section.renderInto(t.source,null,_objectSpread(_objectSpread({},t),{},{append:i.once?"append":"replace",enabled:!0,transitionDeferred:!1}),a))}},scope:e,section:t.section,name:s},d.isPrototypeOf(n)?"changer":"lambda",n));return t.section&&(t.section.addEnchantment(o),o.enchantScope()),t},[g(p,String),o(g(d,t.TypeSignature("via")))]]}e.forEach(function(o){u.addChanger(o,function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.every(Boolean)?d.create(o,n.map(p.from),null,!1):h.create("datatype","A string given to this (".concat(o,":) macro was empty."))},function(e){var t;0<c(e.target).parents().filter("tw-collapsed,[collapsing=true]").length||e.attr.some(function(e){return e.collapsing})||(e.attr=[].concat(_toConsumableArray(e.attr),[{collapsing:!1}])),e.newTargets=e.newTargets||[];for(var n=arguments.length,r=new Array(1<n?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return(t=e.newTargets).push.apply(t,_toConsumableArray(r.filter(function(n){return!e.newTargets.some(function(e){var t=e.target,e=e.append;return m(n,t)&&o===e})}).map(function(e){return{target:e,append:o,before:!0}}))),e},y(g(p,String)))(o+"-with",function(e,t){return d.create(o+"-with",[t],null,!1)},function(e,t){return a.isPrototypeOf(t)&&(t=t.code),e.appendSource=(e.appendSource||[]).concat({source:t,append:o}),e},g(a,String))});var k="ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints,S=[{name:"click",enchantDesc:{event:["click"],once:!0,rerender:"",classList:"link enchantment-link",blockClassList:"enchantment-clickblock"}},{name:"mouseover",enchantDesc:{event:["mouseenter",k?"click":""].filter(Boolean),once:!0,rerender:"",classList:"link enchantment-mouseover",blockClassList:"enchantment-mouseoverblock"}},{name:"mouseout",enchantDesc:{event:["mouseleave",k?"click":""].filter(Boolean),once:!0,rerender:"",classList:"link enchantment-mouseout",blockClassList:"enchantment-mouseoutblock"}},{name:"doubleclick",enchantDesc:{event:["dblclick"],once:!0,rerender:"",classList:"link enchantment-dblclick",blockClassList:"enchantment-dblclickblock"}}];S.forEach(function(e){"doubleclick"!==e.name&&(u.addChanger.apply(u,[e.name].concat(_toConsumableArray(w(e.enchantDesc,e.name)))),"click"===e.name)&&u.addChanger.apply(u,[e.name+"-rerun"].concat(_toConsumableArray(w(_objectSpread(_objectSpread({},e.enchantDesc),{},{once:!1}),e.name+"-rerun"))))}),r.onStartup(function(){S.forEach(function(e){var n=e.enchantDesc;n.blockClassList&&r.storyElement.on(n.event.map(function(e){return e+".enchantment"}).join(" "),function(){var e,t=c(this);r.options.debug&&r.options.ignoreClickEvents&&!t.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *")||t.is("tw-open-button")||(e=(t=c(Array.from(t.parents("."+n.blockClassList.replace(/ /g,"."))).sort(function(e,t){return 8&e.compareDocumentPosition(t)?1:-1})[0])).data("enchantmentEvent"))&&e(t)})})}),e.forEach(function(n){S.forEach(function(e){var t;"doubleclick"!==e&&(t=_objectSpread(_objectSpread({},e.enchantDesc),{},{rerender:n}),e=e.name+"-"+n,u.addChanger.apply(u,[e].concat(_toConsumableArray(w(t,e)))))})}),S.forEach(function(i){"doubleclick"!==i&&["goto","undo"].forEach(function(a){var o=i.name+"-"+a;u.addCommand(o,function(e,t){return!e||!t&&"goto"===a?h.create("datatype","A string given to this ("+o+":) macro was empty."):"goto"!==a||n.hasValid(t)?void 0:h.create("macrocall","I can't ("+o+":) the passage '"+t+"' because it doesn't exist.")},function(e,t,n,r){return"undo"===a&&s.pastLength<1?h.create("macrocall","I can't (undo:) on the first turn."):((0,_slicedToArray(w(_objectSpread(_objectSpread({},i.enchantDesc),{},{transition:e.data.passageT8n},"undo"===a?{undo:!0}:{goto:r}),o),2)[1])({section:t},p.from(n)),b(e,{source:""}))},[g(p,String)].concat("undo"===a?[]:String))})})}),define("macrolib/links",["jquery","macros","utils","state","passages","engine","datatypes/changercommand","internaltypes/changedescriptor","datatypes/hookset","datatypes/lambda","internaltypes/twineerror"],function(i,e,c,l,u,p,a,d,t,f,h){var n=e.TypeSignature,r=n.optional,o=n.rest,n=n.either,m=["Links can't have empty strings for their displayed text.","In the link syntax, a link's displayed text is inside the [[ and ]], and on the non-pointy side of the -> or <- arrow if it's there."],g=Object.assign;function s(e,t,n){n=n||t;var r,a=u.hasValid(t)&&t===n,e=e.evaluateTwineMarkup(c.unescape(n),"a link's passage name");return a?t=(a=0<e.children().length?"`".repeat((n.match(/`+/)||[]).reduce(function(e,t){return Math.max(e,t.length+1)},1)):"")+"\0".repeat(!!a)+t+"\0".repeat(!!a)+a:(e.findAndFilter("tw-error").length&&(r=e.findAndFilter("tw-error").data("TwineError")),n=e.text()),{text:t,passage:n,error:r}}c.onStartup(function(){var e="ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints;function t(e){var t=i(this),n=t.closest("tw-expression"),r=t.closest("tw-expression, tw-hook"),a=r.data("clickEvent"),r=r.data("section");if((!c.options.debug||!c.options.ignoreClickEvents||t.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *"))&&!t.is("tw-open-button")&&(null==r||!r.stackTop||!r.stackTop.blocked||r.stackTop.blocked instanceof i&&r.stackTop.blocked.find(t).length)){if(a)return 0<t.find("tw-error").length?void 0:(e.stopPropagation(),void a(t));var r=n.data("linkPassageName"),o=_objectSpread({},n.data("passageT8n")||{});n.find("tw-enchantment").each(function(e,t){Object.assign(o,i(t).data("passageT8n")||{})}),r?(e.stopPropagation(),p.goToPassage(r,{transition:o})):t.is("[undo]")?(e.stopPropagation(),p.goBack({transition:o})):t.is("[fullscreen]")&&(e.stopPropagation(),p.toggleFullscreen())}}c.storyElement.on("click.passage-link","tw-link"+(e?"":":not(.enchantment-mouseover):not(.enchantment-mouseout):not(.enchantment-dblclick)"),t).on("mouseover.passage-link","tw-link.enchantment-mouseover, tw-expression.enchantment-mouseover > tw-link",t).on("mouseout.passage-link","tw-link.enchantment-mouseout, tw-expression.enchantment-mouseout > tw-link",t).on("dblclick.passage-link","tw-link.enchantment-dblclick, tw-expression.enchantment-dblclick > tw-link",t),i(document).on("fullscreenchange",function(){i("tw-link[fullscreen]",c.storyElement).each(function(e,t){(i(t).closest("tw-expression, tw-hook").data("fullscreenEvent")||Object)(t)})})}),[["link","link-replace"],["link-reveal","link-append"],["link-repeat"],["link-rerun"]].forEach(function(s){return e.addChanger(s,function(e,t,n){return t?n&&!n.canEnchant?h.create("datatype","The changer given to (".concat(s[0],":) can't be (or include) a revision, enchantment, or interaction changer like (replace:), (click:), or (link:).")):a.create(s[0],[t].concat(n||[]),null,!0):h.create("datatype",m[0])},function(r,e,t){var n,a=s[0],o=null!=(n=r.section)&&n.stackTop?r.section.stackTop.tempVariables:Object.create(null),i=d.create({source:"<tw-link tabindex=0>"+e+"</tw-link>",target:function(){return r.target},append:"replace",data:{section:r.section,clickEvent:function(e){r.enablers=r.enablers.filter(function(e){return e.descriptor!==i}),"link-reveal"===a&&e.contents().unwrap();var t,n=e.parentsUntil(":not(tw-enchantment)").parent();n.length||(n=e.parent()),"link-rerun"===a&&(t=e.parentsUntil(":not(tw-enchantment)"),e.detach(),t.remove()),"link"!==a&&"link-rerun"!==a||n.empty(),r.section.renderInto("",null,r,o),"link-rerun"===a&&n.prepend(e)}}});return r.enablers=(r.enablers||[]).concat({descriptor:i,changer:t}),r},[String,r(a)])}),e.addCommand("link-goto",function(e){if(!e)return h.create.apply(h,["datatype"].concat(m))},function(e,t,n,r){var a,o=s(t,n,r);return n=o.text,r=o.passage,(o=o.error)||(e.transition?h.create("datatype","Please attach ("+(o="transition")+"-depart:) or ("+o+"-arrive:) to a passage link, not ("+o+":)."):(a=(a=u.hasValid(r)?a:'<tw-broken-link passage-name="'+c.escape(r)+'">'+n+"</tw-broken-link>")||"<tw-link tabindex=0 "+(0<l.passageNameVisited(r)?'class="visited" ':"")+">"+n+"</tw-link>",e.data.linkPassageName=r,e.data.section=t,g(e,{source:a,transitionDeferred:!0})))},[String,r(String)])("link-storylet",function(){var e=(e=1===arguments.length||"string"!=typeof(arguments.length<=0?void 0:arguments[0])?0:1)<0||arguments.length<=e?void 0:arguments[e];if(!e||"string"==typeof e)return h.create("datatype","(link-storylet:) should be given one index number or one 'where' lambda, after the optional link text string.")},function(e,t){var n=(n=2+("string"==typeof(arguments.length<=2?void 0:arguments[2])?1:0))<2||arguments.length<=n?void 0:arguments[n],r="string"==typeof(arguments.length<=2?void 0:arguments[2])&&(arguments.length<=2?void 0:arguments[2]),a=((a=(arguments.length<=2?0:arguments.length-2)-1+2)<2||arguments.length<=a?void 0:arguments[a])!==n&&((a=(arguments.length<=2?0:arguments.length-2)-1+2)<2||arguments.length<=a?void 0:arguments[a]);if(e.transition)return h.create("datatype","Please attach (".concat(o="transition","-depart:) or (").concat(o,"-arrive:) to (link-storylet:), not (").concat(o,":)."));var o=f.isPrototypeOf(n),i=u.getStorylets(t,o&&n),s=h.containsError(i);if(s)return s;var c,s=i[o?0:n<0?i.length+n:n-1];if(s)s=s.get("name"),r=r||s,c=c||"<tw-link tabindex=0 "+(0<l.passageNameVisited(s)?'class="visited" ':"")+">"+r+"</tw-link>",e.data.linkPassageName=s,e.data.section=t;else{if(!a)return e;c=a}return g(e,{source:c,transitionDeferred:!0})},[n(parseInt,String,f.TypeSignature("where")),r(n(parseInt,String,f.TypeSignature("where"))),r(String)])("link-undo",function(e){if(!e)return h.create("datatype",m[0])},function(t,e,n){var r,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";return l.pastLength<1?g(t,{source:a}):(r=(t.data.section=e).stackTop.tempVariables,t.data.forgetUndosEvent=function(){return t.data.section.whenUnblocked(function(){var e=_objectSpread(_objectSpread({},t),{},{append:"replace",source:a,transitionDeferred:!1});t.section.renderInto("",null,e,r)})},g(t,{source:"<tw-link tabindex=0 undo>"+n+"</tw-link>",transitionDeferred:!0}))},[String,r(String)])("link-show",function(e){if(!e)return h.create("datatype",m[0])},function(r,a,e){for(var t=arguments.length,n=new Array(3<t?t-3:0),o=3;o<t;o++)n[o-3]=arguments[o];return r.data.section=a,r.data.clickEvent=function(e){e.contents().unwrap(),n.forEach(function(e){return e.forEach(a,function(e){var t=e.data("originalSource")||"",n=e.data("hidden");n&&(e.removeData("hidden"),n instanceof i?e.empty().append(n):(n=e.data("tempVariables"),a.renderInto("",null,_objectSpread(_objectSpread({},r),{},{source:t,target:e,transitionDeferred:!1}),n&&Object.create(n))))})})},g(r,{source:"<tw-link tabindex=0>"+e+"</tw-link>",transitionDeferred:!0})},[String,o(t)])("link-fullscreen",function(e,t){if(!e||!t)return h.create("datatype",m[0])},function(t,e,n,r){function a(){return document.fullscreenEnabled||document.msFullscreenEnabled?"<tw-link tabindex=0 fullscreen>"+(document.fullscreenElement||document.msFullscreenElement?r:n)+"</tw-link>":r?"<tw-broken-link>"+r+"</tw-broken-link>":""}var o=e.stackTop.tempVariables;return t.data.section=e,t.data.fullscreenEvent=function(){(document.fullscreenEnabled||document.msFullscreenEnabled)&&t.data.section.whenUnblocked(function(){var e=_objectSpread(_objectSpread({},t),{},{append:"replace",source:a(),transitionDeferred:!1});t.section.renderInto("",null,e,o)})},g(t,{source:a(),transitionDeferred:!0})},[String,String,r(String)]),e.addChanger(["link-reveal-goto"],function(e,t,n,r){if(!t)return h.create.apply(h,["datatype"].concat(m));if(a.isPrototypeOf(n)){if(a.isPrototypeOf(r))return h.create("datatype","You mustn't give two changers to (link-reveal-goto:)");r=n,n=void 0}return r&&!r.canEnchant?h.create("datatype","The changer given to (link-reveal-goto:) can't include a revision, enchantment, or interaction changer like (replace:), (click:), or (link:)."):(t=(e=s(e,t,n)).text,n=e.passage,e.error||a.create("link-reveal-goto",[t,n,r].filter(function(e){return void 0!==e}),null,!1))},function(t,e,n,r){var a,o,i,s;if(u.hasValid(n))return o=l.passageNameVisited(n),i=null!=(a=t.section)&&a.stackTop?t.section.stackTop.tempVariables:Object.create(null),s=d.create({source:"<tw-link tabindex=0 "+(0<o?'class="visited" ':"")+">"+e+"</tw-link>",target:t.target,append:"replace",data:{section:t.section,append:"replace",clickEvent:function(e){t.enablers=t.enablers.filter(function(e){return e.descriptor!==s}),e.contents().unwrap(),t.section.renderInto("",null,t,i),t.section.whenUnblocked(function(){return p.goToPassage(n,{transition:t.data.passageT8n})})}}}),t.enablers=(t.enablers||[]).concat({descriptor:s,changer:r}),t;t.source='<tw-broken-link passage-name="'+c.escape(n)+'">'+e+"</tw-broken-link>"},[String,r(n(a,String)),r(a)])}),define("macrolib/metadata",["macros","utils/operationutils","datatypes/lambda","internaltypes/twineerror"],function(t,e,n,s){function c(e){return{TwineScript_TypeName:"a ("+e+":) macro",TwineScript_ObjectName:"a ("+e+":) macro",TwineScript_Unstorable:!0,TwineScript_Print:function(){return""}}}var l=e.clone,u=e.objectName,p=e.isValidDatamapName,e=t.TypeSignature,r=e.zeroOrMore,e=e.Any;[["storylet",n.TypeSignature("when")],["urgency",Number],["exclusivity",Number]].forEach(function(e){var e=_slicedToArray(e,2),n=e[0],e=e[1];t.add(n,"Metadata",function(e,t){return e.stackTop.speculativePassage?t:c(n)},e)}),t.add("metadata","Metadata",function(e){for(var r,a=new Map,t=arguments.length,n=new Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var i=n.reduce(function(e,t){var n;if(!s.containsError(e))if(void 0===r)r=t;else{if(n=s.containsError(p(a,r)))return n;if(a.has(r))return s.create("macrocall","You used the same data name ("+u(r)+") twice in the same (metadata:) call.");a.set(r,l(t)),r=void 0}return e},!0);return s.containsError(i)?i:void 0!==r?s.create("macrocall","This (metadata:) macro has a data name without a value."):e.stackTop.speculativePassage?a:c("metadata")},r(e))}),define("macrolib/patterns",["macros","utils","utils/operationutils","datatypes/lambda","datatypes/datatype","datatypes/typedvar","internaltypes/twineerror","internaltypes/varscope"],function(e,t,n,y,b,h,v,w){function k(e){var r,t,a=e.name,n=e.fullArgs,o=e.args,i=e.makeRegExpString,s=void 0===i?function(e){return e.join("")}:i,c=void 0!==(i=e.insensitive)&&i,l=void 0===(i=e.canContainTypedVars)||i,u=void 0===(i=e.canBeUsedAlone)||i,p=void 0===(i=e.canContainTypedGlobals)||i,d=o||n,f=E(null),e=d.map(function e(t){if(h.isPrototypeOf(t)){var n=t.varRef;if(!l)return v.create("operation","Optional string patterns, like (".concat(a,":)").concat("p-many"===a?" with a minimum of 0 matches":"",", can't have typed variables inside them."));if(!p&&!w.isPrototypeOf(n.object))return v.create("operation","Only typed temp variables can be used in patterns given to (".concat(a,":)"));n=n.getName();if(n in f)return v.create("operation","There's already a typed temp variable named _".concat(n," inside this (").concat(a,":) call."));f[n]=!0;n=e(t.datatype);return v.containsError(n)?n:"("+n+")"}if(b.isPrototypeOf(t)){if(!(l&&p||"function"!=typeof t.typedVars)){n=t.typedVars();if(!l&&n.length)return v.create("operation","(".concat(a,":) can't have typed variables inside its pattern."));if(!p&&n.some(function(e){return!w.isPrototypeOf(e.varRef.object)}))return v.create("operation","Only typed temp variables can be used in patterns given to (".concat(a,":)"))}var r;return t.regExp?(t.rest?"(?:":"")+(c?t.insensitive():t).regExp+(t.rest?")*":""):(n=t.name,r=t.rest?"*":"","alnum"===n?m+r:"whitespace"===n?_+r:"uppercase"===n?(c?T:g)+r:"lowercase"===n?(c?T:S)+r:"anycase"===n?T+r:"digit"===n?"\\d"+r:"linebreak"===n?"(?:\\r|\\n|\\r\\n)"+r:"str"===n?".*?":["even","odd","int","num"].includes(n)?v.create("datatype","Please use string datatypes like 'digit' in (".concat(a,":) instead of number datatypes.")):v.create("datatype","The (".concat(a,":) macro must only be given string-related datatypes, not ").concat(O(t),".")))}return"string"==typeof t?(t=t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"),c?t.replace(RegExp("(".concat(g,"|").concat(S,")"),"g"),function(e){return"["+e.toUpperCase()+e.toLowerCase()+"]"}):t):(x("createPattern","mapper() was given a non-string non-datatype "+t),"")});return(i=v.containsError(e))||(r=s(e),t=C(E(b),{name:a,regExp:r,insensitive:function(){return c?t:k({name:a,fullArgs:n,args:d.map(function(e){return b.isPrototypeOf(e)&&"function"==typeof e.insensitive?e.insensitive():e}),makeRegExpString:s,insensitive:!0,canContainTypedVars:l,canBeUsedAlone:u})},typedVars:function(){return d.reduce(function(e,t){return h.isPrototypeOf(t)&&(e=e.concat(c?h.create(k({name:"p-ins",fullArgs:[t.datatype],insensitive:!0}),t.varRef):t),t=t.datatype),e=b.isPrototypeOf(t)&&"function"==typeof t.typedVars?e.concat(t.typedVars()):e},[])},destructure:function(e){var n,t;return"string"!=typeof e?[v.create("operation","I can't put ".concat(O(e)," into ").concat(this.TwineScript_ToSource()," because it isn't a string."))]:(n=this.typedVars()).length?(t=(RegExp("^"+(this.rest?"(?:":"")+r+(this.rest?")*":"")+"$").exec(e)||[]).slice(1)).length?t.map(function(e,t){t=n[t];if(t)return t.datatype.rest&&!t.datatype.regExp&&((t=t.TwineScript_Clone()).datatype=k({name:"p",fullArgs:[t.datatype]})),{dest:t,value:e||"",src:void 0}}).filter(Boolean):[v.create("operation","I can't put ".concat(O(e)," because it doesn't match the pattern ").concat(this.TwineScript_ToSource(),"."))]:[]},TwineScript_IsTypeOf:function(e){return u?"string"==typeof e&&!!e.match("^"+(this.rest?"(?:":"")+r+(this.rest?")*":"")+"$"):v.create("operation","A (".concat(a,":) datatype must only be used with a (p:) macro."))},TwineScript_toTypeSignatureObject:function(){var t=this;return{pattern:"range",name:a,range:function(e){return t.TwineScript_IsTypeOf(e)}}},TwineScript_ToSource:function(){return(this.rest?"...":"")+"("+a+":"+n.map(A)+")"}}),Object.defineProperty(t,"TwineScript_ObjectName",{get:function(){return"a (".concat(a,":) datatype")}}),t)}var m=t.anyRealLetter,g=t.anyUppercase,S=t.anyLowercase,T=t.anyCasedLetter,_=t.realWhitespace,x=t.impossible,O=n.objectName,A=n.toSource,t=e.TypeSignature,n=t.rest,r=t.either,a=t.optional,t=t.nonNegativeInteger,C=Object.assign,E=Object.create,o=n(r(String,b,h));e.add(["p","pattern"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p",fullArgs:n})},o)(["p-either","pattern-either"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-either",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?:"+e.join("|")+")"}})},o)(["p-opt","pattern-opt","p-optional","pattern-optional"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-opt",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?:"+e.join("")+")?"}})},o)(["p-not","pattern-not"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.find(function(e){return"string"==typeof e?1!==_toConsumableArray(e).length:e.rest||e.regExp||["str","empty"].includes(e.name)})?v.create("datatype","(p-not:) should only be given single characters, or datatypes that match single characters"):k({name:"p-not",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"[^"+e.map(function(e){return e.startsWith("[")&&e.endsWith("]")?e.slice(1,-1):e}).join("")+"]"}})},o)(["p-not-before","pattern-not-before"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-not-before",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?!"+e.join("")+")"}})},o)(["p-before","pattern-before"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-before",fullArgs:n,canContainTypedVars:!1,makeRegExpString:function(e){return"(?="+e.join("")+")"}})},o)(["p-start","pattern-start"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-start",fullArgs:n,makeRegExpString:function(e){return"^(?:"+e.join("")+")"}})},o)(["p-end","pattern-end"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-end",fullArgs:n,makeRegExpString:function(e){return"(?:"+e.join("")+")$"}})},o)(["p-many","pattern-many"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a,o,i,s=n.slice();return"number"==typeof n[0]&&(a=n.shift(),o="number"==typeof n[0]?n.shift():1/0),!(void 0!==o&&o<a)&&n.length?(i=n.find(function(e){return"string"!=typeof e&&!b.isPrototypeOf(e)&&!h.isPrototypeOf(e)}))?v.create("datatype","This (p-many:) macro can only be given a min and max number followed by datatypes or strings, but was also given "+O(i)+"."):k({name:"p-many",args:n,fullArgs:s,canContainTypedVars:0<a,makeRegExpString:function(e){return"(?:"+e.join("")+")"+(void 0!==a?"{"+a+(o===1/0?",":o!==a?","+o:"")+"}":"+")}}):v.create("datatype","The (p-many:) macro needs to be given string patterns, not just min and max numbers.")},[n(r(t,String,b,h))])(["p-ins","pattern-ins","p-insensitive","pattern-insensitive"],"Datatype",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return k({name:"p-ins",fullArgs:n,insensitive:!0})},o)(["split","splitted"],"Array",function(e,t,n){if(t=k({name:"split",fullArgs:[t],canContainTypedVars:!1}),v.containsError(t))return t;if(!n)return[""];if(!t.regExp)return _toConsumableArray(n);for(var r,a=RegExp(t.regExp),o=[];n&&(r=a.exec(n));){if(r.index+r[0].length===0)return o;o.push(n.slice(0,r.index)),n=n.slice(r.index+r[0].length)}return o.concat(n||[])},[r(String,b),String])("trimmed","String",function(e,t,n){return void 0===n||b.isPrototypeOf(t)&&"whitespace"===t.name?t.trim():(t=k({name:"trimmed",fullArgs:[t],canContainTypedVars:!1}),v.containsError(t)?t:t.regExp?n.replace(RegExp("^("+t.regExp+")*|("+t.regExp+")*$","g"),""):n)},[r(String,b),a(String)])(["str-find","string-find"],"String",function(e,t,n){if(t=k({name:"str-find",fullArgs:[t],canContainTypedGlobals:!1}),v.containsError(t))return t;for(var r,a=t.typedVars(),o=RegExp(t.regExp,"g"),i=[],s=o.lastIndex;(r=o.exec(n))&&s!==o.lastIndex;)if(s=o.lastIndex,a.length){for(var c=new Map,l=0;l<a.length;l+=1){if("match"===a[l].varRef.getName())return v.create("macrocall","There was a typed temp variable named _match in the pattern given to (str-find:)","The variable _match is reserved, and can't be used inside (str-find:)'s pattern.");c.set(a[l].varRef.getName(),r[l+1]),c.set("match",r[0])}i.push(c)}else i.push(r[0]);return i},[b,String])(["str-replaced","string-replaced","replaced"],"String",function(e,t,n,r,a){if("number"!=typeof t){if(void 0!==a)return v.create("macrocall","1 too many values were given to (str-replaced:).","If this is given 5 values, the first value must be a number of replacements.");a=r,r=n,n=t,t=1/0}else if(void 0===a)return v.create("macrocall","The (str-replaced:) macro needs 1 more value.","The final string seems to be missing.");if(b.isPrototypeOf(r))return v.create("datatype","The replacement value for (str-replaced:) must be a string or lambda, not ".concat(O(r)));if(y.isPrototypeOf(a)||y.isPrototypeOf(n))return v.create("datatype","The ".concat(y.isPrototypeOf(a)?"final string":"search pattern"," given to (str-replaced:) can't be a lambda."),"Only the replacement value (after the search pattern) can be a 'via' lambda.");if(n=k({name:"str-replaced",fullArgs:[n],canContainTypedGlobals:!1}),v.containsError(n))return n;if(!n.regExp)return a;for(var o,i=RegExp(n.regExp,"g"),s=y.isPrototypeOf(r)?n.typedVars():[],c=1,l=0,u="",p=i.lastIndex;a&&(o=i.exec(a))&&0<t&&p!==i.lastIndex;){for(var p=i.lastIndex,d=Object.create(e.stack.length?e.stackTop.tempVariables:w),f=0;f<s.length;f+=1){var h=s[f],m=h.varRef.create(d,h.varRef.propertyChain);if(v.containsError(m))return m;h=m.defineType(h.datatype);if(v.containsError(h))return h;m.set(o[f+1])}var g=y.isPrototypeOf(r)?r.apply(e,{loop:o[0],pos:c,tempVariables:d}):r;if(v.containsError(g))return g;if("string"!=typeof g)return v.create("datatype","(str-replaced:)'s lambda must produce a string, but it produced ".concat(O(g),' when given "').concat(o[0],'".'));u+=a.slice(l,o.index)+g,c+=1,--t,l=o.index+o[0].length}return u+=a.slice(l)},[r(t,String,b),r(b,String,y.TypeSignature("via")),r(String,y.TypeSignature("via")),a(String)])}),define("macrolib/stylechangers",["jquery","macros","utils","utils/renderutils","datatypes/colour","datatypes/hookset","datatypes/gradient","datatypes/changercommand","datatypes/lambda","internaltypes/changedescriptor","internaltypes/twineerror"],function(s,e,c,t,a,n,r,o,i,l,u){var p,d,f=t.geomParse,h=t.geomStringRegExp,m=Object.assign,t=e.TypeSignature,g=t.either,y=t.wrapped,b=t.optional,v=t.Any,w=t.Everything,k=t.zeroOrMore,S=t.rest,T=t.insensitiveSet,_=t.positiveNumber,x=t.positiveInteger,O=t.nonNegativeNumber,t=t.percent,y=[y(Boolean,'If you gave a number, you may instead want to check that the number is not 0. If you gave a string, you may instead want to check that the string is not "".')],A=(c.onStartup(function(){return c.storyElement.on("mouseenter.hover-macro","[hover=false]",function(){var e=s(this),t=e.data("hoverChanger");c.options.debug&&c.options.ignoreClickEvents&&!e.is("tw-backdrop.eval-replay *, tw-backdrop.harlowe-crash *")||(e.data({mouseoutStyle:e.attr("style")||""}),l.create({target:e},t).update(),e.attr("hover",!0))}).on("mouseleave.hover-macro","[hover=true]",function(){var e=s(this),t=e.data("mouseoutStyle");e.attr("style",t).removeData("mouseoutStyle").attr("hover",!1)})}),u.on(function(){s("tw-expression, tw-hook",c.storyElement).each(function(e,t){((t=s(t)).data("errorEvent")||Object)(t)})}),T("instant","dissolve","fade","rumble","shudder","pulse","zoom","flicker","slideleft","slideright","slideup","slidedown","fadeleft","faderight","fadeup","fadedown","blur")),C=T("dotted","dashed","solid","double","groove","ridge","inset","outset","none");e.addChanger("if",function(e,t){return o.create("if",[t])},function(e,t){return e.enabled=e.enabled&&t},y)("unless",function(e,t){return o.create("unless",[t])},function(e,t){return e.enabled=e.enabled&&!t},y)("elseif",function(e,t){return"lastHookShown"in e.stack[0]?o.create("elseif",[!1===e.stack[0].lastHookShown&&!!t]):u.create("macrocall","There's no (if:) or something else before this to do (else-if:) with.")},function(e,t){return e.enabled=e.enabled&&t},y)("else",function(e){return"lastHookShown"in e.stack[0]?o.create("else",[!1===e.stack[0].lastHookShown]):u.create("macrocall","There's nothing before this to do (else:) with.")},function(e,t){return e.enabled=e.enabled&&t},null)("hidden",function(){return o.create("hidden")},function(e){return e.enabled=!1},null)(["verbatim","v6m"],function(){return o.create("verbatim")},function(e){return e.verbatim=!0},null)("live",function(e,t){return o.create("live",t?[t]:[])},function(e,t){e.enabled=!1,e.transitionDeferred=!0,e.data.live={delay:t}},b(Number))("event",function(e,t){return o.create("event",[t])},function(e,t){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:t}},i.TypeSignature("when"))("more",function(){return o.create("more")},function(e){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:{when:!0,filter:function(e){return 0!==e.Identifiers.exits?[]:[!0]}}}},null)("after",function(e,t,n){return o.create("after",[t].concat(void 0!==n?[n]:[]))},function(e,t,n){e.enabled=!1,e.transitionDeferred=!0,e.data.live={event:{when:!0,filter:function(e){return c.anyInputDown()&&n&&(t-=n),e.Identifiers.time>t?[!0]:[]}}}},[_,b(O)])("after-error",function(){return o.create("after-error",[])},function(n){n.enabled=!1,n.transitionDeferred=!0;var r=n.section.stackTop.tempVariables;n.data.errorEvent=function(e){e.removeData("errorEvent");var t=_objectSpread(_objectSpread({},n),{},{enabled:!0,transitionDeferred:!1});t.data&&(t.data.errorEvent=void 0),n.section.whenUnblocked(function(){return n.section.renderInto("",null,t,r)})}},[])("hook",function(e,t){var n;return t?(n=c.insensitiveName(t))?o.create("hook",[n]):u.create("datatype",'The string given to (hook:), "'.concat(t,'", contained only dashes and underscores.')):u.create("datatype","The string given to (hook:) was empty.")},function(e,t){return e.attr.push({name:t})},[String])(["for","loop"],function(e,t){if(!t.loop)return u.create("datatype","The lambda provided to (for:) must refer to a temp variable, not just 'it'.");for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return o.create("for",[t].concat(r))},function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];var o,i=t.filter(e.section,r);if(o=u.containsError(i))return o;e.loopVars[t.loop.getName()]=i||[]},[i.TypeSignature("where"),k(v)])(["transition","t8n"],function(e,t){return o.create("transition",[c.insensitiveName(t)])},function(e,t){return"zoom"===(e.transition=t)&&(e.transitionOrigin=function(){var e=s(this).offset(),t=e.left,e=e.top;return c.mouseCoords.x-t+"px "+(c.mouseCoords.y-e)+"px"}),e},[A])(["transition-time","t8n-time"],function(e,t){return o.create("transition-time",[t])},function(e,t){return e.transitionTime=t,e.data.passageT8n=m(e.data.passageT8n||{},{time:t}),e},[_])(["transition-delay","t8n-delay"],function(e,t){return o.create("transition-delay",[t])},function(e,t){return e.transitionDelay=t,e},[O])(["transition-skip","t8n-skip"],function(e,t){return o.create("transition-skip",[t])},function(e,t){return e.transitionSkip=t,e},[_])(["transition-depart","t8n-depart"],function(e,t){return o.create("transition-depart",[c.insensitiveName(t)])},function(e,t){return e.data.passageT8n=m(e.data.passageT8n||{},{depart:t}),"zoom"===t&&(e.data.passageT8n.departOrigin=function(){var e=s(this).offset(),t=e.left,e=e.top;return c.mouseCoords.x-t+"px "+(c.mouseCoords.y-e)+"px"}),e},[A])(["transition-arrive","t8n-arrive"],function(e,t){return o.create("transition-arrive",[c.insensitiveName(t)])},function(e,t){return e.data.passageT8n=m(e.data.passageT8n||{},{arrive:t}),"zoom"===t&&(e.data.passageT8n.arriveOrigin=function(){var e=s(this),t=e.offset(),n=t.left,t=t.top,r=e.height();return{"transform-origin":100*(c.mouseCoords.x-n)/e.width()+"% "+100*(c.mouseCoords.y-t)/r+"%",height:r+"px"}}),e},[A])("button",function(e,t){return void 0===t||f(t).size?o.create("button",t?[t]:[]):u.create("datatype",'The string given to (button:) should be a sizing line ("==X==", "==X", "=XXXX=" etc.), not '.concat(JSON.stringify(t),"."))},function(e,t){var t=f(t),n=t.marginLeft,t=t.size;return e.attr.push({class:function(){return this.className+(this.classList.contains("enchantment-button")?"":" ".repeat(0<this.className.length)+"enchantment-button")}}),e.styles.push({"margin-left":t?n+"%":void 0,width:t?t+"%":"100%"}),e},[b(String)]).apply(void 0,_toConsumableArray((d={click:{className:"enchantment-link",blockClassName:"enchantment-clickblock"},doubleclick:{className:"enchantment-dblclick",blockClassName:"enchantment-dblclickblock"},mouseover:{className:"enchantment-mouseover",blockClassName:"enchantment-mouseoverblock"},mouseout:{className:"enchantment-mouseout",blockClassName:"enchantment-mouseoutblock"}},["action",function(e,t){return o.create("action",[c.insensitiveName(t)])},function(e,t){return e.attr.push({class:function(){var e=function e(t){return(t=s(t)).is("tw-story, tw-sidebar, tw-passage")||["block","flex"].includes(t.css("display"))||t.children().get().some(e)}(this);return Array.from(this.classList).filter(function(t){return!Object.keys(d).some(function(e){return d[e].className===t||d[e].blockClassName===t})}).concat(d[t][e?"blockClassName":"className"]).join(" ")}}),e},[T.apply(void 0,_toConsumableArray(Object.keys(d)))]])))(["border","b4r"],function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("border",n.map(c.insensitiveName))},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({display:function(){var e=s(this).css("display");return n.every(function(e){return"none"===e})||!e.includes("inline")?e:"inline-block"},"border-style":n.join(" "),"border-width":function(){return this.style.borderWidth||"2px"}}),e},[C].concat(_toConsumableArray(Array(3).fill(b(C)))))(["border-size","b4r-size"],function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("border-size",n)},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-width":n.map(function(e){return e+"px"}).join(" ")}),e},[O].concat(_toConsumableArray(Array(3).fill(b(O)))))("corner-radius",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("corner-radius",n)},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-radius":n.map(function(e){return e+"px"}).join(" "),padding:function(){return this.style.padding||n.map(function(e){return e+"px"}).join(" ")}}),e},[O].concat(_toConsumableArray(Array(3).fill(b(O)))))(["border-colour","b4r-colour","border-color","b4r-color"],function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("border-colour",n.map(function(e){return a.isPrototypeOf(e)?e.toRGBAString(e):e}))},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.styles.push({"border-color":n.join(" ")}),e},[g(String,a)].concat(_toConsumableArray(Array(3).fill(b(g(String,a))))))("opacity",function(e,t){return o.create("opacity",[t])},function(e,t){return e.styles.push({opacity:t})},[t])("font",function(e,t){return o.create("font",[t])},function(e,t){return e.styles.push({"font-family":t}),e},[String])("align",function(e,t){var n=t.indexOf("><");return/^(==+>|<=+|=+><=+|<==+>)$/.test(t)?((n=~n?_objectSpread({"text-align":"center","max-width":"50%"},25===(n=Math.round(n/(t.length-2)*50))?{"margin-left":"auto","margin-right":"auto"}:{"margin-left":n+"%"}):"<"===t[0]&&">"===t.slice(-1)?{"text-align":"justify","max-width":"50%"}:t.includes(">")?{"text-align":"right"}:{"text-align":"left"}).display="block",o.create("align",[n])):u.create("datatype",'The (align:) macro requires an alignment arrow ("==>", "<==", "==><=" etc.) be provided, not "'+t+'"')},function(e,t){e.styles.push(t)},[String])(["text-colour","text-color","color","colour"],function(e,t){return o.create("text-colour",[t])},function(e,t){return a.isPrototypeOf(t)&&(t=t.toRGBAString(t)),e.styles.push({color:t}),e},[g(String,a)])(["text-size","size"],function(e,t){return o.create("text-size",[t])},function(e,t){return e.styles.push({"font-size":24*t+"px","line-height":36*t+"px"}),e},[O])("text-indent",function(e,t){return o.create("text-indent",[t])},function(e,t){return e.styles.push({"text-indent":t+"px",display:"inline-block"}),e},[O])(["text-rotate-z","text-rotate"],function(e,t){return o.create("text-rotate-z",[t])},function(e,t){return e.styles.push({display:"inline-block",transform:function(){var e=s(this).css("transform")||"";return(e="none"===e?"":e)+" rotate("+t+"deg)"}}),e},[Number])("text-rotate-y",function(e,t){return o.create("text-rotate-y",[t])},function(e,t){return e.styles.push({display:"inline-block",transform:function(){var e=s(this).css("transform")||"";return(e="none"===e?"":e)+" perspective(50vw) rotateY("+t+"deg)"}}),e},[Number])("text-rotate-x",function(e,t){return o.create("text-rotate-x",[t])},function(e,t){return e.styles.push({display:"inline-block",transform:function(){var e=s(this).css("transform")||"";return(e="none"===e?"":e)+" perspective(50vw) rotateX("+t+"deg)"}}),e},[Number])(["background","bg"],function(e,t){return o.create("background",[t])},function(e,t){return a.isPrototypeOf(t)?t=t.toRGBAString():r.isPrototypeOf(t)&&(t=t.toLinearGradientString()),t=a.isHexString(t)||a.isCSS3Function(t)?{"background-color":t}:t.startsWith("linear-gradient(")||t.startsWith("repeating-linear-gradient(")?{"background-image":t}:{"background-size":"cover","background-image":"url(".concat(t,")"),"background-attachment":"fixed"},e.styles.push(t,{display:function(){var e=s(this);return!e.children().length||c.childrenProbablyInline(e)?s(this).css("display"):"block"}}),e},[g(String,a,r)]).apply(void 0,_toConsumableArray((y={color:function(){return"transparent"}},p=m(Object.create(null),{none:{},bold:{"font-weight":"bold"},italic:{"font-style":"italic"},underline:{"text-decoration":"underline"},doubleunderline:{"text-decoration":"underline","text-decoration-style":"double"},wavyunderline:{"text-decoration":"underline","text-decoration-style":"wavy"},strike:{"text-decoration":"line-through"},doublestrike:{"text-decoration":"line-through","text-decoration-style":"double"},wavystrike:{"text-decoration":"line-through","text-decoration-style":"wavy"},superscript:{"vertical-align":"super","font-size":".83em"},subscript:{"vertical-align":"sub","font-size":".83em"},blink:{animation:"fade-in-out 1s steps(1,end) infinite alternate"},shudder:{animation:"shudder linear 0.1s 0s infinite"},mark:{"background-color":"hsla(60, 100%, 50%, 0.6)"},condense:{"letter-spacing":"-0.08em"},expand:{"letter-spacing":"0.1em"},outline:[{"text-shadow":function(){var e=s(this).css("color");return"-1px -1px 0 "+e+", 1px -1px 0 "+e+",-1px  1px 0 "+e+", 1px  1px 0 "+e}},{color:function(){return c.parentColours(s(this)).backgroundColour}}],shadow:{"text-shadow":function(){return"0.08em 0.08em 0.08em "+s(this).css("color")}},emboss:{"text-shadow":function(){return"0.04em 0.04em 0em "+s(this).css("color")}},smear:[{"text-shadow":function(){var e=s(this).css("color");return"0em   0em 0.02em "+e+",-0.2em 0em  0.5em "+e+", 0.2em 0em  0.5em "+e}},y],blur:[{"text-shadow":function(){return"0em 0em 0.08em "+s(this).css("color")}},y],blurrier:[{"text-shadow":function(){return"0em 0em 0.2em "+s(this).css("color")},"user-select":"none"},y],mirror:{display:"inline-block",transform:"scaleX(-1)"},upsidedown:{display:"inline-block",transform:"scaleY(-1)"},tall:{display:"inline-block",transform:"scaleY(1.5) translateY(-0.25ex)"},flat:{display:"inline-block",transform:"scaleY(0.5) translateY(0.25ex)"},fadeinout:{animation:"fade-in-out 2s ease-in-out infinite alternate"},rumble:{animation:"rumble linear 0.1s 0s infinite"},sway:{animation:"sway linear 2.5s 0s infinite"},buoy:{animation:"buoy linear 2.5s 0s infinite"},fidget:{animation:function(){return"fidget step-end 60s "+60*-Math.random()+"s infinite"+(Math.random()<.5?" reverse":"")}}}),["text-style",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return o.create("text-style",n.map(c.insensitiveName))},function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0;a<n.length;a+=1)"none"===n[a]?e.styles=[]:e.styles=e.styles.concat(p[n[a]]);return e},[S(T.apply(void 0,_toConsumableArray(Object.keys(p))))]])))("collapse",function(){return o.create("collapse")},function(e){return e.attr.push({collapsing:!0}),e},[])("hover-style",function(e,t){var n=l.create(),r=(t.run(n),n.summary());return r+""=="styles"||r.every(function(e){return"styles"===e||"attr"===e})&&n.attr.every(function(e){return Object.keys(e)+""=="style"})?o.create("hover-style",[t]):u.create("datatype","The changer given to (hover-style:) must only change the hook's style.")},function(e,t){return e.data.hoverChanger=t,e.attr.push({hover:function(e,t){return void 0!==t&&t}}),e},[o])("css",function(e,t){return t.trim().endsWith(";")||(t+=";"),o.create("css",[t])},function(e,t){return e.attr.push({style:function(){return(s(this).attr("style")||"")+t}}),e},[String])("test-true",function(){return o.create("test-true",[])},function(e){return e.enabled=!0},k(w))("test-false",function(){return o.create("test-false",[])},function(e){return e.enabled=!1},k(w)),e.addCommand("animate",s.noop,function(r,e,t,a,o){t.forEach(e,function(e){var t,n;"zoom"===name&&(n=(t=e.offset()).left,t=t.top,n=c.mouseCoords.x-n+"px "+(c.mouseCoords.y-t)+"px"),c.transitionIn(e,a,r.transitionTime||o,r.transitionDelay,r.transitionSkip,0,n)})},[S(n),T.apply(void 0,_toConsumableArray(A.innerType.filter(function(e){return"instant"!==e}))),b(_)]),["box","float-box"].forEach(function(i){return e.addChanger(i,function(e,t,n){var r=-1===t.search(h)||1<t.length&&!t.includes("="),a="float-box"===i&&(-1===n.search(h)||1<n.length&&!n.includes("="));return r||a?u.create("datatype","The ("+i+':) macro requires a sizing line("==X==", "==X", "=XXXX=" etc.) be provided, not "'+(r?t:n)+'".'):o.create(i,[t,n].filter(function(e){return void 0!==e}))},function(e,t,n){var r,t=f(t),a=t.marginLeft,t=t.size,o=("float-box"===i&&(r=(o=f(n)).marginLeft,n=o.size),"box"===i?"%":"vw"),t=_defineProperty(_defineProperty(_defineProperty({display:"block",width:t+o,"max-width":t+o},"box"===i?"margin-left":"left",a+o),"overflow-y","auto"),"padding",function(){var e=s(this).css("padding");return e&&"0px"!==e?e:"1em"});return void 0!==n&&(t.height="box"===i?1.5*n+2+"em":n+"vh"),"float-box"===i&&m(t,{position:"fixed",top:r+"vh","background-color":function(){return c.parentColours(s(this)).backgroundColour}}),e.styles.push(t),e},[String,"box"===i?b(x):String])})}),define("macrolib/values",["macros","state","utils","utils/operationutils","datatypes/colour","datatypes/gradient","datatypes/datatype","datatypes/hookset","datatypes/codehook","internaltypes/twineerror"],function(t,r,e,n,l,c,a,o,i,f){var s=e.realWhitespace,u=e.nth,p=e.anyRealLetter,d=e.plural,h=n.subset,m=n.objectName,g=n.clone,y=n.toSource,e=t.TypeSignature,n=e.rest,b=e.zeroOrMore,v=e.either,w=e.optional,k=e.insensitiveSet,S=e.numberRange,T=e.percent,_=e.nonNegativeInteger,x=e.positiveInteger,e=e.Any,O=Math.max,A=Math.min,C=Math.round,E=Math.floor,N=Math.ceil;function j(t){return function(){var e=t.apply(void 0,arguments);return"number"!=typeof e||isNaN(e)?f.create("macrocall","This mathematical expression doesn't compute!"):e}}t.add(["str","string","text"],"String",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.map(function(e){return i.isPrototypeOf(e)?e.source:e}).join("")},[b(t.TypeSignature.either(String,Number,Boolean,Array,i))])("source","String",function(e,t){return"command"!==(null==t?void 0:t.TwineScript_TypeID)||t.TwineScript_ToSource?y(t):f.create("datatype","I can't construct the source code of a command created by a custom macro.")},[e])("substring","String",function(e,t,n,r){return h(t,n,r)},[String,parseInt,parseInt])("lowercase","String",function(e,t){return t.toLowerCase()},[String])("uppercase","String",function(e,t){return t.toUpperCase()},[String])("lowerfirst","String",function(e,t){return t.replace(RegExp(p+"+"),function(e){return(e=Array.from(e))[0].toLowerCase()+e.slice(1).join("").toLowerCase()})},[String])("upperfirst","String",function(e,t){return t.replace(RegExp(p+"+"),function(e){return(e=Array.from(e))[0].toUpperCase()+e.slice(1).join("").toLowerCase()})},[String])("words","Array",function(e,t){return t.split(RegExp(s+"+")).filter(Boolean)},[String])(["str-repeated","string-repeated"],"String",function(e,t,n){return 0===n.length?f.create("macrocall","I can't repeat an empty string."):n.repeat(t)},[_,String])(["str-reversed","string-reversed"],"String",function(e,t){return _toConsumableArray(t).reverse().join("")},[String])("joined","String",function(e,t){for(var n=arguments.length,r=new Array(2<n?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return r.join(t)},[n(String)])("plural","String",function(e,t,n,r){return n&&""!==r?d(t,n,r):f.create("macrocall","The (plural:) macro can't be given empty strings.")},[parseInt,String,w(String)])(["str-nth","string-nth"],"String",function(e,t){return u(t)},[parseInt])("digit-format","String",function(e,t,n){if(1e21<=Math.abs(n))return f.create("macrocall","The number given to (digit-format:) is too big.");for(var r=/([^#0])(?=[#0]*$)/g,a=(r.exec(t)||[])[1],o=(/^[#0]*([^#0])/g.exec(t)||[])[1],i=(t=_toConsumableArray(t)).length,s=(a&&(","!==a||o&&","!==o)&&(i=r.lastIndex-1),Math.abs(n).toFixed(16).replace(/(\.\d*?)0+$/,function(e,t){return t}).replace(/^0+/,"")),c=s.includes(".")?s.indexOf("."):s.length,l=0,u="",p=t.length-1;0<=p;--p){var d=t[p];"0"===d||"#"===d?u=(s[c-i+p+l]||("0"===d?"0":""))+u:p<t.length-1&&0<p&&(u=d+u,l+=p===i?0:1)}return(n<0?"-":"")+u},[String,Number])(["num","number"],"Number",function(e,t){return Number.isNaN(+t)?f.create("macrocall","I couldn't convert "+m(t)+" to a number."):+t},[String])("datatype","Datatype",function(e,t){return a.from(t)},[e])("datapattern","Any",function(e,t){return function n(e){var r;return Array.isArray(e)?r=e.map(n):e instanceof Map?(r=new Map,_toConsumableArray(e).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];return r.set(t,n(e))})):r=a.from(e),(e=f.containsError(r))||r}(t)},[e])(["rgb","rgba"],"Colour",function(e){return l.create({r:arguments.length<=1?void 0:arguments[1],g:arguments.length<=2?void 0:arguments[2],b:arguments.length<=3?void 0:arguments[3],a:arguments.length<=4?void 0:arguments[4]})},[S(0,255),S(0,255),S(0,255),w(T)])(["hsl","hsla"],"Colour",function(e,t,n,r,a){return(t=C(t)%360)<0&&(t+=360),l.create({h:t,s:n,l:r,a:a})},[Number,T,T,w(T)])(["lch","lcha"],"Colour",function(e,t,n,r,a){return(r=C(r)%360)<0&&(r+=360),l.create({l:t,c:n,h:r,a:a})},[T,S(0,132),Number,w(T)])("complement","Colour",function(e,t){return t.LCHRotate(180)},[l])("mix","Colour",function(e,t,n,r,a){n=n.toLCHA(),a=a.toLCHA();var o=1,i=(t+r!==1&&(t+r<1&&(o=t+r),t=(i=[t/(t+r),r/(t+r)])[0],r=i[1]),n.c<2||n.l<.01||.99<n.l?n.h=a.h:(a.c<2||a.l<.01||.99<a.l)&&(a.h=n.h),n.l*=n.a,n.c*=n.a,a.l*=a.a,a.c*=a.a,180<a.h-n.h?n.h+=360:a.h-n.h<-180&&(a.h+=360),n.a*t+a.a*r),s=(n.l*t+a.l*r)/i,c=(n.c*t+a.c*r)/i,n=(n.h*t+a.h*r)/i;return l.create({l:s,c:c,h:n,a:i*o})},[T,l,T,l])("palette","Array",function(e,t,n){var r,a=n.toLCHA(),o=a.l,a={l:o<=.75?.75+o/3:.75-3*(1-o),c:80,h:a.h,a:1},i=l.create(a);return a.l+=o<=.75?-.1:.1,a.l<.5&&(a.l*=.5/a.l),r=l.create(a),a.l+=o<=.85?.15:-.15,o=l.create(a),"adjacent"===t?(r=(i=i.LCHRotate(-30)).LCHRotate(30),o=i.LCHRotate(60)):"triad"===t&&(o=i.LCHRotate(180),r=i.LCHRotate(140),i=i.LCHRotate(-140)),[n,i,r,o]},[k("mono","adjacent","triad"),l])("gradient","Gradient",function(e,t){(t=C(t)%360)<0&&(t+=360);for(var n,r,a,o=arguments.length,i=new Array(2<o?o-2:0),s=2;s<o;s++)i[s-2]=arguments[s];return i.length<4?f.create("datatype","(gradient:) must be given at least 2 colour-stop pairs of numbers and colours."):(r=[],a=i.reduce(function(e,t){if(!f.containsError(e))if(void 0===n)n=t;else{if("number"!=typeof n||!l.isPrototypeOf(t))return f.create("datatype","(gradient:) colour-stops should be pairs of numbers and colours, not colours and numbers.");r.push({stop:n,colour:g(t)}),n=void 0}return e},!0),f.containsError(a)?a:void 0!==n?f.create("macrocall","This gradient has a colour-stop percent without a colour."):c.create(t,r))},[Number,n(v(T,l))])("stripes","Gradient",function(e,t,n){(t=C(t)%360)<0&&(t+=360);for(var r=0,a=[],o=arguments.length,i=new Array(3<o?o-3:0),s=3;s<o;s++)i[s-3]=arguments[s];return i.forEach(function(e){a.push({stop:r,colour:g(e)}),r+=n,a.push({stop:r,colour:g(e)})}),c.create(t,a,!0)},[Number,x,l,n(l)])("hooks-named","HookName",function(e,t){return t?o.create({type:"name",data:t}):f.create("datatype","(hooks-named:) can't be given an empty string.")},[String])("cond","Any",function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0;a<n.length;a+=2){var o=n[a];if(a===n.length-1||f.containsError(o))return o;if("boolean"!=typeof o)return f.create("datatype","(cond:)'s "+u(a+1)+" value is "+m(o)+", but should be a boolean.");if(o)return n[a+1]}return f.create("macrocall","An odd number of values must be given to (cond:), not "+n.length,"(cond:) must be given one or more pairs of booleans and values, as well as one final value.")},[Boolean,e,n(e)]);({weekday:[function(){return["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur"][(new Date).getDay()]+"day"},null],monthday:[function(){return(new Date).getDate()},null],currenttime:[function(){var e=new Date,t=e.getHours()<12;return(e.getHours()%12||12)+":"+((e.getMinutes()<10?"0":"")+e.getMinutes())+" "+(t?"A":"P")+"M"},null],currentdate:[function(){return(new Date).toDateString()},null],min:[A,n(Number)],max:[O,n(Number)],abs:[Math.abs,Number],sign:[Math.sign,Number],sin:[Math.sin,Number],cos:[Math.cos,Number],tan:[Math.tan,Number],floor:[E,Number],round:[C,Number],trunc:[function(e){return(0<e?E:N)(e)},Number],ceil:[N,Number],pow:[j(Math.pow),[Number,Number]],exp:[Math.exp,Number],sqrt:[j(Math.sqrt),Number],log:[j(Math.log),Number],log10:[j(Math.log10),Number],log2:[j(Math.log2),Number],random:[function(e,t){var n,t=t?(n=A(e,t),O(e,t)):(n=0,e);return t+=1,~~(r.random()*(t-n))+n},[parseInt,t.TypeSignature.optional(parseInt)]],"":function(){for(var e in this)e&&hasOwnProperty.call(this,e)&&t.add(e,"Number",function(a){return function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return a.apply(void 0,n)}}(this[e][0]),this[e][1])}})[""](),t.add("either","Any",function(e){var t=1+~~(r.random()*(arguments.length<=1?0:arguments.length-1));return t<1||arguments.length<=t?void 0:arguments[t]},n(e))("nth","Any",function(e,t){return t<=0?f.create("datatype","(nth:)'s first value should be a positive whole number, not "+t):(t=(t-1)%(arguments.length<=2?0:arguments.length-2)+2)<2||arguments.length<=t?void 0:arguments[t]},[parseInt,n(e)])}),!function(){var a,k={};function o(e){for(var t in e)this[t]=e[t]}function i(e,t){for(var n,r,a=e.innerText,o=null,i=0,s=i,c=a.length,l=null;i<c;){for(var u=a.slice(i),p=(o&&o.length?o[0]:e).innerMode,d=0,f=p.length;d<f;d+=1){var h=k[p[d]];if(!(h.constraint&&!h.constraint(l)||h.cannotFollowText&&("text"===(null==(w=l)?void 0:w.type)||s<i))&&(h.plainCompare?u.startsWith(h.pattern):h.pattern.test(u))){var m=h.fn(h.plainCompare?h.pattern:h.pattern.exec(u)),g=!1,y=0;if(m.matches){for(;o&&y<o.length;y+=1){var b=o[y],v=b.type,b=b.aka;if(v in m.matches){g=!0;break}b&&(v=b),-1<(null==(b=m.cannotCross)?void 0:b.indexOf(v))&&(y=o.length-1)}if((!o||y>=o.length)&&!m.isFront)continue}s<i&&e.addChild({type:"text",text:a.slice(s,i),innerMode:p});var s=i+=(l=e.addChild(m)).text.length,w=!1;g&&(t&&S(e,l,o[y]),o=o.slice(y+1),w=!0),!w&&l.isFront&&(o?o.unshift(l):o=[l]);break}}d===f&&(i+=1,null===l)&&(l={type:"text"})}for(s<i&&e.addChild({type:"text",text:a.slice(s,i),innerMode:(null!=(n=o)&&n.length?o[0]:e).innerMode});0<(null==(r=o)?void 0:r.length);)o.shift().demote();return e}function S(e,t,n){var r=e.children.indexOf(t),a=e.children.indexOf(n);t.children=e.children.splice(a+1,r-(a+1)),t.type=t.matches[n.type],t.innerText="";for(var o,i=0,s=t.children.length;i<s;i++)t.innerText+=t.children[i].text;for(o in t.start=n.start,t.text=n.text+t.innerText+t.text,n)hasOwnProperty.call(n,o)&&!hasOwnProperty.call(t,o)&&(t[o]=n[o]);t.isFront&&(t.isFront=!1),e.children.splice(a,1)}o.prototype={constructor:o,addChild:function(e){var t=this.lastChildEnd(),n=new o(e);return n.start=t,n.end=e.text&&t+e.text.length,n.place=this.place,n.children=[],n.innerText&&i(n),this.children.push(n),n},lastChildEnd:function(){var e=this.children&&this.children[this.children.length-1]||null;return e?e.end:this.start+Math.max(0,this.text.indexOf(this.innerText))},tokenAt:function(e){if(e<this.start||e>=this.end)return null;if(this.children.length)for(var t=0;t<this.children.length;t+=1)if(e>=this.children[t].start&&e<this.children[t].end){var n=this.children[t].tokenAt(e);if(n)return n}return this},pathAt:function(e){if(e<this.start||e>=this.end)return[];var t=[];if(this.children.length)for(var n=0;n<this.children.length;n+=1)if(e>=this.children[n].start&&e<this.children[n].end){var r=this.children[n].pathAt(e);if(r.length){t=t.concat(r);break}}return t.concat(this)},nearestTokenAt:function(n){return n<this.start||n>=this.end?null:this.children?this.children.reduce(function(e,t){return e||(n>=t.start&&n<t.end?t:null)},null):this},everyLeaf:function(n){return this.children&&0!==this.children.length?this.children.reduce(function(e,t){return e&&t.everyLeaf(n)},!0):!!n(this)},demote:function(){this.type="text"},error:function(e){this.type="error",this.message=e},toString:function(){var e=this.type+"("+this.start+"\u2192"+this.end+")";return this.children&&0<this.children.length&&(e+="["+this.children+"]"),e},copy:function(){var e=new o(this);return e.children=e.children.slice(),e},foldChildren:function(){for(var e=[],t=this.children.slice(),n=0;n<t.length;n+=1){var r=t[n],a=!1;if(r.matches)for(var o=0;o<e.length;o+=1)e[o].type in r.matches&&(S(this,r,e[o]),e=e.slice(o+1),a=!0);!a&&r.isFront&&e.unshift(r)}}},a={lex:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"start",r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return i(new o({type:"root",place:t,start:0,end:e.length,text:e,innerText:e,children:[],innerMode:a.modes[n]}),!r)},rules:k,modes:{}},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=a:"function"==typeof define&&define.amd?define("lexer",[],function(){return a}):this&&null!=this&&this.loaded?(this.modules||(this.modules={}),this.modules.Lexer=a):this.Lexer=a}.call(eval("this")||("undefined"!=typeof global?global:window)),!function(){Object.assign=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var m,g=Object.keys,y=Object.assign;function t(e){function t(n){return n=n||"innerText",function(e){var e=e.reduceRight(function(e,t,n){return e||(n?t:"")},""),t={};return t[n]=e,t}}function n(e,t){var n={};return n[e]=t,function(){return{isFront:!0,matches:n,cannotCross:["verbatimOpener"]}}}var r=Object.bind(0,null);function a(a,e){return Object.keys(e).forEach(function(n){var r=e[n].fn;e[n].fn=function(e){var t=r(e);return t.text||(t.text="string"==typeof e?e:e[0]),t.type||(t.type=n),t.innerMode||(t.innerMode=a),t}}),e}function o(e){switch(e&&e.type){case null:case"br":case"hr":case"bulleted":case"numbered":case"heading":case"align":case"column":case"escapedLine":return!0}return!1}var i=[],s=[],c=[],l=a(i,{hr:{fn:r},bulleted:{fn:function(e){return{depth:e[1].length}}},numbered:{fn:function(e){return{depth:e[1].length/2}}},heading:{fn:function(e){return{depth:e[1].length}}},align:{fn:function(e){var t,e=e[1],n=e.indexOf("><");return~n?25===(t=Math.round(n/(e.length-2)*50))&&(t="center"):"<"===e[0]&&">"===e.slice(-1)?t="justify":-1<e.indexOf(">")?t="right":-1<e.indexOf("<")&&(t="left"),{align:t}}},column:{fn:function(e){var t,e=e[1],n=e.indexOf("|");return n&&n<e.length-1?t="center":"|"===e[0]&&"|"===e.slice(-1)?t="none":n===e.length-1?t="right":n||(t="left"),{column:t,width:/\|+/.exec(e)[0].length,marginLeft:/^=*/.exec(e)[0].length,marginRight:/=*$/.exec(e)[0].length}}}}),u=(g(l).forEach(function(e){l[e].constraint=o,l[e].cannotFollowText=!0}),a(i,{twine1Macro:{fn:function(){return{type:"error",message:"Harlowe macros use a different syntax to Twine 1, SugarCube, and Yarn macros."}}},emBack:{fn:function(){return{matches:{emFront:"em"},cannotCross:["verbatimOpener"]}}},strongBack:{fn:function(){return{matches:{strongFront:"strong"},cannotCross:["verbatimOpener"]}}},strongFront:{fn:function(){return{isFront:!0}}},emFront:{fn:function(){return{isFront:!0}}},boldOpener:{fn:n("boldOpener","bold")},italicOpener:{fn:n("italicOpener","italic")},strikeOpener:{fn:n("strikeOpener","strike")},supOpener:{fn:n("supOpener","sup")},commentFront:{fn:function(){return{isFront:!0}}},commentBack:{fn:function(){return{matches:{commentFront:"comment"}}}},scriptStyleTag:{fn:r},tag:{fn:r},url:{fn:r},hookPrependedFront:{fn:function(e){return{name:e[1],hidden:")"===e[2],isFront:!0,tagPosition:"prepended"}}},hookFront:{fn:function(){return{isFront:!0}}},hookBack:{fn:function(){return{matches:{hookPrependedFront:"hook",hookFront:"hook"},cannotCross:["verbatimOpener"]}}},hookAppendedBack:{fn:function(e){return{name:e[2],hidden:"("===e[1],tagPosition:"appended",matches:{hookFront:"hook"},cannotCross:["verbatimOpener"]}}},unclosedHook:{fn:r},unclosedHookPrepended:{fn:function(e){return{type:"unclosedHook",name:e[1],hidden:")"===e[2]}}},verbatimOpener:{fn:function(e){var e=e[0].length,t={};return{type:(t["verbatim"+e]="verbatim")+e,isFront:!0,matches:t,aka:"verbatimOpener"}}},unclosedCollapsed:{fn:r},collapsedFront:{fn:function(){return{isFront:!0}}},collapsedBack:{fn:function(){return{matches:{collapsedFront:"collapsed"},cannotCross:["verbatimOpener"]}}},escapedLine:{fn:r},legacyLink:{fn:function(e){return{type:"twineLink",innerText:e[1],passage:e[2],innerMode:i}}},br:{fn:r}})),p=y(a(s,{macroFront:{fn:function(e){return{isFront:!0,name:e[1]}}},groupingBack:{fn:function(){return{matches:{groupingFront:"grouping",macroFront:"macro"},cannotCross:["singleStringOpener","doubleStringOpener","hookFront"]}}},passageLink:{fn:function(e){var t=e[1]||"",n=e[2]||"",e=e[3]||"";return{type:"twineLink",innerText:n?e:t,passage:t?e:n,innerMode:i}}},simpleLink:{fn:function(e){return{type:"twineLink",innerText:e[1]||"",passage:e[1]||"",innerMode:i}}},variable:{constraint:function(e){return!e||"macroFront"!==e.type},fn:t("name")},tempVariable:{constraint:function(e){return!e||"macroFront"!==e.type},fn:t("name")}}),{hookFront:u.hookFront,hookBack:u.hookBack}),d=a(s,_objectSpread(_objectSpread({commentBack:{fn:function(){return{matches:{commentFront:"comment"}}}},macroName:{constraint:function(e){return e&&"macroFront"===e.type},fn:t("name")},groupingFront:{fn:function(){return{isFront:!0}}},property:{fn:t("name"),constraint:function(e){if(e)switch(e.type){case"variable":case"hookName":case"property":case"tempVariable":case"colour":case"itsProperty":case"belongingItProperty":case"macro":case"grouping":case"string":case"datatype":case"hook":case"boolean":case"number":return!0}}},possessiveOperator:{fn:r},itsProperty:{cannotFollowText:!0,fn:t("name")},itsOperator:{cannotFollowText:!0,fn:r},belongingItProperty:{cannotFollowText:!0,fn:t("name")},belongingItOperator:{cannotFollowText:!0,fn:r},belongingProperty:{cannotFollowText:!0,fn:t("name")},belongingOperator:{cannotFollowText:!0,fn:r},escapedStringChar:{fn:function(){return{type:"text"}}},singleStringOpener:{fn:function(){return{isFront:!0,matches:{singleStringOpener:"string"},innerMode:c}}},doubleStringOpener:{fn:function(){return{isFront:!0,matches:{doubleStringOpener:"string"},innerMode:c}}},hookName:{fn:t("name")},cssTime:{fn:function(e){return{value:+e[1]*("s"===e[2].toLowerCase()?1e3:1)}}},datatype:{cannotFollowText:!0,fn:function(e){return{name:e[0].toLowerCase()}}},colour:{cannotFollowText:!0,fn:function(e){var e=e[0].toLowerCase(),t={red:"e61919",orange:"e68019",yellow:"e5e619",lime:"80e619",green:"19e619",cyan:"19e5e6",aqua:"19e5e6",blue:"197fe6",navy:"1919e6",purple:"7f19e6",fuchsia:"e619e5",magenta:"e619e5",white:"fff",black:"000",gray:"888",grey:"888"},t=hasOwnProperty.call(t,e)?"#"+t[e]:e;return{colour:t}}},number:{fn:function(e){return{value:parseFloat(e[0])}}},inequality:{fn:function(e){return{operator:e[2],negate:-1<e[1].indexOf("not")}}},augmentedAssign:{fn:function(e){return{operator:e[0][0]}}},identifier:{fn:t("name"),cannotFollowText:!0},whitespace:{fn:r,cannotFollowText:!0},incorrectOperator:{fn:function(e){var t={"=>":">=","=<":"<=",gte:">=",lte:"<=",gt:">",lt:"<",eq:"is",isnot:"is not",neq:"is not",isa:"is a",are:"is",x:"*","or a":"or"}[e[0].toLowerCase().replace(/\s+/g," ")];return{type:"error",message:"Please say "+(t?"'"+t+"'":"something else")+" instead of '"+e[0]+"'.",explanation:"In the interests of readability, I want certain operators to be in a specific form."}},cannotFollowText:!0}},["boolean","is","to","into","where","when","via","making","each","and","or","not","isNot","contains","doesNotContain","isIn","isA","isNotA","isNotIn","matches","doesNotMatch","bind"].reduce(function(e,t){return e[t]={fn:r,cannotFollowText:!0},e},{})),["comma","spread","typeSignature","addition","subtraction","multiplication","division"].reduce(function(e,t){return e[t]={fn:r},e},{}))),f=a(c,{singleStringCloser:d.singleStringOpener,doubleStringCloser:d.doubleStringOpener,escapedStringChar:d.escapedStringChar}),h=(i.push.apply(i,_toConsumableArray(g(l)).concat(_toConsumableArray(g(p)),_toConsumableArray(g(u)))),s.push.apply(s,_toConsumableArray(g(p)).concat(_toConsumableArray(g(d)))),c.push.apply(c,_toConsumableArray(g(f))),_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({},l),u),p),d),f)),u=(g(h).forEach(function(e){m.PlainCompare[e]?(h[e].pattern=m.PlainCompare[e],h[e].plainCompare=!0):h[e].pattern=RegExp("^(?:"+m[e]+")","i")}),y(e.rules,h),e.modes);return u.start=u.markup=i,u.macro=s,u.string=c,e}function n(e){return Object.freeze({lex:t(e).lex,Patterns:m})}"object"===("undefined"==typeof module?"undefined":_typeof(module))?(m=require("./patterns"),module.exports=n(require("./lexer"))):"function"==typeof define&&define.amd?define("markup",["lexer","patterns"],function(e,t){return m=t,n(e)}):this&&this.loaded&&this.modules?(m=this.modules.Patterns,this.modules.Markup=n(this.modules.Lexer)):(m=this.Patterns,this.Markup=n(this.Lexer))}.call(eval("this")||("undefined"!=typeof global?global:window)),!function(){var e;function n(t){return t&&"object"===_typeof(t)?(Object.keys(t).forEach(function(e){t[e]=n(t[e])}),t):(t+"").replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function t(e){return function(){return"("+e+Array.apply(0,arguments).join("|")+")"}}var r=t("?:"),a=t("?!"),o=t("?="),i="[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",s=i.replace("*","+"),c="\\b",l="[\\w\\-\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171\\uD800-\\uDFFF]",u=l.replace("\\-",""),p=r("\\n","$"),d=i+"(\\*+)"+s,f=i+"((?:0\\.)+)"+s,h=i+"-{3,}"+i+p,m=i+"(==+>|<=+|=+><=+|<==+>)"+i+p,p=i+"(=+\\|+|\\|+=+|=+\\|+=+|\\|=+\\|)"+i+p,g={opener:"\\[\\[(?!\\[)",text:"("+function(){return"[^"+Array.apply(0,arguments).map(n).join("")+"]*"}("]")+")",rightSeparator:r("\\->","\\|"),leftSeparator:"<\\-",closer:"\\]\\]",legacySeparator:"\\|",legacyText:"("+r("[^\\|\\]]","\\]"+a("\\]"))+"+)"},y=u+"*"+u.replace("\\w","a-zA-Z")+u+"*",b="\\$("+y+")",v="_("+y+")",w="'s"+s+a("_")+"("+y+")",k="("+y+")"+s+"of"+c+a("it\\b"),S="'s"+s,T=r("it","time","turns?","visits?","exits?","pos")+c,_="its"+s+"("+y+")",x="("+y+")"+s+"of"+s+"it"+c,O="of"+s+"it"+c,A={opener:"\\(",name:"("+r("\\$","_")+"?"+l+"+):"+a("\\/"),closer:"\\)"},C=r("=<","=>","[gl]te?\\b","n?eq\\b","isnot\\b","are\\b","x\\b","isa\\b","or"+s+"a"+c),E="[a-zA-Z][\\w\\-]*",N="(?:\"[^\"]*\"|'[^']*'|[^'\">])*?",j="\\|("+l+"+)(>|\\))",P="(<|\\()("+l+"+)\\|",R="((?:\\b\\d+(?:\\.\\d+)?|\\.\\d+)(?:[eE][+\\-]?\\d+)?)"+a("m?s")+c;g.main=g.opener+r(g.text+g.rightSeparator,g.text.replace("*","*?")+g.leftSeparator)+g.text,e={upperLetter:"[A-Z\\u00c0-\\u00de\\u0150\\u0170]",lowerLetter:"[a-z0-9_\\-\\u00df-\\u00ff\\u0151\\u0171]",anyLetter:l,anyLetterStrict:u,whitespace:s.replace("[","[\\n\\r"),escapedLine:"\\\\\\n\\\\?|\\n\\\\",br:"\\n(?!\\\\)",tag:"<\\/?"+E+N+">",scriptStyleTag:"<("+r("script","style","textarea")+")"+N+">[^]*?<\\/\\1>",scriptStyleTagOpener:"<",url:"("+r("https?","mailto","javascript","ftp","data")+":\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])",bullet:"\\*",hr:h,heading:"[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*(#{1,6})[ \\f\\t\\v\\u00a0\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000]*",align:m,column:p,bulleted:d,numbered:f,verbatimOpener:"`+",hookAppendedFront:"\\["+a("=+"),hookPrependedFront:j+"\\["+a("=+"),hookFront:"\\["+a("=+"),hookBack:"\\]"+a(P),hookAppendedBack:"\\]"+P,unclosedHook:"\\[=+",unclosedHookPrepended:j+"\\[=+",unclosedCollapsed:"\\{=+",passageLink:g.main+g.closer,legacyLink:g.opener+g.legacyText+g.legacySeparator+g.legacyText+g.closer,simpleLink:g.opener+g.legacyText+g.closer,macroFront:A.opener+o(A.name),macroName:A.name,groupingFront:"\\("+a(A.name),twine1Macro:"<<[^>\\s]+\\s*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"|[^'\"\\\\>]|>(?!>))*>>",validPropertyName:y,property:w,belongingProperty:k,possessiveOperator:S,belongingOperator:"of\\b",itsOperator:"its\\b",belongingItOperator:O,variable:b,tempVariable:v,hookName:"\\?("+l+"+)\\b",cssTime:"(\\d+\\.?\\d*|\\d*\\.?\\d+)(m?s)\\b",colour:r(r("Red","Orange","Yellow","Lime","Green","Cyan","Aqua","Blue","Navy","Purple","Fuchsia","Magenta","White","Gray","Grey","Black","Transparent"),"#[\\dA-Fa-f]{3}(?:[\\dA-Fa-f]{3})?"),datatype:r("alnum","alphanumeric","any(?:case)?","array","bool(?:ean)?","changer","codehook","colou?r","const","command","dm","data"+r("map","type","set"),"ds","digit","gradient","empty","even","int"+a("o")+"(?:eger)?","lambda","lowercase","macro","linebreak","newline","num(?:ber)?","odd","str(?:ing)?","uppercase","whitespace")+c,number:R,boolean:r("true","false")+c,identifier:T,itsProperty:_,belongingItProperty:x,escapedStringChar:"\\\\[^\\n]",singleStringOpener:"'",doubleStringOpener:'"',singleStringCloser:"'",doubleStringCloser:'"',is:"is"+a(s+"not"+c,s+"an?"+c,s+"in"+c,s+"<",s+">")+c,isNot:"is"+s+"not"+a(s+r("an?","in")+c)+c,isA:"is"+s+"an?"+c,isNotA:"is"+s+"not"+s+"an?"+c,matches:"matches\\b",doesNotMatch:"does"+s+"not"+s+"match"+c,and:"and\\b",or:"or\\b",not:"not\\b",inequality:"((?:is(?:"+s+"not)?"+i+")*)("+r("<(?!=)","<=",">(?!=)",">=")+")",isIn:"is"+s+"in"+c,contains:"contains\\b",doesNotContain:"does"+s+"not"+s+"contain"+c,isNotIn:"is"+s+"not"+s+"in"+c,addition:n("+")+a("="),subtraction:n("-")+a("=","type"),multiplication:n("*")+a("="),division:r("/","%")+a("="),spread:"\\.\\.\\."+a("\\."),to:r("to\\b","="),into:"into\\b",making:"making\\b",where:"where\\b",when:"when\\b",via:"via\\b",each:"each\\b",augmentedAssign:r("\\+","\\-","\\*","\\/","%")+"=",bind:"2?bind\\b",typeSignature:n("-type")+c,incorrectOperator:C,PlainCompare:{comma:",",commentFront:"\x3c!--",commentBack:"--\x3e",strikeOpener:"~~",italicOpener:"//",boldOpener:"''",supOpener:"^^",strongFront:"**",strongBack:"**",emFront:"*",emBack:"*",collapsedFront:"{",collapsedBack:"}",groupingBack:")"}},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e:"function"==typeof define&&define.amd?define("patterns",[],function(){return e}):this&&this.loaded?(this.modules||(this.modules={}),this.modules.Patterns=e):this.Patterns=e}.call(eval("this")||("undefined"!=typeof global?global:window)),define("twinescript/operations",["utils","utils/operationutils","datatypes/typedvar","datatypes/datatype","internaltypes/twineerror"],function(e,t,n,r,m){var a=e.plural,o=t.isObject,i=t.collectionType,s=t.is,c=t.isA,l=t.clone,u=t.unique,p=t.contains,e=t.matches,g=t.objectName,d=t.toSource;function f(r,a,o,i){return o=o||"do this to",function(e,t){var n;return 1===a.length&&(t=e),(n=m.containsError(e,t))||(_typeof(e)!==r||_typeof(t)!==r?m.create("operation","I can only ".concat(o," ").concat(r,"s, not ").concat(g(_typeof(e)!==r?e:t),"."),i):a(e,t))}}function h(a){return function(e,t){var n,r;return(n=m.containsError(e,t))||(_typeof(e)!==_typeof(t)||o(e)&&"TwineScript_TypeName"in e&&o(t)&&"TwineScript_TypeName"in t&&e.TwineScript_TypeName!==t.TwineScript_TypeName||i(e)!==i(t)?(n="".concat(g(e)," isn't the same type of data as ").concat(g(t)),_typeof(e)+_typeof(t)!=="stringnumber"&&_typeof(e)+_typeof(t)!=="numberstring"||(r="You might want to convert one side to a number using (num:), or to a string using (str:)."),m.create("operation",n[0].toUpperCase()+n.slice(1),r)):a(e,t))}}function y(d,f,e){var h=2<arguments.length&&void 0!==e&&e;return function r(a,o){var e;if(e=m.containsError(a,o))return e;var t=_slicedToArray(a.determiner?[a,o]:o.determiner?[o,a]:[],2),i=t[0],t=t[1];if(i){var n=i,s=n.determiner,n=n.determined;if("start"===s||"end"===s){if(f)return m.create("operation","I can't use '".concat(f,"' with the 'start' or 'end' of ").concat(g(n),"."));if(t.determiner){if("start"===t.determiner||"end"===t.determiner)return m.create("operation","I can't compare one value's 'start' or 'end' with another value's 'start' or 'end'.","Please change one of them to use an exact range, such as '1stto4th' or '2ndlasttolast'.");n=[t,i],i=n[0]}for(var c=i.string||i.array,l=0;l<c.length+1;l+=1){var u=l?"end"===s?c.slice(-l):c.slice(0,l):c.constructor(),u=i===a?r(u,o):r(a,u);if(e=m.containsError(u))return e;if(u!==h)return u}return h}var p="all"===s;return i.array.reduce(function(e,t){var n,t=i===a?r(t,o):r(a,t);return(n=m.containsError(e,t))||(p?e&&t:e||t)},p)}return d(a,o)}}function b(n,e){return y(function(e,t){e=n(e,t);return m.containsError(e)?e:!e},e,!0)}t="If one of these values is a number, you may want to write a check that it 'is not 0'. Also, if one is a string, you may want to write a check that it 'is not \"\" '.",t={and:f("boolean",h(function(e,t){return e&&t}),"use 'and' to join",t),or:f("boolean",h(function(e,t){return e||t}),"use 'or' to join",t),not:f("boolean",function(e){return!e},"use 'not' to invert",t),"+":h(function(e,t){var n;return Array.isArray(e)?[].concat(_toConsumableArray(e),_toConsumableArray(t)):e instanceof Map?(n=new Map(e),t.forEach(function(e,t){return n.set(t,e)}),n):e instanceof Set?new Set([].concat(_toConsumableArray(e),_toConsumableArray(t)).filter(u).map(l)):"function"==typeof e["TwineScript_+"]?e["TwineScript_+"](t):"string|number|boolean".includes(_typeof(e))?e+t:m.create("operation","I can't use + on ".concat(g(e),"."))}),"-":h(function(e,n){var r;return Array.isArray(e)?e.filter(function(t){return!n.some(function(e){return s(t,e)})}):e instanceof Set?(r=_toConsumableArray(n),new Set(_toConsumableArray(e).filter(function(t){return!r.some(function(e){return s(t,e)})}))):"string"==typeof e?e.split(n).join(""):"number"==typeof e?e-n:m.create("operation","I can't use - on ".concat(g(e),"."))}),"*":f("number",h(function(e,t){return e*t}),"multiply"),"/":f("number",h(function(e,t){return 0===t?m.create("operation","I can't divide ".concat(g(e)," by zero.")):e/t}),"divide"),"%":f("number",h(function(e,t){return 0===t?m.create("operation","I can't modulo ".concat(g(e)," by zero.")):e%t}),"modulus"),"<":y(f("number",h(function(e,t){return e<t}),"do < to"),"<"),">":y(f("number",h(function(e,t){return t<e}),"do > to"),">"),"<=":y(f("number",h(function(e,t){return e<=t}),"do <= to"),"<="),">=":y(f("number",h(function(e,t){return t<=e}),"do >= to"),">="),is:y(s),isNot:b(s),contains:y(p,"contains"),doesNotContain:b(p,"does not contain"),isIn:y(function(e,t){return p(t,e)},"is in"),isNotIn:b(function(e,t){return p(t,e)},"is not in"),isA:y(c,"is a"),isNotA:b(c,"is not a"),typifies:y(function(e,t){return c(t,e)}),untypifies:b(function(e,t){return c(t,e)}),matches:y(e),doesNotMatch:b(e),makeSpreader:function(e){var t;return m.containsError(e)?e:n.isPrototypeOf(e)||r.isPrototypeOf(e)?(t=l(e),(n.isPrototypeOf(e)?t.datatype:t).rest=!0,t):{value:e,spreader:!0,TwineScript_TypeName:"a spreaded '...' value",TwineScript_ObjectName:a("string"==typeof e||Array.isArray(e)?_toConsumableArray(e).length:1,"spreaded '...' value"),TwineScript_Unstorable:!0,TwineScript_ToSource:function(){return""+_toConsumableArray(e).map(d)}}}};return Object.freeze(t)}),define("twinescript/runner",["macros","state","utils","utils/operationutils","twinescript/operations","datatypes/colour","datatypes/hookset","datatypes/lambda","datatypes/datatype","datatypes/varbind","datatypes/codehook","datatypes/typedvar","datatypes/assignmentrequest","internaltypes/varref","internaltypes/twineerror"],function(Macros,State,Utils,_ref127,Operations,Colour,HookSet,Lambda,Datatype,VarBind,CodeHook,TypedVar,AssignmentRequest,VarRef,TwineError){var toSource=_ref127.toSource,typeName=_ref127.typeName,objectName=_ref127.objectName,insensitiveName=Utils.insensitiveName,impossible=Utils.impossible,hash=Utils.hash;function addFreeVariable(e,t){var n,r=e.freeVariables;"macro"===t.type?"current-time"===(n=insensitiveName(t.name))||"current-date"===n||"monthday"===n||"weekday"===n||"history"===n||"visited"===n||"passage"===n?e.freeVariables=!0:t.blockedValue&&!r.blockedValues?r.blockedValues=e.stackTop.blockedValues.concat():"random"!==n&&"either"!==n&&"shuffled"!==n||r.seed||(r.seed=State.seed,r.seedIter=State.seedIter):"identifier"===t.type?"time"!==(n=insensitiveName(t.text))&&"exits"!==n&&"it"!==n&&"visits"!==n&&"turns"!==n||(e.freeVariables=!0):"property"===t.type||"belongingProperty"===t.type?"random"!==insensitiveName(t.name)||r.seed||(r.seed=State.seed,r.seedIter=State.seedIter):"variable"!==t.type&&"tempVariable"!==t.type||(e.freeVariables=!0)}var precedenceTable=[["error","text"],["comma"],["to","into"],["where","when","via","making","each"],["typeSignature"],["augmentedAssign"],["and","or"],["is","isNot"],["contains","doesNotContain","isIn","isNotIn"],["isA","isNotA","matches","doesNotMatch"],["inequality"],["addition","subtraction"],["multiplication","division"],{rightAssociative:["spread","bind"]},{rightAssociative:["not","positive","negative"]},{rightAssociative:["belongingProperty","belongingItProperty","belongingOperator","belongingItOperator"]},["property","itsProperty","possessiveOperator","itsOperator"],["twineLink","macro","identifier","variable","tempVariable","hookName","number","cssTime","boolean","string","hook","colour","datatype","root"],["grouping"]];function precedentToken(e,t){var n,r,a,o=[];if(e.length)for("most"===t?(n=precedenceTable.length-1,r=a=-1):(n=0,r=precedenceTable.length,a=1);n!==r;n+=a){var i=precedenceTable[n],s=NaN;if(i.rightAssociative){for(var c=0;c<e.length;c+=1)if(i.rightAssociative.includes(e[c].type)){s=c;break}}else for(var l=e.length-1;0<=l;--l)if(i.includes(e[l].type)){s=l;break}if(!Number.isNaN(s)&&-1<s){o=[e[s],s];break}}return o}var comparisonOpTypes=["inequality","is","isNot","isIn","contains","doesNotContain","isNotIn","isA","typifies","isNotA","untypifies","matches","doesNotMatch"],inequalityNegator={">":"<=","<":">=",">=":"<","<=":">"};function compileComparisonOperator(e){return"inequality"===e.type?e.negate?inequalityNegator[e.operator]:e.operator:e.type}var comparisonReverser={">":"<","<":">",">=":"<=","<=":">=",contains:"isIn",doesNotContain:"isNotIn",isIn:"contains",isA:"typifies",typifies:"isA",isNotA:"untypifies",untypifies:"isNotA"};function reverseComparisonOperator(e){e=compileComparisonOperator(e);return comparisonReverser[e]||e}var tokenSides={error:"neither",identifier:"neither",variable:"neither",tempVariable:"neither",hookName:"neither",number:"neither",boolean:"neither",string:"neither",hook:"neither",colour:"neither",datatype:"neither",root:"neither",twineLink:"neither",macro:"neither",grouping:"neither",itsProperty:"neither",belongingItProperty:"neither",to:"both",into:"both",typeSignature:"both",augmentedAssign:"both",and:"both",or:"both",belongingOperator:"both",possessiveOperator:"both",multiplication:"both",division:"both",spread:"after",bind:"after",not:"after",belongingProperty:"after",each:"after",itsOperator:"after",positive:"after",negative:"after",belongingItOperator:"before",property:"before"};function missingSideError(e,t,n){return TwineError.create("syntax","I need usable code to be ".concat(e?"left ":"").concat(e&&t?"and ":"").concat(t?"right ":"","of ").concat(n.text,"."))}function wrongSideError(e,t,n){return TwineError.create("syntax","There can't be a ".concat(e&&t?e.map(function(e){return e.text}).join("")+" or "+t.map(function(e){return e.text}).join(""):(e||t).map(function(e){return e.text}).join("")," to the ").concat(e?"left ":"").concat(e&&t?"or ":"").concat(t?"right ":"","of ").concat(n.text,"."),"There could be a comma missing between them.")}function makeEvalReplayFrame(e,t){var n=t.val,r=t.fromCode,a=t.toCode,o=t.toDesc,i=t.reason,s=t.it,c=t.tokens,t=t.i;if(!(200<=e.length)){var l=c[t],u=c.slice(0,t),t=c.slice(t+1);if(1===c.length&&(u=t=!1,l=c[0]),!e[e.length-1].error){var p,d,c=TwineError.containsError(n),f=e[e.length-1].code,h=e[0].basis,m=(null!=(p=u)&&p.length&&null!=(p=t)&&p.length&&u[0].start>t[0].start&&(u=(p=[t,u])[0],t=p[1]),p=a||"".concat(null!=(p=u)&&p.length&&"whitespace"===u[u.length-1].type?" ":"").concat(c?" \ud83d\udc1e ":(n&&!n.TwineScript_ToSource&&n.TwineScript_Unstorable?objectName:toSource)(n)).concat(null==(p=t)||!p.length||"whitespace"!==t[0].type&&"addition"!==l.type&&"subtraction"!==l.type?"":" "),(u.length?u[0]:l).start-h),g=(t.length?t[t.length-1]:l).end-h,y=_createForOfIteratorHelper(e);try{for(y.s();!(d=y.n()).done;){var b=d.value;b.start<m?(m+=b.diff,g+=b.diff):b.start<g&&(g+=b.diff)}}catch(e){y.e(e)}finally{y.f()}!r&&(r=f.slice(m,g),a)&&a.trim()===r.trim()||(u=p.length-(g-m),e.push({code:f.slice(0,m)+p+f.slice(g),fromCode:r,toCode:!c&&a,toDesc:!c&&!a&&(o||objectName(n)),start:m,end:g,diff:u,reason:i,itIdentifier:void 0!==s&&objectName(s),error:c&&c.render(f.slice(m,g),!0)}))}}}function setIt(e,t){return(VarRef.isPrototypeOf(t)||TypedVar.isPrototypeOf(t))&&(e.Identifiers.it=t.get()),t}return function run(section,tokens){var isVarRef=2<arguments.length&&void 0!==arguments[2]&&arguments[2],isTypedVar=3<arguments.length&&void 0!==arguments[3]&&arguments[3],evalReplay=section.evalReplay,hasEvalReplay=null==evalReplay?void 0:evalReplay.length,evalReplayReason,evalReplaySkip=!1,evalReplayIt,ops=Operations,token,ret,i,before,after,_precedentToken,_precedentToken2,token,i,before,after;if(Array.isArray(tokens)||(tokens=[tokens]),!tokens.length||!tokens[0])return impossible("Runner.run","No tokens to run!"),0;1===tokens.length?token=tokens[0]:(_precedentToken=precedentToken(tokens,"least"),_precedentToken2=_slicedToArray(_precedentToken,2),token=_precedentToken2[0],i=_precedentToken2[1],before=tokens.slice(0,i),after=tokens.slice(i+1),before.length&&(1!==before.length||"whitespace"!==before[0].type)||(before=!1),after.length&&(1!==after.length||"whitespace"!==after[0].type)||(after=!1));var type=token.type;if(!type)return impossible("Runner.run","Token has no type!"),0;var sides=tokenSides[type]||"",VARREF=("both"!==sides||before&&after?"neither"===sides&&(before||after)?ret=wrongSideError(before,after,token):"before"===sides?before?after&&(ret=wrongSideError(null,after,token)):ret=missingSideError(!0,!1,token):"after"===sides&&(after?before&&(ret=wrongSideError(before,null,token)):ret=missingSideError(!1,!0,token)):ret=missingSideError(!before,!after,token),section.freeVariables&&"object"===_typeof(section.freeVariables)&&addFreeVariable(section,token),!0),TYPEDVAR=!0,_ret4,val,evalReplayReason,ret,source,_source4,_value4,msg;if(!ret){if("comma"===type)return impossible("Section.run","a comma token was run() somehow."),0;if("root"===type)ret=run(section,token.children);else if("identifier"===type)ret=isVarRef?VarRef.create(section.Identifiers,token.text.toLowerCase()):section.Identifiers[token.text.toLowerCase()];else if("variable"===type||"tempVariable"===type){ret=VarRef.create("tempVariable"===type?section.stackTop.tempVariables:State.variables,token.name),isTypedVar?(ret=TypedVar.create(Datatype.create("any"),ret),evalReplayReason=hasEvalReplay&&"Variables in 'to' or 'into' expressions with no -type to their left are considered to be 'any-type' variables that can store any storable value."):isVarRef||TwineError.containsError(ret)?evalReplaySkip=!0:(val=ret.get(),evalReplayReason=hasEvalReplay&&((null==(_ret4=ret)?void 0:_ret4.object)!==State.variables||hasOwnProperty.call(ret.object,ret.compiledPropertyChain[0])?"":"This variable didn't exist; for story-wide $ variables, a default value of 0 is used if they don't exist."),ret=val)}else if("hookName"===type)ret=HookSet.create({type:"name",data:token.name}),evalReplaySkip=!0;else if("number"===type||"cssTime"===type)ret=token.value,evalReplayReason=hasEvalReplay&&"cssTime"===type&&(token.text.endsWith("ms")?"The letters 'ms' at the end of numbers are ignored, so you can use them to indicate that a number represents milliseconds.":"The letter 's' at the end of numbers represents 'seconds'. Harlowe converts them to milliseconds (multiplies them by 1000)."),evalReplaySkip=!evalReplayReason;else if("boolean"===type)ret="true"===token.text.toLowerCase(),evalReplaySkip=!0;else if("string"===type){var t=token.text.replace(/(.?)\n/g,function(e,t){return("\\"===t?"\\\\":"\n"===t?"\\n":t)+"\\n"}).replace(/(\\*)\\0/g,function(e,t){return(t?"\\".repeat(2*t.length):"")+"0"});ret=eval(t),evalReplaySkip=!0}else if("hook"===type)ret=CodeHook.create(token.children,token.text),evalReplaySkip=!0;else if("colour"===type)ret=Colour.create(token.colour),evalReplaySkip=!0;else if("datatype"===type)ret=Datatype.create(token.name),evalReplaySkip=!0;else if("spread"===type)ret=ops.makeSpreader(run(section,after,!1,isTypedVar));else if("bind"===type)ret=VarBind.create(run(section,after,VARREF),token.text.startsWith("2")?"two way":""),evalReplaySkip=!0;else if("to"===type||"into"===type){var dest="to"===type?setIt(section,run(section,before,VARREF,TYPEDVAR)):run(section,after,VARREF,TYPEDVAR);if(TwineError.containsError(dest))ret=dest;else{(VarRef.isPrototypeOf(dest)&&dest.propertyChain.length<=1||TypedVar.isPrototypeOf(dest)&&dest.varRef.propertyChain.length<=1)&&(section.freeVariables=Object.create(null));var src="to"===type?run(section,after,VARREF):setIt(section,run(section,before,VARREF));if(TwineError.containsError(src))return src;var freeVariables=section.freeVariables,srcRef;section.freeVariables=null,token.place&&freeVariables&&"object"===_typeof(freeVariables)&&"boolean"!=typeof src&&"number"!=typeof src&&!Utils.options.uncompressedPureValues&&(srcRef=freeVariables,srcRef.at=token.place,srcRef.from=after[0].start,srcRef.to=after[after.length-1].end,srcRef.hash=hash(after.reduce(function(e,t){return e+t.text},"")).toString(16),JSON.stringify(srcRef).length>=toSource(src).length)&&(srcRef=void 0),ret=AssignmentRequest.create(dest,src,type,srcRef),evalReplaySkip=!0,evalReplayIt=section.Identifiers.it}}else if("typeSignature"===type){var datatype=run(section,before),free=section.freeVariables,variable=(section.freeVariables=null,run(section,after,VARREF));section.freeVariables=free,ret=TypedVar.create(datatype,variable),evalReplaySkip=!0}else if("where"===type||"when"===type||"via"===type){after?(source=tokens.map(function(e){return e.text}).join(""),ret=Lambda.create(before?run(section,before,VARREF):void 0,token.type,after,source),evalReplaySkip=!0):ret=missingSideError(!1,!0,token)}else if("making"===type||"each"===type){after?(_source4=[].concat(tokens).map(function(e){return e.text}).join(""),ret="each"===type?Lambda.create(run(section,after,VARREF),"each",null,_source4):Lambda.create(before?run(section,before,VARREF):void 0,token.type,run(section,after,VARREF),_source4),evalReplaySkip=!0):ret=missingSideError(!1,!0,token)}else if("augmentedAssign"===type)ret=ops.makeAssignmentRequest(run(section,before,VARREF),ops[token.operator](run(section,before),run(section,after)),token.operator),evalReplaySkip=!0;else if("and"===type||"or"===type){var isComparisonOp=function e(t){var n=_slicedToArray(precedentToken(t,"least"),2),r=n[0],n=n[1];if(r&&"whitespace"!==r.type)return comparisonOpTypes.includes(r.type)?r:r.type===type?e(t.slice(0,n))||e(t.slice(n+1)):void 0},leftIsComparison=isComparisonOp(before),rightIsComparison=isComparisonOp(after),ambiguityError=TwineError.create("operation",'This use of "is not" and "'.concat(type,'" is grammatically ambiguous.'),'Maybe try rewriting this as "__ is not __ '.concat(type,' __ is not __"')),operator,getElisionOperands=function e(t){var n,r=_slicedToArray(precedentToken(t,"least"),2),a=r[0],r=r[1];return a&&"whitespace"!==a.type?a.type===type?[].concat(_toConsumableArray(e(t.slice(0,r))),_toConsumableArray(e(t.slice(r+1)))):(a=run(section,t),hasEvalReplay&&"boolean"!=typeof a&&(n=operator.replace(/[A-Z]/g,function(e){return" "+e.toLowerCase()}),makeEvalReplayFrame(evalReplay,{toCode:" it ".concat(n," ").concat(toSource(a)," "),reason:"A missing 'it ".concat(n,"' was inferred to correct the '").concat(type,"' operation."),tokens:t,i:r}),makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(section.Identifiers.it)," ").concat(n," ").concat(toSource(a)," "),tokens:t,i:r})),[{val:a,tokens:t,i:r}]):[]},elidedComparisonOperator=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){var n=t.val,r=t.tokens,t=t.i;return"boolean"==typeof n?n:(e=Operations[token.type](e,Operations[operator](section.Identifiers.it,n)),hasEvalReplay&&makeEvalReplayFrame(evalReplay,{val:e,tokens:r,i:t}),e)},"and"===token.type)},leftSide,evalBefore,operator,rightSide,rightIndex,swappedSides,evalAfter;ret=leftIsComparison&&!rightIsComparison?(leftSide=leftIsComparison,operator=compileComparisonOperator(leftSide),"isNot"===leftSide.type||"isNotA"===leftSide.type||"untypifies"===leftSide.type?ambiguityError:(evalBefore=run(section,before),ops[type](evalBefore,elidedComparisonOperator.apply(void 0,_toConsumableArray(getElisionOperands(after)))))):!leftIsComparison&&rightIsComparison?(rightSide=rightIsComparison,rightIndex=tokens.indexOf(rightSide),operator=reverseComparisonOperator(rightSide),"isNot"===rightSide.type||"isNotA"===rightSide.type||"untypifies"===rightSide.type?ambiguityError:(swappedSides=[].concat(_toConsumableArray(tokens.slice(rightIndex+1)),[Object.assign(Object.create(rightSide),_defineProperty({},"inequality"===rightSide.type?"operator":"type",reverseComparisonOperator(rightSide)))],_toConsumableArray(tokens.slice(i+1,rightIndex))),evalAfter=run(section,swappedSides),ops[type](evalAfter,elidedComparisonOperator.apply(void 0,_toConsumableArray(getElisionOperands(before)))))):ops[type](run(section,before),run(section,after))}else if(comparisonOpTypes.includes(type)){after||missingSideError(!1,!0,token);var leftOp=before?run(section,before):section.Identifiers.it;ret=ops[compileComparisonOperator(token)](leftOp,run(section,after)),section.Identifiers.it=leftOp,evalReplayIt=leftOp,evalReplayReason=hasEvalReplay&&!before&&"A missing 'it' was inferred to complete the operation."}else if("addition"===type||"subtraction"===type){after||missingSideError(!1,!0,token);var convert=!before,_precedentToken7,_precedentToken8,previousPrecedentToken,_i10,_sides,pType,convert;before&&(_precedentToken7=precedentToken(before,"least"),_precedentToken8=_slicedToArray(_precedentToken7,2),previousPrecedentToken=_precedentToken8[0],_i10=_precedentToken8[1],_sides=tokenSides[previousPrecedentToken.type],pType=previousPrecedentToken.type,convert=("both"===_sides||"after"===_sides||"addition"===pType||"subtraction"===pType)&&(_i10===before.length-1||_i10===before.length-2&&"whitespace"===before[before.length-1].type)),convert?(token.type="addition"===type?"positive":"negative",ret=run(section,tokens),token.type=type,evalReplaySkip=!0):ret=ops[token.text](run(section,before),run(section,after))}else if("multiplication"===type||"division"===type)ret=ops[token.text](run(section,before),run(section,after));else if("positive"===type||"negative"===type)ret=ops["*"]("negative"===type?-1:1,run(section,after)),evalReplaySkip=!0;else if("not"===type)ret=ops.not(run(section,after));else if("belongingProperty"===type){var container=run(section,after,isVarRef),isRef=(ret=VarRef.create(container,token.name),isVarRef||TwineError.containsError(ret));ret=isRef?ret:ret.get(),isRef=isVarRef||TwineError.containsError(ret),hasEvalReplay&&!isRef?makeEvalReplayFrame(evalReplay,{toCode:" ".concat(token.name," of ").concat(toSource(VarRef.isPrototypeOf(container)?container.get():container)," "),tokens:tokens,i:i}):isRef||(evalReplayReason="The value to the right of 'of', ".concat(typeName(container),', had a "').concat(token.name,'" data name corresponding to that data value.'))}else if("belongingOperator"===type||"belongingItOperator"===type){var value=run(section,before);"random"===value&&section.freeVariables&&"object"===_typeof(section.freeVariables)&&!section.freeVariables.seed&&(section.freeVariables.seed=State.seed,section.freeVariables.seedIter=State.seedIter),ret=VarRef.create("belongingItOperator"===type?section.Identifiers.it:run(section,after,isVarRef),{computed:!0,value:value}),ret=isVarRef||TwineError.containsError(ret)?ret:ret.get(),"belongingItOperator"===type&&hasEvalReplay&&makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(value)," of ").concat(toSource(section.Identifiers.it)," "),tokens:tokens,i:i})}else if("property"===type){var _container=run(section,before,VARREF),_isRef=(ret=VarRef.create(_container,token.name),isVarRef||TwineError.containsError(ret));ret=_isRef?ret:ret.get(),_isRef=isVarRef||TwineError.containsError(ret),hasEvalReplay&&VarRef.isPrototypeOf(_container)&&!_isRef?makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(_container.get()),"'s ").concat(token.name," "),tokens:tokens,i:i}):_isRef||(evalReplayReason="The value to the left of 's, ".concat(typeName(_container),', had a "').concat(token.name,'" data name corresponding to that data value.'))}else if("itsProperty"===type||"belongingItProperty"===type)ret=VarRef.create(section.Identifiers.it,token.name),ret=isVarRef||TwineError.containsError(ret)?ret:ret.get(),hasEvalReplay&&makeEvalReplayFrame(evalReplay,{toCode:"itsProperty"===type?" ".concat(toSource(section.Identifiers.it),"'s ").concat(token.name," "):" ".concat(token.name," of ").concat(toSource(section.Identifiers.it)," "),tokens:tokens,i:i});else if("possessiveOperator"===type||"itsOperator"===type){!after||!before&&"itsOperator"!==token.type?ret=missingSideError(!before,!after,token):(_value4=run(section,after),"random"===_value4&&section.freeVariables&&"object"===_typeof(section.freeVariables)&&!section.freeVariables.seed&&(section.freeVariables.seed=State.seed,section.freeVariables.seedIter=State.seedIter),ret=VarRef.create("itsOperator"===token.type?section.Identifiers.it:run(section,before,isVarRef),{computed:!0,value:_value4}),ret=isVarRef||TwineError.containsError(ret)?ret:ret.get(),"itsOperator"===type&&hasEvalReplay&&makeEvalReplayFrame(evalReplay,{toCode:" ".concat(toSource(section.Identifiers.it),"'s ").concat(toSource(_value4)," "),tokens:tokens,i:i}))}else if("twineLink"===type)ret=Macros.run("link-goto",section,[token.innerText,token.passage]),evalReplayReason=hasEvalReplay&&"Passage links are the same as (link-goto:) macro calls.";else if("macro"===type)if(token.blockedValue&&!section.blocked){if(ret=section.blockedValue(),void 0===ret)return impossible("Runner.run","section.blockedValue() returned undefined"),0}else{var macroNameToken=token.children[0],variableCall="$"===macroNameToken.text[0]||"_"===macroNameToken.text[0],macroRef;if("macroName"!==macroNameToken.type&&!variableCall)return impossible("Runner.run","macro token had no macroName child token"),0;variableCall?(macroRef=VarRef.create("_"===macroNameToken.text[0]?section.stackTop.tempVariables:State.variables,macroNameToken.text.trim().slice(1,-1)),TwineError.containsError(macroRef)||(macroRef=macroRef.get())):macroRef=token.name,ret=Macros[variableCall?"runCustom":"run"](macroRef,section,token.children.slice(1).reduce(function(e,t){return"comma"===t.type?e.push([]):e[e.length-1].push(t),e},[[]]).filter(function(e){return e.length&&(1<e.length||"whitespace"!==e[0].type)}).map(function(e){return run(section,e,!1,isTypedVar)})),evalReplayReason=hasEvalReplay&&variableCall&&"I called ".concat(objectName(macroRef),".")}else if("grouping"===type)ret=run(section,token.children,isVarRef),evalReplaySkip=!0;else if("error"===type)ret=TwineError.create("syntax",token.message,token.explanation||"");else{if("text"!==type)return impossible("Section.run","unknown syntax token type: ".concat(type,"!!")),0;token.text.trim().match(/^\d+(?:th|nd|st|rd)(?:last)?(?:to\d+(?:nth|nd|st|rd)(?:last)?)?$/g)&&(msg='Position data names like "'.concat(token.text,'" need to be either left of "of" or right of "\'s".')),ret=TwineError.create("syntax",msg||'"'.concat(token.text,"\" isn't valid Harlowe syntax for the inside of a macro call."),"Maybe you misspelled something? Also, as of 3.3.0, Javascript syntax is not allowed inside macro calls.")}}return void 0===ret?(impossible("Section.run","token ".concat(type).concat(token.name?" (".concat(token.name,":)"):""," produced undefined")),0):ret===section?(impossible("Section.run","token ".concat(type).concat(token.name?" (".concat(token.name,":)"):""," produced the section")),0):(hasEvalReplay&&!evalReplaySkip&&makeEvalReplayFrame(evalReplay,{val:ret,reason:evalReplayReason,it:evalReplayIt,tokens:tokens,i:i}),ret)}}),define("utils/jqueryplugins",["jquery"],function(e){e.prototype.extend({popAttr:function(e){var t=this.attr(e);return this.removeAttr(e),t},popData:function(e){var t=this.data(e);return this.removeData(e),t},tag:function(){return this[0]&&this[0].tagName&&this[0].tagName.toLowerCase()},textNodes:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*";return 1===this.length&&this[0]&&this[0].nodeType===Node.TEXT_NODE?[this[0]]:this.get().concat(this.contents().get(),this.find(e).contents().get()).filter(function(e,t,n){return(null==e?void 0:e.nodeType)===Node.TEXT_NODE&&n.indexOf(e)===t}).sort(function(e,t){return 2&e.compareDocumentPosition(t)?1:-1})},findAndFilter:function(e){var t=this.find(e),e=this.filter(e);return e.length?t.add(e):t}})}),define("utils/naturalsort",[],function(){return function(h){var m=1<arguments.length&&void 0!==arguments[1]?arguments[1]:String;return function(e,t){var n,r,a,o,i=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,s=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[/-]\d{1,4}[/-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,c=/^0x[0-9a-f]+$/i,l=/^0/,e=m(e).trim(),t=m(t).trim(),u=e.replace(i,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),p=t.replace(i,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),i=parseInt(e.match(c))||1!==u.length&&e.match(s)&&Date.parse(e),e=parseInt(t.match(c))||i&&t.match(s)&&Date.parse(t)||null;if(h&&window.Intl&&window.Intl.Collator&&(a=window.Intl.Collator(h)),e){if(i<e)return-1;if(e<i)return 1}for(var d=0,f=Math.max(u.length,p.length);d<f;d++){if(n=!(u[d]||"").match(l)&&parseFloat(u[d])||u[d]||0,r=!(p[d]||"").match(l)&&parseFloat(p[d])||p[d]||0,isNaN(n)!==isNaN(r))return isNaN(n)?1:-1;if(_typeof(n)!==_typeof(r))n+="",r+="";else if("string"==typeof n&&a&&0!==(o=a.compare(n,r)))return o;if(n<r)return-1;if(r<n)return 1}return 0}}}),define("utils/operationutils",["utils/naturalsort","utils","internaltypes/twineerror","patterns"],function(f,e,h,t){var m=e.impossible,g=e.nth,u=e.permutations,s=e.plural,y=t.validPropertyName,r="object",n="boolean",b="string",v="number",w="function";function a(e){return!!e&&(_typeof(e)===r||_typeof(e)===w)}var k=Array.isArray;function S(e){return e&&Object.getPrototypeOf(e)===Object.prototype}function i(e){return k(e)?"array":e instanceof Map?"datamap":e instanceof Set?"dataset":_typeof(e)===b?b:e&&_typeof(e)===r?r:""}function c(e){if(a(e)){if(_typeof(e.TwineScript_Clone)===w)return e.TwineScript_Clone();if(k(e))return _toConsumableArray(e);if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(_typeof(e)===w)return Object.assign(e.bind(),e);switch(Object.getPrototypeOf(e)){case Object.prototype:return _objectSpread({},e);case null:return Object.assign(Object.create(null),e)}m("OperationUtils.clone","The value "+e+" cannot be cloned!")}return e}function o(e,t,n,r){for(var a="",o=0;a.length<=t&&o<e.length;){var i=r(e[o]);if(!(i.length+a.length<=t)){a+=(0<o?" and ":"")+s(e.length-o,(0<o?"other ":"")+n);break}a+=(0<o&&o===e.length-1?" and ":"")+i+(o<e.length-1?", ":""),o+=1}return a}function l(e){var t;return a(e)&&"TwineScript_ObjectName"in e?e.TwineScript_ObjectName:k(e)?0===e.length?"an empty array":"an array (with "+o(e,48,"item",l)+")":e instanceof Map?0===e.size?"an empty datamap":"a datamap (with "+o(_toConsumableArray(e.keys()),48,"dataname",_)+")":e instanceof Set?0===e.size?"an empty dataset":"a dataset (with "+o(_toConsumableArray(e.values()),48,"item",l)+")":_typeof(e)===b?0===e.length?"an empty string":48<(t=_toConsumableArray(e)).length?"a ".concat(t.length,"-character string starting with ").concat(JSON.stringify(t.slice(0,48).join(""))):"the string ".concat(JSON.stringify(e)):_typeof(e)===n?"the boolean value '"+e+"'":_typeof(e)===v?"the number "+JSON.stringify(e):void 0===e?"an empty variable":"...whatever this is"}function T(e,t){return[e[0],t[0]].sort(f("en"))[0]===e[0]?-1:1}function _(e,t){var n=h.containsError(e);if(n&&m("toSource","received a TwineError: "+n.message),_typeof(e.TwineScript_ToSource)===w)return e.TwineScript_ToSource();if(S(e)&&"first"in e&&"last"in e)return(e.first<0?(-1!==e.first?g(-e.first):"")+"last":g(e.first+1))+"to"+(e.last<0?(-1!==e.last?g(-e.last):"")+"last":g(e.last+1));if(k(e)){var r,a="",o=_createForOfIteratorHelper(e);try{for(o.s();!(r=o.n()).done;)var i=r.value,a=(a+=a?",":"(a:")+("property"===t?i+(0<i):_(i))}catch(e){o.e(e)}finally{o.f()}return a+(a?")":"(a:)")}if(e instanceof Map){var s,c="",l=_createForOfIteratorHelper(Array.from(e.entries()).sort(T));try{for(l.s();!(s=l.n()).done;){var u=_slicedToArray(s.value,2),p=u[0],d=u[1];c+=(c?",":"(dm:")+_(p)+","+_(d)}}catch(e){l.e(e)}finally{l.f()}return c+(c?")":"(dm:)")}return e instanceof Set?"(ds:"+Array.from(e).sort(f("en")).map(_)+")":_typeof(e)===v&&"property"===t?e<0?-1===e?"last":g(-e)+"last":g(e+1):_typeof(e)===b&&"property"===t?RegExp(y).test(e)?e:"("+JSON.stringify(e)+")":JSON.stringify(e)}function p(t,n){return _typeof(t)!==r&&_typeof(n)!==r?t===n:k(t)&&k(n)?t.length===n.length&&t.every(function(e,t){return p(n[t],e)}):t instanceof Map&&n instanceof Map?p(Array.from(t.entries()).sort(),Array.from(n.entries()).sort()):t instanceof Set&&n instanceof Set?p(_toConsumableArray(t),_toConsumableArray(n)):t&&_typeof(t.TwineScript_is)===w?t.TwineScript_is(n):t&&_typeof(t)===r&&n&&_typeof(n)===r&&S(t)&&S(n)?p(Object.getOwnPropertyNames(t).map(function(e){return[e,t[e]]}),Object.getOwnPropertyNames(n).map(function(e){return[e,n[e]]})):Object.is(t,n)}return Object.freeze({isObject:a,isValidDatamapName:function(e,t){var n;return e instanceof Map||m("isValidDatamapName","called with non-Map"),h.containsError(t)?t:_typeof(t)!==b&&_typeof(t)!==v?h.create("property","Only strings and numbers can be used as data names for "+l(e)+", not "+l(t)+"."):(n=_typeof(t)===b?+t:""+t,!(!Number.isNaN(n)&&e.has(n))||h.create("property","You mustn't use both "+l(t)+" and "+l(n)+" as data names in the same datamap."))},collectionType:i,isSequential:function(e){return _typeof(e)===b||k(e)||_typeof(e.hooks)===w},unstorableValue:function e(t){return(null==t?void 0:t.TwineScript_Unstorable)&&t||k(t)&&t.find(e)||t instanceof Map&&_toConsumableArray(t.values()).find(e)||t instanceof Set&&_toConsumableArray(t).find(e)},isHarloweJSValue:function e(t){return _typeof(t)===b||_typeof(t)===n||_typeof(t)===v&&!Number.isNaN(t)&&Math.abs(t)!==1/0||Array.isArray(t)&&t.every(e)||t instanceof Set&&_toConsumableArray(t).every(e)||t instanceof Map&&_toConsumableArray(t.values()).every(e)&&_toConsumableArray(t.keys()).every(function(e){return _typeof(e)===b})},clone:c,objectName:l,typeName:function e(t){var n,r=S(t);return r&&t.innerType?t.typeName||("insensitive set"===t.pattern?"a case-insensitive string name":"either"===t.pattern?(k(t.innerType)||m("typeName",'"either" pattern had non-array inner type'),t.innerType.map(e).join(" or ")):"optional"===t.pattern?"(optional) "+e(t.innerType):e(t.innerType)):r&&"range"===t.pattern?t.name||(r=t.min,n=t.max,"a"+(0<r?" positive":"")+(t.integer?" whole":"")+" number"+(0===r?" between 0 and "+n:n<1/0?" up to "+n:"")):t===String||t===Number||t===Boolean?"a "+_typeof(t()):t===parseInt?"a whole number":t===Map?"a datamap":t===Set?"a dataset":t===Array?"an array":a(t)&&"TwineScript_TypeName"in t?t.TwineScript_TypeName:l(t)},typeID:function(e){var t=_typeof(e);return[n,b,v].includes(t)?t:k(e)?"array":e instanceof Map?"datamap":e instanceof Set?"dataset":e.TwineScript_TypeID||""},toSource:_,is:p,contains:function(e,t){if(e||""===e){if(_typeof(e)===b)return _typeof(t)!==b?h.create("operation",l(e)+" can only contain strings, not "+l(t)+"."):e.includes(t);if(k(e))return e.some(function(e){return p(e,t)});if(e instanceof Set||e instanceof Map)return Array.from(e.keys()).some(function(e){return p(e,t)})}return h.create("operation",l(e)+" cannot contain any values, let alone "+l(t))},isA:function(e,t){return _typeof(t.TwineScript_IsTypeOf)===w?t.TwineScript_IsTypeOf(e):h.create("operation",'"is a" should only be used to compare type names, not '+l(t)+".")},matches:function t(n,e){var r=!1;if(n&&_typeof(n.TwineScript_IsTypeOf)===w){var a=n.TwineScript_IsTypeOf(e);if(h.containsError(a))return a;r|=a}if(e&&_typeof(e.TwineScript_IsTypeOf)===w){if(a=e.TwineScript_IsTypeOf(n),h.containsError(a))return a;r|=a}if(r)return!0;if(k(n)&&k(e)){for(var o=0,i=0,s=!0;s&&o<n.length&&i<e.length;){var c=n[o],l=e[i];if(c.rest){for(;i<e.length&&t(c,l);)l=e[i+=1];o+=1}else if(l.rest){for(;o<n.length&&t(c,l);)c=n[o+=1];i+=1}else t(c,l)?(o+=1,i+=1):s=!1}return s&&o>=n.length&&i>=e.length}return n instanceof Map&&e instanceof Map?t(Array.from(n.entries()).sort(),Array.from(e.entries()).sort()):n instanceof Set&&e instanceof Set?(n=_toConsumableArray(n),u.apply(void 0,_toConsumableArray(e)).some(function(e){return t(n,e)})):p(n,e)},subset:function e(t,n,r){var a,o;return n&&r?((a=_typeof(t)===b)&&(t=Array.from(t)),n<0&&(n=Math.max(0,t.length+n+1)),(r=r<0?Math.max(0,t.length+r+1):r)<n?e(arguments[0],r,n):(o=t.slice(0<n?n-1:n,r).map(c),a?o.join(""):o)):h.create("macrocall","The sub"+i(t)+" index value must not be "+(n&&r)+".")},range:function e(t,n){if(n<t)return e(n,t);var r=[t];for(n-=t;0<n--;)r.push(++t);return r},printBuiltinValue:function r(e){return h.containsError(e)?e:e&&_typeof(e.TwineScript_Print)===w?e.TwineScript_Print():e instanceof Map?(e=Array.from(e.entries()),h.containsError(e)?e:e.reduce(function(e,t){var n=(t=_slicedToArray(t,2))[0],t=t[1];return e+"<tr><td>`"+r(n)+"`</td><td>`"+r(t)+"`</td></tr>"},"<table class=datamap>")+"</table>"):e instanceof Set?Array.from(e.values()).map(r)+"":k(e)?e.map(r)+"":e&&_typeof(e.jquery)===b?e:a(e)?h.create("unimplemented","I don't know how to print this value yet."):e+""},unique:function(t,e,n){return n.findIndex(function(e){return p(t,e)})===e}})}),define("utils/polyfills",[],function(){var o=Array.prototype;"function"!=typeof o.includes&&(o.includes=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(!Number.isNaN(e)&&Number.isFinite(t)&&void 0!==e)return-1<o.indexOf.call(this,e,t);var n=Object(this),r=parseInt(n.length);if(!(r<=0))for(var a=0<=t?t:Math.max(0,r+t);a<r;){if(Object.is(e,n[a]))return!0;a+=1}return!1}),window.Symbol||(window.Symbol={iterator:"_es6-shim iterator_"})}),define("utils/renderutils",["jquery","utils","renderer"],function(l,u,p){var n=RegExp(u.realWhitespace+"+"),s=RegExp(u.realWhitespace+"+","g");function d(e,t,n){var r,a=e.textContent.length;if(!(a<=t))return r=[e=0===t?e:e.splitText(t)],n&&(n=n<=0?a-n:n)<a&&r.push(e.splitText(n-t)),r}var t,c=function(){var e;return void 0!==t?t:(e=l("<p>"),t=!!e[0].normalize&&(e.append(document.createTextNode("0-"),document.createTextNode("2"),document.createTextNode(""))[0].normalize(),1===e.contents().length))};var f="tw-collapsed,[collapsing=true]";var o=/^(=*)([^=]+)=*$/;return Object.freeze({dialog:function(){var e,t=(c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).section,n=void 0===(n=c.parent)?u.storyElement:n,r=c.cd,a=void 0===(a=c.message)?"":a,o=c.defaultValue,i=void 0===(c=c.buttons)?[{name:"OK",confirm:!0,callback:Object}]:c,s=("a code hook"===a.TwineScript_TypeName&&(a=a.code),l("<tw-backdrop><tw-dialog>"+(o||""===o?"<input type=text style='display:block;margin:0 auto'></input>\n":"")+"<tw-dialog-links>"+(i.length?i.reduce(function(e,t,n){t=t.name;return e+"<tw-link style='margin:0 "+(n===i.length-1?"0 0 0.5em":0===n?"0.5em 0 0":"0.5em")+"' tabindex=0>"+t+"</tw-link>"},""):"<tw-link tabindex=0>"+i[0].name+"</tw-link>")+"</tw-dialog-links></tw-dialog></tw-backdrop>")),c=s.find("tw-dialog");return n.append(s),t?(t.renderInto(a,c,_objectSpread(_objectSpread({},r),{},{append:"prepend"})),null!=(n=(null==r?void 0:r.transition)&&s.find("tw-dialog > tw-transition-container"))&&n.length&&n.appendTo(s).append(c.prepend(n.contents().detach()))):c.prepend(p.exec(a)),o&&((e=s.find("input").last()).val(o).on("keypress",function(e){13===e.which&&(s.remove(),i.filter(function(e){return e.confirm}).forEach(function(e){return e.callback()}))}),setTimeout(function(){return e.focus()},100)),i.reverse().forEach(function(e,t){l(s.find("tw-link").get(-t-1)).on("click",function(){u.options.debug&&u.options.ignoreClickEvents&&!l(s).is(".eval-replay, .harlowe-crash")||(s.remove(),e.callback())})}),s},realWhitespace:n,textNodeToChars:function(r){var e=_toConsumableArray(r.textContent);return 1===e.length?[r]:e.reduce(function(e,t){return t.match(n)&&e.length&&e[e.length-1].match(n)?e[e.length-1]+=t:e.push(t),e},[]).reduce(function(e,t){var n=r;return t.length<r.textContent.length&&(r=r.splitText(t.length)),e.concat(n)},[])},findTextInNodes:function e(t,n){var r=[],a="",o=[];if(!t.length||!n)return o;for(;0<t.length;){r.push(t[0]),a+=t[0].textContent,t.shift();var i=a.indexOf(n);if(-1<i){for(var s=a.length-(i+n.length);i>=r[0].textContent.length;)i-=r[0].textContent.length,r.shift();if(1===r.length){var c=d(r[0],i,i+n.length);o.push(c[0]),c[1]&&t.unshift(c[1]);break}o.push(d(r[0],i,r[0].length)[0]),o.push.apply(o,_toConsumableArray(r.slice(1,-1))),c=d(r[r.length-1],0,r[r.length-1].textContent.length-s),o.push(c[0]),c[1]&&t.unshift(c[1]),o=o.filter(Boolean);break}}return[o].concat(_toConsumableArray(e(t,n)))},collapse:function(e){function n(e){return 0===l(this||e).parentsUntil(f).filter("tw-verbatim, tw-expression, [collapsing=false]").length}var t=function e(t){var n=t[0],r=t.parent();return!r.length||t.findAndFilter("tw-story").length?null:(t=(t=r.textNodes().filter(function(e){return 4&(e=e.compareDocumentPosition(n))&&!(8&e)}))[t.length-1])||e(r)}(e),r=(l(t).parents(f).length||(t=null),function e(t){var n=t[0],r=t.parent();return!r.length||t.findAndFilter("tw-story").length?null:r.textNodes().filter(function(e){return 2&(e=e.compareDocumentPosition(n))&&!(8&e)})[0]||e(r)}(e)),a=(l(r).parents(f).length||(r=null),"br:not([data-raw]),tw-consecutive-br:not([data-raw])"),o=(e.find(a).filter(n).replaceWith(document.createTextNode(" ")),(e=l(e.get().map(function(e){return l(e).filter(n).is(a)?l(document.createTextNode(" ")).replaceAll(e)[0]:e}))).textNodes()),i=0;o.reduce(function(e,t){return n(t)?(t.textContent=t.textContent.replace(s," ")," "!==t.textContent[0]||e&&e.textContent&&!(-1<e.textContent.search(/\s$/))||(t.textContent=t.textContent.slice(1)),t):document.createTextNode("A")},t),_toConsumableArray(o).reverse().every(function(e){return!(!n(e)||(e.textContent.match(/^\s*$/)?(i+=e.textContent.length,e.textContent=""):(e.textContent=e.textContent.replace(/\s+$/,function(e){return i+=e.length,""}),1)))}),0<i&&r&&(o[o.length-1].textContent+=" "),e[0]&&c()&&e[0].normalize()},geomStringRegExp:o,geomParse:function(e){var t,n,r,a;return!e||(t=e.length,n=(a=_slicedToArray(o.exec(e)||[],3))[0],r=a[1],a=a[2],!n)||a===e&&1<a.length?{marginLeft:0,size:0}:{marginLeft:r.length/t*100,size:a.length/t*100}}})}),define("utils/scripttag",["state","utils/operationutils","internaltypes/varref","internaltypes/twineerror"],function(a,o,i,s){return function(e,r){Function("script","scope","with(scope){var scope=void 0,arguments=void 0;eval([script,script=void 0][0]);}")(e,Object.create(null,Object.keys(a.variables).map(function(e){return!e.startsWith("TwineScript_")&&"$"+e}).concat(Object.keys(r).map(function(e){return!e.startsWith("TwineScript_")&&"_"+e})).reduce(function(e,n){return n&&(e[n]={get:function(){var e=("$"===n[0]?a.variables:r)[n.slice(1)];if(o.isHarloweJSValue(e))return o.clone(e);throw s.create("","The contents of the variable ".concat(n,", ").concat(o.objectName(e),", couldn't be converted to a Javascript value."),"Only booleans, strings, numbers, datamaps, datasets and arrays can be converted to Javascript values.")},set:function(e){var t="$"===n[0]?a.variables:r;if(!o.isHarloweJSValue(e))throw s.create("","The Javascript value, ".concat(e,", couldn't be converted to a Harlowe value and assigned to the variable ").concat(n,"."),"Only booleans, strings, numbers (except NaN and Infinity), Maps, Sets and Arrays can be converted to Harlowe values.");e=o.clone(e);t=i.create(t,n.slice(1)).set(e);if(s.containsError(t))throw t}}),e},{})))}}),!function(){function e(t,n,r){return function(e){return"background-color: hsla(".concat(t,",").concat(n,"%,").concat(r,"%,").concat(e,");")}}var t={boolean:"color:hsla(0,0%,30%,1.0)",array:"color:hsla(0,100%,30%,1.0)",dataset:"color:hsla(30,100%,40%,1.0)",number:"color:hsla(30,100%,30%,1.0)",datamap:"color:hsla(60,100%,30%,1.0)",changer:"color:hsla(90,100%,30%,1.0)",lambda:"color:hsla(120,100%,40%,1.0)",hookName:"color:hsla(160,100%,30%,1.0)",string:"color:hsla(180,100%,30%,1.0)",identifier:"color:hsla(200,80%,40%,1.0)",variable:"color:hsla(200,100%,30%,1.0)",tempVariable:"color:hsla(200,70%,20%,1.0)",datatype:"color:hsla(220,100%,30%,1.0)",colour:"color:hsla(280,100%,30%,1.0)",macro:"color:hsla(320,80%,30%,1.0)",twineLink:"color:hsla(240,100%,20%,1.0)"},o=(t.gradient=t.colour,t.command=t.twineLink,t.instant=t.metadata=t.any=t.customMacro=t.macro,Math.min),n=e(40,100,50),r=e(220,100,50),i=/hsla\((\d+),\s*(\d+)%,\s*(\d+)%,\s*(\d+\.\d+)\)/g,s="cm-harlowe-3-",a=(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(n={root:"box-sizing:border-box;",hook:n(.05),"hook-2":n(.1),"hook-3":n(.15),"hook-4":n(.2),"hook-5":n(.25),"hook-6":n(.3),"hook-7":n(.35),"hook-8":n(.4),"^=hook , ^=hook-":"font-weight:bold;",unclosedHook:n(.05)+"font-weight:bold;"},"error:not([class*='"+s+"string'])","background-color: hsla(17,100%,50%,0.5) !important;"),"^=macroName","font-style:italic;"),"macroName-boolean",t.boolean),"macroName-array",t.array),"macroName-dataset",t.dataset),"macroName-datatype",t.datatype),"macroName-number",t.number),"macroName-datamap",t.datamap),"macroName-changer",t.changer),"macroName-string",t.string),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(n,"macroName-colour, macroName-gradient",t.colour),"macroName-command, macroName-instant, macroName-metadata",t.command),"macroName-custommacro, macroName-macro, macroName-any",t.macro),"^=macro ","font-weight:bold;"+t.macro),"comma, spread",t.macro),"addition",t.any),"subtraction, multiplication, division",t.number),"is, and, or, not, isNot, contains, doesNotContain, isIn, isA, isNotA, isNotIn, matches, doesNotMatch",t.boolean),"bold, strong","font-weight:bold;"),"italic, em","font-style:italic;"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(n,"sup","vertical-align: super;font-size:0.8em;"),"strike","text-decoration: line-through;"),"verbatim","background-color: hsla(0,0%,50%,0.1);font:var(--font-monospaced)"),"^=bold, ^=strong, ^=italic, ^=em, ^=sup, ^=verbatim, ^=strike","font-weight:100; color: hsla(0,0%,0%,0.5)"),"^=collapsed","font-weight:bold; color: hsla(201,100%,30%,1.0);"),"unclosedCollapsed",r(.025)+"font-weight:bold; color: hsla(201,100%,30%,1.0);"),"collapsed",r(.025)),"collapsed.hook",r(.05)),"collapsed.hook-2",r(.1)),"collapsed.hook-3",r(.15)),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(n,"collapsed.hook-4",r(.2)),"collapsed.hook-5",r(.25)),"collapsed.hook-6",r(.3)),"collapsed.hook-7",r(.35)),"collapsed.hook-8",r(.4)),"twineLink:not(.text)",t.twineLink),"tag, scriptStyleTag, comment","color: hsla(240,34%,25%,1.0);"),"boolean",t.boolean),"string",t.string),"number",t.number),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(n,"variable",t.variable),"tempVariable",t.tempVariable),"hookName",t.hookName),"datatype",t.datatype),"colour",t.colour),"cssTime",t.number),"passageString",t.variable+";text-decoration:underline 1px;"),"tagString",t.variable+";text-decoration:underline 1px dotted;"),"variableOccurrence, hookOccurrence","background: hsla(159,50%,75%,1.0) !important;"),"^=where, ^=via, ^=with, ^=making, ^=each, ^=when",t.lambda+"; font-style:italic;"),_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(n,"heading","font-weight:bold;"),"hr","background-image: linear-gradient(0deg, transparent, transparent 45%, hsla(0,0%,75%,1.0) 45%, transparent 55%, transparent);"),"align","color: hsla(14,99%,37%,1.0); background-color: hsla(14,99%,87%,0.1);"),"column","color: hsla(204,99%,37%,1.0); background-color: hsla(204,99%,87%,0.1);"),"escapedLine","font-weight:bold; color: hsla(51,100%,30%,1.0);"),"identifier, property, belongingProperty, itsProperty, belongingItProperty, belongingItOperator, possessiveOperator, belongingOperator",t.identifier),"toString",function(){var a=this;return Object.keys(this).reduce(function(e,n){var r;return"toString"!==n&&(r=n.split(", ").map(function e(t){return-1<t.indexOf(".")?t.split(/\./g).map(e).join(""):0===t.indexOf("^=")?"[class^='"+s+t.slice(2)+"']":"."+s+t}),e+=r.join(", ")+"{"+a[n]+"}",a[n].match(i))&&[".theme-dark","[data-app-theme=dark]"].forEach(function(t){e+=r.map(function(e){return t+" "+e}).join(", ")+"{"+a[n].replace(i,function(e,t,n,r,a){return"hsla("+t+","+o(100,1.5*+n)+"%,"+(100-r)+"%,"+a+")"})+"}"}),e},"")})+"");"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports={Colours:t,CSS:a,versionClass:s}:"function"==typeof define&&define.amd&&define("utils/typecolours",[],function(){return{Colours:t,CSS:a,versionClass:s}})}.call(void 0);
;require("harlowe")}());
</script>

</body>
</html>
